<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JustHodl.AI | Treasury Auction Monitor</title>
<script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{--bg0:#060a12;--bg1:#0b0f1a;--bg2:#111827;--bg3:#1a2035;--bg4:#232b42;--brd:#1e2a45;--brd2:#2d3a5c;--t1:#e2e8f0;--t2:#94a3b8;--t3:#64748b;--green:#10b981;--red:#ef4444;--blue:#3b82f6;--yellow:#f59e0b;--orange:#f97316;--purple:#a78bfa;--cyan:#22d3ee;--pink:#ec4899;--gold:#fbbf24}
*{margin:0;padding:0;box-sizing:border-box}
body{background:var(--bg0);color:var(--t1);font-family:'DM Sans',sans-serif;min-height:100vh;padding-bottom:40px}
.mono{font-family:'JetBrains Mono',monospace}
a{color:var(--cyan);text-decoration:none}
.topbar{background:linear-gradient(180deg,var(--bg1) 0%,rgba(11,15,26,.95) 100%);border-bottom:1px solid var(--brd);padding:12px 24px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;backdrop-filter:blur(12px)}
.logo{font-size:18px;font-weight:700;letter-spacing:-0.5px}
.logo .hl{color:var(--gold)}
.logo sub{color:var(--t3);font-weight:400;font-size:11px;margin-left:8px;letter-spacing:1.5px;text-transform:uppercase}
.topbar-r{display:flex;align-items:center;gap:16px;font-size:11px;color:var(--t3)}
.live{display:flex;align-items:center;gap:5px;color:var(--green)}
.dot{width:6px;height:6px;border-radius:50%;background:var(--green);animation:blink 2s infinite}
@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}
.nav-link{color:var(--t3);font-size:11px;text-decoration:none;padding:4px 10px;border:1px solid var(--brd);border-radius:5px;transition:all .15s}
.nav-link:hover{color:var(--cyan);border-color:var(--cyan)}
.filters{padding:12px 24px;display:flex;gap:8px;flex-wrap:wrap;align-items:center}
.fbtn{background:var(--bg2);border:1px solid var(--brd);color:var(--t2);padding:5px 14px;border-radius:6px;font-size:11px;cursor:pointer;transition:all .15s;font-family:'DM Sans',sans-serif}
.fbtn:hover{border-color:var(--brd2);color:var(--t1)}
.fbtn.active{background:rgba(251,191,36,.1);border-color:var(--gold);color:var(--gold)}
.fbtn-group{display:flex;gap:0}
.fbtn-group .fbtn{border-radius:0}.fbtn-group .fbtn:first-child{border-radius:6px 0 0 6px}.fbtn-group .fbtn:last-child{border-radius:0 6px 6px 0}
.hero{padding:16px 24px;display:grid;grid-template-columns:repeat(5,1fr);gap:10px}
.hc{background:linear-gradient(135deg,var(--bg2),var(--bg3));border:1px solid var(--brd);border-radius:10px;padding:14px;position:relative;overflow:hidden}
.hc::before{content:'';position:absolute;top:0;left:0;right:0;height:2px}
.hc.g::before{background:linear-gradient(90deg,var(--green),transparent)}
.hc.r::before{background:linear-gradient(90deg,var(--red),transparent)}
.hc.y::before{background:linear-gradient(90deg,var(--yellow),transparent)}
.hc.go::before{background:linear-gradient(90deg,var(--gold),transparent)}
.hc-lbl{font-size:10px;color:var(--t3);text-transform:uppercase;letter-spacing:1px;margin-bottom:5px}
.hc-val{font-size:24px;font-weight:700;font-family:'JetBrains Mono',monospace}
.hc-sub{font-size:10px;color:var(--t3);margin-top:3px}
.hc-val.green{color:var(--green)}.hc-val.red{color:var(--red)}.hc-val.yellow{color:var(--yellow)}.hc-val.cyan{color:var(--cyan)}.hc-val.gold{color:var(--gold)}
.section{padding:0 24px 16px}
.sh{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px;padding-top:8px;border-top:1px solid var(--brd)}
.st{font-size:14px;font-weight:600;display:flex;align-items:center;gap:8px}
.badge{font-size:9px;padding:2px 8px;border-radius:10px;font-weight:600;font-family:'JetBrains Mono',monospace;text-transform:uppercase;letter-spacing:.5px}
.b-gold{background:rgba(251,191,36,.12);color:var(--gold);border:1px solid rgba(251,191,36,.2)}
.b-info{background:rgba(59,130,246,.12);color:var(--blue);border:1px solid rgba(59,130,246,.2)}
.at-wrap{overflow-x:auto}
.at{width:100%;border-collapse:separate;border-spacing:0 3px}
.at th{font-size:9px;color:var(--t3);text-transform:uppercase;letter-spacing:1px;padding:5px 10px;text-align:left;font-weight:500;position:sticky;top:56px;background:var(--bg0);z-index:10;cursor:pointer}
.at th:hover{color:var(--t1)}
.at td{padding:8px 10px;font-size:11px;background:var(--bg2);border-top:1px solid var(--brd);border-bottom:1px solid var(--brd)}
.at tr td:first-child{border-left:1px solid var(--brd);border-radius:6px 0 0 6px}
.at tr td:last-child{border-right:1px solid var(--brd);border-radius:0 6px 6px 0}
.at tbody tr:hover td{background:var(--bg3)}
.pos{color:var(--green)}.neg{color:var(--red)}.flat{color:var(--t3)}
.grade{display:inline-block;font-size:11px;font-weight:700;padding:2px 8px;border-radius:4px;font-family:'JetBrains Mono',monospace;min-width:28px;text-align:center}
.gA{background:rgba(16,185,129,.15);color:#10b981;border:1px solid rgba(16,185,129,.3)}
.gB{background:rgba(59,130,246,.15);color:#60a5fa;border:1px solid rgba(59,130,246,.3)}
.gC{background:rgba(245,158,11,.15);color:#f59e0b;border:1px solid rgba(245,158,11,.3)}
.gD{background:rgba(239,68,68,.15);color:#f87171;border:1px solid rgba(239,68,68,.3)}
.gF{background:rgba(239,68,68,.25);color:#ef4444;border:1px solid rgba(239,68,68,.4)}
.type-tag{font-size:10px;padding:1px 6px;border-radius:3px;font-weight:600}
.type-Bill{background:rgba(59,130,246,.1);color:var(--blue)}
.type-Note{background:rgba(16,185,129,.1);color:var(--green)}
.type-Bond{background:rgba(251,191,36,.1);color:var(--gold)}
.type-TIPS{background:rgba(167,139,250,.1);color:var(--purple)}
.type-FRN{background:rgba(236,72,153,.1);color:var(--pink)}
.type-CMB{background:rgba(249,115,22,.1);color:var(--orange)}
.detail{font-size:10px;color:var(--t3);max-width:200px}
.chart-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:10px}
.chart-box{background:var(--bg2);border:1px solid var(--brd);border-radius:8px;padding:14px}
.chart-box h4{font-size:11px;color:var(--t2);margin-bottom:6px;font-weight:500}
.analysis{background:var(--bg2);border:1px solid var(--brd);border-radius:8px;padding:16px;margin-bottom:10px;line-height:1.7;font-size:12px;color:var(--t2)}
.analysis h4{color:var(--t1);font-size:13px;margin-bottom:6px}
.analysis .key{color:var(--cyan);font-weight:600}
.analysis .warn{color:var(--yellow);font-weight:600}
.analysis .danger{color:var(--red);font-weight:600}
.analysis .good{color:var(--green);font-weight:600}
.status-bar{position:fixed;bottom:0;left:0;right:0;background:var(--bg1);border-top:1px solid var(--brd);padding:5px 24px;font-size:10px;color:var(--t3);font-family:'JetBrains Mono',monospace;display:flex;justify-content:space-between;z-index:100}
.prog{width:180px;height:3px;background:var(--bg3);border-radius:2px;overflow:hidden;display:none}
.prog-fill{height:100%;background:var(--gold);border-radius:2px;transition:width .3s}
@media(max-width:1200px){.hero{grid-template-columns:repeat(3,1fr)}.chart-row{grid-template-columns:1fr}}
@media(max-width:768px){.hero{grid-template-columns:1fr 1fr}}
</style>
</head>
<body>
<div class="topbar">
  <div class="logo"><span class="hl">TREASURY</span>AUCTIONS<sub>Daily Monitor v1.0</sub></div>
  <div class="topbar-r">
    <a href="index.html" class="nav-link">Terminal</a>
    <a href="fred.html" class="nav-link">FRED</a>
    <a href="carry.html" class="nav-link">Carry</a>
    <div class="live"><div class="dot"></div> LIVE</div>
    <span id="clock" class="mono"></span>
  </div>
</div>
<div class="filters">
  <div class="fbtn-group" id="typeFilter">
    <button class="fbtn active" data-type="all">All</button>
    <button class="fbtn" data-type="Bill">Bills</button>
    <button class="fbtn" data-type="Note">Notes</button>
    <button class="fbtn" data-type="Bond">Bonds</button>
    <button class="fbtn" data-type="TIPS">TIPS</button>
    <button class="fbtn" data-type="FRN">FRN</button>
    <button class="fbtn" data-type="CMB">CMB</button>
  </div>
  <div class="fbtn-group" id="rangeFilter">
    <button class="fbtn" data-days="14">2W</button>
    <button class="fbtn" data-days="30">1M</button>
    <button class="fbtn active" data-days="90">3M</button>
    <button class="fbtn" data-days="180">6M</button>
    <button class="fbtn" data-days="365">1Y</button>
  </div>
  <span style="font-size:10px;color:var(--t3);margin-left:8px" id="filterInfo">Loading...</span>
</div>
<div class="hero">
  <div class="hc go"><div class="hc-lbl">Total Auctioned</div><div class="hc-val gold" id="vTotal">--</div><div class="hc-sub" id="sTotal">Recent period</div></div>
  <div class="hc g"><div class="hc-lbl">Avg Bid-to-Cover</div><div class="hc-val" id="vBtc">--</div><div class="hc-sub" id="sBtc">Demand ratio</div></div>
  <div class="hc" id="hGrade"><div class="hc-lbl">Avg Auction Grade</div><div class="hc-val" id="vGrade">--</div><div class="hc-sub" id="sGrade">Overall quality</div></div>
  <div class="hc" id="hTail"><div class="hc-lbl">Avg Tail (bps)</div><div class="hc-val" id="vTail">--</div><div class="hc-sub" id="sTail">Yield surprise</div></div>
  <div class="hc" id="hIndirect"><div class="hc-lbl">Avg Indirect Bid</div><div class="hc-val" id="vIndirect">--</div><div class="hc-sub" id="sIndirect">Foreign demand proxy</div></div>
</div>
<div class="section">
  <div class="sh"><div class="st">Auction Results <span class="badge b-gold">GRADED</span></div><div style="font-size:10px;color:var(--t3)" id="lastRefresh"></div></div>
  <div class="at-wrap"><table class="at">
    <thead><tr>
      <th onclick="sortTable(0)">Date</th><th onclick="sortTable(1)">Type</th><th onclick="sortTable(2)">Term</th>
      <th onclick="sortTable(3)">CUSIP</th><th onclick="sortTable(4)">Size ($B)</th>
      <th onclick="sortTable(5)">High Yield/Rate</th><th onclick="sortTable(6)">Tail (bps)</th>
      <th onclick="sortTable(7)">Bid/Cover</th><th onclick="sortTable(8)">Indirect %</th>
      <th onclick="sortTable(9)">Direct %</th><th onclick="sortTable(10)">Dealer %</th>
      <th onclick="sortTable(11)">Grade</th><th>Assessment</th>
    </tr></thead>
    <tbody id="atBody"></tbody>
  </table></div>
</div>
<div class="section">
  <div class="sh"><div class="st">Market Impact Analysis <span class="badge b-info">AI</span></div></div>
  <div class="analysis" id="analysisBox"><h4>Loading auction data...</h4></div>
</div>
<div class="section">
  <div class="sh"><div class="st">Auction Analytics</div></div>
  <div class="chart-row">
    <div class="chart-box"><h4>Bid-to-Cover Ratio Over Time</h4><div id="chBtc" style="height:260px"></div></div>
    <div class="chart-box"><h4>Auction Tail (bps) - Negative = Strong</h4><div id="chTail" style="height:260px"></div></div>
  </div>
  <div class="chart-row">
    <div class="chart-box"><h4>Bidder Composition (%)</h4><div id="chBidders" style="height:260px"></div></div>
    <div class="chart-box"><h4>Offering Size ($B)</h4><div id="chSize" style="height:260px"></div></div>
  </div>
</div>
<div class="status-bar">
  <span id="sMsg">Initializing...</span>
  <div class="prog" id="prog"><div class="prog-fill" id="pFill"></div></div>
</div>
<script>
var PROXY='https://x6ssu4ow2iinjhsmgdwqzqspqm0dtglv.lambda-url.us-east-1.on.aws/';
var allAuctions=[],filtered=[],currentType='all',currentDays=90,sortCol=-1,sortAsc=false;
async function loadData(){
  var p=document.getElementById('prog'),f=document.getElementById('pFill');
  p.style.display='block';f.style.width='20%';setS('Fetching Treasury auction data...');
  try{
    var url=PROXY+'?action=recent&days='+currentDays+'&limit=200';
    if(currentType!=='all')url+='&type='+currentType;
    var r=await fetch(url);var j=await r.json();f.style.width='80%';
    if(j.auctions){allAuctions=j.auctions;applyFilter();setS('Loaded '+allAuctions.length+' auctions');}
    else{setS('Error: '+JSON.stringify(j));}
  }catch(e){setS('Error: '+e.message);}
  p.style.display='none';
  document.getElementById('lastRefresh').textContent='Updated: '+new Date().toLocaleTimeString();
}
function applyFilter(){
  if(currentType==='all')filtered=allAuctions.slice();
  else filtered=allAuctions.filter(function(a){return a.security_type===currentType;});
  document.getElementById('filterInfo').textContent=filtered.length+' auctions | '+currentType+' | '+currentDays+'d';
  renderAll();
}
function renderAll(){renderHero();renderTable();renderCharts();renderAnalysis();}
function renderHero(){
  var totalB=0;filtered.forEach(function(a){if(a._offering_b)totalB+=a._offering_b;});
  document.getElementById('vTotal').textContent='$'+(totalB>=1000?(totalB/1000).toFixed(1)+'T':totalB.toFixed(0)+'B');
  document.getElementById('sTotal').textContent=filtered.length+' auctions in '+currentDays+'d';
  var btcs=filtered.filter(function(a){return a._btc!==null&&a._btc!==undefined;}).map(function(a){return a._btc;});
  var avgBtc=btcs.length>0?(btcs.reduce(function(s,v){return s+v;},0)/btcs.length):0;
  var be=document.getElementById('vBtc');be.textContent=avgBtc.toFixed(2)+'x';
  be.className='hc-val '+(avgBtc>=2.5?'green':avgBtc>=2.2?'yellow':'red');
  document.getElementById('sBtc').textContent=btcs.length+' auctions with BTC data';
  var grades={'A+':95,'A':90,'A-':85,'B+':78,'B':70,'B-':65,'C+':58,'C':50,'C-':45,'D':35,'F':20};
  var gScores=filtered.filter(function(a){return a._grade&&grades[a._grade]!==undefined;}).map(function(a){return grades[a._grade];});
  var avgG=gScores.length>0?(gScores.reduce(function(s,v){return s+v;},0)/gScores.length):0;
  var gLbl='--';if(avgG>=88)gLbl='A';else if(avgG>=78)gLbl='B+';else if(avgG>=68)gLbl='B';else if(avgG>=58)gLbl='B-';else if(avgG>=48)gLbl='C';else if(avgG>=35)gLbl='D';else gLbl='F';
  var ge=document.getElementById('vGrade');ge.textContent=gLbl;
  ge.className='hc-val '+(avgG>=70?'green':avgG>=50?'yellow':'red');
  document.getElementById('hGrade').className='hc '+(avgG>=70?'g':avgG>=50?'y':'r');
  var tails=filtered.filter(function(a){return a._tail_bps!==null&&a._tail_bps!==undefined;}).map(function(a){return a._tail_bps;});
  var avgTail=tails.length>0?(tails.reduce(function(s,v){return s+v;},0)/tails.length):0;
  var te=document.getElementById('vTail');te.textContent=(avgTail>0?'+':'')+avgTail.toFixed(1);
  te.className='hc-val '+(avgTail<=0?'green':avgTail<=2?'yellow':'red');
  document.getElementById('hTail').className='hc '+(avgTail<=0?'g':avgTail<=2?'y':'r');
  document.getElementById('sTail').textContent=(avgTail<=0?'Bullish: stopping through':'Bearish: tailing');
  var inds=filtered.filter(function(a){return a._indirect_pct!==null&&a._indirect_pct!==undefined;}).map(function(a){return a._indirect_pct;});
  var avgInd=inds.length>0?(inds.reduce(function(s,v){return s+v;},0)/inds.length):0;
  var ie=document.getElementById('vIndirect');ie.textContent=avgInd.toFixed(1)+'%';
  ie.className='hc-val '+(avgInd>=65?'green':avgInd>=55?'yellow':'red');
  document.getElementById('hIndirect').className='hc '+(avgInd>=65?'g':avgInd>=55?'y':'r');
}
function renderTable(){
  var tb=document.getElementById('atBody');var html='';
  filtered.forEach(function(a){
    var dt=a.auction_date||'--';var tp=a.security_type||'--';var tm=a.security_term||a.original_security_term||'--';
    var cusip=a.cusip||'--';var sz=a._offering_b!=null?'$'+a._offering_b.toFixed(1)+'B':'--';
    var hy=a.high_yield||a.high_discount_rate||'--';if(hy!=='--')hy=parseFloat(hy).toFixed(3)+'%';
    var tail=a._tail_bps!=null?((a._tail_bps>0?'+':'')+a._tail_bps.toFixed(1)):'--';
    var tailC=a._tail_bps!=null?(a._tail_bps<=0?'pos':a._tail_bps<=2?'flat':'neg'):'flat';
    var btc=a._btc!=null?a._btc.toFixed(2)+'x':'--';
    var btcC=a._btc!=null?(a._btc>=2.5?'pos':a._btc>=2.2?'flat':'neg'):'flat';
    var ind=a._indirect_pct!=null?a._indirect_pct.toFixed(1)+'%':'--';
    var indC=a._indirect_pct!=null?(a._indirect_pct>=65?'pos':a._indirect_pct>=55?'flat':'neg'):'flat';
    var dir=a._direct_pct!=null?a._direct_pct.toFixed(1)+'%':'--';
    var dlr=a._dealer_pct!=null?a._dealer_pct.toFixed(1)+'%':'--';
    var dlrC=a._dealer_pct!=null?(a._dealer_pct<=15?'pos':a._dealer_pct<=25?'flat':'neg'):'flat';
    var gr=a._grade||'N/A';var grC=gr.startsWith('A')?'gA':gr.startsWith('B')?'gB':gr.startsWith('C')?'gC':gr==='D'?'gD':'gF';
    html+='<tr><td class="mono">'+dt+'</td><td><span class="type-tag type-'+tp+'">'+tp+'</span></td><td class="mono">'+tm+'</td><td class="mono" style="font-size:10px">'+cusip+'</td><td class="mono">'+sz+'</td><td class="mono">'+hy+'</td><td class="mono '+tailC+'">'+tail+'</td><td class="mono '+btcC+'">'+btc+'</td><td class="mono '+indC+'">'+ind+'</td><td class="mono">'+dir+'</td><td class="mono '+dlrC+'">'+dlr+'</td><td><span class="grade '+grC+'">'+gr+'</span></td><td class="detail">'+(a._grade_detail||'')+'</td></tr>';
  });tb.innerHTML=html;
}
function renderCharts(){
  var lo={paper_bgcolor:'#111827',plot_bgcolor:'#111827',font:{color:'#64748b',family:'JetBrains Mono',size:10},margin:{l:50,r:15,t:10,b:40},xaxis:{gridcolor:'#1e2a45'},yaxis:{gridcolor:'#1e2a45'},hovermode:'x unified',showlegend:false};
  var cfg={responsive:true};
  var nb=filtered.filter(function(a){return a.security_type==='Note'||a.security_type==='Bond'||a.security_type==='TIPS';});
  if(nb.length<2)nb=filtered;var rev=nb.slice().reverse();
  var btcD=rev.filter(function(a){return a._btc;});
  if(btcD.length>0){Plotly.newPlot('chBtc',[{x:btcD.map(function(a){return a.auction_date;}),y:btcD.map(function(a){return a._btc;}),type:'scatter',mode:'lines+markers',marker:{size:5,color:btcD.map(function(a){return a._btc>=2.5?'#10b981':a._btc>=2.2?'#f59e0b':'#ef4444';}),line:{width:1,color:'#1e2a45'}},line:{color:'#3b82f6',width:1.5},hovertemplate:'%{x}<br>BTC: %{y:.2f}x<extra></extra>'}],Object.assign({},lo,{yaxis:{gridcolor:'#1e2a45',title:'BTC Ratio'}}),cfg);}
  var tailD=rev.filter(function(a){return a._tail_bps!=null;});
  if(tailD.length>0){Plotly.newPlot('chTail',[{x:tailD.map(function(a){return a.auction_date;}),y:tailD.map(function(a){return a._tail_bps;}),type:'bar',marker:{color:tailD.map(function(a){return a._tail_bps<=0?'#10b981':a._tail_bps<=2?'#f59e0b':'#ef4444';}),opacity:0.8},hovertemplate:'%{x}<br>Tail: %{y:.1f}bp<extra></extra>'}],Object.assign({},lo,{yaxis:{gridcolor:'#1e2a45',title:'bps',zeroline:true,zerolinecolor:'#64748b'}}),cfg);}
  var bidD=rev.filter(function(a){return a._indirect_pct&&a._direct_pct&&a._dealer_pct;});
  if(bidD.length>0){var lo2=Object.assign({},lo);lo2.showlegend=true;lo2.legend={font:{size:9},orientation:'h',y:1.1};lo2.barmode='stack';Plotly.newPlot('chBidders',[{x:bidD.map(function(a){return a.auction_date;}),y:bidD.map(function(a){return a._indirect_pct;}),name:'Indirect',type:'bar',marker:{color:'#3b82f6'}},{x:bidD.map(function(a){return a.auction_date;}),y:bidD.map(function(a){return a._direct_pct;}),name:'Direct',type:'bar',marker:{color:'#10b981'}},{x:bidD.map(function(a){return a.auction_date;}),y:bidD.map(function(a){return a._dealer_pct;}),name:'Dealer',type:'bar',marker:{color:'#f59e0b'}}],lo2,cfg);}
  var szD=rev.filter(function(a){return a._offering_b;});
  if(szD.length>0){var tc={'Bill':'#3b82f6','Note':'#10b981','Bond':'#fbbf24','TIPS':'#a78bfa','FRN':'#ec4899','CMB':'#f97316'};Plotly.newPlot('chSize',[{x:szD.map(function(a){return a.auction_date;}),y:szD.map(function(a){return a._offering_b;}),type:'bar',marker:{color:szD.map(function(a){return tc[a.security_type]||'#64748b';}),opacity:0.8},hovertemplate:'%{x}<br>$%{y:.1f}B<extra></extra>'}],Object.assign({},lo,{yaxis:{gridcolor:'#1e2a45',title:'$B'}}),cfg);}
}
function renderAnalysis(){
  var box=document.getElementById('analysisBox');if(filtered.length===0){box.innerHTML='<h4>No data</h4>';return;}
  var twa=new Date();twa.setDate(twa.getDate()-14);
  var recent=filtered.filter(function(a){return new Date(a.auction_date)>=twa;});
  if(recent.length===0)recent=filtered.slice(0,10);
  var h='<h4>Treasury Auction Market Assessment</h4>';
  var avgBtc=avg(recent,'_btc');
  if(avgBtc!==null){
    if(avgBtc>=2.5)h+='<p><span class="good">Strong overall demand</span> (avg BTC: '+avgBtc.toFixed(2)+'x). Investors actively competing for Treasury supply - bullish for bonds, suggests confidence in rates outlook.</p>';
    else if(avgBtc>=2.2)h+='<p><span class="key">Adequate demand</span> (avg BTC: '+avgBtc.toFixed(2)+'x). Market absorbing new supply without stress, though not exceptional.</p>';
    else h+='<p><span class="danger">Weak demand signal</span> (avg BTC: '+avgBtc.toFixed(2)+'x). Below-average bid-to-cover ratios - market struggling to absorb supply, could push yields higher.</p>';
  }
  var avgTail=avg(recent,'_tail_bps');
  if(avgTail!==null){
    if(avgTail<=0)h+='<p>Auctions <span class="good">stopping through</span> (avg tail: '+avgTail.toFixed(1)+'bp) - clearing yield below when-issued level. Strong bullish signal, real money aggressively bidding.</p>';
    else if(avgTail<=2)h+='<p>Auctions showing <span class="key">minor tails</span> (avg: +'+avgTail.toFixed(1)+'bp). Pricing close to when-issued, orderly supply absorption.</p>';
    else h+='<p><span class="danger">Significant tailing</span> (avg: +'+avgTail.toFixed(1)+'bp) - market demanding concession to buy Treasuries. Bearish for bonds.</p>';
  }
  var avgInd=avg(recent,'_indirect_pct');
  if(avgInd!==null){
    if(avgInd>=70)h+='<p><span class="good">Very strong foreign/institutional demand</span> ('+avgInd.toFixed(1)+'% indirect). Central banks and institutions remain eager buyers, supporting dollar and keeping borrowing costs contained.</p>';
    else if(avgInd>=60)h+='<p>Foreign demand at <span class="key">'+avgInd.toFixed(1)+'%</span> (indirect) is healthy. International investors view Treasuries as core allocation.</p>';
    else h+='<p><span class="warn">Below-average foreign demand</span> ('+avgInd.toFixed(1)+'% indirect). Declining foreign interest could signal concerns about fiscal policy or dollar strength.</p>';
  }
  var avgDlr=avg(recent,'_dealer_pct');
  if(avgDlr!==null){
    if(avgDlr>=25)h+='<p><span class="danger">Primary dealers forced to absorb '+avgDlr.toFixed(1)+'%</span> of supply. Real money stepping back - warning sign.</p>';
    else if(avgDlr<=12)h+='<p><span class="good">Low dealer takedown</span> ('+avgDlr.toFixed(1)+'%) shows strong end-user demand. Healthy sign.</p>';
  }
  var gc={'A':0,'B':0,'C':0,'D':0,'F':0};
  recent.forEach(function(a){if(!a._grade)return;if(a._grade.startsWith('A'))gc['A']++;else if(a._grade.startsWith('B'))gc['B']++;else if(a._grade.startsWith('C'))gc['C']++;else if(a._grade==='D')gc['D']++;else gc['F']++;});
  var tot=recent.length;
  if(tot>0){var gp=((gc['A']+gc['B'])/tot*100).toFixed(0);var bp=((gc['D']+gc['F'])/tot*100).toFixed(0);
    h+='<p>Of '+tot+' recent auctions: <span class="good">'+gp+'% graded A/B</span>, '+bp+'% graded D/F. ';
    if(parseInt(gp)>=70)h+='Treasury successfully financing at acceptable rates.</p>';
    else if(parseInt(bp)>=30)h+='<span class="danger">Deteriorating auction environment could pressure yields higher.</span></p>';
    else h+='Mixed results - investors discriminating between maturities.</p>';}
  h+='<h4 style="margin-top:12px">Market Consequences</h4>';
  var bull=0,bear=0;
  if(avgBtc>=2.5)bull++;else if(avgBtc<2.2)bear++;
  if(avgTail!=null&&avgTail<=0)bull++;else if(avgTail>2)bear++;
  if(avgInd>=65)bull++;else if(avgInd<55)bear++;
  if(avgDlr!=null&&avgDlr<=15)bull++;else if(avgDlr>25)bear++;
  if(bull>bear)h+='<p><span class="good">Net bullish for bonds.</span> Strong auctions support lower yields. Positive for rate-sensitive sectors, supports risk assets, gives Fed room to maintain policy.</p>';
  else if(bear>bull)h+='<p><span class="danger">Net bearish for bonds.</span> Weak auctions create upward yield pressure. Negative for growth stocks and rate-sensitive sectors, may force higher coupons.</p>';
  else h+='<p><span class="warn">Mixed signals.</span> Some metrics strong, others weak. Watch upcoming 10Y and 30Y auctions for directional clarity.</p>';
  box.innerHTML=h;
}
function avg(arr,f){var v=arr.filter(function(a){return a[f]!=null;}).map(function(a){return a[f];});if(v.length===0)return null;return v.reduce(function(s,x){return s+x;},0)/v.length;}
function sortTable(col){
  if(sortCol===col)sortAsc=!sortAsc;else{sortCol=col;sortAsc=true;}
  var keys=['auction_date','security_type','security_term','cusip','_offering_b','high_yield','_tail_bps','_btc','_indirect_pct','_direct_pct','_dealer_pct','_grade'];
  var key=keys[col];if(!key)return;
  filtered.sort(function(a,b){var va=a[key],vb=b[key];if(va==null)va=sortAsc?Infinity:-Infinity;if(vb==null)vb=sortAsc?Infinity:-Infinity;if(typeof va==='string')return sortAsc?va.localeCompare(vb):vb.localeCompare(va);return sortAsc?(va-vb):(vb-va);});
  renderTable();
}
document.getElementById('typeFilter').addEventListener('click',function(e){if(!e.target.classList.contains('fbtn'))return;document.querySelectorAll('#typeFilter .fbtn').forEach(function(b){b.classList.remove('active');});e.target.classList.add('active');currentType=e.target.dataset.type;loadData();});
document.getElementById('rangeFilter').addEventListener('click',function(e){if(!e.target.classList.contains('fbtn'))return;document.querySelectorAll('#rangeFilter .fbtn').forEach(function(b){b.classList.remove('active');});e.target.classList.add('active');currentDays=parseInt(e.target.dataset.days);loadData();});
function setS(m){document.getElementById('sMsg').textContent=m;}
function updClk(){document.getElementById('clock').textContent=new Date().toLocaleTimeString('en-US',{hour12:false});}
setInterval(updClk,1000);updClk();
setInterval(function(){loadData();},15*60*1000);
loadData();
</script>
</body>
</html>
