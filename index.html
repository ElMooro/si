<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Global Economic Data Watchlist</title>
  <style>
    body { font-family: sans-serif; background: #0a0a0a; color: #e0e0e0; margin: 0; padding: 0; }
    .container { display: flex; height: 100vh; overflow: hidden; }
    .sidebar { width: 350px; background: #1a1a1a; border-right: 1px solid #333; padding: 20px; overflow-y: auto; }
    .main-content { flex: 1; padding: 20px; overflow-y: auto; }
    .header { background: linear-gradient(135deg, #1a237e, #3949ab); padding: 20px; border-radius: 10px; margin-bottom: 20px; }
    .header h1 { margin: 0 0 10px; color: #fff; }
    .header p { margin: 0; color: #b3c5ff; }
    .category-browser h3 { color: #4a9eff; margin-bottom: 15px; }
    .main-category { margin-bottom: 10px; }
    .main-category-header { background: #2a2a2a; padding: 10px; cursor: pointer; border-radius: 6px; display: flex; justify-content: space-between; }
    .main-category-header:hover { background: #333; }
    .main-category-header.active { background: #3949ab; }
    .category-count { background: #111; padding: 2px 8px; border-radius: 12px; color: #999; font-size: 0.8em; }
    .subcategories { margin-left: 15px; display: none; margin-top: 8px; }
    .subcategories.show { display: block; }
    .subcategory-header { background: #222; padding: 8px; cursor: pointer; border-radius: 4px; display: flex; justify-content: space-between; margin-top: 6px; }
    .series-list { margin-left: 15px; margin-top: 5px; display: none; }
    .series-list.show { display: block; }
    .series-item { background: #1a1a1a; padding: 6px; margin-bottom: 4px; border-radius: 4px; display: flex; justify-content: space-between; font-size: 0.85em; }
    .add-btn { background: #4caf50; color: white; border: none; padding: 3px 10px; border-radius: 4px; cursor: pointer; }
    .add-btn:hover { background: #5cbf60; }
  </style>
</head>
<body>
  <div class="container">
    <aside class="sidebar">
      <h2 style="color:#4a9eff; margin-bottom: 20px;">Global Economic Data</h2>
      <div class="category-browser">
        <h3>Browse Categories</h3>
        <div id="categoryList"></div>
      </div>
    </aside>
    <main class="main-content">
      <div class="header">
        <h1>Data Series Explorer</h1>
        <p>All economic indicators from FRED, ECB, NY Fed, and OFR</p>
      </div>
      <div id="mainContent">
        <p>Select a series to display or add to your analysis tool.</p>
      </div>
    </main>
  </div>

  <script>
    const API_BASE = "https://ped8gafyuz.us-east-1.awsapprunner.com";
    let economicData = {};

    async function loadAllEconomicData() {
      try {
        const res = await fetch(`${API_BASE}/api/v1/universal/all_series`);
        economicData = await res.json();
        initializeCategories();
      } catch (err) {
        document.getElementById('categoryList').innerHTML = '<p style="color:red;">Failed to load data.</p>';
        console.error("Error loading data:", err);
      }
    }

    function initializeCategories() {
      const container = document.getElementById('categoryList');
      container.innerHTML = '';
      Object.entries(economicData).forEach(([mainCat, subCats]) => {
        const total = Object.values(subCats).reduce((sum, arr) => sum + arr.length, 0);
        const mainDiv = document.createElement('div');
        mainDiv.className = 'main-category';

        const mainHeader = document.createElement('div');
        mainHeader.className = 'main-category-header';
        mainHeader.innerHTML = `<span>${mainCat}</span><span class="category-count">${total}</span>`;
        mainHeader.onclick = () => toggleMain(mainCat);

        const subcatContainer = document.createElement('div');
        subcatContainer.className = 'subcategories';
        subcatContainer.id = `main-${mainCat.replace(/\W+/g, '-')}`;

        Object.entries(subCats).forEach(([subcat, series]) => {
          const subDiv = document.createElement('div');
          const subHeader = document.createElement('div');
          subHeader.className = 'subcategory-header';
          subHeader.innerHTML = `<span>${subcat}</span><span class="category-count">${series.length}</span>`;
          subHeader.onclick = () => toggleSub(mainCat, subcat);

          const seriesList = document.createElement('div');
          seriesList.className = 'series-list';
          seriesList.id = `series-${mainCat.replace(/\W+/g, '-')}-${subcat.replace(/\W+/g, '-')}`;

          series.forEach(({ symbol, name }) => {
            const row = document.createElement('div');
            row.className = 'series-item';
            row.innerHTML = `
              <span>${name} (${symbol})</span>
              <button class="add-btn" onclick="alert('You selected ${name}')">Add</button>
            `;
            seriesList.appendChild(row);
          });

          subDiv.appendChild(subHeader);
          subDiv.appendChild(seriesList);
          subcatContainer.appendChild(subDiv);
        });

        mainDiv.appendChild(mainHeader);
        mainDiv.appendChild(subcatContainer);
        container.appendChild(mainDiv);
      });
    }

    function toggleMain(cat) {
      const id = `main-${cat.replace(/\W+/g, '-')}`;
      const element = document.getElementById(id);
      const all = document.querySelectorAll('.subcategories');
      all.forEach(sub => {
        if (sub.id !== id) {
          sub.classList.remove('show');
          sub.previousElementSibling.classList.remove('active');
        }
      });
      element.classList.toggle('show');
      element.previousElementSibling.classList.toggle('active');
    }

    function toggleSub(main, sub) {
      const id = `series-${main.replace(/\W+/g, '-')}-${sub.replace(/\W+/g, '-')}`;
      const el = document.getElementById(id);
      const all = el.parentElement.querySelectorAll('.series-list');
      all.forEach(s => s !== el && s.classList.remove('show'));
      el.classList.toggle('show');
    }

    window.addEventListener('DOMContentLoaded', loadAllEconomicData);
  </script>
</body>
</html>
