<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BLS Employment Crisis Detection Platform - Real Federal Data</title>
    
    <!-- Required Libraries -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #151932 100%);
            color: #e0e0e0;
            min-height: 100vh;
        }
        
        /* Header Styles */
        .header {
            background: rgba(20, 24, 44, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            border-bottom: 1px solid rgba(0, 255, 136, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(45deg, #00ff88, #00ccff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .header-stats {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            min-width: 100px;
        }
        
        .stat-value {
            font-size: 1.25rem;
            font-weight: bold;
            color: #00ff88;
        }
        
        .stat-label {
            font-size: 0.75rem;
            color: #888;
            text-transform: uppercase;
        }
        
        /* Crisis Level Indicator */
        .crisis-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .crisis-level {
            font-weight: bold;
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
        }
        
        .crisis-normal {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
        }
        
        .crisis-elevated {
            background: rgba(255, 170, 0, 0.2);
            color: #ffaa00;
        }
        
        .crisis-warning {
            background: rgba(255, 68, 68, 0.2);
            color: #ff4444;
        }
        
        .crisis-severe {
            background: rgba(255, 0, 0, 0.3);
            color: #ff0000;
            animation: criticalPulse 1s ease-in-out infinite;
        }
        
        @keyframes criticalPulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        /* API Status Indicators */
        .api-status {
            display: flex;
            gap: 1rem;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            flex-wrap: wrap;
        }
        
        .api-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .status-dot.connected {
            background: #00ff88;
        }
        
        .status-dot.error {
            background: #ff4444;
        }
        
        .status-dot.loading {
            background: #ffaa00;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Container */
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        /* Tabs Navigation */
        .tabs-nav {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 0.5rem;
            overflow-x: auto;
        }
        
        .tab-btn {
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: none;
            border-radius: 8px;
            color: #888;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .tab-btn:hover {
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
        }
        
        .tab-btn.active {
            background: #00ff88;
            color: #000;
            font-weight: bold;
        }
        
        /* Tab Content */
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Key Metrics Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .metric-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
        }
        
        .metric-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 255, 136, 0.1);
        }
        
        .metric-title {
            font-size: 0.875rem;
            color: #888;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
        }
        
        .metric-value {
            font-size: 1.75rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .metric-change {
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .positive { color: #00ff88; }
        .negative { color: #ff4444; }
        .neutral { color: #888; }
        
        /* Crisis Phase Banner */
        .crisis-phase-banner {
            background: linear-gradient(90deg, #00ff88, #00ccff);
            color: #000;
            padding: 12px;
            text-align: center;
            font-weight: bold;
            font-size: 1.1rem;
            animation: phaseGlow 2s ease-in-out infinite;
            position: sticky;
            top: 80px;
            z-index: 999;
        }
        
        @keyframes phaseGlow {
            0%, 100% { opacity: 0.9; }
            50% { opacity: 1; }
        }
        
        /* Data Grid */
        .data-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .data-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .data-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 255, 136, 0.2);
            border-color: #00ff88;
        }
        
        .data-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }
        
        .data-title {
            font-size: 1rem;
            font-weight: bold;
            color: #fff;
            flex: 1;
            margin-right: 0.5rem;
        }
        
        .data-source {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            background: rgba(0, 255, 136, 0.2);
            border-radius: 4px;
            color: #00ff88;
        }
        
        .data-value {
            font-size: 1.75rem;
            font-weight: bold;
            margin: 0.75rem 0;
        }
        
        .data-change {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }
        
        .series-id {
            font-size: 0.65rem;
            color: #666;
            margin-top: 0.5rem;
            font-family: monospace;
        }
        
        /* Chart Container */
        .chart-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .chart-title {
            font-size: 1.25rem;
            font-weight: bold;
        }
        
        .chart-controls {
            display: flex;
            gap: 0.5rem;
        }
        
        .chart-control-btn {
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            color: #fff;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.3s;
        }
        
        .chart-control-btn:hover {
            background: rgba(0, 255, 136, 0.2);
            border-color: #00ff88;
        }
        
        .chart-control-btn.active {
            background: #00ff88;
            color: #000;
        }
        
        #mainChart, #historicalChart, .category-chart {
            height: 500px;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
        }
        
        /* Loading Spinner */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(0, 255, 136, 0.3);
            border-top-color: #00ff88;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Messages */
        .message {
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }
        
        .error-message {
            background: rgba(255, 68, 68, 0.1);
            border: 1px solid #ff4444;
            color: #ff6666;
        }
        
        .success-message {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid #00ff88;
            color: #00ff88;
        }

        /* Crisis Alert Styles */
        .crisis-alert {
            background: rgba(255, 0, 0, 0.15);
            border: 2px solid #ff0000;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            animation: criticalPulse 1s ease-in-out infinite;
        }
        
        /* State Grid */
        .state-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 0.75rem;
            margin-top: 1rem;
        }
        
        .state-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 0.75rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
            transition: all 0.3s;
        }
        
        .state-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 136, 0.1);
        }
        
        .state-name {
            font-size: 0.75rem;
            color: #888;
            margin-bottom: 0.25rem;
        }
        
        .state-value {
            font-size: 1.25rem;
            font-weight: bold;
        }
        
        /* API Response Display */
        .raw-data-container {
            background: rgba(0, 0, 0, 0.5);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .raw-data {
            font-family: monospace;
            font-size: 0.875rem;
            white-space: pre-wrap;
            word-break: break-all;
        }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .header {
                padding: 1rem;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            .data-grid {
                grid-template-columns: 1fr;
            }
            
            .tabs-nav {
                overflow-x: auto;
            }
            
            .state-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }
        }
    </style>
</head>
<body>
    <!-- Crisis Phase Banner -->
    <div class="crisis-phase-banner" id="crisisPhaseBanner">
        📊 BLS EMPLOYMENT STATUS: CONNECTING TO REAL FEDERAL DATA...
    </div>
    
    <header class="header">
        <div class="logo">
            🏛️ BLS Employment Platform
            <span style="font-size: 0.875rem; color: #888;">Real Federal Data</span>
        </div>
        
        <div class="header-stats">
            <div class="stat-item">
                <div class="stat-value" id="unemploymentRate">--</div>
                <div class="stat-label">Unemployment</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="totalIndicators">--</div>
                <div class="stat-label">Series Loaded</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="dataPoints">--</div>
                <div class="stat-label">Data Points</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="lastUpdate">--</div>
                <div class="stat-label">Last Update</div>
            </div>
        </div>
        
        <div class="crisis-indicator">
            <span>Crisis Level:</span>
            <span class="crisis-level crisis-normal" id="crisisLevel">LOADING...</span>
        </div>
        
        <div class="api-status">
            <div class="api-indicator">
                <div class="status-dot loading" id="blsApiStatus"></div>
                <span>BLS API</span>
            </div>
            <div class="api-indicator">
                <div class="status-dot loading" id="lambdaStatus"></div>
                <span>Lambda</span>
            </div>
            <div class="api-indicator">
                <div class="status-dot loading" id="autoUpdate"></div>
                <span>Auto-Update</span>
            </div>
        </div>
    </header>
    
    <div class="container">
        <!-- Navigation Tabs -->
        <div class="tabs-nav">
            <button class="tab-btn active" data-tab="overview">📊 Overview</button>
            <button class="tab-btn" data-tab="core">💼 Core Employment</button>
            <button class="tab-btn" data-tab="demographics">👥 Demographics</button>
            <button class="tab-btn" data-tab="states">🗺️ State Data</button>
            <button class="tab-btn" data-tab="jolts">📈 JOLTS</button>
            <button class="tab-btn" data-tab="payroll">💰 Payroll</button>
            <button class="tab-btn" data-tab="sectors">🏭 Sectors</button>
            <button class="tab-btn" data-tab="costs">💵 Costs</button>
            <button class="tab-btn" data-tab="alternative">📉 Alternative</button>
            <button class="tab-btn" data-tab="inflation">📈 Inflation</button>
            <button class="tab-btn" data-tab="all">🌐 All Data</button>
            <button class="tab-btn" data-tab="raw">📋 Raw API</button>
        </div>
        
        <!-- Overview Tab -->
        <div class="tab-content active" id="overview">
            <!-- Key Metrics -->
            <div class="metrics-grid" id="keyMetrics">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
            
            <!-- Main Historical Chart -->
            <div class="chart-container">
                <div class="chart-header">
                    <h2 class="chart-title">Historical Employment Trends</h2>
                    <div class="chart-controls">
                        <button class="chart-control-btn active" onclick="updateChartPeriod('1y')">1Y</button>
                        <button class="chart-control-btn" onclick="updateChartPeriod('5y')">5Y</button>
                        <button class="chart-control-btn" onclick="updateChartPeriod('10y')">10Y</button>
                        <button class="chart-control-btn" onclick="updateChartPeriod('all')">All</button>
                    </div>
                </div>
                <div id="mainChart"></div>
            </div>
            
            <!-- Crisis Analysis Summary -->
            <div class="crisis-alert" id="crisisAlertSummary" style="display: none;">
                <h3 style="color: #ff0000; margin-bottom: 1rem;">🚨 EMPLOYMENT CRISIS DETECTED</h3>
                <div id="crisisMessage"></div>
            </div>
            
            <!-- All Core Indicators -->
            <h3 style="margin: 2rem 0 1rem 0; color: #00ff88;">All Available Indicators</h3>
            <div class="data-grid" id="overviewGrid">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
        
        <!-- Core Employment Tab -->
        <div class="tab-content" id="core">
            <div class="chart-container">
                <div class="chart-header">
                    <h2 class="chart-title">Core Employment Historical Data</h2>
                </div>
                <div id="coreChart" class="category-chart"></div>
            </div>
            <div class="data-grid" id="coreGrid">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
        
        <!-- Demographics Tab -->
        <div class="tab-content" id="demographics">
            <div class="chart-container">
                <div class="chart-header">
                    <h2 class="chart-title">Demographic Unemployment Breakdown</h2>
                </div>
                <div id="demographicsChart" class="category-chart"></div>
            </div>
            <div class="data-grid" id="demographicsGrid">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
        
        <!-- States Tab -->
        <div class="tab-content" id="states">
            <div class="chart-container">
                <div class="chart-header">
                    <h2 class="chart-title">State Unemployment Rates</h2>
                </div>
                <div id="statesChart" class="category-chart"></div>
            </div>
            <h3 style="margin: 2rem 0 1rem 0; color: #00ff88;">All States Data</h3>
            <div class="state-grid" id="statesGrid">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
        
        <!-- JOLTS Tab -->
        <div class="tab-content" id="jolts">
            <div class="chart-container">
                <div class="chart-header">
                    <h2 class="chart-title">JOLTS - Job Openings and Labor Turnover</h2>
                </div>
                <div id="joltsChart" class="category-chart"></div>
            </div>
            <div class="data-grid" id="joltsGrid">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
        
        <!-- Payroll Tab -->
        <div class="tab-content" id="payroll">
            <div class="chart-container">
                <div class="chart-header">
                    <h2 class="chart-title">Payroll Employment & Earnings</h2>
                </div>
                <div id="payrollChart" class="category-chart"></div>
            </div>
            <div class="data-grid" id="payrollGrid">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
        
        <!-- Sectors Tab -->
        <div class="tab-content" id="sectors">
            <div class="chart-container">
                <div class="chart-header">
                    <h2 class="chart-title">Employment by Major Sectors</h2>
                </div>
                <div id="sectorsChart" class="category-chart"></div>
            </div>
            <div class="data-grid" id="sectorsGrid">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
        
        <!-- Costs Tab -->
        <div class="tab-content" id="costs">
            <div class="chart-container">
                <div class="chart-header">
                    <h2 class="chart-title">Employment Costs & Productivity</h2>
                </div>
                <div id="costsChart" class="category-chart"></div>
            </div>
            <div class="data-grid" id="costsGrid">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
        
        <!-- Alternative Tab -->
        <div class="tab-content" id="alternative">
            <div class="chart-container">
                <div class="chart-header">
                    <h2 class="chart-title">Alternative Employment Measures</h2>
                </div>
                <div id="alternativeChart" class="category-chart"></div>
            </div>
            <div class="data-grid" id="alternativeGrid">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
        
        <!-- Inflation Tab -->
        <div class="tab-content" id="inflation">
            <div class="chart-container">
                <div class="chart-header">
                    <h2 class="chart-title">Inflation & Price Indicators</h2>
                </div>
                <div id="inflationChart" class="category-chart"></div>
            </div>
            <div class="data-grid" id="inflationGrid">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
        
        <!-- All Data Tab -->
        <div class="tab-content" id="all">
            <h3 style="margin: 1rem 0; color: #00ff88;">All Available BLS Data</h3>
            <div class="data-grid" id="allDataGrid">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
        
        <!-- Raw API Tab -->
        <div class="tab-content" id="raw">
            <h3 style="margin: 1rem 0; color: #00ff88;">Raw API Response</h3>
            <div class="raw-data-container">
                <pre class="raw-data" id="rawApiData">Loading API data...</pre>
            </div>
        </div>
    </div>
    
    <script>
        // BLS API Configuration - YOUR ACTUAL API ENDPOINT
        const BLS_CONFIG = {
            API_URL: 'https://tajry2f7v3.execute-api.us-east-1.amazonaws.com/prod/data',
            UPDATE_INTERVAL: 60000, // 60 seconds for auto-refresh
            CHART_UPDATE_INTERVAL: 120000 // 2 minutes for chart updates
        };
        
        // Global state for BLS data
        let blsData = {
            rawResponse: null,
            current: {},
            historical: {},
            crisis: {},
            stats: {},
            allData: {},
            lastUpdate: null,
            chartPeriod: '5y'
        };
        
        let autoUpdateInterval = null;
        let chartUpdateInterval = null;
        
        // Initialize the BLS platform
        async function initializePlatform() {
            console.log('🚀 Initializing BLS Employment Platform...');
            console.log('📡 Connecting to:', BLS_CONFIG.API_URL);
            
            try {
                // Load initial data - try all modes to get maximum data
                await loadAllAvailableData();
                
                // Setup event listeners
                setupEventListeners();
                
                // Start auto-update
                startAutoUpdate();
                
                console.log('✅ BLS Platform initialized successfully');
            } catch (error) {
                console.error('❌ Initialization failed:', error);
                showError('Failed to initialize. Check console for details.');
            }
        }
        
        // Load all available data from the API
        async function loadAllAvailableData() {
            console.log('📊 Loading all available BLS data...');
            
            // Try to load data from all modes
            const modes = ['core', 'demographics', 'states', 'jolts', 'payroll', 'sectors', 'costs', 'alternative', 'inflation', 'all'];
            
            for (const mode of modes) {
                try {
                    console.log(`Loading ${mode} data...`);
                    const data = await loadBLSData(mode);
                    
                    // Store all data
                    if (data) {
                        blsData.allData[mode] = data;
                        
                        // Process and display the data
                        processAPIResponse(data, mode);
                    }
                    
                    // Small delay between requests
                    await new Promise(resolve => setTimeout(resolve, 500));
                } catch (error) {
                    console.error(`Failed to load ${mode}:`, error);
                }
            }
            
            // Update all displays
            updateAllDisplays();
        }
        
        // Load BLS data for specific mode
        async function loadBLSData(mode = 'core', startYear = 2020) {
            try {
                console.log(`📊 Fetching BLS ${mode} data from API...`);
                
                const requestBody = {
                    mode: mode,
                    startYear: startYear,
                    endYear: new Date().getFullYear()
                };
                
                console.log('Request:', requestBody);
                
                const response = await axios.post(BLS_CONFIG.API_URL, requestBody, {
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    timeout: 30000
                });
                
                console.log(`Response for ${mode}:`, response.data);
                
                if (response.data) {
                    // Store raw response
                    blsData.rawResponse = response.data;
                    
                    // Update raw API display
                    updateRawApiDisplay(response.data);
                    
                    // Update connection status
                    updateConnectionStatus(true);
                    
                    return response.data;
                }
            } catch (error) {
                console.error(`Error loading BLS ${mode} data:`, error);
                updateConnectionStatus(false);
                
                // Try GET request as fallback
                try {
                    console.log('Trying GET request as fallback...');
                    const response = await axios.get(BLS_CONFIG.API_URL);
                    
                    if (response.data) {
                        blsData.rawResponse = response.data;
                        updateRawApiDisplay(response.data);
                        updateConnectionStatus(true);
                        return response.data;
                    }
                } catch (getError) {
                    console.error('GET request also failed:', getError);
                }
                
                throw error;
            }
        }
        
        // Process API response and extract all data
        function processAPIResponse(data, mode) {
            if (!data) return;
            
            console.log(`Processing ${mode} response...`);
            
            // Extract current metrics
            if (data.current_metrics) {
                blsData.current[mode] = data.current_metrics;
                console.log(`Found ${Object.keys(data.current_metrics).length} current metrics`);
            }
            
            // Extract chart data
            if (data.chart_data) {
                blsData.historical[mode] = data.chart_data;
                console.log(`Found ${Object.keys(data.chart_data).length} chart series`);
            }
            
            // Extract crisis analysis
            if (data.crisis_analysis) {
                blsData.crisis = data.crisis_analysis;
                updateCrisisDisplay(data.crisis_analysis);
            }
            
            // Extract statistics
            if (data.results) {
                blsData.stats = data.results;
                updateStatistics(data.results);
            }
            
            // Update last update time
            blsData.lastUpdate = new Date();
            updateLastUpdateTime();
        }
        
        // Update all displays with the loaded data
        function updateAllDisplays() {
            console.log('Updating all displays...');
            
            // Update overview with all available data
            const allCurrentMetrics = {};
            Object.values(blsData.current).forEach(modeData => {
                Object.assign(allCurrentMetrics, modeData);
            });
            
            console.log(`Total metrics available: ${Object.keys(allCurrentMetrics).length}`);
            
            // Update grids
            updateGrid('overviewGrid', allCurrentMetrics);
            updateGrid('allDataGrid', allCurrentMetrics);
            
            // Update specific category grids
            Object.keys(blsData.current).forEach(mode => {
                const gridId = mode + 'Grid';
                if (document.getElementById(gridId)) {
                    updateGrid(gridId, blsData.current[mode]);
                }
            });
            
            // Update key metrics
            updateKeyMetrics(allCurrentMetrics);
            
            // Update charts
            updateAllCharts();
        }
        
        // Update grid with real BLS data
        function updateGrid(gridId, data) {
            const grid = document.getElementById(gridId);
            if (!grid || !data) return;
            
            grid.innerHTML = '';
            
            const entries = Object.entries(data);
            console.log(`Updating ${gridId} with ${entries.length} items`);
            
            if (entries.length === 0) {
                grid.innerHTML = '<div class="message">No data available for this category</div>';
                return;
            }
            
            entries.forEach(([seriesId, indicator]) => {
                const card = document.createElement('div');
                card.className = 'data-card';
                
                const value = indicator.current || indicator.value || 0;
                const units = indicator.units || '';
                const title = indicator.title || seriesId;
                const category = indicator.category || 'BLS Data';
                const lastUpdated = indicator.last_updated || indicator.date || 'N/A';
                
                // Determine color based on value
                let valueClass = 'neutral';
                if (units === 'Percent' || units === '%') {
                    valueClass = value > 5 ? 'negative' : value < 3 ? 'positive' : 'neutral';
                }
                
                card.innerHTML = `
                    <div class="data-card-header">
                        <div class="data-title">${title}</div>
                        <div class="data-source">${category}</div>
                    </div>
                    <div class="data-value ${valueClass}">
                        ${formatValue(value, units)}
                    </div>
                    <div class="data-change">
                        <span>Updated: ${lastUpdated}</span>
                    </div>
                    <div class="series-id">Series: ${seriesId}</div>
                `;
                
                grid.appendChild(card);
            });
        }
        
        // Update key metrics display
        function updateKeyMetrics(data) {
            const metricsGrid = document.getElementById('keyMetrics');
            if (!metricsGrid) return;
            
            metricsGrid.innerHTML = '';
            
            // Priority indicators to show
            const priorityIndicators = [
                'LNS14000000', // Unemployment Rate
                'CES0000000001', // Total Nonfarm Payrolls
                'LNS11300000', // Labor Force Participation
                'JTS00000000JOL', // Job Openings
                'CES0500000008', // Average Hourly Earnings
                'CUUR0000SA0' // CPI
            ];
            
            // First add priority indicators if they exist
            priorityIndicators.forEach(seriesId => {
                if (data[seriesId]) {
                    const card = createMetricCard(seriesId, data[seriesId]);
                    metricsGrid.appendChild(card);
                }
            });
            
            // Then add other indicators up to 12 total
            let count = metricsGrid.children.length;
            Object.entries(data).forEach(([seriesId, metric]) => {
                if (count < 12 && !priorityIndicators.includes(seriesId)) {
                    const card = createMetricCard(seriesId, metric);
                    metricsGrid.appendChild(card);
                    count++;
                }
            });
        }
        
        // Create metric card
        function createMetricCard(seriesId, metric) {
            const card = document.createElement('div');
            card.className = 'metric-card';
            
            const value = metric.current || metric.value || 0;
            const units = metric.units || '';
            const title = metric.title || seriesId;
            
            let valueClass = 'neutral';
            if (units === 'Percent' || units === '%') {
                valueClass = value > 5 ? 'negative' : value < 3 ? 'positive' : 'neutral';
            }
            
            card.innerHTML = `
                <div class="metric-title">${title}</div>
                <div class="metric-value ${valueClass}">${formatValue(value, units)}</div>
                <div class="metric-change">
                    <span>${metric.last_updated || 'Latest'}</span>
                </div>
            `;
            
            return card;
        }
        
        // Format value based on units
        function formatValue(value, units) {
            if (value === null || value === undefined) return 'N/A';
            
            const numValue = parseFloat(value);
            if (isNaN(numValue)) return value;
            
            if (units === 'Thousands') {
                if (numValue >= 1000) {
                    return (numValue / 1000).toFixed(1) + 'M';
                }
                return numValue.toFixed(1) + 'K';
            } else if (units === 'Millions') {
                return numValue.toFixed(2) + 'M';
            } else if (units === 'Percent' || units === '%') {
                return numValue.toFixed(2) + '%';
            } else if (units === 'Dollars') {
                return '$' + numValue.toFixed(2);
            } else if (units === 'Hours') {
                return numValue.toFixed(1) + ' hrs';
            } else if (units === 'Index') {
                return numValue.toFixed(1);
            } else {
                return numValue.toFixed(2);
            }
        }
        
        // Update all charts
        function updateAllCharts() {
            console.log('Updating all charts...');
            
            // Combine all historical data
            const allHistoricalData = {};
            Object.values(blsData.historical).forEach(modeData => {
                Object.assign(allHistoricalData, modeData);
            });
            
            // Update main chart with combined data
            updateMainChart(allHistoricalData);
            
            // Update category charts
            Object.keys(blsData.historical).forEach(mode => {
                const chartId = mode + 'Chart';
                if (document.getElementById(chartId)) {
                    updateCategoryChart(chartId, blsData.historical[mode], mode);
                }
            });
        }
        
        // Update main chart
        function updateMainChart(data) {
            const chartDiv = document.getElementById('mainChart');
            if (!chartDiv || !data) return;
            
            const traces = [];
            const seriesIds = Object.keys(data).slice(0, 5); // Limit to 5 series for clarity
            
            seriesIds.forEach(seriesId => {
                const seriesData = data[seriesId];
                if (seriesData && seriesData.labels && seriesData.values) {
                    traces.push({
                        x: seriesData.labels,
                        y: seriesData.values,
                        type: 'scatter',
                        mode: 'lines',
                        name: seriesData.title || seriesId,
                        line: { width: 2 }
                    });
                }
            });
            
            if (traces.length === 0) {
                chartDiv.innerHTML = '<div style="text-align: center; padding: 2rem; color: #888;">No chart data available</div>';
                return;
            }
            
            const layout = {
                title: 'BLS Employment Indicators - Real Federal Data',
                paper_bgcolor: 'rgba(0, 0, 0, 0)',
                plot_bgcolor: 'rgba(0, 0, 0, 0.3)',
                font: { color: '#fff' },
                xaxis: {
                    title: 'Date',
                    gridcolor: 'rgba(255, 255, 255, 0.1)',
                    tickfont: { color: '#888' }
                },
                yaxis: {
                    gridcolor: 'rgba(255, 255, 255, 0.1)',
                    tickfont: { color: '#888' }
                },
                legend: {
                    font: { color: '#fff' },
                    bgcolor: 'rgba(0, 0, 0, 0.5)',
                    bordercolor: 'rgba(255, 255, 255, 0.2)',
                    borderwidth: 1
                },
                hovermode: 'x unified'
            };
            
            Plotly.newPlot('mainChart', traces, layout, {responsive: true});
        }
        
        // Update category chart
        function updateCategoryChart(chartId, data, category) {
            const chartDiv = document.getElementById(chartId);
            if (!chartDiv || !data) return;
            
            const traces = [];
            const seriesIds = Object.keys(data).slice(0, 10); // Show up to 10 series
            
            seriesIds.forEach(seriesId => {
                const seriesData = data[seriesId];
                if (seriesData && seriesData.labels && seriesData.values) {
                    traces.push({
                        x: seriesData.labels,
                        y: seriesData.values,
                        type: 'scatter',
                        mode: 'lines',
                        name: seriesData.title || seriesId,
                        line: { width: 2 }
                    });
                }
            });
            
            if (traces.length === 0) {
                chartDiv.innerHTML = '<div style="text-align: center; padding: 2rem; color: #888;">No chart data available</div>';
                return;
            }
            
            const layout = {
                title: `${category.toUpperCase()} - Historical Data`,
                paper_bgcolor: 'rgba(0, 0, 0, 0)',
                plot_bgcolor: 'rgba(0, 0, 0, 0.3)',
                font: { color: '#fff' },
                xaxis: {
                    gridcolor: 'rgba(255, 255, 255, 0.1)',
                    tickfont: { color: '#888' }
                },
                yaxis: {
                    gridcolor: 'rgba(255, 255, 255, 0.1)',
                    tickfont: { color: '#888' }
                },
                legend: { font: { color: '#fff' } },
                hovermode: 'x unified'
            };
            
            Plotly.newPlot(chartId, traces, layout, {responsive: true});
        }
        
        // Update crisis display
        function updateCrisisDisplay(crisis) {
            if (!crisis) return;
            
            // Update crisis level indicator
            const crisisLevel = document.getElementById('crisisLevel');
            const level = crisis.crisis_level || 'UNKNOWN';
            
            crisisLevel.textContent = level.toUpperCase();
            crisisLevel.className = `crisis-level ${
                level.includes('Severe') ? 'crisis-severe' :
                level.includes('Crisis') ? 'crisis-warning' :
                level.includes('Elevated') ? 'crisis-elevated' :
                'crisis-normal'
            }`;
            
            // Update unemployment rate
            if (crisis.current_unemployment_rate !== undefined) {
                document.getElementById('unemploymentRate').textContent = 
                    crisis.current_unemployment_rate.toFixed(1) + '%';
            }
            
            // Update crisis banner
            const banner = document.getElementById('crisisPhaseBanner');
            if (banner && crisis.current_unemployment_rate !== undefined) {
                const rate = crisis.current_unemployment_rate;
                let message = '';
                
                if (rate >= 10) {
                    message = '🚨 SEVERE CRISIS: UNEMPLOYMENT CRITICAL';
                } else if (rate >= 7) {
                    message = '🔴 CRISIS MODE: ELEVATED UNEMPLOYMENT';
                } else if (rate >= 5) {
                    message = '🟡 WARNING: UNEMPLOYMENT RISING';
                } else {
                    message = `🟢 NORMAL: UNEMPLOYMENT AT ${rate.toFixed(1)}%`;
                }
                
                banner.textContent = message;
            }
            
            // Update crisis alert
            const alertSummary = document.getElementById('crisisAlertSummary');
            if (alertSummary && crisis.current_unemployment_rate >= 7) {
                alertSummary.style.display = 'block';
                document.getElementById('crisisMessage').innerHTML = `
                    <p>Unemployment Rate: ${crisis.current_unemployment_rate}%</p>
                    <p>Crisis Level: ${crisis.crisis_level}</p>
                    <p>Trend: ${crisis.trend || 'Unknown'}</p>
                `;
            }
        }
        
        // Update statistics
        function updateStatistics(stats) {
            if (!stats) return;
            
            if (stats.series_fetched !== undefined) {
                document.getElementById('totalIndicators').textContent = stats.series_fetched;
            }
            
            if (stats.total_data_points !== undefined) {
                document.getElementById('dataPoints').textContent = stats.total_data_points;
            }
        }
        
        // Update connection status
        function updateConnectionStatus(connected) {
            const blsStatus = document.getElementById('blsApiStatus');
            const lambdaStatus = document.getElementById('lambdaStatus');
            const autoUpdateStatus = document.getElementById('autoUpdate');
            
            if (connected) {
                blsStatus.className = 'status-dot connected';
                lambdaStatus.className = 'status-dot connected';
                autoUpdateStatus.className = 'status-dot connected';
            } else {
                blsStatus.className = 'status-dot error';
                lambdaStatus.className = 'status-dot error';
                autoUpdateStatus.className = 'status-dot error';
            }
        }
        
        // Update raw API display
        function updateRawApiDisplay(data) {
            const rawDataElement = document.getElementById('rawApiData');
            if (rawDataElement && data) {
                rawDataElement.textContent = JSON.stringify(data, null, 2);
            }
        }
        
        // Update last update time
        function updateLastUpdateTime() {
            const lastUpdateEl = document.getElementById('lastUpdate');
            if (!lastUpdateEl) return;
            
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-US', { 
                hour: 'numeric', 
                minute: '2-digit'
            });
            
            lastUpdateEl.textContent = timeStr;
        }
        
        // Update chart period
        window.updateChartPeriod = function(period) {
            blsData.chartPeriod = period;
            
            // Update button states
            document.querySelectorAll('.chart-control-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // Determine start year based on period
            let startYear = new Date().getFullYear();
            switch(period) {
                case '1y':
                    startYear = new Date().getFullYear() - 1;
                    break;
                case '5y':
                    startYear = new Date().getFullYear() - 5;
                    break;
                case '10y':
                    startYear = new Date().getFullYear() - 10;
                    break;
                case 'all':
                    startYear = 2000;
                    break;
            }
            
            // Reload data with new period
            loadAllAvailableData();
        };
        
        // Setup event listeners
        function setupEventListeners() {
            // Tab navigation
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    // Update active tab
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    
                    // Show corresponding content
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    const tabId = e.target.dataset.tab;
                    document.getElementById(tabId).classList.add('active');
                });
            });
            
            // Add refresh button
            const refreshBtn = document.createElement('button');
            refreshBtn.textContent = '🔄 Refresh All Data';
            refreshBtn.style.cssText = 'position: fixed; bottom: 20px; right: 20px; padding: 10px 20px; background: #00ff88; color: #000; border: none; border-radius: 8px; cursor: pointer; font-weight: bold; z-index: 1000;';
            refreshBtn.onclick = () => {
                refreshBtn.disabled = true;
                refreshBtn.textContent = 'Loading...';
                
                loadAllAvailableData().then(() => {
                    refreshBtn.textContent = '✅ Updated!';
                    setTimeout(() => {
                        refreshBtn.textContent = '🔄 Refresh All Data';
                        refreshBtn.disabled = false;
                    }, 2000);
                }).catch(() => {
                    refreshBtn.textContent = '❌ Error';
                    setTimeout(() => {
                        refreshBtn.textContent = '🔄 Refresh All Data';
                        refreshBtn.disabled = false;
                    }, 2000);
                });
            };
            document.body.appendChild(refreshBtn);
        }
        
        // Start auto-update
        function startAutoUpdate() {
            console.log('🔄 Starting auto-update...');
            
            autoUpdateInterval = setInterval(() => {
                console.log('🔄 Auto-updating data...');
                loadAllAvailableData();
            }, BLS_CONFIG.UPDATE_INTERVAL);
        }
        
        // Show error message
        function showError(message) {
            console.error('❌ Error:', message);
            
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.style.cssText = 'position: fixed; top: 100px; right: 20px; z-index: 9999; max-width: 300px;';
            errorDiv.textContent = message;
            
            document.body.appendChild(errorDiv);
            
            setTimeout(() => {
                errorDiv.remove();
            }, 5000);
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            console.log('=====================================');
            console.log('BLS Employment Crisis Detection v2.0');
            console.log('Real-time Federal Employment Data');
            console.log('=====================================');
            
            initializePlatform();
        });
        
        // Cleanup on page unload
        window.addEventListener('beforeunload', () => {
            if (autoUpdateInterval) clearInterval(autoUpdateInterval);
            if (chartUpdateInterval) clearInterval(chartUpdateInterval);
        });
    </script>
</body>
</html>
