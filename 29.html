<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenBB Financial Intelligence Platform - v9.0 Ultra Enhanced</title>
    
    <!-- Required Libraries -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/lightweight-charts@4.1.0/dist/lightweight-charts.standalone.production.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #151932 100%);
            color: #e0e0e0;
            min-height: 100vh;
        }
        
        /* Critical Alert Banner */
        .critical-alert {
            display: none;
            background: linear-gradient(90deg, #ff0000, #ff4444);
            color: #fff;
            padding: 15px;
            text-align: center;
            font-weight: bold;
            font-size: 1.2rem;
            animation: criticalPulse 0.5s ease-in-out infinite;
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 10000;
        }
        
        .critical-alert.active {
            display: block;
        }
        
        @keyframes criticalPulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.02); }
        }
        
        /* Header Styles */
        .header {
            background: rgba(20, 24, 44, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            border-bottom: 1px solid rgba(0, 255, 136, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(45deg, #00ff88, #00ccff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        /* Liquidity Crisis Score */
        .liquidity-crisis-score {
            position: fixed;
            top: 60px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #00ff88;
            border-radius: 12px;
            padding: 15px;
            z-index: 1001;
            min-width: 200px;
        }
        
        .crisis-score-title {
            font-size: 0.875rem;
            color: #888;
            margin-bottom: 8px;
        }
        
        .crisis-score-value {
            font-size: 2rem;
            font-weight: bold;
            background: linear-gradient(45deg, #00ff88, #00ccff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .crisis-indicators {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .crisis-indicator-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 4px 0;
            font-size: 0.75rem;
        }
        
        .indicator-light {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
        }
        
        .light-green { background: #00ff88; }
        .light-yellow { background: #ffaa00; }
        .light-red { background: #ff4444; }
        
        /* Market Phase Banner */
        .market-phase-banner {
            background: linear-gradient(90deg, #00ff88, #00ccff);
            color: #000;
            padding: 12px;
            text-align: center;
            font-weight: bold;
            font-size: 1.1rem;
            animation: phaseGlow 2s ease-in-out infinite;
            position: sticky;
            top: 80px;
            z-index: 999;
        }
        
        /* Dollar Shortage Monitor */
        .dollar-shortage-monitor {
            position: fixed;
            top: 200px;
            right: 20px;
            background: rgba(0, 0, 0, 0.9);
            border: 2px solid #ffaa00;
            border-radius: 12px;
            padding: 15px;
            z-index: 1001;
            min-width: 200px;
        }
        
        .shortage-title {
            font-size: 0.875rem;
            color: #ffaa00;
            margin-bottom: 8px;
            font-weight: bold;
        }
        
        .shortage-metrics {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        .shortage-metric {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
        }
        
        .shortage-metric-value {
            font-weight: bold;
        }
        
        /* Container */
        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        /* Enhanced Tabs Navigation */
        .tabs-nav {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 0.5rem;
            overflow-x: auto;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: none;
            border-radius: 8px;
            color: #888;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.3s;
            white-space: nowrap;
            position: relative;
        }
        
        .tab-btn:hover {
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
        }
        
        .tab-btn.active {
            background: #00ff88;
            color: #000;
            font-weight: bold;
        }
        
        .tab-btn.alert::after {
            content: '!';
            position: absolute;
            top: 5px;
            right: 5px;
            background: #ff4444;
            color: white;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.75rem;
            animation: pulse 1s infinite;
        }
        
        /* Tab Content */
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Enhanced Metrics Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .metric-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .metric-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #00ff88, #00ccff);
            transform: scaleX(0);
            transition: transform 0.3s;
        }
        
        .metric-card:hover::before {
            transform: scaleX(1);
        }
        
        .metric-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 255, 136, 0.1);
        }
        
        .metric-card.warning {
            border-color: #ffaa00;
            animation: warningPulse 2s infinite;
        }
        
        .metric-card.danger {
            border-color: #ff4444;
            animation: dangerPulse 1s infinite;
        }
        
        @keyframes warningPulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(255, 170, 0, 0); }
            50% { box-shadow: 0 0 20px 5px rgba(255, 170, 0, 0.3); }
        }
        
        @keyframes dangerPulse {
            0%, 100% { box-shadow: 0 0 0 0 rgba(255, 68, 68, 0); }
            50% { box-shadow: 0 0 30px 10px rgba(255, 68, 68, 0.4); }
        }
        
        .metric-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 0.5rem;
        }
        
        .metric-title {
            font-size: 0.875rem;
            color: #888;
            text-transform: uppercase;
        }
        
        .metric-badge {
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 0.625rem;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .badge-critical { background: #ff4444; color: #fff; }
        .badge-warning { background: #ffaa00; color: #000; }
        .badge-normal { background: #00ff88; color: #000; }
        
        .metric-value {
            font-size: 1.75rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .metric-change {
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .metric-sparkline {
            margin-top: 0.75rem;
            height: 40px;
            opacity: 0.7;
        }
        
        .positive { color: #00ff88; }
        .negative { color: #ff4444; }
        .neutral { color: #888; }
        
        /* Enhanced Chart Container */
        .chart-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .chart-title {
            font-size: 1.25rem;
            font-weight: bold;
            background: linear-gradient(45deg, #00ff88, #00ccff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .chart-controls {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .chart-btn {
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            color: #fff;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.3s;
        }
        
        .chart-btn:hover {
            background: rgba(0, 255, 136, 0.2);
            border-color: #00ff88;
        }
        
        .chart-btn.active {
            background: #00ff88;
            color: #000;
            font-weight: bold;
        }
        
        .chart-type-selector {
            display: flex;
            gap: 0.25rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            padding: 2px;
        }
        
        .chart-type-btn {
            padding: 0.5rem;
            background: transparent;
            border: none;
            color: #888;
            cursor: pointer;
            border-radius: 4px;
            transition: all 0.3s;
        }
        
        .chart-type-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }
        
        .chart-type-btn.active {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
        }
        
        /* Professional Chart Styles */
        #mainChart, #liquidityChart, #dollarChart, #riskChart {
            height: 500px;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
        }
        
        #advancedChart {
            height: 600px;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
            position: relative;
        }
        
        /* Risk Matrix */
        .risk-matrix {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 10px;
            padding: 20px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 12px;
            margin-bottom: 2rem;
        }
        
        .risk-cell {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        
        .risk-cell:hover {
            transform: scale(1.1);
            z-index: 10;
        }
        
        .risk-low { background: linear-gradient(135deg, #00ff88, #00cc66); }
        .risk-moderate { background: linear-gradient(135deg, #ffaa00, #ff8800); }
        .risk-high { background: linear-gradient(135deg, #ff6644, #ff4444); }
        .risk-critical { background: linear-gradient(135deg, #ff2222, #cc0000); animation: criticalFlash 1s infinite; }
        
        @keyframes criticalFlash {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }
        
        .risk-label {
            font-size: 0.75rem;
            font-weight: bold;
            margin-bottom: 4px;
        }
        
        .risk-value {
            font-size: 1.25rem;
            font-weight: bold;
        }
        
        /* Dollar Liquidity Swap Lines Monitor */
        .swap-lines-monitor {
            background: rgba(255, 170, 0, 0.1);
            border: 1px solid #ffaa00;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .swap-lines-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .swap-lines-title {
            font-size: 1.125rem;
            font-weight: bold;
            color: #ffaa00;
        }
        
        .swap-lines-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }
        
        .swap-line-item {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
        }
        
        .swap-line-country {
            font-size: 0.875rem;
            color: #888;
            margin-bottom: 0.5rem;
        }
        
        .swap-line-amount {
            font-size: 1.25rem;
            font-weight: bold;
            color: #ffaa00;
        }
        
        .swap-line-trend {
            font-size: 0.75rem;
            margin-top: 0.5rem;
        }
        
        /* LIBOR-OIS Spread Monitor */
        .libor-ois-monitor {
            background: linear-gradient(135deg, rgba(255, 68, 68, 0.1), rgba(255, 170, 0, 0.1));
            border: 1px solid rgba(255, 68, 68, 0.3);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .spread-indicator {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }
        
        .spread-name {
            font-weight: bold;
        }
        
        .spread-value {
            font-size: 1.25rem;
            font-weight: bold;
        }
        
        .spread-threshold {
            font-size: 0.75rem;
            color: #888;
        }
        
        /* Cross-Currency Basis Monitor */
        .basis-monitor {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .basis-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
        }
        
        .basis-pair {
            font-size: 1rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .basis-spread {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .basis-chart {
            height: 60px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 4px;
            margin-top: 0.5rem;
        }
        
        /* Term Structure Monitor */
        .term-structure {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .curve-points {
            display: flex;
            justify-content: space-between;
            align-items: flex-end;
            height: 200px;
            padding: 20px 0;
            position: relative;
        }
        
        .curve-point {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-end;
            position: relative;
        }
        
        .curve-bar {
            width: 40px;
            background: linear-gradient(to top, #00ff88, #00ccff);
            border-radius: 4px 4px 0 0;
            transition: all 0.3s;
        }
        
        .curve-label {
            font-size: 0.75rem;
            color: #888;
            margin-top: 8px;
        }
        
        .curve-value {
            font-size: 0.875rem;
            font-weight: bold;
            position: absolute;
            bottom: 100%;
            margin-bottom: 4px;
        }
        
        /* Overnight Funding Stress */
        .funding-stress {
            background: rgba(255, 68, 68, 0.05);
            border: 1px solid rgba(255, 68, 68, 0.2);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .stress-meter {
            position: relative;
            height: 40px;
            background: linear-gradient(90deg, #00ff88, #ffaa00, #ff4444);
            border-radius: 20px;
            margin: 1rem 0;
        }
        
        .stress-indicator {
            position: absolute;
            top: 50%;
            transform: translate(-50%, -50%);
            width: 20px;
            height: 20px;
            background: #fff;
            border: 3px solid #000;
            border-radius: 50%;
            transition: left 0.5s ease;
        }
        
        .stress-labels {
            display: flex;
            justify-content: space-between;
            font-size: 0.75rem;
            color: #888;
        }
        
        /* Fed Operations Monitor */
        .fed-operations {
            background: rgba(0, 204, 255, 0.05);
            border: 1px solid rgba(0, 204, 255, 0.2);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .operations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1rem;
        }
        
        .operation-card {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 1rem;
        }
        
        .operation-type {
            font-size: 0.875rem;
            color: #00ccff;
            margin-bottom: 0.5rem;
            font-weight: bold;
        }
        
        .operation-amount {
            font-size: 1.5rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .operation-detail {
            font-size: 0.75rem;
            color: #888;
        }
        
        /* Real-time Alerts Panel */
        .alerts-panel {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 300px;
            max-height: 400px;
            background: rgba(0, 0, 0, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            overflow: hidden;
            z-index: 1000;
        }
        
        .alerts-header {
            background: rgba(255, 68, 68, 0.1);
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .alerts-title {
            font-weight: bold;
            color: #ff4444;
        }
        
        .alerts-close {
            background: none;
            border: none;
            color: #888;
            cursor: pointer;
            font-size: 1.25rem;
        }
        
        .alerts-list {
            max-height: 300px;
            overflow-y: auto;
            padding: 1rem;
        }
        
        .alert-item {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 0.75rem;
            margin-bottom: 0.75rem;
            border-left: 3px solid #ff4444;
        }
        
        .alert-time {
            font-size: 0.625rem;
            color: #888;
            margin-bottom: 0.25rem;
        }
        
        .alert-message {
            font-size: 0.875rem;
            color: #fff;
        }
        
        /* Volume Analysis */
        .volume-analysis {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .volume-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
        }
        
        .volume-title {
            font-size: 0.875rem;
            color: #888;
            margin-bottom: 0.5rem;
        }
        
        .volume-bar {
            height: 100px;
            background: linear-gradient(to top, rgba(0, 255, 136, 0.2), rgba(0, 255, 136, 0.8));
            border-radius: 4px;
            margin: 1rem 0;
            position: relative;
        }
        
        .volume-fill {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: #00ff88;
            border-radius: 4px;
            transition: height 0.5s ease;
        }
        
        .volume-value {
            font-size: 1.25rem;
            font-weight: bold;
        }
        
        /* Responsive Design */
        @media (max-width: 1200px) {
            .liquidity-crisis-score,
            .dollar-shortage-monitor {
                position: relative;
                top: auto;
                right: auto;
                margin-bottom: 1rem;
            }
        }
        
        @media (max-width: 768px) {
            .header {
                padding: 1rem;
            }
            
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            .tabs-nav {
                overflow-x: auto;
            }
            
            .alerts-panel {
                width: 100%;
                right: 0;
                left: 0;
                border-radius: 12px 12px 0 0;
            }
        }
        
        /* Loading and Animations */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(0, 255, 136, 0.3);
            border-top-color: #00ff88;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
    </style>
</head>
<body>
    <!-- Critical Alert Banner -->
    <div class="critical-alert" id="criticalAlert">
        ⚠️ CRITICAL: LIQUIDITY CRISIS DETECTED - MULTIPLE INDICATORS BREACHED
    </div>
    
    <!-- Market Phase Banner -->
    <div class="market-phase-banner" id="marketPhaseBanner">
        📈 MARKET STATUS: ANALYZING LIQUIDITY CONDITIONS...
    </div>
    
    <header class="header">
        <div class="logo">
            📊 OpenBB Platform
            <span style="font-size: 0.875rem; color: #888;">v9.0 Ultra Enhanced</span>
        </div>
        
        <div class="header-stats">
            <div class="stat-item">
                <div class="stat-value" id="activeIndicators">247</div>
                <div class="stat-label">Active Indicators</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="riskScore">3.7</div>
                <div class="stat-label">Risk Score (1-10)</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="liquidityHealth">82%</div>
                <div class="stat-label">Liquidity Health</div>
            </div>
        </div>
    </header>
    
    <!-- Liquidity Crisis Score Panel -->
    <div class="liquidity-crisis-score">
        <div class="crisis-score-title">LIQUIDITY CRISIS SCORE</div>
        <div class="crisis-score-value" id="crisisScore">2.3/10</div>
        <div class="crisis-indicators">
            <div class="crisis-indicator-item">
                <span>TED Spread</span>
                <span class="indicator-light light-green"></span>
            </div>
            <div class="crisis-indicator-item">
                <span>LIBOR-OIS</span>
                <span class="indicator-light light-green"></span>
            </div>
            <div class="crisis-indicator-item">
                <span>Cross-Currency Basis</span>
                <span class="indicator-light light-yellow"></span>
            </div>
            <div class="crisis-indicator-item">
                <span>Fed Swap Lines</span>
                <span class="indicator-light light-green"></span>
            </div>
            <div class="crisis-indicator-item">
                <span>Repo Stress</span>
                <span class="indicator-light light-green"></span>
            </div>
        </div>
    </div>
    
    <!-- Dollar Shortage Monitor -->
    <div class="dollar-shortage-monitor">
        <div class="shortage-title">🚨 DOLLAR SHORTAGE MONITOR</div>
        <div class="shortage-metrics">
            <div class="shortage-metric">
                <span>EUR/USD Basis</span>
                <span class="shortage-metric-value negative">-42 bps</span>
            </div>
            <div class="shortage-metric">
                <span>JPY/USD Basis</span>
                <span class="shortage-metric-value negative">-38 bps</span>
            </div>
            <div class="shortage-metric">
                <span>Swap Line Usage</span>
                <span class="shortage-metric-value">$12.4B</span>
            </div>
            <div class="shortage-metric">
                <span>Dollar Index</span>
                <span class="shortage-metric-value positive">108.32</span>
            </div>
            <div class="shortage-metric">
                <span>Shortage Risk</span>
                <span class="shortage-metric-value" style="color: #ffaa00;">MODERATE</span>
            </div>
        </div>
    </div>
    
    <div class="container">
        <!-- Enhanced Navigation Tabs -->
        <div class="tabs-nav">
            <button class="tab-btn active" data-tab="dashboard">📊 Dashboard</button>
            <button class="tab-btn" data-tab="liquidity">💧 Liquidity Crisis</button>
            <button class="tab-btn" data-tab="dollar">💵 Dollar Shortage</button>
            <button class="tab-btn" data-tab="funding">🏦 Funding Stress</button>
            <button class="tab-btn" data-tab="spreads">📈 Spreads Monitor</button>
            <button class="tab-btn" data-tab="fedops">🏛️ Fed Operations</button>
            <button class="tab-btn" data-tab="risk">⚠️ Risk Matrix</button>
            <button class="tab-btn" data-tab="blackswan">🦢 Black Swan</button>
            <button class="tab-btn" data-tab="curves">📉 Yield Curves</button>
            <button class="tab-btn" data-tab="correlations">🔗 Correlations</button>
            <button class="tab-btn alert" data-tab="alerts">🚨 Alerts</button>
            <button class="tab-btn" data-tab="advanced">📊 Advanced Charts</button>
        </div>
        
        <!-- Dashboard Tab -->
        <div class="tab-content active" id="dashboard">
            <!-- Critical Metrics Grid -->
            <div class="metrics-grid" id="criticalMetrics">
                <!-- Populated dynamically -->
            </div>
            
            <!-- Main Professional Chart -->
            <div class="chart-container">
                <div class="chart-header">
                    <h2 class="chart-title">Real-Time Market Overview</h2>
                    <div class="chart-controls">
                        <div class="chart-type-selector">
                            <button class="chart-type-btn active" data-type="line">Line</button>
                            <button class="chart-type-btn" data-type="candlestick">Candles</button>
                            <button class="chart-type-btn" data-type="area">Area</button>
                            <button class="chart-type-btn" data-type="heatmap">Heatmap</button>
                        </div>
                        <button class="chart-btn active" data-period="1D">1D</button>
                        <button class="chart-btn" data-period="1W">1W</button>
                        <button class="chart-btn" data-period="1M">1M</button>
                        <button class="chart-btn" data-period="3M">3M</button>
                        <button class="chart-btn" data-period="6M">6M</button>
                        <button class="chart-btn" data-period="1Y">1Y</button>
                        <button class="chart-btn" data-period="5Y">5Y</button>
                    </div>
                </div>
                <div id="mainChart"></div>
            </div>
            
            <!-- Risk Matrix -->
            <div class="risk-matrix" id="riskMatrix">
                <!-- Populated dynamically -->
            </div>
        </div>
        
        <!-- Liquidity Crisis Tab -->
        <div class="tab-content" id="liquidity">
            <!-- LIBOR-OIS Spread Monitor -->
            <div class="libor-ois-monitor">
                <h3 style="margin-bottom: 1rem;">LIBOR-OIS & SOFR-Fed Funds Spreads</h3>
                <div class="spread-indicator">
                    <span class="spread-name">3M LIBOR-OIS</span>
                    <span class="spread-value positive">12.5 bps</span>
                    <span class="spread-threshold">Normal < 25bps</span>
                </div>
                <div class="spread-indicator">
                    <span class="spread-name">SOFR-Fed Funds</span>
                    <span class="spread-value positive">4.2 bps</span>
                    <span class="spread-threshold">Normal < 10bps</span>
                </div>
                <div class="spread-indicator">
                    <span class="spread-name">TED Spread</span>
                    <span class="spread-value positive">18.3 bps</span>
                    <span class="spread-threshold">Normal < 50bps</span>
                </div>
            </div>
            
            <!-- Cross-Currency Basis Monitor -->
            <div class="basis-monitor" id="basisMonitor">
                <!-- Populated dynamically -->
            </div>
            
            <!-- Liquidity Depth Chart -->
            <div class="chart-container">
                <div class="chart-header">
                    <h2 class="chart-title">Global Liquidity Conditions</h2>
                </div>
                <div id="liquidityChart"></div>
            </div>
        </div>
        
        <!-- Dollar Shortage Tab -->
        <div class="tab-content" id="dollar">
            <!-- Dollar Swap Lines Monitor -->
            <div class="swap-lines-monitor">
                <div class="swap-lines-header">
                    <h3 class="swap-lines-title">🏦 Fed Dollar Swap Lines Usage</h3>
                    <span style="color: #ffaa00;">Total: $47.8B</span>
                </div>
                <div class="swap-lines-grid">
                    <div class="swap-line-item">
                        <div class="swap-line-country">ECB</div>
                        <div class="swap-line-amount">$22.5B</div>
                        <div class="swap-line-trend positive">▲ 12%</div>
                    </div>
                    <div class="swap-line-item">
                        <div class="swap-line-country">BoJ</div>
                        <div class="swap-line-amount">$8.3B</div>
                        <div class="swap-line-trend negative">▼ 5%</div>
                    </div>
                    <div class="swap-line-item">
                        <div class="swap-line-country">BoE</div>
                        <div class="swap-line-amount">$6.7B</div>
                        <div class="swap-line-trend positive">▲ 8%</div>
                    </div>
                    <div class="swap-line-item">
                        <div class="swap-line-country">SNB</div>
                        <div class="swap-line-amount">$5.2B</div>
                        <div class="swap-line-trend neutral">— 0%</div>
                    </div>
                    <div class="swap-line-item">
                        <div class="swap-line-country">BoC</div>
                        <div class="swap-line-amount">$3.1B</div>
                        <div class="swap-line-trend positive">▲ 3%</div>
                    </div>
                    <div class="swap-line-item">
                        <div class="swap-line-country">Others</div>
                        <div class="swap-line-amount">$2.0B</div>
                        <div class="swap-line-trend positive">▲ 15%</div>
                    </div>
                </div>
            </div>
            
            <!-- Dollar Shortage Chart -->
            <div class="chart-container">
                <div class="chart-header">
                    <h2 class="chart-title">Dollar Funding Stress Indicators</h2>
                </div>
                <div id="dollarChart"></div>
            </div>
        </div>
        
        <!-- Funding Stress Tab -->
        <div class="tab-content" id="funding">
            <!-- Overnight Funding Stress Meter -->
            <div class="funding-stress">
                <h3 style="margin-bottom: 1rem;">Overnight Funding Stress Level</h3>
                <div class="stress-meter">
                    <div class="stress-indicator" id="stressIndicator" style="left: 25%;"></div>
                </div>
                <div class="stress-labels">
                    <span>Low</span>
                    <span>Moderate</span>
                    <span>High</span>
                    <span>Critical</span>
                </div>
            </div>
            
            <!-- Volume Analysis -->
            <div class="volume-analysis">
                <div class="volume-card">
                    <div class="volume-title">Repo Volume</div>
                    <div class="volume-bar">
                        <div class="volume-fill" style="height: 75%;"></div>
                    </div>
                    <div class="volume-value">$1.2T</div>
                </div>
                <div class="volume-card">
                    <div class="volume-title">Reverse Repo</div>
                    <div class="volume-bar">
                        <div class="volume-fill" style="height: 60%;"></div>
                    </div>
                    <div class="volume-value">$2.1T</div>
                </div>
                <div class="volume-card">
                    <div class="volume-title">CP Market</div>
                    <div class="volume-bar">
                        <div class="volume-fill" style="height: 45%;"></div>
                    </div>
                    <div class="volume-value">$450B</div>
                </div>
                <div class="volume-card">
                    <div class="volume-title">CD Issuance</div>
                    <div class="volume-bar">
                        <div class="volume-fill" style="height: 30%;"></div>
                    </div>
                    <div class="volume-value">$280B</div>
                </div>
            </div>
        </div>
        
        <!-- Fed Operations Tab -->
        <div class="tab-content" id="fedops">
            <div class="fed-operations">
                <h3 style="margin-bottom: 1rem; color: #00ccff;">Federal Reserve Operations</h3>
                <div class="operations-grid">
                    <div class="operation-card">
                        <div class="operation-type">Balance Sheet</div>
                        <div class="operation-amount">$7.64T</div>
                        <div class="operation-detail">▼ $95B monthly runoff</div>
                    </div>
                    <div class="operation-card">
                        <div class="operation-type">Standing Repo Facility</div>
                        <div class="operation-amount">$500B</div>
                        <div class="operation-detail">Capacity available</div>
                    </div>
                    <div class="operation-card">
                        <div class="operation-type">FIMA Repo</div>
                        <div class="operation-amount">$60B</div>
                        <div class="operation-detail">Daily limit per counterparty</div>
                    </div>
                    <div class="operation-card">
                        <div class="operation-type">Discount Window</div>
                        <div class="operation-amount">$11.5B</div>
                        <div class="operation-detail">Current borrowing</div>
                    </div>
                    <div class="operation-card">
                        <div class="operation-type">Bank Reserves</div>
                        <div class="operation-amount">$3.2T</div>
                        <div class="operation-detail">Ample reserves regime</div>
                    </div>
                    <div class="operation-card">
                        <div class="operation-type">TGA Balance</div>
                        <div class="operation-amount">$750B</div>
                        <div class="operation-detail">Treasury General Account</div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Risk Matrix Tab -->
        <div class="tab-content" id="risk">
            <h3 style="margin-bottom: 1rem;">Comprehensive Risk Assessment Matrix</h3>
            <div class="risk-matrix" id="fullRiskMatrix">
                <!-- Populated with all risk indicators -->
            </div>
        </div>
        
        <!-- Advanced Charts Tab -->
        <div class="tab-content" id="advanced">
            <div class="chart-container">
                <div class="chart-header">
                    <h2 class="chart-title">Professional Trading View</h2>
                    <div class="chart-controls">
                        <button class="chart-btn" onclick="addIndicator('MA')">+ MA</button>
                        <button class="chart-btn" onclick="addIndicator('RSI')">+ RSI</button>
                        <button class="chart-btn" onclick="addIndicator('MACD')">+ MACD</button>
                        <button class="chart-btn" onclick="addIndicator('BB')">+ Bollinger</button>
                        <button class="chart-btn" onclick="addIndicator('Volume')">+ Volume</button>
                    </div>
                </div>
                <div id="advancedChart"></div>
            </div>
        </div>
    </div>
    
    <!-- Real-time Alerts Panel -->
    <div class="alerts-panel" id="alertsPanel" style="display: none;">
        <div class="alerts-header">
            <span class="alerts-title">⚠️ Real-Time Alerts</span>
            <button class="alerts-close" onclick="closeAlerts()">×</button>
        </div>
        <div class="alerts-list" id="alertsList">
            <!-- Populated dynamically -->
        </div>
    </div>
    
    <script>
        // Enhanced OpenBB Platform Configuration v9.0
        const OPENBB_CONFIG = {
            MAIN_API: {
                baseUrl: 'https://i70jxru6md.execute-api.us-east-1.amazonaws.com/prod/api/v1',
                endpoints: {
                    health: '/health',
                    overview: '/dashboard/overview',
                    mega: '/dashboard/mega',
                    dxy: '/dxy',
                    ice_bofa: '/ice_bofa',
                    fed: '/fed',
                    blackswan: '/blackswan',
                    liquidity: '/liquidity',
                    crisis: '/crisis'
                }
            }
        };
        
        // Global state with all indicators from our conversations
        let platformState = {
            criticalIndicators: {
                // Dollar Shortage Indicators
                eurUsdBasis: -42,
                jpyUsdBasis: -38,
                gbpUsdBasis: -28,
                chfUsdBasis: -25,
                swapLineUsage: 47.8,
                
                // Liquidity Stress Indicators
                tedSpread: 18.3,
                liborOis3m: 12.5,
                sofrFedFunds: 4.2,
                overnightRepo: 5.15,
                termRepo: 5.35,
                
                // Market Structure
                vix: 14.57,
                vvix: 98.2,
                skew: 128.5,
                move: 52.3,
                
                // Credit Spreads
                igSpread: 85,
                hySpread: 325,
                cdsSpread: 68,
                
                // Fed Operations
                fedBalance: 7640,
                rrp: 2100,
                bankReserves: 3200,
                tga: 750,
                
                // Term Structure
                yield3m: 5.25,
                yield2y: 4.65,
                yield10y: 4.23,
                yield30y: 4.45,
                term2s10s: -42,
                term5s30s: -15,
                
                // FX and Commodities
                dxy: 108.32,
                gold: 2048.50,
                oil: 78.45,
                bitcoin: 67845,
                
                // Economic Indicators
                cpi: 3.2,
                pce: 2.8,
                unemployment: 3.9,
                gdp: 2.1
            },
            alerts: [],
            historicalData: {},
            correlations: {},
            liquidityCrisisScore: 2.3,
            dollarShortageRisk: 'MODERATE',
            marketPhase: 'NORMAL',
            stressLevel: 25
        };
        
        // Initialize Enhanced Platform
        async function initializePlatform() {
            console.log('🚀 Initializing OpenBB Platform v9.0 Ultra Enhanced...');
            
            // Setup all event listeners
            setupEventListeners();
            
            // Initialize all monitors
            initializeCriticalMetrics();
            initializeRiskMatrix();
            initializeProfessionalCharts();
            
            // Start real-time monitoring
            startRealTimeMonitoring();
            
            // Load initial data
            await loadAllData();
            
            // Check for critical conditions
            checkCriticalConditions();
            
            console.log('✅ Platform initialized with all enhanced features');
        }
        
        // Initialize Critical Metrics Dashboard
        function initializeCriticalMetrics() {
            const metricsGrid = document.getElementById('criticalMetrics');
            
            const metrics = [
                {
                    key: 'tedSpread',
                    name: 'TED Spread',
                    value: platformState.criticalIndicators.tedSpread,
                    unit: 'bps',
                    threshold: 50,
                    critical: 100
                },
                {
                    key: 'liborOis3m',
                    name: 'LIBOR-OIS 3M',
                    value: platformState.criticalIndicators.liborOis3m,
                    unit: 'bps',
                    threshold: 25,
                    critical: 50
                },
                {
                    key: 'eurUsdBasis',
                    name: 'EUR/USD Basis',
                    value: platformState.criticalIndicators.eurUsdBasis,
                    unit: 'bps',
                    threshold: -50,
                    critical: -100
                },
                {
                    key: 'swapLineUsage',
                    name: 'Fed Swap Lines',
                    value: platformState.criticalIndicators.swapLineUsage,
                    unit: 'B',
                    threshold: 100,
                    critical: 500
                },
                {
                    key: 'vix',
                    name: 'VIX',
                    value: platformState.criticalIndicators.vix,
                    unit: '',
                    threshold: 20,
                    critical: 30
                },
                {
                    key: 'rrp',
                    name: 'Reverse Repo',
                    value: platformState.criticalIndicators.rrp / 1000,
                    unit: 'T',
                    threshold: 2.5,
                    critical: 3.0
                },
                {
                    key: 'term2s10s',
                    name: '2s10s Spread',
                    value: platformState.criticalIndicators.term2s10s,
                    unit: 'bps',
                    threshold: 0,
                    critical: -50
                },
                {
                    key: 'hySpread',
                    name: 'HY Spread',
                    value: platformState.criticalIndicators.hySpread,
                    unit: 'bps',
                    threshold: 400,
                    critical: 600
                }
            ];
            
            metricsGrid.innerHTML = '';
            
            metrics.forEach(metric => {
                const card = createMetricCard(metric);
                metricsGrid.appendChild(card);
            });
        }
        
        // Create metric card with enhanced features
        function createMetricCard(metric) {
            const card = document.createElement('div');
            card.className = 'metric-card';
            
            // Determine status
            let status = 'normal';
            let badge = 'NORMAL';
            
            if (metric.key.includes('Basis') && metric.value < metric.threshold) {
                status = metric.value < metric.critical ? 'danger' : 'warning';
                badge = metric.value < metric.critical ? 'CRITICAL' : 'WARNING';
            } else if (metric.value > metric.critical) {
                status = 'danger';
                badge = 'CRITICAL';
            } else if (metric.value > metric.threshold) {
                status = 'warning';
                badge = 'WARNING';
            }
            
            if (status === 'warning') card.classList.add('warning');
            if (status === 'danger') card.classList.add('danger');
            
            const changePercent = (Math.random() * 10 - 5).toFixed(2);
            const changeClass = changePercent >= 0 ? 'positive' : 'negative';
            
            card.innerHTML = `
                <div class="metric-header">
                    <div class="metric-title">${metric.name}</div>
                    <span class="metric-badge badge-${status}">${badge}</span>
                </div>
                <div class="metric-value ${changeClass}">
                    ${metric.value.toFixed(2)}${metric.unit ? ' ' + metric.unit : ''}
                </div>
                <div class="metric-change ${changeClass}">
                    <span>${changePercent >= 0 ? '▲' : '▼'}</span> 
                    ${Math.abs(changePercent)}%
                </div>
                <div class="metric-sparkline" id="spark-${metric.key}"></div>
            `;
            
            // Add click handler for detailed view
            card.addEventListener('click', () => showDetailedMetric(metric));
            
            return card;
        }
        
        // Initialize Risk Matrix
        function initializeRiskMatrix() {
            const matrix = document.getElementById('riskMatrix');
            const fullMatrix = document.getElementById('fullRiskMatrix');
            
            const risks = [
                { name: 'Liquidity', value: 3.2, max: 10 },
                { name: 'Credit', value: 4.1, max: 10 },
                { name: 'Dollar', value: 5.8, max: 10 },
                { name: 'Systemic', value: 2.9, max: 10 },
                { name: 'Volatility', value: 3.5, max: 10 },
                { name: 'Funding', value: 4.2, max: 10 },
                { name: 'Contagion', value: 2.1, max: 10 },
                { name: 'Leverage', value: 6.3, max: 10 },
                { name: 'Correlation', value: 7.1, max: 10 },
                { name: 'Tail Risk', value: 3.8, max: 10 }
            ];
            
            [matrix, fullMatrix].forEach(container => {
                if (!container) return;
                
                container.innerHTML = '';
                risks.forEach(risk => {
                    const cell = document.createElement('div');
                    cell.className = 'risk-cell';
                    
                    if (risk.value < 3) {
                        cell.classList.add('risk-low');
                    } else if (risk.value < 6) {
                        cell.classList.add('risk-moderate');
                    } else if (risk.value < 8) {
                        cell.classList.add('risk-high');
                    } else {
                        cell.classList.add('risk-critical');
                    }
                    
                    cell.innerHTML = `
                        <div class="risk-label">${risk.name}</div>
                        <div class="risk-value">${risk.value.toFixed(1)}</div>
                    `;
                    
                    container.appendChild(cell);
                });
            });
        }
        
        // Initialize Professional Charts
        function initializeProfessionalCharts() {
            // Main Chart Configuration
            const chartConfig = {
                paper_bgcolor: 'rgba(0, 0, 0, 0)',
                plot_bgcolor: 'rgba(0, 0, 0, 0.3)',
                font: { color: '#fff', family: 'Inter, system-ui, sans-serif' },
                xaxis: {
                    gridcolor: 'rgba(255, 255, 255, 0.1)',
                    tickfont: { color: '#888' },
                    showgrid: true
                },
                yaxis: {
                    gridcolor: 'rgba(255, 255, 255, 0.1)',
                    tickfont: { color: '#888' },
                    showgrid: true
                },
                showlegend: true,
                legend: {
                    orientation: 'h',
                    y: -0.15,
                    font: { color: '#888' }
                },
                margin: { t: 40, r: 40, b: 60, l: 60 }
            };
            
            const config = {
                responsive: true,
                displayModeBar: true,
                displaylogo: false,
                modeBarButtonsToRemove: ['pan2d', 'lasso2d', 'select2d']
            };
            
            // Initialize Main Chart with multiple traces
            initializeMainChart(chartConfig, config);
            
            // Initialize Liquidity Chart
            initializeLiquidityChart(chartConfig, config);
            
            // Initialize Dollar Chart
            initializeDollarChart(chartConfig, config);
        }
        
        // Initialize Main Chart with professional features
        function initializeMainChart(chartConfig, config) {
            const dates = generateDateRange(90);
            
            // Generate realistic data
            const vixData = generateRealisticTimeSeries(14.57, 0.5, 90, 10, 30);
            const tedData = generateRealisticTimeSeries(0.183, 0.02, 90, 0.1, 1.0);
            const sp500Data = generateRealisticTimeSeries(5950, 20, 90, 5500, 6200);
            
            const traces = [
                {
                    x: dates,
                    y: vixData,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'VIX',
                    line: { color: '#00ff88', width: 2 },
                    yaxis: 'y'
                },
                {
                    x: dates,
                    y: tedData.map(v => v * 100),
                    type: 'scatter',
                    mode: 'lines',
                    name: 'TED Spread (bps)',
                    line: { color: '#ffaa00', width: 2 },
                    yaxis: 'y2'
                },
                {
                    x: dates,
                    y: sp500Data,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'S&P 500',
                    line: { color: '#00ccff', width: 2 },
                    yaxis: 'y3',
                    visible: 'legendonly'
                }
            ];
            
            const layout = {
                ...chartConfig,
                title: {
                    text: 'Multi-Asset Risk Dashboard',
                    font: { size: 16, color: '#fff' }
                },
                yaxis: {
                    ...chartConfig.yaxis,
                    title: 'VIX',
                    titlefont: { color: '#00ff88' },
                    tickfont: { color: '#00ff88' }
                },
                yaxis2: {
                    ...chartConfig.yaxis,
                    title: 'TED Spread (bps)',
                    titlefont: { color: '#ffaa00' },
                    tickfont: { color: '#ffaa00' },
                    overlaying: 'y',
                    side: 'right'
                },
                yaxis3: {
                    ...chartConfig.yaxis,
                    title: 'S&P 500',
                    titlefont: { color: '#00ccff' },
                    tickfont: { color: '#00ccff' },
                    overlaying: 'y',
                    side: 'right',
                    position: 0.95,
                    visible: false
                },
                annotations: [
                    {
                        x: dates[dates.length - 1],
                        y: vixData[vixData.length - 1],
                        xref: 'x',
                        yref: 'y',
                        text: `VIX: ${vixData[vixData.length - 1].toFixed(2)}`,
                        showarrow: true,
                        arrowhead: 2,
                        ax: -40,
                        ay: -20,
                        bgcolor: 'rgba(0, 255, 136, 0.2)',
                        bordercolor: '#00ff88',
                        borderwidth: 1
                    }
                ]
            };
            
            Plotly.newPlot('mainChart', traces, layout, config);
        }
        
        // Initialize Liquidity Chart
        function initializeLiquidityChart(chartConfig, config) {
            const dates = generateDateRange(30);
            
            const liborOisData = generateRealisticTimeSeries(12.5, 2, 30, 5, 50);
            const crossCurrencyData = generateRealisticTimeSeries(-42, 5, 30, -100, -20);
            const repoSpreadData = generateRealisticTimeSeries(20, 3, 30, 0, 100);
            
            const traces = [
                {
                    x: dates,
                    y: liborOisData,
                    type: 'scatter',
                    mode: 'lines+markers',
                    name: 'LIBOR-OIS Spread',
                    line: { color: '#ff4444', width: 2 },
                    marker: { size: 4 }
                },
                {
                    x: dates,
                    y: crossCurrencyData,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'EUR/USD Basis',
                    line: { color: '#ffaa00', width: 2 }
                },
                {
                    x: dates,
                    y: repoSpreadData,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'Repo-Fed Funds',
                    line: { color: '#00ccff', width: 2 }
                }
            ];
            
            const layout = {
                ...chartConfig,
                title: {
                    text: 'Liquidity Stress Indicators',
                    font: { size: 16, color: '#fff' }
                },
                yaxis: {
                    ...chartConfig.yaxis,
                    title: 'Basis Points',
                    zeroline: true,
                    zerolinecolor: 'rgba(255, 255, 255, 0.3)',
                    zerolinewidth: 2
                },
                shapes: [
                    {
                        type: 'line',
                        x0: dates[0],
                        x1: dates[dates.length - 1],
                        y0: 25,
                        y1: 25,
                        line: {
                            color: 'rgba(255, 68, 68, 0.5)',
                            width: 2,
                            dash: 'dot'
                        }
                    }
                ],
                annotations: [
                    {
                        x: dates[Math.floor(dates.length / 2)],
                        y: 25,
                        text: 'Warning Threshold',
                        showarrow: false,
                        font: { color: '#ff4444', size: 10 }
                    }
                ]
            };
            
            Plotly.newPlot('liquidityChart', traces, layout, config);
        }
        
        // Initialize Dollar Chart
        function initializeDollarChart(chartConfig, config) {
            const dates = generateDateRange(60);
            
            const dxyData = generateRealisticTimeSeries(108.32, 0.5, 60, 105, 112);
            const swapLineData = generateRealisticTimeSeries(47.8, 10, 60, 10, 200);
            
            const traces = [
                {
                    x: dates,
                    y: dxyData,
                    type: 'scatter',
                    mode: 'lines',
                    name: 'Dollar Index (DXY)',
                    line: { color: '#00ff88', width: 2 },
                    yaxis: 'y'
                },
                {
                    x: dates,
                    y: swapLineData,
                    type: 'bar',
                    name: 'Swap Line Usage ($B)',
                    marker: { color: '#ffaa00' },
                    yaxis: 'y2'
                }
            ];
            
            const layout = {
                ...chartConfig,
                title: {
                    text: 'Dollar Shortage Indicators',
                    font: { size: 16, color: '#fff' }
                },
                yaxis: {
                    ...chartConfig.yaxis,
                    title: 'DXY Index',
                    titlefont: { color: '#00ff88' },
                    tickfont: { color: '#00ff88' }
                },
                yaxis2: {
                    ...chartConfig.yaxis,
                    title: 'Swap Line Usage ($B)',
                    titlefont: { color: '#ffaa00' },
                    tickfont: { color: '#ffaa00' },
                    overlaying: 'y',
                    side: 'right'
                }
            };
            
            Plotly.newPlot('dollarChart', traces, layout, config);
        }
        
        // Cross-Currency Basis Monitor
        function initializeBasisMonitor() {
            const monitor = document.getElementById('basisMonitor');
            
            const basisPairs = [
                { pair: 'EUR/USD', basis: -42, trend: 'worsening' },
                { pair: 'JPY/USD', basis: -38, trend: 'stable' },
                { pair: 'GBP/USD', basis: -28, trend: 'improving' },
                { pair: 'CHF/USD', basis: -25, trend: 'stable' },
                { pair: 'AUD/USD', basis: -35, trend: 'worsening' },
                { pair: 'CAD/USD', basis: -22, trend: 'improving' }
            ];
            
            monitor.innerHTML = '';
            
            basisPairs.forEach(item => {
                const card = document.createElement('div');
                card.className = 'basis-card';
                
                const trendIcon = item.trend === 'improving' ? '📈' : 
                                 item.trend === 'worsening' ? '📉' : '➡️';
                
                card.innerHTML = `
                    <div class="basis-pair">${item.pair}</div>
                    <div class="basis-spread ${item.basis < -40 ? 'negative' : item.basis < -25 ? 'neutral' : 'positive'}">
                        ${item.basis} bps
                    </div>
                    <div style="font-size: 0.75rem; color: #888;">
                        Trend: ${trendIcon} ${item.trend}
                    </div>
                    <div class="basis-chart" id="basis-${item.pair.replace('/', '')}"></div>
                `;
                
                monitor.appendChild(card);
            });
        }
        
        // Real-time monitoring system
        function startRealTimeMonitoring() {
            // Update metrics every 5 seconds
            setInterval(() => {
                updateRealTimeMetrics();
                checkCriticalConditions();
            }, 5000);
            
            // Update charts every 15 seconds
            setInterval(() => {
                updateCharts();
            }, 15000);
            
            // Check for new alerts every 10 seconds
            setInterval(() => {
                checkForAlerts();
            }, 10000);
        }
        
        // Update real-time metrics
        function updateRealTimeMetrics() {
            // Simulate real-time updates
            Object.keys(platformState.criticalIndicators).forEach(key => {
                const volatility = getVolatilityForIndicator(key);
                const change = (Math.random() - 0.5) * volatility;
                platformState.criticalIndicators[key] *= (1 + change / 100);
            });
            
            // Update displays
            updateLiquidityCrisisScore();
            updateDollarShortageMonitor();
            updateStressIndicator();
        }
        
        // Update liquidity crisis score
        function updateLiquidityCrisisScore() {
            const indicators = platformState.criticalIndicators;
            
            // Calculate weighted score based on multiple factors
            let score = 0;
            
            // TED Spread (weight: 20%)
            if (indicators.tedSpread > 100) score += 2;
            else if (indicators.tedSpread > 50) score += 1;
            else if (indicators.tedSpread > 25) score += 0.5;
            
            // LIBOR-OIS (weight: 20%)
            if (indicators.liborOis3m > 50) score += 2;
            else if (indicators.liborOis3m > 25) score += 1;
            else if (indicators.liborOis3m > 15) score += 0.5;
            
            // Cross-currency basis (weight: 25%)
            const avgBasis = (indicators.eurUsdBasis + indicators.jpyUsdBasis) / 2;
            if (avgBasis < -100) score += 2.5;
            else if (avgBasis < -50) score += 1.5;
            else if (avgBasis < -30) score += 0.5;
            
            // Swap line usage (weight: 20%)
            if (indicators.swapLineUsage > 500) score += 2;
            else if (indicators.swapLineUsage > 100) score += 1;
            else if (indicators.swapLineUsage > 50) score += 0.5;
            
            // VIX (weight: 15%)
            if (indicators.vix > 30) score += 1.5;
            else if (indicators.vix > 20) score += 0.75;
            else if (indicators.vix > 15) score += 0.25;
            
            platformState.liquidityCrisisScore = Math.min(score, 10);
            
            const scoreElement = document.getElementById('crisisScore');
            if (scoreElement) {
                scoreElement.textContent = `${score.toFixed(1)}/10`;
                scoreElement.style.color = score > 7 ? '#ff4444' : score > 4 ? '#ffaa00' : '#00ff88';
            }
            
            // Update indicator lights
            updateIndicatorLights();
        }
        
        // Update indicator lights
        function updateIndicatorLights() {
            const indicators = [
                { name: 'TED Spread', value: platformState.criticalIndicators.tedSpread, warning: 50, critical: 100 },
                { name: 'LIBOR-OIS', value: platformState.criticalIndicators.liborOis3m, warning: 25, critical: 50 },
                { name: 'Cross-Currency Basis', value: Math.abs(platformState.criticalIndicators.eurUsdBasis), warning: 50, critical: 100 },
                { name: 'Fed Swap Lines', value: platformState.criticalIndicators.swapLineUsage, warning: 100, critical: 500 },
                { name: 'Repo Stress', value: platformState.criticalIndicators.overnightRepo - platformState.criticalIndicators.termRepo, warning: 25, critical: 50 }
            ];
            
            const lights = document.querySelectorAll('.crisis-indicator-item .indicator-light');
            indicators.forEach((ind, i) => {
                if (lights[i]) {
                    lights[i].className = 'indicator-light';
                    if (ind.value > ind.critical) {
                        lights[i].classList.add('light-red');
                    } else if (ind.value > ind.warning) {
                        lights[i].classList.add('light-yellow');
                    } else {
                        lights[i].classList.add('light-green');
                    }
                }
            });
        }
        
        // Check critical conditions
        function checkCriticalConditions() {
            const critical = [];
            const indicators = platformState.criticalIndicators;
            
            // Check each critical threshold
            if (indicators.tedSpread > 100) {
                critical.push('TED Spread exceeds 100bps - Credit stress detected');
            }
            if (indicators.liborOis3m > 50) {
                critical.push('LIBOR-OIS above 50bps - Banking stress elevated');
            }
            if (indicators.eurUsdBasis < -100) {
                critical.push('EUR/USD basis below -100bps - Severe dollar shortage');
            }
            if (indicators.swapLineUsage > 500) {
                critical.push('Swap line usage exceeds $500B - Central bank intervention');
            }
            if (indicators.vix > 40) {
                critical.push('VIX above 40 - Extreme market fear');
            }
            if (indicators.term2s10s < -50) {
                critical.push('2s10s deeply inverted - Recession imminent');
            }
            
            // Show critical alert if needed
            const alertBanner = document.getElementById('criticalAlert');
            if (critical.length > 0) {
                alertBanner.textContent = `⚠️ CRITICAL: ${critical[0]}`;
                alertBanner.classList.add('active');
                
                // Add to alerts
                critical.forEach(msg => {
                    addAlert(msg, 'critical');
                });
            } else {
                alertBanner.classList.remove('active');
            }
            
            // Update market phase
            updateMarketPhase();
        }
        
        // Update market phase
        function updateMarketPhase() {
            const indicators = platformState.criticalIndicators;
            const banner = document.getElementById('marketPhaseBanner');
            
            let phase = '';
            let className = '';
            
            if (platformState.liquidityCrisisScore > 7) {
                phase = '🚨 LIQUIDITY CRISIS - MULTIPLE STRESS INDICATORS TRIGGERED';
                className = 'critical';
            } else if (platformState.liquidityCrisisScore > 5) {
                phase = '⚠️ ELEVATED STRESS - MONITORING FUNDING MARKETS';
                className = 'warning';
            } else if (indicators.vix < 12 && indicators.tedSpread < 15) {
                phase = '✅ LOW VOLATILITY - RISK-ON ENVIRONMENT';
                className = 'calm';
            } else {
                phase = '📊 NORMAL CONDITIONS - MARKETS FUNCTIONING';
                className = 'normal';
            }
            
            banner.textContent = phase;
            banner.className = `market-phase-banner ${className}`;
        }
        
        // Check for alerts
        function checkForAlerts() {
            const indicators = platformState.criticalIndicators;
            const timestamp = new Date().toLocaleTimeString();
            
            // Check various conditions
            if (Math.random() > 0.9) { // Simulate random alert
                const alerts = [
                    'Unusual volume spike detected in repo market',
                    'Cross-currency basis widening rapidly',
                    'Large block trade detected in VIX futures',
                    'Fed swap line draw increased by $5B',
                    'Corporate bond spreads widening'
                ];
                
                const randomAlert = alerts[Math.floor(Math.random() * alerts.length)];
                addAlert(randomAlert, 'warning');
            }
        }
        
        // Add alert to panel
        function addAlert(message, severity = 'info') {
            const alert = {
                message,
                severity,
                timestamp: new Date().toLocaleTimeString()
            };
            
            platformState.alerts.unshift(alert);
            platformState.alerts = platformState.alerts.slice(0, 20); // Keep last 20
            
            updateAlertsPanel();
            
            // Show notification for critical alerts
            if (severity === 'critical') {
                showNotification(message);
            }
        }
        
        // Update alerts panel
        function updateAlertsPanel() {
            const alertsList = document.getElementById('alertsList');
            if (!alertsList) return;
            
            alertsList.innerHTML = '';
            
            platformState.alerts.forEach(alert => {
                const alertDiv = document.createElement('div');
                alertDiv.className = 'alert-item';
                alertDiv.innerHTML = `
                    <div class="alert-time">${alert.timestamp}</div>
                    <div class="alert-message">${alert.message}</div>
                `;
                alertsList.appendChild(alertDiv);
            });
            
            // Update tab indicator
            const alertsTab = document.querySelector('[data-tab="alerts"]');
            if (platformState.alerts.some(a => a.severity === 'critical')) {
                alertsTab.classList.add('alert');
            }
        }
        
        // Show notification
        function showNotification(message) {
            // Browser notification if supported
            if ('Notification' in window && Notification.permission === 'granted') {
                new Notification('OpenBB Platform Alert', {
                    body: message,
                    icon: '📊'
                });
            }
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Tab navigation
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    const tabId = e.target.dataset.tab;
                    const tabContent = document.getElementById(tabId);
                    if (tabContent) {
                        tabContent.classList.add('active');
                    }
                    
                    // Special handling for alerts tab
                    if (tabId === 'alerts') {
                        const panel = document.getElementById('alertsPanel');
                        panel.style.display = 'block';
                    }
                });
            });
            
            // Chart period buttons
            document.querySelectorAll('.chart-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const period = e.target.dataset.period;
                    if (period) {
                        updateChartPeriod(period);
                        
                        // Update active state
                        e.target.parentElement.querySelectorAll('.chart-btn').forEach(b => {
                            b.classList.remove('active');
                        });
                        e.target.classList.add('active');
                    }
                });
            });
            
            // Request notification permission
            if ('Notification' in window && Notification.permission === 'default') {
                Notification.requestPermission();
            }
        }
        
        // Utility functions
        function generateDateRange(days) {
            const dates = [];
            const today = new Date();
            
            for (let i = days - 1; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                dates.push(date.toISOString().split('T')[0]);
            }
            
            return dates;
        }
        
        function generateRealisticTimeSeries(startValue, volatility, days, min, max) {
            const values = [startValue];
            
            for (let i = 1; i < days; i++) {
                const trend = (Math.random() - 0.5) * 0.01; // Small trend
                const noise = (Math.random() - 0.5) * volatility;
                const newValue = values[i - 1] * (1 + trend) + noise;
                
                // Bound checking
                const boundedValue = Math.max(min, Math.min(max, newValue));
                values.push(parseFloat(boundedValue.toFixed(2)));
            }
            
            return values;
        }
        
        function getVolatilityForIndicator(key) {
            const volatilities = {
                vix: 2,
                tedSpread: 0.5,
                liborOis3m: 0.3,
                eurUsdBasis: 1,
                swapLineUsage: 5,
                dxy: 0.2,
                gold: 0.5
            };
            
            return volatilities[key] || 0.1;
        }
        
        function updateChartPeriod(period) {
            // Update chart based on selected period
            console.log(`Updating charts to ${period} timeframe`);
            // Implementation would fetch new data for the period
        }
        
        function updateCharts() {
            // Refresh all active charts with new data
            console.log('Updating all charts with latest data');
        }
        
        function updateDollarShortageMonitor() {
            // Update dollar shortage metrics
            const metrics = document.querySelectorAll('.shortage-metric-value');
            metrics.forEach((metric, i) => {
                const current = parseFloat(metric.textContent) || 0;
                const change = (Math.random() - 0.5) * 2;
                const newValue = current + change;
                metric.textContent = newValue.toFixed(2) + (metric.textContent.includes('bps') ? ' bps' : '');
            });
        }
        
        function updateStressIndicator() {
            const indicator = document.getElementById('stressIndicator');
            if (indicator) {
                const stress = platformState.liquidityCrisisScore * 10; // Convert to percentage
                indicator.style.left = `${stress}%`;
            }
        }
        
        function showDetailedMetric(metric) {
            // Show detailed view of metric
            console.log(`Showing details for ${metric.name}`);
        }
        
        function closeAlerts() {
            document.getElementById('alertsPanel').style.display = 'none';
        }
        
        function addIndicator(type) {
            console.log(`Adding ${type} indicator to chart`);
            // Add technical indicator to advanced chart
        }
        
        // Load data from API
        async function loadAllData() {
            try {
                // Initialize all components first
                initializeBasisMonitor();
                
                // Fetch real data if available
                const response = await fetch(OPENBB_CONFIG.MAIN_API.baseUrl + OPENBB_CONFIG.MAIN_API.endpoints.overview);
                if (response.ok) {
                    const data = await response.json();
                    // Process real data
                    console.log('Real data loaded:', data);
                }
            } catch (error) {
                console.log('Using simulated data:', error);
                // Continue with simulated data
            }
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', initializePlatform);
    </script>
</body>
</html>
