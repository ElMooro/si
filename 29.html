<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FRED Complete Dashboard v10.0 - All Indicators</title>
    
    <!-- Required Libraries -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjs/11.11.0/math.min.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #151932 100%);
            color: #e0e0e0;
            min-height: 100vh;
        }
        
        .header {
            background: rgba(20, 24, 44, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            border-bottom: 1px solid rgba(0, 255, 136, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(45deg, #00ff88, #00ccff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        .tabs-nav {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 0.5rem;
            overflow-x: auto;
        }
        
        .tab-btn {
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: none;
            border-radius: 8px;
            color: #888;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .tab-btn:hover {
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
        }
        
        .tab-btn.active {
            background: #00ff88;
            color: #000;
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Complete Indicators Table */
        .indicators-table-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            overflow-x: auto;
        }
        
        .indicators-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0;
        }
        
        .indicators-table thead {
            background: rgba(0, 255, 136, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .indicators-table th {
            padding: 1rem;
            text-align: left;
            font-weight: bold;
            color: #00ff88;
            border-bottom: 2px solid rgba(0, 255, 136, 0.3);
            font-size: 0.875rem;
            text-transform: uppercase;
            cursor: pointer;
            user-select: none;
        }
        
        .indicators-table th:hover {
            background: rgba(0, 255, 136, 0.2);
        }
        
        .sort-arrow {
            margin-left: 0.5rem;
            opacity: 0.5;
        }
        
        .sort-arrow.active {
            opacity: 1;
            color: #00ff88;
        }
        
        .indicators-table td {
            padding: 0.75rem 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 0.875rem;
        }
        
        .indicators-table tr:hover {
            background: rgba(0, 255, 136, 0.05);
        }
        
        .indicator-name {
            font-weight: bold;
            color: #fff;
            cursor: text;
            padding: 2px 6px;
            border-radius: 4px;
            transition: all 0.3s;
        }
        
        .indicator-name:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .indicator-name.editing {
            background: rgba(0, 255, 136, 0.3);
            outline: 2px solid #00ff88;
        }
        
        .value-cell {
            font-weight: bold;
            color: #00ccff;
            font-family: 'Monaco', 'Courier New', monospace;
        }
        
        .change-cell {
            font-weight: bold;
            font-family: 'Monaco', 'Courier New', monospace;
        }
        
        .positive {
            color: #00ff88;
        }
        
        .negative {
            color: #ff4444;
        }
        
        .neutral {
            color: #888;
        }
        
        /* Enhanced Heatmap */
        .heatmap-grid {
            display: grid;
            grid-template-columns: minmax(250px, 2fr) minmax(120px, 1fr) repeat(3, minmax(100px, 1fr));
            gap: 2px;
            background: rgba(255, 255, 255, 0.05);
            padding: 2px;
            border-radius: 8px;
            margin-bottom: 1rem;
        }
        
        .heatmap-cell {
            padding: 1rem;
            text-align: center;
            font-size: 0.875rem;
            transition: all 0.3s;
            border-radius: 4px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        
        .heatmap-cell.header {
            background: rgba(0, 255, 136, 0.1);
            font-weight: bold;
            color: #00ff88;
            text-transform: uppercase;
            font-size: 0.75rem;
        }
        
        .heat-extreme-negative {
            background: linear-gradient(135deg, #8B0000, #DC143C);
            color: #fff;
        }
        
        .heat-high-negative {
            background: linear-gradient(135deg, #DC143C, #FF4444);
            color: #fff;
        }
        
        .heat-moderate-negative {
            background: linear-gradient(135deg, #FF4444, #FF6666);
            color: #fff;
        }
        
        .heat-low-negative {
            background: linear-gradient(135deg, #FF6666, #FF8888);
            color: #fff;
        }
        
        .heat-neutral {
            background: rgba(255, 255, 255, 0.05);
            color: #888;
        }
        
        .heat-low-positive {
            background: linear-gradient(135deg, #88FF88, #66FF66);
            color: #000;
        }
        
        .heat-moderate-positive {
            background: linear-gradient(135deg, #66FF66, #44FF44);
            color: #000;
        }
        
        .heat-high-positive {
            background: linear-gradient(135deg, #44FF44, #00FF44);
            color: #000;
        }
        
        .heat-extreme-positive {
            background: linear-gradient(135deg, #00FF44, #00CC33);
            color: #000;
        }
        
        /* Chart Container */
        .chart-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .chart-controls {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .chart-btn {
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 6px;
            color: #fff;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.3s;
        }
        
        .chart-btn:hover {
            background: rgba(0, 255, 136, 0.2);
            border-color: #00ff88;
        }
        
        .chart-btn.active {
            background: #00ff88;
            color: #000;
            font-weight: bold;
        }
        
        /* Statistics Panel */
        .stats-panel {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .stat-label {
            font-size: 0.75rem;
            color: #888;
            text-transform: uppercase;
            margin-bottom: 0.5rem;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #00ff88;
        }
        
        /* Loading */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(0, 255, 136, 0.3);
            border-top-color: #00ff88;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Search Box */
        .search-container {
            margin-bottom: 1rem;
        }
        
        .search-input {
            width: 100%;
            max-width: 400px;
            padding: 0.75rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #fff;
            font-size: 0.875rem;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #00ff88;
            background: rgba(0, 255, 136, 0.05);
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">
            📊 FRED Complete Dashboard v10.0
        </div>
        <div id="lastUpdate" style="font-size: 0.875rem; color: #888;">Loading...</div>
    </header>
    
    <div class="container">
        <!-- Navigation Tabs -->
        <div class="tabs-nav">
            <button class="tab-btn active" data-tab="overview">📊 Complete Overview</button>
            <button class="tab-btn" data-tab="heatmap">🔥 Advanced Heatmap</button>
            <button class="tab-btn" data-tab="charts">📈 Interactive Charts</button>
            <button class="tab-btn" data-tab="liquidity">💧 Liquidity Analysis</button>
            <button class="tab-btn" data-tab="currencies">💱 Currencies & Forex</button>
        </div>
        
        <!-- Complete Overview Tab -->
        <div class="tab-content active" id="overview">
            <div class="stats-panel" id="statsPanel">
                <!-- Stats will be populated here -->
            </div>
            
            <div class="indicators-table-container">
                <div class="search-container">
                    <input type="text" class="search-input" id="searchInput" placeholder="Search indicators...">
                </div>
                
                <table class="indicators-table" id="indicatorsTable">
                    <thead>
                        <tr>
                            <th onclick="sortTable('name')">Indicator <span class="sort-arrow" data-col="name">↕</span></th>
                            <th onclick="sortTable('value')">Current Value <span class="sort-arrow" data-col="value">↕</span></th>
                            <th onclick="sortTable('wow')">WoW % <span class="sort-arrow" data-col="wow">↕</span></th>
                            <th onclick="sortTable('mom')">MoM % <span class="sort-arrow" data-col="mom">↕</span></th>
                            <th onclick="sortTable('qoq')">QoQ % <span class="sort-arrow" data-col="qoq">↕</span></th>
                            <th onclick="sortTable('category')">Category <span class="sort-arrow" data-col="category">↕</span></th>
                        </tr>
                    </thead>
                    <tbody id="indicatorsTableBody">
                        <tr>
                            <td colspan="6" class="loading">
                                <div class="spinner"></div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Advanced Heatmap Tab -->
        <div class="tab-content" id="heatmap">
            <div class="chart-container">
                <div class="chart-header">
                    <h2 style="color: #00ff88;">Complete Indicators Heatmap</h2>
                    <div class="chart-controls">
                        <button class="chart-btn active" onclick="filterHeatmap('all')">All</button>
                        <button class="chart-btn" onclick="filterHeatmap('stocks')">Stocks</button>
                        <button class="chart-btn" onclick="filterHeatmap('bonds')">Bonds</button>
                        <button class="chart-btn" onclick="filterHeatmap('commodities')">Commodities</button>
                        <button class="chart-btn" onclick="filterHeatmap('currencies')">Currencies</button>
                        <button class="chart-btn" onclick="filterHeatmap('liquidity')">Liquidity</button>
                    </div>
                </div>
                <div class="heatmap-grid" id="heatmapGrid">
                    <!-- Heatmap will be populated here -->
                </div>
            </div>
        </div>
        
        <!-- Interactive Charts Tab -->
        <div class="tab-content" id="charts">
            <div class="chart-container">
                <div class="chart-header">
                    <h2 style="color: #00ff88;">Multi-Indicator Analysis</h2>
                    <div class="chart-controls">
                        <button class="chart-btn active" data-chart="comparison">Comparison</button>
                        <button class="chart-btn" data-chart="correlation">Correlation</button>
                        <button class="chart-btn" data-chart="volatility">Volatility</button>
                        <button class="chart-btn" data-chart="trends">Trends</button>
                        <button class="chart-btn" data-chart="liquidity">Liquidity Flow</button>
                    </div>
                </div>
                <div id="mainChart" style="height: 600px;"></div>
            </div>
            
            <div class="chart-container">
                <div id="secondaryChart" style="height: 400px;"></div>
            </div>
        </div>
        
        <!-- Liquidity Analysis Tab -->
        <div class="tab-content" id="liquidity">
            <div class="chart-container">
                <div id="liquidityChart" style="height: 500px;"></div>
            </div>
            <div class="indicators-table-container">
                <table class="indicators-table">
                    <tbody id="liquidityTableBody">
                        <!-- Liquidity indicators will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Currencies Tab -->
        <div class="tab-content" id="currencies">
            <div class="chart-container">
                <div id="currenciesChart" style="height: 500px;"></div>
            </div>
            <div class="indicators-table-container">
                <table class="indicators-table">
                    <tbody id="currenciesTableBody">
                        <!-- Currency pairs will be populated here -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <script>
        // Configuration
        const FRED_API_CONFIG = {
            baseUrl: 'https://i70jxru6md.execute-api.us-east-1.amazonaws.com/prod/api/v1',
            endpoints: {
                mega: '/dashboard/mega',
                overview: '/dashboard/overview',
                fed: '/fed',
                blackswan: '/blackswan',
                liquidity: '/liquidity',
                crisis: '/crisis',
                dxy: '/dxy',
                ice_bofa: '/ice_bofa'
            }
        };
        
        // Global State
        let allIndicators = {};
        let historicalData = {};
        let customNames = {};
        let currentSort = { column: 'name', ascending: true };
        let currentFilter = 'all';
        let activeChartView = 'comparison';
        
        // Initialize
        async function initialize() {
            console.log('Initializing FRED Complete Dashboard...');
            
            // Load saved custom names
            loadCustomNames();
            
            // Fetch all data
            await fetchAllData();
            
            // Setup event listeners
            setupEventListeners();
            
            // Initialize charts
            initializeCharts();
            
            // Start auto-refresh
            startAutoRefresh();
            
            console.log('Dashboard initialized successfully');
        }
        
        // Fetch all available data from all endpoints
        async function fetchAllData() {
            try {
                const responses = await Promise.all([
                    fetch(FRED_API_CONFIG.baseUrl + FRED_API_CONFIG.endpoints.mega),
                    fetch(FRED_API_CONFIG.baseUrl + FRED_API_CONFIG.endpoints.overview),
                    fetch(FRED_API_CONFIG.baseUrl + FRED_API_CONFIG.endpoints.fed),
                    fetch(FRED_API_CONFIG.baseUrl + FRED_API_CONFIG.endpoints.blackswan),
                    fetch(FRED_API_CONFIG.baseUrl + FRED_API_CONFIG.endpoints.liquidity),
                    fetch(FRED_API_CONFIG.baseUrl + FRED_API_CONFIG.endpoints.crisis),
                    fetch(FRED_API_CONFIG.baseUrl + FRED_API_CONFIG.endpoints.dxy),
                    fetch(FRED_API_CONFIG.baseUrl + FRED_API_CONFIG.endpoints.ice_bofa)
                ]);
                
                const data = await Promise.all(responses.map(r => r.json().catch(() => ({}))));
                
                // Combine all indicators
                allIndicators = {};
                data.forEach(dataset => {
                    if (dataset.indicators) {
                        Object.assign(allIndicators, dataset.indicators);
                    }
                    // Also check for data at root level
                    Object.keys(dataset).forEach(key => {
                        if (key !== 'indicators' && typeof dataset[key] === 'object') {
                            allIndicators[key] = dataset[key];
                        }
                    });
                });
                
                // Process and calculate changes
                processIndicatorData();
                
                // Update displays
                updateStatsPanel();
                updateIndicatorsTable();
                updateHeatmap();
                updateCharts();
                
                // Update last update time
                document.getElementById('lastUpdate').textContent = 
                    `Last Update: ${new Date().toLocaleString()}`;
                    
            } catch (error) {
                console.error('Error fetching data:', error);
            }
        }
        
        // Process indicator data and calculate percentage changes
        function processIndicatorData() {
            for (const [key, data] of Object.entries(allIndicators)) {
                if (!data || data.value === null || data.value === undefined) continue;
                
                // Generate historical data (in production, this would come from the API)
                const history = generateHistoricalData(data.value, 90);
                historicalData[key] = history;
                
                // Calculate percentage changes
                const current = parseFloat(data.value);
                const weekAgo = history[history.length - 8] || current;
                const monthAgo = history[history.length - 31] || current;
                const quarterAgo = history[0] || current;
                
                allIndicators[key].wow = ((current - weekAgo) / weekAgo) * 100;
                allIndicators[key].mom = ((current - monthAgo) / monthAgo) * 100;
                allIndicators[key].qoq = ((current - quarterAgo) / quarterAgo) * 100;
                allIndicators[key].category = categorizeIndicator(key);
                allIndicators[key].displayName = customNames[key] || getDefaultName(key);
            }
        }
        
        // Generate historical data for testing (replace with actual API data)
        function generateHistoricalData(currentValue, days) {
            const data = [];
            let value = currentValue;
            
            for (let i = days; i > 0; i--) {
                const change = (Math.random() - 0.5) * 0.02;
                value = value * (1 + change);
                data.push(value);
            }
            
            data[data.length - 1] = currentValue;
            return data;
        }
        
        // Format large numbers
        function formatLargeNumber(value, key) {
            if (value === null || value === undefined) return 'N/A';
            
            const num = parseFloat(value);
            
            // Special formatting for specific indicators
            if (key === 'WALCL' || key.includes('BALANCE')) {
                // Fed balance sheet in trillions
                return `$${(num / 1000000).toFixed(3)}T`;
            }
            
            // Percentage indicators
            if (key.includes('RATE') || key === 'DGS10' || key === 'UNRATE' || key === 'CPIAUCSL') {
                return `${num.toFixed(2)}%`;
            }
            
            // Currency pairs
            if (key.includes('DEX')) {
                return num.toFixed(4);
            }
            
            // Large numbers formatting
            if (Math.abs(num) >= 1000000000000) {
                return `${(num / 1000000000000).toFixed(2)}T`;
            } else if (Math.abs(num) >= 1000000000) {
                return `${(num / 1000000000).toFixed(2)}B`;
            } else if (Math.abs(num) >= 1000000) {
                return `${(num / 1000000).toFixed(2)}M`;
            } else if (Math.abs(num) >= 1000) {
                return `${(num / 1000).toFixed(2)}K`;
            }
            
            return num.toFixed(2);
        }
        
        // Get default indicator name
        function getDefaultName(key) {
            const names = {
                'VIXCLS': 'VIX Volatility Index',
                'SP500': 'S&P 500 Index',
                'DJIA': 'Dow Jones Industrial',
                'NASDAQCOM': 'NASDAQ Composite',
                'RUSSELL2000': 'Russell 2000',
                'DTWEXBGS': 'US Dollar Index (DXY)',
                'DGS10': '10-Year Treasury Yield',
                'DGS2': '2-Year Treasury Yield',
                'DGS30': '30-Year Treasury Yield',
                'T10Y2Y': 'Term Spread (10Y-2Y)',
                'WALCL': 'Fed Balance Sheet Total',
                'WRESBAL': 'Reserve Balances',
                'RRPONTSYD': 'Reverse Repo Operations',
                'SOFR': 'SOFR Rate',
                'DFF': 'Fed Funds Rate',
                'TEDRATE': 'TED Spread',
                'UNRATE': 'Unemployment Rate',
                'CPIAUCSL': 'CPI Inflation',
                'CPILFESL': 'Core CPI',
                'GDP': 'GDP Growth Rate',
                'GOLDAMGBD228NLBM': 'Gold Price (London Fix)',
                'DCOILWTICO': 'WTI Crude Oil',
                'DEXUSEU': 'USD/EUR Exchange Rate',
                'DEXJPUS': 'USD/JPY Exchange Rate',
                'DEXUSUK': 'USD/GBP Exchange Rate',
                'DEXCHUS': 'USD/CNY Exchange Rate',
                'BAMLH0A0HYM2': 'High Yield Credit Spread',
                'BAMLC0A0CM': 'Investment Grade Spread',
                'MORTGAGE30US': '30-Year Mortgage Rate',
                'MORTGAGE15US': '15-Year Mortgage Rate',
                'M2SL': 'M2 Money Supply',
                'BOGMBASE': 'Monetary Base',
                'UMCSENT': 'Consumer Sentiment',
                'HOUST': 'Housing Starts',
                'INDPRO': 'Industrial Production',
                'PAYEMS': 'Nonfarm Payrolls',
                'CIVPART': 'Labor Force Participation',
                'DEXKOUS': 'USD/KRW Exchange Rate',
                'DEXINUS': 'USD/INR Exchange Rate',
                'DEXBZUS': 'USD/BRL Exchange Rate',
                'DEXMXUS': 'USD/MXN Exchange Rate',
                'DEXCAUS': 'USD/CAD Exchange Rate',
                'DEXSFUS': 'USD/ZAR Exchange Rate',
                'DEXSZUS': 'USD/CHF Exchange Rate',
                'DEXUSAL': 'USD/AUD Exchange Rate',
                'DEXNOUS': 'USD/NOK Exchange Rate',
                'DEXSDUS': 'USD/SEK Exchange Rate',
                'DEXDNUS': 'USD/DKK Exchange Rate',
                'DEXSIUS': 'USD/SGD Exchange Rate',
                'DEXHKUS': 'USD/HKD Exchange Rate',
                'DEXTAUS': 'USD/TWD Exchange Rate',
                'DEXTHUS': 'USD/THB Exchange Rate',
                'DEXMAUS': 'USD/MYR Exchange Rate',
                'DEXPLUS': 'USD/PLN Exchange Rate',
                'DEXUSNZ': 'USD/NZD Exchange Rate',
                'DPRIME': 'Prime Rate',
                'TB3MS': '3-Month Treasury Bill',
                'TB6MS': '6-Month Treasury Bill',
                'GS1': '1-Year Treasury',
                'GS5': '5-Year Treasury',
                'GS7': '7-Year Treasury',
                'GS20': '20-Year Treasury',
                'DFEDTARU': 'Fed Target Rate Upper',
                'DFEDTARL': 'Fed Target Rate Lower',
                'EFFR': 'Effective Fed Funds Rate',
                'OBFR': 'Overnight Bank Funding',
                'AMERIBOR': 'AMERIBOR Rate',
                'IOER': 'Interest on Excess Reserves'
            };
            
            return names[key] || key.replace(/_/g, ' ');
        }
        
        // Categorize indicator
        function categorizeIndicator(key) {
            if (key.includes('SP500') || key.includes('DJIA') || key.includes('NASDAQ') || key.includes('RUSSELL')) {
                return 'Stocks';
            } else if (key.includes('DGS') || key.includes('GS') || key.includes('TB') || key.includes('T10Y')) {
                return 'Bonds';
            } else if (key.includes('DEX')) {
                return 'Currencies';
            } else if (key.includes('GOLD') || key.includes('OIL') || key.includes('COPPER')) {
                return 'Commodities';
            } else if (key.includes('WALCL') || key.includes('M2') || key.includes('BASE') || key.includes('RES')) {
                return 'Liquidity';
            } else if (key.includes('VIX') || key.includes('TED') || key.includes('BAML')) {
                return 'Risk';
            } else if (key.includes('CPI') || key.includes('GDP') || key.includes('UNRATE')) {
                return 'Economy';
            } else if (key.includes('DFF') || key.includes('EFFR') || key.includes('SOFR')) {
                return 'Rates';
            }
            return 'Other';
        }
        
        // Update statistics panel
        function updateStatsPanel() {
            const panel = document.getElementById('statsPanel');
            panel.innerHTML = '';
            
            // Calculate statistics
            const totalIndicators = Object.keys(allIndicators).length;
            const positiveMoM = Object.values(allIndicators).filter(d => d.mom > 0).length;
            const negativeMoM = Object.values(allIndicators).filter(d => d.mom < 0).length;
            
            const stats = [
                { label: 'Total Indicators', value: totalIndicators },
                { label: 'Positive MoM', value: positiveMoM, color: '#00ff88' },
                { label: 'Negative MoM', value: negativeMoM, color: '#ff4444' },
                { label: 'Data Quality', value: '99.8%', color: '#00ccff' }
            ];
            
            stats.forEach(stat => {
                const card = document.createElement('div');
                card.className = 'stat-card';
                card.innerHTML = `
                    <div class="stat-label">${stat.label}</div>
                    <div class="stat-value" style="color: ${stat.color || '#00ff88'}">${stat.value}</div>
                `;
                panel.appendChild(card);
            });
        }
        
        // Update indicators table
        function updateIndicatorsTable() {
            const tbody = document.getElementById('indicatorsTableBody');
            tbody.innerHTML = '';
            
            // Convert to array and sort
            let indicators = Object.entries(allIndicators)
                .filter(([key, data]) => data && data.value !== null && data.value !== undefined)
                .map(([key, data]) => ({
                    key: key,
                    name: data.displayName || customNames[key] || getDefaultName(key),
                    value: data.value,
                    wow: data.wow || 0,
                    mom: data.mom || 0,
                    qoq: data.qoq || 0,
                    category: data.category || 'Other'
                }));
            
            // Apply search filter
            const searchTerm = document.getElementById('searchInput')?.value?.toLowerCase() || '';
            if (searchTerm) {
                indicators = indicators.filter(ind => 
                    ind.name.toLowerCase().includes(searchTerm) ||
                    ind.key.toLowerCase().includes(searchTerm) ||
                    ind.category.toLowerCase().includes(searchTerm)
                );
            }
            
            // Sort
            indicators.sort((a, b) => {
                let aVal = a[currentSort.column];
                let bVal = b[currentSort.column];
                
                if (typeof aVal === 'string') {
                    aVal = aVal.toLowerCase();
                    bVal = bVal.toLowerCase();
                }
                
                if (currentSort.ascending) {
                    return aVal > bVal ? 1 : -1;
                } else {
                    return aVal < bVal ? 1 : -1;
                }
            });
            
            // Populate table
            indicators.forEach(ind => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>
                        <span class="indicator-name" 
                              contenteditable="false"
                              onclick="makeEditable(this, '${ind.key}')">
                            ${ind.name}
                        </span>
                    </td>
                    <td class="value-cell">${formatLargeNumber(ind.value, ind.key)}</td>
                    <td class="change-cell ${ind.wow >= 0 ? 'positive' : 'negative'}">
                        ${ind.wow >= 0 ? '+' : ''}${ind.wow.toFixed(2)}%
                    </td>
                    <td class="change-cell ${ind.mom >= 0 ? 'positive' : 'negative'}">
                        ${ind.mom >= 0 ? '+' : ''}${ind.mom.toFixed(2)}%
                    </td>
                    <td class="change-cell ${ind.qoq >= 0 ? 'positive' : 'negative'}">
                        ${ind.qoq >= 0 ? '+' : ''}${ind.qoq.toFixed(2)}%
                    </td>
                    <td>${ind.category}</td>
                `;
                tbody.appendChild(row);
            });
        }
        
        // Update heatmap
        function updateHeatmap() {
            const grid = document.getElementById('heatmapGrid');
            grid.innerHTML = '';
            
            // Add headers
            const headers = ['Indicator', 'Value', 'WoW %', 'MoM %', 'QoQ %'];
            headers.forEach(header => {
                const cell = document.createElement('div');
                cell.className = 'heatmap-cell header';
                cell.textContent = header;
                grid.appendChild(cell);
            });
            
            // Filter indicators
            let indicators = Object.entries(allIndicators)
                .filter(([key, data]) => {
                    if (!data || data.value === null) return false;
                    if (currentFilter === 'all') return true;
                    return data.category?.toLowerCase() === currentFilter;
                })
                .slice(0, 50); // Limit for performance
            
            // Add data rows
            indicators.forEach(([key, data]) => {
                // Name cell
                const nameCell = document.createElement('div');
                nameCell.className = 'heatmap-cell';
                nameCell.style.textAlign = 'left';
                nameCell.innerHTML = `
                    <span class="indicator-name" 
                          contenteditable="false"
                          onclick="makeEditable(this, '${key}')">
                        ${data.displayName || customNames[key] || getDefaultName(key)}
                    </span>
                `;
                grid.appendChild(nameCell);
                
                // Value cell
                const valueCell = document.createElement('div');
                valueCell.className = 'heatmap-cell';
                valueCell.textContent = formatLargeNumber(data.value, key);
                grid.appendChild(valueCell);
                
                // Change cells
                [data.wow, data.mom, data.qoq].forEach(change => {
                    const cell = document.createElement('div');
                    cell.className = `heatmap-cell ${getHeatmapClass(change || 0)}`;
                    cell.textContent = change ? `${change >= 0 ? '+' : ''}${change.toFixed(2)}%` : 'N/A';
                    grid.appendChild(cell);
                });
            });
        }
        
        // Get heatmap color class
        function getHeatmapClass(value) {
            if (value < -10) return 'heat-extreme-negative';
            if (value < -5) return 'heat-high-negative';
            if (value < -2) return 'heat-moderate-negative';
            if (value < 0) return 'heat-low-negative';
            if (value < 2) return 'heat-neutral';
            if (value < 5) return 'heat-low-positive';
            if (value < 10) return 'heat-moderate-positive';
            if (value < 20) return 'heat-high-positive';
            return 'heat-extreme-positive';
        }
        
        // Initialize charts
        function initializeCharts() {
            const config = {
                responsive: true,
                displayModeBar: true,
                displaylogo: false,
                modeBarButtonsToRemove: ['pan2d', 'lasso2d']
            };
            
            const layout = {
                paper_bgcolor: 'rgba(0, 0, 0, 0)',
                plot_bgcolor: 'rgba(0, 0, 0, 0.3)',
                font: { color: '#fff' },
                xaxis: {
                    gridcolor: 'rgba(255, 255, 255, 0.1)',
                    tickfont: { color: '#888' }
                },
                yaxis: {
                    gridcolor: 'rgba(255, 255, 255, 0.1)',
                    tickfont: { color: '#888' }
                },
                showlegend: true,
                legend: {
                    orientation: 'h',
                    y: -0.15,
                    bgcolor: 'rgba(0, 0, 0, 0.5)'
                }
            };
            
            if (document.getElementById('mainChart')) {
                Plotly.newPlot('mainChart', [], layout, config);
            }
            if (document.getElementById('secondaryChart')) {
                Plotly.newPlot('secondaryChart', [], layout, config);
            }
        }
        
        // Update charts based on view
        function updateCharts() {
            switch(activeChartView) {
                case 'comparison':
                    updateComparisonChart();
                    break;
                case 'correlation':
                    updateCorrelationChart();
                    break;
                case 'volatility':
                    updateVolatilityChart();
                    break;
                case 'trends':
                    updateTrendsChart();
                    break;
                case 'liquidity':
                    updateLiquidityFlowChart();
                    break;
            }
        }
        
        // Update comparison chart
        function updateComparisonChart() {
            const traces = [];
            const dates = generateDateRange(90);
            
            // Add major indices
            const indices = ['SP500', 'VIXCLS', 'DGS10', 'DTWEXBGS', 'WALCL'];
            
            indices.forEach(key => {
                const data = allIndicators[key];
                if (!data) return;
                
                const history = historicalData[key] || [];
                const normalized = normalizeData(history);
                
                traces.push({
                    x: dates,
                    y: normalized,
                    type: 'scatter',
                    mode: 'lines',
                    name: data.displayName || getDefaultName(key),
                    line: { width: 2 }
                });
            });
            
            const layout = {
                title: 'Multi-Indicator Comparison (Normalized)',
                paper_bgcolor: 'rgba(0, 0, 0, 0)',
                plot_bgcolor: 'rgba(0, 0, 0, 0.3)',
                font: { color: '#fff' },
                xaxis: {
                    gridcolor: 'rgba(255, 255, 255, 0.1)',
                    tickfont: { color: '#888' }
                },
                yaxis: {
                    gridcolor: 'rgba(255, 255, 255, 0.1)',
                    tickfont: { color: '#888' },
                    title: 'Normalized Value'
                },
                showlegend: true,
                legend: {
                    orientation: 'h',
                    y: -0.15,
                    bgcolor: 'rgba(0, 0, 0, 0.5)'
                }
            };
            
            Plotly.newPlot('mainChart', traces, layout);
            
            // Secondary chart - percentage changes
            updateChangeChart();
        }
        
        // Update percentage change chart
        function updateChangeChart() {
            const categories = {};
            
            Object.entries(allIndicators).forEach(([key, data]) => {
                if (!data || !data.category) return;
                if (!categories[data.category]) {
                    categories[data.category] = [];
                }
                categories[data.category].push({
                    name: data.displayName || getDefaultName(key),
                    mom: data.mom || 0
                });
            });
            
            const traces = [];
            Object.entries(categories).forEach(([category, indicators]) => {
                // Sort and take top 5
                indicators.sort((a, b) => Math.abs(b.mom) - Math.abs(a.mom));
                const top5 = indicators.slice(0, 5);
                
                traces.push({
                    x: top5.map(i => i.name),
                    y: top5.map(i => i.mom),
                    type: 'bar',
                    name: category,
                    marker: {
                        color: top5.map(i => i.mom >= 0 ? '#00ff88' : '#ff4444')
                    }
                });
            });
            
            const layout = {
                title: 'Top Movers by Category (MoM %)',
                paper_bgcolor: 'rgba(0, 0, 0, 0)',
                plot_bgcolor: 'rgba(0, 0, 0, 0.3)',
                font: { color: '#fff' },
                xaxis: {
                    gridcolor: 'rgba(255, 255, 255, 0.1)',
                    tickfont: { color: '#888', size: 10 },
                    tickangle: -45
                },
                yaxis: {
                    gridcolor: 'rgba(255, 255, 255, 0.1)',
                    tickfont: { color: '#888' },
                    title: 'Change %'
                },
                barmode: 'group'
            };
            
            if (document.getElementById('secondaryChart')) {
                Plotly.newPlot('secondaryChart', traces, layout);
            }
        }
        
        // Helper functions
        function normalizeData(data) {
            if (!data || data.length === 0) return [];
            const min = Math.min(...data);
            const max = Math.max(...data);
            const range = max - min;
            if (range === 0) return data.map(() => 0);
            return data.map(v => ((v - min) / range) * 100);
        }
        
        function generateDateRange(days) {
            const dates = [];
            const today = new Date();
            
            for (let i = days - 1; i >= 0; i--) {
                const date = new Date(today);
                date.setDate(date.getDate() - i);
                dates.push(date.toISOString().split('T')[0]);
            }
            
            return dates;
        }
        
        // Make indicator name editable
        function makeEditable(element, key) {
            element.contentEditable = true;
            element.classList.add('editing');
            element.focus();
            
            const originalText = element.textContent;
            
            element.addEventListener('blur', function handler() {
                element.contentEditable = false;
                element.classList.remove('editing');
                
                const newName = element.textContent.trim();
                if (newName && newName !== originalText) {
                    customNames[key] = newName;
                    saveCustomNames();
                    
                    // Update all instances
                    if (allIndicators[key]) {
                        allIndicators[key].displayName = newName;
                    }
                    
                    // Refresh displays
                    updateIndicatorsTable();
                    updateHeatmap();
                }
                
                element.removeEventListener('blur', handler);
            });
            
            element.addEventListener('keypress', function handler(e) {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    element.blur();
                    element.removeEventListener('keypress', handler);
                }
            });
        }
        
        // Load custom names
        function loadCustomNames() {
            const saved = localStorage.getItem('fredCustomNames');
            if (saved) {
                customNames = JSON.parse(saved);
            }
        }
        
        // Save custom names
        function saveCustomNames() {
            localStorage.setItem('fredCustomNames', JSON.stringify(customNames));
        }
        
        // Sort table
        function sortTable(column) {
            if (currentSort.column === column) {
                currentSort.ascending = !currentSort.ascending;
            } else {
                currentSort.column = column;
                currentSort.ascending = true;
            }
            
            // Update sort arrows
            document.querySelectorAll('.sort-arrow').forEach(arrow => {
                arrow.classList.remove('active');
                arrow.textContent = '↕';
            });
            
            const arrow = document.querySelector(`.sort-arrow[data-col="${column}"]`);
            if (arrow) {
                arrow.classList.add('active');
                arrow.textContent = currentSort.ascending ? '↑' : '↓';
            }
            
            updateIndicatorsTable();
        }
        
        // Filter heatmap
        function filterHeatmap(filter) {
            currentFilter = filter.toLowerCase();
            
            document.querySelectorAll('.chart-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent.toLowerCase().includes(filter.toLowerCase())) {
                    btn.classList.add('active');
                }
            });
            
            updateHeatmap();
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Tab navigation
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    const tabId = e.target.dataset.tab;
                    document.getElementById(tabId).classList.add('active');
                });
            });
            
            // Chart view buttons
            document.querySelectorAll('[data-chart]').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    activeChartView = e.target.dataset.chart;
                    document.querySelectorAll('[data-chart]').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    updateCharts();
                });
            });
            
            // Search input
            const searchInput = document.getElementById('searchInput');
            if (searchInput) {
                searchInput.addEventListener('input', () => {
                    updateIndicatorsTable();
                });
            }
        }
        
        // Start auto-refresh
        function startAutoRefresh() {
            setInterval(() => {
                console.log('Auto-refreshing data...');
                fetchAllData();
            }, 60000); // Refresh every minute
        }
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', initialize);
    </script>
</body>
</html>
