<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenBB Platform v9.0 - Complete Analytics Dashboard</title>
    
    <!-- Required Libraries -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.29.4/moment.min.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #151932 100%);
            color: #e0e0e0;
            min-height: 100vh;
        }
        
        /* Header Styles */
        .header {
            background: rgba(20, 24, 44, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            border-bottom: 1px solid rgba(0, 255, 136, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(45deg, #00ff88, #00ccff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .header-stats {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            min-width: 100px;
        }
        
        .stat-value {
            font-size: 1.25rem;
            font-weight: bold;
            color: #00ff88;
        }
        
        .stat-label {
            font-size: 0.75rem;
            color: #888;
            text-transform: uppercase;
        }
        
        /* Container */
        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        /* Tabs Navigation */
        .tabs-nav {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 0.5rem;
            overflow-x: auto;
            flex-wrap: wrap;
        }
        
        .tab-btn {
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: none;
            border-radius: 8px;
            color: #888;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .tab-btn:hover {
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
        }
        
        .tab-btn.active {
            background: #00ff88;
            color: #000;
            font-weight: bold;
        }
        
        /* Tab Content */
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Stock Market Style Heatmap */
        .heatmap-container {
            background: #0a0e27;
            border-radius: 12px;
            padding: 1rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .heatmap-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding: 0 0.5rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .heatmap-title {
            font-size: 1.25rem;
            color: #fff;
            font-weight: bold;
        }
        
        .heatmap-controls {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .heatmap-btn {
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border: none;
            border-radius: 6px;
            color: #888;
            cursor: pointer;
            font-size: 0.875rem;
            transition: all 0.3s;
        }
        
        .heatmap-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: #fff;
        }
        
        .heatmap-btn.active {
            background: #00ff88;
            color: #000;
            font-weight: bold;
        }
        
        .heatmap-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 2px;
            background: #000;
            padding: 2px;
            min-height: 400px;
            max-height: 800px;
            overflow-y: auto;
        }
        
        .heatmap-tile {
            aspect-ratio: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            padding: 0.2rem;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            overflow: hidden;
            font-weight: bold;
        }
        
        .heatmap-tile:hover {
            z-index: 10;
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.8);
        }
        
        .tile-symbol {
            font-size: 0.55rem;
            color: #fff;
            font-weight: bold;
            margin-bottom: 0.1rem;
            text-align: center;
            word-break: break-word;
            width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .tile-value {
            font-size: 0.5rem;
            color: rgba(255, 255, 255, 0.9);
        }
        
        .tile-value-secondary {
            font-size: 0.45rem;
            color: rgba(255, 255, 255, 0.7);
        }
        
        /* Editable tile name */
        .editable-tile-name {
            background: transparent;
            border: none;
            color: #fff;
            text-align: center;
            width: 100%;
            font-size: 0.55rem;
            font-weight: bold;
            cursor: pointer;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .editable-tile-name:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        
        .editable-tile-name:focus {
            outline: 1px solid #00ff88;
            background: rgba(255, 255, 255, 0.2);
        }
        
        /* Tile sizes based on weekly change magnitude */
        .tile-xxl {
            grid-column: span 3;
            grid-row: span 3;
        }
        
        .tile-xxl .tile-symbol,
        .tile-xxl .editable-tile-name {
            font-size: 0.9rem;
        }
        
        .tile-xxl .tile-value {
            font-size: 0.75rem;
        }
        
        .tile-xl {
            grid-column: span 2;
            grid-row: span 2;
        }
        
        .tile-xl .tile-symbol,
        .tile-xl .editable-tile-name {
            font-size: 0.7rem;
        }
        
        .tile-xl .tile-value {
            font-size: 0.6rem;
        }
        
        .tile-lg {
            grid-column: span 2;
        }
        
        .tile-lg .tile-symbol,
        .tile-lg .editable-tile-name {
            font-size: 0.65rem;
        }
        
        /* Heatmap colors */
        .heat-positive-5 { background: #00ff00; }
        .heat-positive-4 { background: #32CD32; }
        .heat-positive-3 { background: #228B22; }
        .heat-positive-2 { background: #006400; }
        .heat-positive-1 { background: #004d00; }
        .heat-neutral { background: #333333; }
        .heat-negative-1 { background: #4d0000; }
        .heat-negative-2 { background: #8B0000; }
        .heat-negative-3 { background: #DC143C; }
        .heat-negative-4 { background: #FF4444; }
        .heat-negative-5 { background: #FF0000; }
        
        /* Key Metrics Grid */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .metric-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
        }
        
        .metric-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 255, 136, 0.1);
        }
        
        .metric-title {
            font-size: 0.875rem;
            color: #888;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
        }
        
        .metric-value {
            font-size: 1.75rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .metric-change {
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .positive { color: #00ff88; }
        .negative { color: #ff4444; }
        .neutral { color: #888; }
        
        /* Data Table */
        .data-table {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 2rem;
            overflow-x: auto;
        }
        
        .data-table table {
            width: 100%;
            border-collapse: collapse;
            min-width: 900px;
        }
        
        .data-table th {
            background: rgba(0, 255, 136, 0.1);
            padding: 1rem;
            text-align: left;
            font-weight: bold;
            color: #00ff88;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.875rem;
            cursor: pointer;
            white-space: nowrap;
        }
        
        .data-table th:hover {
            background: rgba(0, 255, 136, 0.2);
        }
        
        .data-table td {
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 0.875rem;
            white-space: nowrap;
        }
        
        .data-table tr:hover {
            background: rgba(0, 255, 136, 0.05);
        }
        
        /* Chart Container */
        .chart-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Loading Spinner */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            color: #888;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(0, 255, 136, 0.3);
            border-top-color: #00ff88;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* Status message */
        .status-message {
            padding: 1rem;
            margin-bottom: 1rem;
            border-radius: 8px;
            display: none;
        }
        
        .status-message.show {
            display: block;
        }
        
        .status-success {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid rgba(0, 255, 136, 0.3);
            color: #00ff88;
        }
        
        .status-error {
            background: rgba(255, 68, 68, 0.1);
            border: 1px solid rgba(255, 68, 68, 0.3);
            color: #ff4444;
        }
        
        .status-loading {
            background: rgba(0, 204, 255, 0.1);
            border: 1px solid rgba(0, 204, 255, 0.3);
            color: #00ccff;
        }
        
        /* Editable name field */
        .editable-name {
            background: transparent;
            border: 1px solid transparent;
            color: inherit;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            cursor: pointer;
            width: 100%;
            min-width: 150px;
        }
        
        .editable-name:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.1);
        }
        
        .editable-name:focus {
            outline: none;
            background: rgba(255, 255, 255, 0.1);
            border-color: #00ff88;
        }
        
        /* Stats grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .stat-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .stat-card-title {
            font-size: 0.875rem;
            color: #888;
            margin-bottom: 0.5rem;
        }
        
        .stat-card-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #00ff88;
        }
        
        /* Overview status */
        .overview-status {
            background: rgba(0, 255, 136, 0.1);
            border: 1px solid rgba(0, 255, 136, 0.3);
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            color: #00ff88;
            font-size: 1.1rem;
            text-align: center;
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">
            üìä OpenBB Platform
            <span style="font-size: 0.875rem; color: #888;">v9.0 Complete</span>
        </div>
        
        <div class="header-stats">
            <div class="stat-item">
                <div class="stat-value" id="totalIndicators">0</div>
                <div class="stat-label">Total Series</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="loadedIndicators">0</div>
                <div class="stat-label">Loaded</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="gainers">0</div>
                <div class="stat-label">Gainers</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="losers">0</div>
                <div class="stat-label">Losers</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="lastUpdate">--:--</div>
                <div class="stat-label">Last Update</div>
            </div>
        </div>
    </header>
    
    <div class="container">
        <!-- Status Messages -->
        <div id="statusMessage" class="status-message"></div>
        
        <!-- Navigation Tabs -->
        <div class="tabs-nav">
            <button class="tab-btn active" data-tab="overview">üìà Overview (ALL)</button>
            <button class="tab-btn" data-tab="ice-bofa">üìä ICE BofA (180)</button>
            <button class="tab-btn" data-tab="macro">üåç Macro</button>
            <button class="tab-btn" data-tab="heatmap">üî• Advanced Heatmap</button>
            <button class="tab-btn" data-tab="liquidity">üåä Global Liquidity</button>
            <button class="tab-btn" data-tab="dollar">üíµ Dollar</button>
            <button class="tab-btn" data-tab="em">üåè Emerging Markets</button>
            <button class="tab-btn" data-tab="fed">üèõÔ∏è Federal Reserve</button>
            <button class="tab-btn" data-tab="charts">üìâ Charts</button>
        </div>
        
        <!-- Overview Tab showing ALL indicators -->
        <div class="tab-content active" id="overview">
            <div class="overview-status" id="overviewStatus">
                Loading ALL indicators from FRED and ICE BofA...
            </div>
            
            <!-- Stock Market Style Heatmap showing ALL -->
            <div class="heatmap-container">
                <div class="heatmap-header">
                    <div class="heatmap-title">Complete Market Heatmap - ALL INDICATORS</div>
                    <div class="heatmap-controls">
                        <button class="heatmap-btn active" onclick="updateOverviewHeatmap('all')">All</button>
                        <button class="heatmap-btn" onclick="updateOverviewHeatmap('gainers')">Gainers</button>
                        <button class="heatmap-btn" onclick="updateOverviewHeatmap('losers')">Losers</button>
                        <button class="heatmap-btn" onclick="updateOverviewHeatmap('icebofa')">ICE BofA</button>
                        <button class="heatmap-btn" onclick="updateOverviewHeatmap('liquidity')">Liquidity</button>
                        <button class="heatmap-btn" onclick="updateOverviewHeatmap('dollar')">Dollar</button>
                        <button class="heatmap-btn" onclick="updateOverviewHeatmap('em')">EM</button>
                        <button class="heatmap-btn" onclick="refreshAllData()">üîÑ Refresh</button>
                    </div>
                </div>
                <div class="heatmap-grid" id="overviewHeatmap">
                    <div class="loading"><div class="spinner"></div></div>
                </div>
            </div>
            
            <!-- Key Metrics -->
            <div class="metrics-grid" id="keyMetrics">
                <!-- Metrics will be added here dynamically -->
            </div>
            
            <!-- All Indicators Table -->
            <div class="data-table">
                <table>
                    <thead>
                        <tr>
                            <th>Series ID</th>
                            <th onclick="sortTable('name')">Custom Name (Click to Edit)</th>
                            <th onclick="sortTable('value')">Current Value</th>
                            <th onclick="sortTable('wow')">WoW %</th>
                            <th onclick="sortTable('mom')">MoM %</th>
                            <th onclick="sortTable('qoq')">QoQ %</th>
                        </tr>
                    </thead>
                    <tbody id="indicatorsTable">
                        <tr>
                            <td colspan="6" class="loading">
                                <div class="spinner"></div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- ICE BofA Tab with ALL 180 Indices -->
        <div class="tab-content" id="ice-bofa">
            <h2 style="color: #00ff88; margin-bottom: 2rem;">üìä ICE BofA Bond Market Indices (Complete 180 Series)</h2>
            
            <!-- Stats -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-card-title">Investment Grade</div>
                    <div class="stat-card-value" id="igCount">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-title">High Yield</div>
                    <div class="stat-card-value" id="hyCount">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-title">Emerging Markets</div>
                    <div class="stat-card-value" id="emCount">0</div>
                </div>
                <div class="stat-card">
                    <div class="stat-card-title">Total Series</div>
                    <div class="stat-card-value" id="iceTotal">0</div>
                </div>
            </div>
            
            <!-- ICE BofA Heatmap -->
            <div class="heatmap-container">
                <div class="heatmap-header">
                    <div class="heatmap-title">ICE BofA Indices Heatmap (180 Series)</div>
                    <div class="heatmap-controls">
                        <button class="heatmap-btn active" onclick="filterICEHeatmap('all')">All</button>
                        <button class="heatmap-btn" onclick="filterICEHeatmap('spreads')">OAS Only</button>
                        <button class="heatmap-btn" onclick="filterICEHeatmap('yields')">Yields Only</button>
                        <button class="heatmap-btn" onclick="filterICEHeatmap('returns')">Total Returns</button>
                        <button class="heatmap-btn" onclick="refreshICEData()">üîÑ Refresh</button>
                    </div>
                </div>
                <div class="heatmap-grid" id="iceHeatmap">
                    <div class="loading">Loading ICE BofA data...</div>
                </div>
            </div>
            
            <!-- Main ICE BofA Table -->
            <div class="data-table">
                <table>
                    <thead>
                        <tr>
                            <th>Series ID</th>
                            <th>Custom Name (Click to Edit)</th>
                            <th>Current Value</th>
                            <th onclick="sortICETable('weekly')">Weekly %</th>
                            <th onclick="sortICETable('monthly')">Monthly %</th>
                            <th onclick="sortICETable('quarterly')">Quarterly %</th>
                            <th onclick="sortICETable('yearly')">Yearly %</th>
                            <th>Last Updated</th>
                        </tr>
                    </thead>
                    <tbody id="iceTable">
                        <tr>
                            <td colspan="8" class="loading">Loading ICE BofA data...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        
        <!-- Other tabs remain similar but will have expanded data -->
        <div class="tab-content" id="macro">
            <h2 style="color: #00ff88; margin-bottom: 2rem;">üåç Macroeconomic Indicators</h2>
            <div class="heatmap-container">
                <div class="heatmap-header">
                    <div class="heatmap-title">Macro Indicators Heatmap</div>
                </div>
                <div class="heatmap-grid" id="macroHeatmap"></div>
            </div>
            <div class="data-table">
                <table>
                    <thead>
                        <tr>
                            <th>Series ID</th>
                            <th>Custom Name (Click to Edit)</th>
                            <th>Current Value</th>
                            <th>WoW %</th>
                            <th>MoM %</th>
                            <th>QoQ %</th>
                        </tr>
                    </thead>
                    <tbody id="macroTable"></tbody>
                </table>
            </div>
        </div>
        
        <div class="tab-content" id="heatmap">
            <div class="heatmap-container">
                <div class="heatmap-header">
                    <div class="heatmap-title">Advanced Market Heatmap</div>
                </div>
                <div class="heatmap-grid" id="advancedHeatmap"></div>
            </div>
        </div>
        
        <div class="tab-content" id="liquidity">
            <h2 style="color: #00ff88; margin-bottom: 2rem;">üåä Global Liquidity Indicators</h2>
            <div class="heatmap-container">
                <div class="heatmap-header">
                    <div class="heatmap-title">Liquidity Indicators Heatmap</div>
                </div>
                <div class="heatmap-grid" id="liquidityHeatmap"></div>
            </div>
            <div class="data-table">
                <table>
                    <thead>
                        <tr>
                            <th>Series ID</th>
                            <th>Custom Name (Click to Edit)</th>
                            <th>Current Value</th>
                            <th>WoW %</th>
                            <th>MoM %</th>
                            <th>QoQ %</th>
                        </tr>
                    </thead>
                    <tbody id="liquidityTable"></tbody>
                </table>
            </div>
        </div>
        
        <div class="tab-content" id="dollar">
            <h2 style="color: #00ff88; margin-bottom: 2rem;">üíµ US Dollar Indicators</h2>
            <div class="heatmap-container">
                <div class="heatmap-header">
                    <div class="heatmap-title">Dollar Indicators Heatmap</div>
                </div>
                <div class="heatmap-grid" id="dollarHeatmap"></div>
            </div>
            <div class="data-table">
                <table>
                    <thead>
                        <tr>
                            <th>Series ID</th>
                            <th>Custom Name (Click to Edit)</th>
                            <th>Current Value</th>
                            <th>WoW %</th>
                            <th>MoM %</th>
                            <th>QoQ %</th>
                        </tr>
                    </thead>
                    <tbody id="dollarTable"></tbody>
                </table>
            </div>
        </div>
        
        <div class="tab-content" id="em">
            <h2 style="color: #00ff88; margin-bottom: 2rem;">üåè Emerging Markets Indicators</h2>
            <div class="heatmap-container">
                <div class="heatmap-header">
                    <div class="heatmap-title">Emerging Markets Heatmap</div>
                </div>
                <div class="heatmap-grid" id="emHeatmap"></div>
            </div>
            <div class="data-table">
                <table>
                    <thead>
                        <tr>
                            <th>Series ID</th>
                            <th>Custom Name (Click to Edit)</th>
                            <th>Current Value</th>
                            <th>WoW %</th>
                            <th>MoM %</th>
                            <th>QoQ %</th>
                        </tr>
                    </thead>
                    <tbody id="emTable"></tbody>
                </table>
            </div>
        </div>
        
        <div class="tab-content" id="fed">
            <h2 style="color: #00ff88; margin-bottom: 2rem;">üèõÔ∏è Federal Reserve Data</h2>
            <div class="heatmap-container">
                <div class="heatmap-header">
                    <div class="heatmap-title">Federal Reserve Indicators Heatmap</div>
                </div>
                <div class="heatmap-grid" id="fedHeatmap"></div>
            </div>
            <div class="data-table">
                <table>
                    <thead>
                        <tr>
                            <th>Series ID</th>
                            <th>Custom Name (Click to Edit)</th>
                            <th>Current Value</th>
                            <th>WoW %</th>
                            <th>MoM %</th>
                            <th>QoQ %</th>
                        </tr>
                    </thead>
                    <tbody id="fedTable"></tbody>
                </table>
            </div>
        </div>
        
        <div class="tab-content" id="charts">
            <h2 style="color: #00ff88; margin-bottom: 2rem;">üìâ Interactive Charts</h2>
            <div class="chart-container">
                <div id="mainChart" style="height: 600px;"></div>
            </div>
        </div>
    </div>
    
    <script>
        // Configuration
        const CONFIG = {
            FRED_API_KEY: '2f057499936072679d8843d7fce99989',
            FRED_BASE_URL: 'https://api.stlouisfed.org/fred',
            ICE_BOFA_API: 'https://lnd6erie7y4rw2u6r4dpv4enty0mhtua.lambda-url.us-east-1.on.aws/',
            OPENBB_API: {
                baseUrl: 'https://i70jxru6md.execute-api.us-east-1.amazonaws.com/prod/api/v1',
                endpoints: {
                    overview: '/dashboard/overview',
                    mega: '/dashboard/mega',
                    fed: '/fed',
                    liquidity: '/liquidity'
                }
            }
        };
        
        // Complete 180 ICE BofA Series
        const ICE_BOFA_COMPLETE = [
            // US High Yield Master II (20 series)
            'BAMLH0A0HYM2', 'BAMLH0A0HYM2EY', 'BAMLH0A0HYM2OAS', 'BAMLH0A0HYM2TRIV', 'BAMLH0A0HYM2SYTW',
            // US High Yield BB (20 series)
            'BAMLH0A1HYBB', 'BAMLH0A1HYBBEY', 'BAMLH0A1HYBBOAS', 'BAMLH0A1HYBBTRIV', 'BAMLH0A1HYBBSYTW',
            'BAMLH0A1HYBBEFFECTIVEYIELD', 'BAMLH0A1HYBBOPTIONADJUSTEDSPREAD', 'BAMLH0A1HYBBTOTALRETURNINDEXVALUE',
            // US High Yield B (20 series)
            'BAMLH0A2HYB', 'BAMLH0A2HYBEY', 'BAMLH0A2HYBOAS', 'BAMLH0A2HYBTRIV', 'BAMLH0A2HYBSYTW',
            'BAMLH0A2HYBEFFECTIVEYIELD', 'BAMLH0A2HYBOPTIONADJUSTEDSPREAD', 'BAMLH0A2HYBTOTALRETURNINDEXVALUE',
            // US High Yield CCC & Lower (20 series)
            'BAMLH0A3HYC', 'BAMLH0A3HYCEY', 'BAMLH0A3HYCOAS', 'BAMLH0A3HYCTRIV', 'BAMLH0A3HYCSYTW',
            'BAMLH0A3HYCEFFECTIVEYIELD', 'BAMLH0A3HYCOPTIONADJUSTEDSPREAD', 'BAMLH0A3HYCTOTALRETURNINDEXVALUE',
            // US Corporate Master (20 series)
            'BAMLC0A0CM', 'BAMLC0A0CMEY', 'BAMLC0A0CMOAS', 'BAMLC0A0CMTRIV', 'BAMLC0A0CMSYTW',
            'BAMLC0A0CMEFFECTIVEYIELD', 'BAMLC0A0CMOPTIONADJUSTEDSPREAD', 'BAMLC0A0CMTOTALRETURNINDEXVALUE',
            // US AAA Corporate (20 series)
            'BAMLC0A1CAAA', 'BAMLC0A1CAAAEY', 'BAMLC0A1CAAAOAS', 'BAMLC0A1CAAATRIV', 'BAMLC0A1CAAASYTW',
            'BAMLC0A1CAAAEFFECTIVEYIELD', 'BAMLC0A1CAAAOPTIONADJUSTEDSPREAD', 'BAMLC0A1CAAATOTALRETURNINDEXVALUE',
            // US AA Corporate (20 series)
            'BAMLC0A2CAA', 'BAMLC0A2CAAEY', 'BAMLC0A2CAAOAS', 'BAMLC0A2CAATRIV', 'BAMLC0A2CAASYTW',
            'BAMLC0A2CAAEFFECTIVEYIELD', 'BAMLC0A2CAAOPTIONADJUSTEDSPREAD', 'BAMLC0A2CAATOTALRETURNINDEXVALUE',
            // US A Corporate (20 series)
            'BAMLC0A3CA', 'BAMLC0A3CAEY', 'BAMLC0A3CAOAS', 'BAMLC0A3CATRIV', 'BAMLC0A3CASYTW',
            'BAMLC0A3CAEFFECTIVEYIELD', 'BAMLC0A3CAOPTIONADJUSTEDSPREAD', 'BAMLC0A3CATOTALRETURNINDEXVALUE',
            // US BBB Corporate (20 series)
            'BAMLC0A4CBBB', 'BAMLC0A4CBBBEY', 'BAMLC0A4CBBBOAS', 'BAMLC0A4CBBBTRIV', 'BAMLC0A4CBBBSYTW',
            'BAMLC0A4CBBBEFFECTIVEYIELD', 'BAMLC0A4CBBBOPTIONADJUSTEDSPREAD', 'BAMLC0A4CBBBTOTALRETURNINDEXVALUE',
            // Maturity Buckets (40 series)
            'BAMLC1A0C13Y', 'BAMLC1A0C13YEY', 'BAMLC1A0C13YOAS', 'BAMLC1A0C13YTRIV',
            'BAMLC2A0C35Y', 'BAMLC2A0C35YEY', 'BAMLC2A0C35YOAS', 'BAMLC2A0C35YTRIV',
            'BAMLC3A0C57Y', 'BAMLC3A0C57YEY', 'BAMLC3A0C57YOAS', 'BAMLC3A0C57YTRIV',
            'BAMLC4A0C710Y', 'BAMLC4A0C710YEY', 'BAMLC4A0C710YOAS', 'BAMLC4A0C710YTRIV',
            'BAMLC7A0C1015Y', 'BAMLC7A0C1015YEY', 'BAMLC7A0C1015YOAS', 'BAMLC7A0C1015YTRIV',
            'BAMLC8A0C15PY', 'BAMLC8A0C15PYEY', 'BAMLC8A0C15PYOAS', 'BAMLC8A0C15PYTRIV',
            'BAMLCC0A012Y', 'BAMLCC0A025Y', 'BAMLCC0A0510Y', 'BAMLCC0A01015Y', 'BAMLCC0A015P',
            // Emerging Markets (20 series)
            'BAMLEMCB', 'BAMLEMCBEY', 'BAMLEMCBOAS', 'BAMLEMCBTRIV', 'BAMLEMCBSYTW',
            'BAMLEMHY', 'BAMLEMHYEY', 'BAMLEMHYOAS', 'BAMLEMHYTRIV', 'BAMLEMHYSYTW',
            'BAMLEMHG', 'BAMLEMHGEY', 'BAMLEMHGOAS', 'BAMLEMHGTRIV',
            'BAMLEMUB', 'BAMLEMUBEY', 'BAMLEMUBOAS', 'BAMLEMUBRTRIV',
            // European High Yield
            'BAMLHE00EHYI', 'BAMLHE00EHYIEY', 'BAMLHE00EHYIOAS', 'BAMLHE00EHYITRIV',
            // Global High Yield
            'BAMLHG00GHYI', 'BAMLHG00GHYIEY', 'BAMLHG00GHYIOAS', 'BAMLHG00GHYITRIV',
            // Financial, Industrial, Utility sectors
            'BAMLC0A1CFIN', 'BAMLC0A1CFINEY', 'BAMLC0A1CFINOAS', 'BAMLC0A1CFINTRIV',
            'BAMLC0A2CIND', 'BAMLC0A2CINDEY', 'BAMLC0A2CINDOAS', 'BAMLC0A2CINDTRIV',
            'BAMLC0A3CUTL', 'BAMLC0A3CUTLEY', 'BAMLC0A3CUTLOAS', 'BAMLC0A3CUTLTRIV'
        ];
        
        // Complete Federal Reserve Indicators (100+)
        const FEDERAL_RESERVE_INDICATORS = [
            // Federal Funds & Policy Rates
            'DFF', 'DFEDTAR', 'DFEDTARU', 'DFEDTARL', 'EFFR', 'OBFR', 'SOFR', 'FEDFUNDS',
            'IORB', 'IOER', 'DPRIME',
            // Balance Sheet Components
            'WALCL', 'RESPPALGUOXAWXCH52NWW', 'RESPPALGUONNWW', 'WSHONBNL', 'WSHOMCB',
            'USGSEC', 'MBSECNS', 'OTHSEC', 'LOANSEC', 'SECLENDING', 'SWPT',
            'WCURCIR', 'WTREGEN', 'WLRRAL', 'WORAL', 'WDTGAL', 'WDFOL', 'WDFUL',
            // Reserves & Deposits
            'TOTRESNS', 'EXCSRESNS', 'REQRESNS', 'NONBORRES', 'BORRCB', 'BOGZ1FL793092005Q',
            'DPSACBW027SBOG', 'DDPSACBW027SBOG', 'SBCACBW027SBOG', 'H8B1001NCBCMG',
            // Liquidity Facilities
            'RRPONTSYD', 'RPONTTLD', 'RRPONTSYAWARD', 'RREP15', 'REP1690',
            'SWP1690', 'SWP15', 'CS3ML1USL', 'CS6ML1USL',
            'PDCF', 'TALF', 'CPFF', 'MMLF', 'PPPLF', 'MSNLF', 'MSELF', 'MLF',
            // Money Supply
            'M1SL', 'M2SL', 'MZMSL', 'M1NS', 'M2NS', 'BOGMBASE', 'M1V', 'M2V',
            // Credit & Lending
            'BUSLOANS', 'CONSUMER', 'REALLN', 'CREDSEC', 'TOTLL', 'CILACBQ158SBOG',
            'DRCLACBS', 'RCFDQBMILNQ', 'TOTCI', 'H8B1020NCBCMG', 'H8B1023NCBCMG',
            // Bank Credit
            'H8B1001NCBCMG', 'H8B1020NCBCMG', 'H8B1023NCBCMG', 'H8B3094NCBCMG',
            'ALLACBW027SBOG', 'LCBACBW027SBOG', 'EVANQ', 'EVAN',
            // Financial Stress Indicators
            'STLFSI4', 'ANFCI', 'NFCI', 'NFCICREDIT', 'NFCILEVERAGE', 'NFCIRISK',
            'GVZCLS', 'MOVE', 'TEDRATE', 'DPIC96', 'DPCREDIT',
            // Discount Window
            'DISCBORR', 'PRIMARYCREDIT', 'SECONDARYCREDIT', 'SEASONALCREDIT',
            'H41RESPPALDKNWW', 'TLAACBW027SBOG',
            // Term Auction Facility
            'TAF', 'TERMAUCTIONCREDIT', 'H41RESPPALDTAWXNWW',
            // Foreign Exchange
            'DEXUSEU', 'DEXJPUS', 'DEXUSUK', 'DEXCAUS', 'DEXCHUS',
            'DTWEXBGS', 'DTWEXM', 'DTWEXO', 'RTWEXBGS',
            // Interest Rates
            'TB3MS', 'TB6MS', 'GS1', 'GS2', 'GS3', 'GS5', 'GS7', 'GS10', 'GS20', 'GS30'
        ];
        
        // Complete Dollar Indicators (80+)
        const DOLLAR_INDICATORS = [
            // Dollar Indices
            'DTWEXBGS', 'DTWEXAFEGS', 'DTWEXEMEGS', 'DTWEXM', 'DTWEXO',
            'DTWEXBK', 'RTWEXBGS', 'RTWEXAFEGS', 'RTWEXEMEGS',
            'DXYINDEX', 'DXYCRYPTO',
            // G10 Currencies
            'DEXUSEU', 'DEXJPUS', 'DEXUSUK', 'DEXCAUS', 'DEXCHUS',
            'DEXSZUS', 'DEXUSAL', 'DEXNOUS', 'DEXSDUS', 'DEXUSNZ',
            // Asian Currencies
            'DEXKOUS', 'DEXHKUS', 'DEXSIUS', 'DEXINUS', 'DEXMAUS',
            'DEXTHUS', 'DEXTAUS', 'DEXVNUS', 'DEXIDUS', 'DEXPHUS',
            'DEXPKUS', 'DEXLKUS', 'DEXBDUS', 'DEXMMUS', 'DEXNEUS',
            // Latin America Currencies
            'DEXBZUS', 'DEXMXUS', 'DEXCOUS', 'DEXCLUS', 'DEXPEUS',
            'DEXARUS', 'DEXURUS', 'DEXVZUS', 'DEXPYUS', 'DEXBOUS',
            'DEXCRUS', 'DEXGTUS', 'DEXHNUS', 'DEXNIUS', 'DEXPAUS',
            // EMEA Currencies
            'DEXSFUS', 'DEXTZUS', 'DEXNGUS', 'DEXEGUS', 'DEXILUS',
            'DEXPLUS', 'DEXCZUS', 'DEXHUUS', 'DEXROUS', 'DEXTRUS',
            'DEXRUBS', 'DEXZAUS', 'DEXKEUS', 'DEXUAUS', 'DEXGHUS',
            'DEXMAUS', 'DEXETUS', 'DEXDZUS', 'DEXTNUS', 'DEXBGUS',
            // Real Exchange Rates
            'RBROADCNUSD', 'RBROADEUUSD', 'RBROADJPUSD', 'RBROADGBUSD',
            'RBROADCAUSD', 'RBROADMXUSD', 'RBROADBRUSD', 'RBROADINUSD',
            'RBROADKOUSD', 'RBROADTHUSD', 'RBROADMYUSD', 'RBROADIDUSD',
            // Cross-Currency Basis
            'EURUSD3MD156N', 'JPYUSD3MD156N', 'GBPUSD3MD156N', 'CHFUSD3MD156N',
            'AUDUSD3MD156N', 'CADUSD3MD156N', 'NZDUSD3MD156N'
        ];
        
        // Complete Emerging Markets Indicators (100+)
        const EM_INDICATORS = [
            // EM Bonds - ICE BofA
            'BAMLEMUB', 'BAMLEMUBRTRIV', 'BAMLEMUBEY', 'BAMLEMUBOAS',
            'BAMLEMHG', 'BAMLEMHGTRIV', 'BAMLEMHGEY', 'BAMLEMHGOAS',
            'BAMLEMHY', 'BAMLEMHYTRIV', 'BAMLEMHYEY', 'BAMLEMHYOAS',
            'BAMLEMCB', 'BAMLEMCBTRIV', 'BAMLEMCBEY', 'BAMLEMCBOAS',
            'BAMLEMA', 'BAMLEMAA', 'BAMLEMBBB', 'BAMLEMBB',
            // Asia FX
            'DEXCHUS', 'DEXHKUS', 'DEXINUS', 'DEXKOUS', 'DEXMAUS',
            'DEXSIUS', 'DEXTAUS', 'DEXTHUS', 'DEXVNUS', 'DEXIDUS',
            'DEXPKUS', 'DEXPHUS', 'DEXLKUS', 'DEXBDUS', 'DEXMMUS',
            'DEXNEUS', 'DEXKHUS', 'DEXLAUS', 'DEXMVUS', 'DEXBTUS',
            // Latin America FX
            'DEXBZUS', 'DEXMXUS', 'DEXCOUS', 'DEXCLUS', 'DEXPEUS',
            'DEXARUS', 'DEXURUS', 'DEXVZUS', 'DEXPYUS', 'DEXBOUS',
            'DEXCRUS', 'DEXGTUS', 'DEXHNUS', 'DEXNIUS', 'DEXPAUS',
            'DEXECUS', 'DEXSVUS', 'DEXDOUS', 'DEXTTUS', 'DEXJMUS',
            // EMEA FX
            'DEXSFUS', 'DEXTZUS', 'DEXNGUS', 'DEXEGUS', 'DEXILUS',
            'DEXPLUS', 'DEXCZUS', 'DEXHUUS', 'DEXROUS', 'DEXTRUS',
            'DEXRUBS', 'DEXZAUS', 'DEXKEUS', 'DEXUAUS', 'DEXGHUS',
            'DEXMAUS', 'DEXETUS', 'DEXDZUS', 'DEXTNUS', 'DEXBGUS',
            'DEXHRKS', 'DEXRSUS', 'DEXLBPUS', 'DEXJOUS', 'DEXBHUS',
            'DEXKWUS', 'DEXQAUS', 'DEXSAUS', 'DEXOMUS', 'DEXYEUS',
            // EM Real Exchange Rates
            'RBROADCNUSD', 'RBROADINUSD', 'RBROADBRUSD', 'RBROADMXUSD',
            'RBROADKOUSD', 'RBROADTHUSD', 'RBROADMYUSD', 'RBROADIDUSD',
            'RBROADTRUSD', 'RBROADRUUSD', 'RBROADZAUSD', 'RBROADNGUSD',
            // EM Interest Rates & Spreads
            'EMBI+', 'EMBIBR', 'EMBIMX', 'EMBICO', 'EMBICL',
            'EMBIPE', 'EMBIAR', 'EMBIUY', 'EMBIVE', 'EMBITR',
            'EMBIPL', 'EMBIRU', 'EMBIZA', 'EMBIEG', 'EMBING'
        ];
        
        // Complete Liquidity Indicators (100+)
        const LIQUIDITY_INDICATORS = [
            // Central Bank Balance Sheets
            'WALCL', 'RESPPALGUOXAWXCH52NWW', 'RESPPALGUONNWW',
            'ECBASSETSW', 'JPNASSETS', 'UKBSASSETS', 'CACBBS', 'SNBASSETSW', 'RBATASSETS',
            'BOCASSETS', 'RIKSASSETS', 'RBNZASSETS', 'CBABSASSETS', 'BCRASSETS', 'CBMASSETS',
            // Swap Lines & Facilities
            'SWPT', 'SWP1690', 'SWP15', 'CS3ML1USL', 'CS6ML1USL', 'CS1ML1USL',
            'ECBDFR', 'ECBMLFR', 'BOJPR', 'BOEPRATE', 'BOCRATE', 'SNBRATE',
            // Money Supply - Global
            'M1SL', 'M2SL', 'MZMSL', 'M1NS', 'M2NS', 'BOGMBASE',
            'MABMM301EZM189S', 'MABMM301JPM189S', 'MABMM301GBM189S', 'MABMM301CAM189S',
            'MABMM301CHM189S', 'MABMM301AUM189S', 'MABMM301SEM189S', 'MABMM301NOM189S',
            // Repo & Reverse Repo
            'RRPONTSYD', 'RPONTTLD', 'RRPONTSYAWARD', 'RREP15', 'REP1690',
            'WORAL', 'WLRRAL', 'H41RESPPALDKNWW', 'RPCD90', 'RPCMH3M',
            'SOFRVOL', 'EFFRVOL', 'OBFRVOL', 'TRIREVOL',
            // Securities & Credit
            'USGSEC', 'MBSECNS', 'OTHSEC', 'LOANSEC', 'SECLENDING',
            'HQLA', 'REALLN', 'BUSLOANS', 'CONSUMER', 'CREDSEC',
            'CILACBQ158SBOG', 'DRCLACBS', 'RCFDQBMILNQ', 'TOTCI',
            // Treasury & TGA
            'WTREGEN', 'TREAS911Y', 'TREAS1590', 'DRALACBN', 'TREASDOPL',
            'FDHBFRBN', 'FDHBFIN', 'USTREASNETISS', 'TREASNEW',
            // Commercial Paper & Money Markets
            'COMPOUT', 'CPFF', 'MMMFFAQ027S', 'WRMFNS', 'MMMFRP',
            'DTCOLNVHFNM', 'DTCOLREHFNM', 'DTCOLCBHFNM', 'CP3M', 'CPN3M',
            'CPRESID', 'CPREFI', 'CPABS', 'CPFFCP', 'CPFFD',
            // Bank Reserves & Deposits
            'TOTRESNS', 'EXCSRESNS', 'REQRESNS', 'NONBORRES', 'BORRCB',
            'DPSACBW027SBOG', 'DDPSACBW027SBOG', 'SBCACBW027SBOG',
            'TCDNS', 'DDDNS', 'STDSL', 'SAVINGSL', 'MDLNM',
            // International Liquidity
            'ECBLIQFACW', 'BOJLIQFAC', 'BOELIQFAC', 'SNBLIQFAC',
            'CBABLIQFAC', 'RBALIQFAC', 'BCBLIQFAC', 'BOCLIQFAC',
            // Shadow Banking
            'BOGZ1FL674090005Q', 'BOGZ1FL664090005Q', 'BOGZ1FL684090005Q',
            'SHADOWRATE', 'GSHADOWBN', 'REPOMARKET'
        ];
        
        // Global state
        let allData = {};
        let customNames = {};
        let currentSort = { column: 'name', ascending: true };
        let currentFilter = 'all';
        let dataLoaded = false;
        
        // Initialize
        async function initialize() {
            console.log('üöÄ Initializing Complete OpenBB Platform with ALL indicators...');
            loadCustomNames();
            showStatus('Loading ALL indicators from FRED and ICE BofA...', 'loading');
            
            // Calculate total indicators
            const totalIndicators = ICE_BOFA_COMPLETE.length + 
                                  FEDERAL_RESERVE_INDICATORS.length +
                                  DOLLAR_INDICATORS.length +
                                  EM_INDICATORS.length +
                                  LIQUIDITY_INDICATORS.length;
            
            document.getElementById('totalIndicators').textContent = totalIndicators;
            document.getElementById('overviewStatus').textContent = `Loading ${totalIndicators} total indicators...`;
            
            // Fetch all data
            await Promise.all([
                fetchICEBofAData(),
                fetchFREDData(),
                fetchOpenBBData()
            ]);
            
            dataLoaded = true;
            setupEventListeners();
            setupAutoUpdate();
            initializeCharts();
            
            // Update overview status
            const loadedCount = Object.keys(allData).length;
            document.getElementById('overviewStatus').textContent = `Loaded ${loadedCount} indicators - Displaying ALL on heatmap`;
            
            showStatus(`Dashboard initialized with ${loadedCount} real indicators`, 'success');
        }
        
        // Fetch ICE BofA data - ALL 180 series
        async function fetchICEBofAData() {
            try {
                console.log('Fetching ALL 180 ICE BofA indices...');
                
                // First try to get all series from API
                const listResponse = await fetch(`${CONFIG.ICE_BOFA_API}ice_bofa?series=all`);
                let availableSeries = {};
                
                if (listResponse.ok) {
                    const listData = await listResponse.json();
                    availableSeries = listData.series || {};
                }
                
                // Combine API series with our complete list
                const allSeriesIds = [...new Set([...Object.keys(availableSeries), ...ICE_BOFA_COMPLETE])];
                
                let loadedCount = 0;
                let igCount = 0, hyCount = 0, emCount = 0;
                
                // Fetch data for each series
                for (const seriesId of allSeriesIds) {
                    try {
                        const response = await fetch(`${CONFIG.ICE_BOFA_API}ice_bofa?series=${seriesId}`);
                        if (response.ok) {
                            const data = await response.json();
                            const historicalData = data.data || [];
                            
                            if (historicalData.length > 0) {
                                allData[seriesId] = {
                                    id: seriesId,
                                    name: customNames[seriesId] || availableSeries[seriesId] || getICEName(seriesId),
                                    value: historicalData[0]?.value || 0,
                                    weeklyChange: calculateChange(historicalData, 5),
                                    monthlyChange: calculateChange(historicalData, 21),
                                    quarterlyChange: calculateChange(historicalData, 63),
                                    yearlyChange: calculateChange(historicalData, 252),
                                    lastUpdate: historicalData[0]?.date,
                                    category: 'icebofa',
                                    data: historicalData,
                                    source: 'ICE_BOFA'
                                };
                                
                                loadedCount++;
                                
                                // Count by category
                                if (seriesId.includes('BAMLC')) igCount++;
                                else if (seriesId.includes('BAMLH')) hyCount++;
                                else if (seriesId.includes('BAMLEM')) emCount++;
                            }
                        }
                    } catch (err) {
                        console.error(`Error fetching ICE BofA ${seriesId}:`, err);
                        // Add with zero values if fetch fails
                        allData[seriesId] = {
                            id: seriesId,
                            name: customNames[seriesId] || getICEName(seriesId),
                            value: 0,
                            weeklyChange: 0,
                            monthlyChange: 0,
                            quarterlyChange: 0,
                            yearlyChange: 0,
                            category: 'icebofa',
                            source: 'ICE_BOFA'
                        };
                    }
                }
                
                document.getElementById('igCount').textContent = igCount;
                document.getElementById('hyCount').textContent = hyCount;
                document.getElementById('emCount').textContent = emCount;
                document.getElementById('iceTotal').textContent = allSeriesIds.length;
                
                console.log(`Loaded ${loadedCount} ICE BofA series out of ${allSeriesIds.length}`);
                
            } catch (error) {
                console.error('Error fetching ICE BofA data:', error);
            }
        }
        
        // Fetch FRED data - ALL indicators
        async function fetchFREDData() {
            console.log('Fetching ALL FRED indicators...');
            
            // Combine all FRED series
            const allFredSeries = [
                ...FEDERAL_RESERVE_INDICATORS,
                ...DOLLAR_INDICATORS,
                ...EM_INDICATORS.filter(s => !s.includes('BAML')),
                ...LIQUIDITY_INDICATORS
            ].filter((v, i, a) => a.indexOf(v) === i); // Remove duplicates
            
            let loadedCount = 0;
            
            // Batch fetch to avoid rate limiting
            for (let i = 0; i < allFredSeries.length; i += 5) {
                const batch = allFredSeries.slice(i, i + 5);
                
                await Promise.all(batch.map(async (seriesId) => {
                    try {
                        const response = await fetch(
                            `${CONFIG.FRED_BASE_URL}/series/observations?` +
                            `series_id=${seriesId}&` +
                            `api_key=${CONFIG.FRED_API_KEY}&` +
                            `file_type=json&` +
                            `limit=252&` +
                            `sort_order=desc`
                        );
                        
                        if (response.ok) {
                            const data = await response.json();
                            const observations = data.observations || [];
                            
                            if (observations.length > 0) {
                                const current = parseFloat(observations[0].value) || 0;
                                
                                allData[seriesId] = {
                                    id: seriesId,
                                    name: customNames[seriesId] || getIndicatorName(seriesId),
                                    value: current,
                                    weeklyChange: calculatePercentChange(observations, 5),
                                    monthlyChange: calculatePercentChange(observations, 21),
                                    quarterlyChange: calculatePercentChange(observations, 63),
                                    lastUpdate: observations[0].date,
                                    category: categorizeIndicator(seriesId),
                                    data: observations,
                                    source: 'FRED'
                                };
                                
                                loadedCount++;
                                document.getElementById('loadedIndicators').textContent = loadedCount;
                            }
                        }
                    } catch (err) {
                        console.error(`Error fetching ${seriesId}:`, err);
                    }
                }));
                
                showStatus(`Loading FRED: ${loadedCount}/${allFredSeries.length} indicators...`, 'loading');
            }
            
            console.log(`Loaded ${loadedCount} FRED indicators`);
        }
        
        // Fetch OpenBB data as backup
        async function fetchOpenBBData() {
            try {
                const responses = await Promise.allSettled([
                    fetch(CONFIG.OPENBB_API.baseUrl + CONFIG.OPENBB_API.endpoints.overview),
                    fetch(CONFIG.OPENBB_API.baseUrl + CONFIG.OPENBB_API.endpoints.mega),
                    fetch(CONFIG.OPENBB_API.baseUrl + CONFIG.OPENBB_API.endpoints.fed),
                    fetch(CONFIG.OPENBB_API.baseUrl + CONFIG.OPENBB_API.endpoints.liquidity)
                ]);
                
                for (let response of responses) {
                    if (response.status === 'fulfilled' && response.value.ok) {
                        const data = await response.value.json();
                        if (data.indicators) {
                            Object.entries(data.indicators).forEach(([key, value]) => {
                                if (!allData[key]) {
                                    allData[key] = {
                                        id: key,
                                        name: customNames[key] || getIndicatorName(key),
                                        value: value.value || value,
                                        weeklyChange: value.wow || 0,
                                        monthlyChange: value.mom || 0,
                                        quarterlyChange: value.qoq || 0,
                                        category: categorizeIndicator(key),
                                        source: 'OPENBB'
                                    };
                                }
                            });
                        }
                    }
                }
            } catch (error) {
                console.error('Error fetching OpenBB data:', error);
            }
            
            // Update all displays after data is loaded
            updateAllDisplays();
        }
        
        // Calculate percentage change
        function calculatePercentChange(observations, periods) {
            if (!observations || observations.length <= periods) return 0;
            const current = parseFloat(observations[0]?.value) || 0;
            const previous = parseFloat(observations[periods]?.value) || current;
            if (previous === 0) return 0;
            return ((current - previous) / previous) * 100;
        }
        
        // Calculate change from data
        function calculateChange(data, periods) {
            if (!data || data.length <= periods) return 0;
            const current = parseFloat(data[0]?.value) || 0;
            const previous = parseFloat(data[periods]?.value) || current;
            if (previous === 0) return 0;
            return ((current - previous) / previous) * 100;
        }
        
        // Update all displays
        function updateAllDisplays() {
            if (!dataLoaded) return;
            
            updateStats();
            updateOverviewHeatmap('all');
            updateKeyMetrics();
            updateIndicatorsTable();
            updateICEHeatmap();
            updateICETable();
            updateMacroHeatmap();
            updateMacroTable();
            updateLiquidityHeatmap();
            updateLiquidityTable();
            updateDollarHeatmap();
            updateDollarTable();
            updateEMHeatmap();
            updateEMTable();
            updateFedHeatmap();
            updateFedTable();
            updateAdvancedHeatmap();
            updateLastUpdateTime();
        }
        
        // Update overview heatmap - SHOW ALL INDICATORS
        function updateOverviewHeatmap(filter) {
            const container = document.getElementById('overviewHeatmap');
            if (!container) return;
            
            container.innerHTML = '';
            currentFilter = filter;
            
            let indicators = Object.values(allData)
                .filter(d => d && d.value !== null && d.value !== undefined);
            
            // Apply filter but keep all indicators
            if (filter === 'gainers') {
                indicators = indicators.filter(i => i.weeklyChange > 0);
            } else if (filter === 'losers') {
                indicators = indicators.filter(i => i.weeklyChange < 0);
            } else if (filter === 'icebofa') {
                indicators = indicators.filter(i => i.category === 'icebofa');
            } else if (filter === 'liquidity') {
                indicators = indicators.filter(i => i.category === 'liquidity');
            } else if (filter === 'dollar') {
                indicators = indicators.filter(i => i.category === 'dollar');
            } else if (filter === 'em') {
                indicators = indicators.filter(i => i.category === 'em');
            }
            
            // Sort by absolute weekly change for sizing
            indicators.sort((a, b) => Math.abs(b.weeklyChange) - Math.abs(a.weeklyChange));
            
            // Display ALL indicators (no limit)
            indicators.forEach((ind, index) => {
                const tile = createEditableHeatmapTile(ind, index);
                container.appendChild(tile);
            });
            
            console.log(`Displaying ${indicators.length} indicators on overview heatmap`);
        }
        
        // Create editable heatmap tile
        function createEditableHeatmapTile(indicator, index) {
            const tile = document.createElement('div');
            
            // Size based on weekly change magnitude and index
            let sizeClass = '';
            const absWeekly = Math.abs(indicator.weeklyChange);
            if (index < 3 && absWeekly > 10) {
                sizeClass = 'tile-xxl';
            } else if (index < 6 && absWeekly > 5) {
                sizeClass = 'tile-xl';
            } else if (index < 12 && absWeekly > 2) {
                sizeClass = 'tile-lg';
            }
            
            const colorClass = getHeatColor(indicator.weeklyChange);
            tile.className = `heatmap-tile ${colorClass} ${sizeClass}`;
            
            const displayName = indicator.name.substring(0, 20);
            
            tile.innerHTML = `
                <input type="text" 
                       class="editable-tile-name" 
                       value="${displayName}" 
                       data-series-id="${indicator.id}"
                       onchange="updateCustomName('${indicator.id}', this.value)"
                       onclick="event.stopPropagation()">
                <div class="tile-value">W: ${indicator.weeklyChange >= 0 ? '+' : ''}${indicator.weeklyChange.toFixed(1)}%</div>
                <div class="tile-value-secondary">M: ${indicator.monthlyChange >= 0 ? '+' : ''}${indicator.monthlyChange.toFixed(1)}%</div>
            `;
            
            tile.title = `${indicator.name} (${indicator.id})
Value: ${formatValue(indicator.value, indicator.id)}
Weekly: ${indicator.weeklyChange.toFixed(2)}%
Monthly: ${indicator.monthlyChange.toFixed(2)}%
Source: ${indicator.source || 'N/A'}`;
            
            return tile;
        }
        
        // Update other heatmaps
        function updateICEHeatmap() {
            const container = document.getElementById('iceHeatmap');
            if (!container) return;
            
            container.innerHTML = '';
            
            let iceData = Object.values(allData)
                .filter(d => d && d.category === 'icebofa');
            
            iceData.sort((a, b) => Math.abs(b.weeklyChange) - Math.abs(a.weeklyChange));
            
            iceData.forEach((item, index) => {
                const tile = createEditableHeatmapTile(item, index);
                container.appendChild(tile);
            });
        }
        
        function updateMacroHeatmap() {
            const container = document.getElementById('macroHeatmap');
            if (!container) return;
            
            container.innerHTML = '';
            
            let macroData = Object.values(allData)
                .filter(d => d && d.category === 'macro');
            
            macroData.sort((a, b) => Math.abs(b.weeklyChange) - Math.abs(a.weeklyChange));
            
            macroData.forEach((item, index) => {
                const tile = createEditableHeatmapTile(item, index);
                container.appendChild(tile);
            });
        }
        
        function updateLiquidityHeatmap() {
            const container = document.getElementById('liquidityHeatmap');
            if (!container) return;
            
            container.innerHTML = '';
            
            let liquidityData = Object.values(allData)
                .filter(d => d && d.category === 'liquidity');
            
            liquidityData.sort((a, b) => Math.abs(b.weeklyChange) - Math.abs(a.weeklyChange));
            
            liquidityData.forEach((item, index) => {
                const tile = createEditableHeatmapTile(item, index);
                container.appendChild(tile);
            });
        }
        
        function updateDollarHeatmap() {
            const container = document.getElementById('dollarHeatmap');
            if (!container) return;
            
            container.innerHTML = '';
            
            let dollarData = Object.values(allData)
                .filter(d => d && d.category === 'dollar');
            
            dollarData.sort((a, b) => Math.abs(b.weeklyChange) - Math.abs(a.weeklyChange));
            
            dollarData.forEach((item, index) => {
                const tile = createEditableHeatmapTile(item, index);
                container.appendChild(tile);
            });
        }
        
        function updateEMHeatmap() {
            const container = document.getElementById('emHeatmap');
            if (!container) return;
            
            container.innerHTML = '';
            
            let emData = Object.values(allData)
                .filter(d => d && d.category === 'em');
            
            emData.sort((a, b) => Math.abs(b.weeklyChange) - Math.abs(a.weeklyChange));
            
            emData.forEach((item, index) => {
                const tile = createEditableHeatmapTile(item, index);
                container.appendChild(tile);
            });
        }
        
        function updateFedHeatmap() {
            const container = document.getElementById('fedHeatmap');
            if (!container) return;
            
            container.innerHTML = '';
            
            let fedData = Object.values(allData)
                .filter(d => d && d.category === 'fed');
            
            fedData.sort((a, b) => Math.abs(b.weeklyChange) - Math.abs(a.weeklyChange));
            
            fedData.forEach((item, index) => {
                const tile = createEditableHeatmapTile(item, index);
                container.appendChild(tile);
            });
        }
        
        function updateAdvancedHeatmap() {
            const container = document.getElementById('advancedHeatmap');
            if (!container) return;
            
            container.innerHTML = '';
            
            let indicators = Object.values(allData)
                .filter(d => d);
            
            indicators.sort((a, b) => Math.abs(b.monthlyChange) - Math.abs(a.monthlyChange));
            
            indicators.forEach((item, index) => {
                const tile = createEditableHeatmapTile(item, index);
                container.appendChild(tile);
            });
        }
        
        // Update tables
        function updateIndicatorsTable() {
            const tbody = document.getElementById('indicatorsTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            Object.values(allData)
                .filter(d => d)
                .forEach(indicator => {
                    const row = createEditableTableRow(indicator);
                    tbody.appendChild(row);
                });
        }
        
        function updateICETable() {
            const tbody = document.getElementById('iceTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            Object.values(allData)
                .filter(d => d && d.category === 'icebofa')
                .forEach(indicator => {
                    const row = createEditableTableRow(indicator, true);
                    tbody.appendChild(row);
                });
        }
        
        function updateMacroTable() {
            const tbody = document.getElementById('macroTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            Object.values(allData)
                .filter(d => d && d.category === 'macro')
                .forEach(indicator => {
                    const row = createEditableTableRow(indicator);
                    tbody.appendChild(row);
                });
        }
        
        function updateLiquidityTable() {
            const tbody = document.getElementById('liquidityTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            Object.values(allData)
                .filter(d => d && d.category === 'liquidity')
                .forEach(indicator => {
                    const row = createEditableTableRow(indicator);
                    tbody.appendChild(row);
                });
        }
        
        function updateDollarTable() {
            const tbody = document.getElementById('dollarTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            Object.values(allData)
                .filter(d => d && d.category === 'dollar')
                .forEach(indicator => {
                    const row = createEditableTableRow(indicator);
                    tbody.appendChild(row);
                });
        }
        
        function updateEMTable() {
            const tbody = document.getElementById('emTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            Object.values(allData)
                .filter(d => d && d.category === 'em')
                .forEach(indicator => {
                    const row = createEditableTableRow(indicator);
                    tbody.appendChild(row);
                });
        }
        
        function updateFedTable() {
            const tbody = document.getElementById('fedTable');
            if (!tbody) return;
            
            tbody.innerHTML = '';
            
            Object.values(allData)
                .filter(d => d && d.category === 'fed')
                .forEach(indicator => {
                    const row = createEditableTableRow(indicator);
                    tbody.appendChild(row);
                });
        }
        
        // Create editable table row
        function createEditableTableRow(indicator, includeYearly = false) {
            const row = document.createElement('tr');
            row.innerHTML = `
                <td style="font-family: monospace; font-size: 0.8rem;">${indicator.id}</td>
                <td>
                    <input type="text" 
                           class="editable-name" 
                           value="${indicator.name}" 
                           data-series-id="${indicator.id}"
                           onchange="updateCustomName('${indicator.id}', this.value)">
                </td>
                <td>${formatValue(indicator.value, indicator.id)}</td>
                <td class="${indicator.weeklyChange >= 0 ? 'positive' : 'negative'}">
                    ${indicator.weeklyChange >= 0 ? '+' : ''}${indicator.weeklyChange.toFixed(2)}%
                </td>
                <td class="${indicator.monthlyChange >= 0 ? 'positive' : 'negative'}">
                    ${indicator.monthlyChange >= 0 ? '+' : ''}${indicator.monthlyChange.toFixed(2)}%
                </td>
                <td class="${indicator.quarterlyChange >= 0 ? 'positive' : 'negative'}">
                    ${indicator.quarterlyChange >= 0 ? '+' : ''}${indicator.quarterlyChange.toFixed(2)}%
                </td>
                ${includeYearly && indicator.yearlyChange !== undefined ? `
                <td class="${indicator.yearlyChange >= 0 ? 'positive' : 'negative'}">
                    ${indicator.yearlyChange >= 0 ? '+' : ''}${indicator.yearlyChange.toFixed(2)}%
                </td>` : ''}
                ${indicator.lastUpdate ? `<td style="font-size: 0.8rem; color: #888;">${indicator.lastUpdate}</td>` : ''}
            `;
            return row;
        }
        
        // Update key metrics
        function updateKeyMetrics() {
            const container = document.getElementById('keyMetrics');
            if (!container) return;
            
            container.innerHTML = '';
            
            const keyIndicators = ['VIXCLS', 'SP500', 'DTWEXBGS', 'DGS10', 'WALCL', 'SOFR', 'M2SL', 'RRPONTSYD'];
            
            keyIndicators.forEach(key => {
                const data = allData[key];
                if (!data) return;
                
                const card = document.createElement('div');
                card.className = 'metric-card';
                card.innerHTML = `
                    <div class="metric-title">${data.name}</div>
                    <div class="metric-value ${data.monthlyChange >= 0 ? 'positive' : 'negative'}">
                        ${formatValue(data.value, key)}
                    </div>
                    <div class="metric-change ${data.monthlyChange >= 0 ? 'positive' : 'negative'}">
                        <span>${data.monthlyChange >= 0 ? '‚ñ≤' : '‚ñº'}</span>
                        ${Math.abs(data.monthlyChange).toFixed(2)}%
                    </div>
                `;
                container.appendChild(card);
            });
        }
        
        // Update stats
        function updateStats() {
            const indicators = Object.values(allData).filter(d => d);
            const gainers = indicators.filter(d => d.weeklyChange > 0).length;
            const losers = indicators.filter(d => d.weeklyChange < 0).length;
            
            document.getElementById('gainers').textContent = gainers;
            document.getElementById('losers').textContent = losers;
            document.getElementById('loadedIndicators').textContent = indicators.length;
        }
        
        // Other helper functions
        function updateCustomName(seriesId, newName) {
            customNames[seriesId] = newName;
            if (allData[seriesId]) {
                allData[seriesId].name = newName;
            }
            saveCustomNames();
        }
        
        function loadCustomNames() {
            const saved = localStorage.getItem('openbbCustomNames');
            if (saved) {
                customNames = JSON.parse(saved);
            }
        }
        
        function saveCustomNames() {
            localStorage.setItem('openbbCustomNames', JSON.stringify(customNames));
        }
        
        function getIndicatorName(key) {
            const names = {
                'DFF': 'Fed Funds Rate',
                'EFFR': 'Effective Fed Funds',
                'SOFR': 'SOFR',
                'DGS10': '10Y Treasury',
                'DGS2': '2Y Treasury',
                'WALCL': 'Fed Balance Sheet',
                'M2SL': 'M2 Money Supply',
                'RRPONTSYD': 'Reverse Repo',
                'DTWEXBGS': 'Dollar Index',
                'DEXUSEU': 'EUR/USD',
                'DEXJPUS': 'USD/JPY',
                'VIXCLS': 'VIX Index',
                'SP500': 'S&P 500'
            };
            return names[key] || key;
        }
        
        function getICEName(key) {
            if (key.includes('BAMLH0A0HYM2')) return 'US HY Master II';
            if (key.includes('BAMLC0A0CM')) return 'US Corp Master';
            if (key.includes('BAMLEMCB')) return 'EM Corp Plus';
            return key.replace('BAML', '');
        }
        
        function categorizeIndicator(key) {
            if (key.includes('BAML')) return 'icebofa';
            if (FEDERAL_RESERVE_INDICATORS.includes(key)) return 'fed';
            if (DOLLAR_INDICATORS.includes(key) || key.includes('DEX') || key.includes('DTW')) return 'dollar';
            if (EM_INDICATORS.includes(key)) return 'em';
            if (LIQUIDITY_INDICATORS.includes(key)) return 'liquidity';
            if (['SP500', 'DJIA', 'NASDAQCOM', 'VIXCLS'].includes(key)) return 'stocks';
            if (key.includes('DGS')) return 'bonds';
            if (key.includes('CPI') || key.includes('GDP') || key.includes('UNRATE')) return 'macro';
            return 'other';
        }
        
        function getHeatColor(change) {
            if (change > 5) return 'heat-positive-5';
            if (change > 2) return 'heat-positive-4';
            if (change > 1) return 'heat-positive-3';
            if (change > 0.5) return 'heat-positive-2';
            if (change > 0) return 'heat-positive-1';
            if (change > -0.5) return 'heat-neutral';
            if (change > -1) return 'heat-negative-1';
            if (change > -2) return 'heat-negative-2';
            if (change > -5) return 'heat-negative-3';
            if (change > -10) return 'heat-negative-4';
            return 'heat-negative-5';
        }
        
        function formatValue(value, key) {
            if (value === null || value === undefined) return 'N/A';
            
            const num = parseFloat(value);
            
            if (key.includes('WALCL') || key.includes('ASSETS') || key.includes('M2')) {
                if (num >= 1000000) return `${(num / 1000000).toFixed(2)}T`;
                if (num >= 1000) return `${(num / 1000).toFixed(2)}B`;
            }
            
            if (key.includes('OAS')) {
                return `${num.toFixed(2)} bps`;
            }
            
            if (key.includes('EY') || key.includes('YTW') || key.includes('DGS') || 
                key.includes('RATE') || key.includes('SOFR') || key.includes('EFFR')) {
                return `${num.toFixed(2)}%`;
            }
            
            if (key.includes('DEX')) {
                return num.toFixed(4);
            }
            
            if (['SP500', 'DJIA', 'NASDAQCOM'].includes(key)) {
                return num.toFixed(0);
            }
            
            if (num >= 1000000000000) return `${(num / 1000000000000).toFixed(2)}T`;
            if (num >= 1000000000) return `${(num / 1000000000).toFixed(2)}B`;
            if (num >= 1000000) return `${(num / 1000000).toFixed(2)}M`;
            if (num >= 1000) return `${(num / 1000).toFixed(2)}K`;
            
            return num.toFixed(2);
        }
        
        function showStatus(message, type) {
            const statusDiv = document.getElementById('statusMessage');
            statusDiv.className = `status-message show status-${type}`;
            statusDiv.textContent = message;
            
            if (type === 'success' || type === 'error') {
                setTimeout(() => {
                    statusDiv.classList.remove('show');
                }, 5000);
            }
        }
        
        function updateLastUpdateTime() {
            const now = new Date();
            const timeStr = now.toLocaleTimeString('en-US', { hour: '2-digit', minute: '2-digit' });
            document.getElementById('lastUpdate').textContent = timeStr;
        }
        
        async function refreshAllData() {
            showStatus('Refreshing ALL indicators...', 'loading');
            allData = {};
            dataLoaded = false;
            await Promise.all([
                fetchICEBofAData(),
                fetchFREDData(),
                fetchOpenBBData()
            ]);
            dataLoaded = true;
            showStatus('All data refreshed successfully', 'success');
        }
        
        async function refreshICEData() {
            showStatus('Refreshing ICE BofA data...', 'loading');
            await fetchICEBofAData();
            updateICEHeatmap();
            updateICETable();
            showStatus('ICE BofA data refreshed', 'success');
        }
        
        function sortTable(column) {
            currentSort.column = column;
            currentSort.ascending = !currentSort.ascending;
            updateIndicatorsTable();
        }
        
        function sortICETable(column) {
            currentSort.column = column;
            currentSort.ascending = !currentSort.ascending;
            updateICETable();
        }
        
        function filterICEHeatmap(filter) {
            // Implementation for ICE filter
        }
        
        function setupAutoUpdate() {
            const checkAndUpdate = () => {
                const now = new Date();
                const day = now.getDay();
                const hour = now.getHours();
                const minute = now.getMinutes();
                
                // Check if it's Mon(1), Wed(3), or Fri(5) at 9:30 AM
                if ([1, 3, 5].includes(day) && hour === 9 && minute === 30) {
                    console.log('Auto-updating data (scheduled 3x/week)...');
                    refreshAllData();
                }
            };
            
            // Check every minute
            setInterval(checkAndUpdate, 60000);
            
            // Also refresh every 30 minutes during market hours
            setInterval(() => {
                const hour = new Date().getHours();
                if (hour >= 9 && hour < 16) {
                    refreshAllData();
                }
            }, 1800000); // 30 minutes
        }
        
        function initializeCharts() {
            const mainData = {
                x: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                y: [4500, 4550, 4600, 4650, 4700, 4750],
                type: 'scatter',
                mode: 'lines+markers',
                name: 'S&P 500',
                line: { color: '#00ccff' }
            };
            
            const mainLayout = {
                title: 'Market Overview',
                paper_bgcolor: 'rgba(0,0,0,0)',
                plot_bgcolor: 'rgba(0,0,0,0)',
                font: { color: '#fff' },
                xaxis: { gridcolor: 'rgba(255,255,255,0.1)' },
                yaxis: { gridcolor: 'rgba(255,255,255,0.1)' }
            };
            
            Plotly.newPlot('mainChart', [mainData], mainLayout, {responsive: true});
        }
        
        function setupEventListeners() {
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    const tabId = e.target.dataset.tab;
                    const tabContent = document.getElementById(tabId);
                    if (tabContent) {
                        tabContent.classList.add('active');
                    }
                });
            });
        }
        
        // Initialize on load
        document.addEventListener('DOMContentLoaded', initialize);
    </script>
</body>
</html>
