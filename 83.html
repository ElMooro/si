<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Multi-Agent Financial Intelligence System - 650+ Real-Time Metrics</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #0f0c1d 0%, #1a1a2e 50%, #16213e 100%);
            color: #e0e0e0;
            min-height: 100vh;
        }

        .dashboard-container {
            max-width: 1900px;
            margin: 0 auto;
            padding: 20px;
        }

        /* Header Section */
        .header {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header-title {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        h1 {
            font-size: 2.8em;
            background: linear-gradient(90deg, #00ff88, #00d4ff, #ff00ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-weight: 700;
        }

        .live-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px 20px;
            background: rgba(0, 255, 0, 0.1);
            border-radius: 10px;
            border: 1px solid rgba(0, 255, 0, 0.3);
        }

        .pulse-dot {
            width: 12px;
            height: 12px;
            background: #00ff00;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0, 255, 0, 0.7); }
            70% { box-shadow: 0 0 0 10px rgba(0, 255, 0, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0, 255, 0, 0); }
        }

        /* Khalid Index Display */
        .khalid-index-container {
            background: rgba(255, 255, 255, 0.03);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .khalid-index-header {
            text-align: center;
            margin-bottom: 20px;
        }

        .khalid-index-value {
            font-size: 4em;
            font-weight: bold;
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .khalid-index-extreme-greed {
            background: linear-gradient(135deg, #00ff00, #00cc00);
            color: #001100;
        }

        .khalid-index-greed {
            background: linear-gradient(135deg, #88ff00, #66cc00);
            color: #002200;
        }

        .khalid-index-neutral {
            background: linear-gradient(135deg, #ffff00, #ffcc00);
            color: #333300;
        }

        .khalid-index-fear {
            background: linear-gradient(135deg, #ff8800, #ff6600);
            color: #330000;
        }

        .khalid-index-extreme-fear {
            background: linear-gradient(135deg, #ff0000, #cc0000);
            color: #ffffff;
        }

        .khalid-components {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .khalid-component {
            background: rgba(255, 255, 255, 0.02);
            padding: 15px;
            border-radius: 10px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        /* Grid Layout for Sections */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(450px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 15px;
            padding: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 40px rgba(0, 0, 0, 0.4);
        }

        .metric-card h3 {
            color: #00d4ff;
            margin-bottom: 15px;
            font-size: 1.3em;
            border-bottom: 2px solid rgba(0, 212, 255, 0.3);
            padding-bottom: 10px;
        }

        .metric-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .metric-label {
            color: #b0b0b0;
            font-size: 0.9em;
        }

        .metric-value {
            font-weight: 600;
            font-size: 1.1em;
        }

        .positive {
            color: #00ff88;
        }

        .negative {
            color: #ff4444;
        }

        .neutral {
            color: #ffcc00;
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top-color: #00d4ff;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Alert Boxes */
        .alert-box {
            background: rgba(255, 0, 0, 0.1);
            border: 1px solid rgba(255, 0, 0, 0.3);
            border-radius: 10px;
            padding: 15px;
            margin: 20px 0;
        }

        .alert-box h4 {
            color: #ff6666;
            margin-bottom: 10px;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .metrics-grid {
                grid-template-columns: 1fr;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .khalid-index-value {
                font-size: 3em;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <!-- Header Section -->
        <div class="header">
            <div class="header-title">
                <h1>Multi-Agent Financial Intelligence System</h1>
                <div class="live-indicator">
                    <div class="pulse-dot"></div>
                    <span>LIVE DATA</span>
                    <span id="last-update"></span>
                </div>
            </div>
            <div>
                <p>650+ Metrics ‚Ä¢ 15 Intelligent Agents ‚Ä¢ Real-Time Analysis</p>
            </div>
        </div>

        <!-- Khalid Index Section -->
        <div class="khalid-index-container">
            <div class="khalid-index-header">
                <h2>KHALID INDEX</h2>
                <p>Proprietary Market Sentiment Indicator</p>
            </div>
            <div id="khalid-index" class="khalid-index-value khalid-index-neutral">
                <span id="khalid-value">Calculating...</span>
            </div>
            <div class="khalid-components" id="khalid-components">
                <!-- Components will be populated here -->
            </div>
        </div>

        <!-- Risk Assessment Alert -->
        <div class="alert-box" id="risk-alert" style="display: none;">
            <h4>‚ö†Ô∏è MASTER RISK ASSESSMENT</h4>
            <div id="risk-content"></div>
        </div>

        <!-- Main Metrics Grid -->
        <div class="metrics-grid">
            <!-- 1. Global Liquidity Metrics -->
            <div class="metric-card">
                <h3>üåç Global Liquidity (500+ Metrics)</h3>
                <div id="global-liquidity">
                    <div class="metric-item">
                        <span class="metric-label">Fed Balance Sheet</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">ECB Total Assets</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">BOJ Balance Sheet</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">PBOC Total Assets</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Combined G4 Liquidity</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                </div>
            </div>

            <!-- 2. Volatility Analysis -->
            <div class="metric-card">
                <h3>üìä Volatility Analysis</h3>
                <div id="volatility-metrics">
                    <div class="metric-item">
                        <span class="metric-label">VIX Index</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">MOVE Index</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">VVIX</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Put/Call Ratio</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Term Structure</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                </div>
            </div>

            <!-- 3. Manufacturing Data -->
            <div class="metric-card">
                <h3>üè≠ Manufacturing & PMI Data</h3>
                <div id="manufacturing-data">
                    <div class="metric-item">
                        <span class="metric-label">ISM Manufacturing</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">ISM Services</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Global Manufacturing PMI</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">China Caixin PMI</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Eurozone PMI</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                </div>
            </div>

            <!-- 4. Dollar Strength -->
            <div class="metric-card">
                <h3>üíµ Dollar Strength (30+ Pairs)</h3>
                <div id="dollar-strength">
                    <div class="metric-item">
                        <span class="metric-label">DXY Index</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">EUR/USD</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">USD/JPY</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">GBP/USD</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">USD/CNY</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                </div>
            </div>

            <!-- 5. Bond Market Analysis -->
            <div class="metric-card">
                <h3>üìà Bond Market & Spreads</h3>
                <div id="bond-market">
                    <div class="metric-item">
                        <span class="metric-label">10Y Treasury</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">2Y-10Y Spread</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">IG Spreads</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">HY Spreads</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">TED Spread</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                </div>
            </div>

            <!-- 6. Repo Market Stress -->
            <div class="metric-card">
                <h3>üè¶ Repo Market Stress Indicators</h3>
                <div id="repo-market">
                    <div class="metric-item">
                        <span class="metric-label">SOFR Rate</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">GC Repo Rate</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Repo Volume</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Fails Rate</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">RRP Usage</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                </div>
            </div>

            <!-- 7. Labor Market Data -->
            <div class="metric-card">
                <h3>üë• Labor Market (BLS)</h3>
                <div id="labor-market">
                    <div class="metric-item">
                        <span class="metric-label">Unemployment Rate</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">NFP (Last)</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">JOLTS Openings</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Quits Rate</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Wage Growth YoY</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                </div>
            </div>

            <!-- 8. Economic Indicators -->
            <div class="metric-card">
                <h3>üìâ Economic Indicators (BEA)</h3>
                <div id="economic-indicators">
                    <div class="metric-item">
                        <span class="metric-label">GDP Growth</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">CPI YoY</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Core PCE</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Retail Sales MoM</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Consumer Confidence</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                </div>
            </div>

            <!-- 9. Market Breadth -->
            <div class="metric-card">
                <h3>üìä Market Breadth Analysis</h3>
                <div id="market-breadth">
                    <div class="metric-item">
                        <span class="metric-label">Advance/Decline</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">New Highs/Lows</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">McClellan Oscillator</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">% Above 200 MA</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">NYSE TICK</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                </div>
            </div>

            <!-- 10. News Sentiment -->
            <div class="metric-card">
                <h3>üì∞ News Sentiment Analysis</h3>
                <div id="news-sentiment">
                    <div class="metric-item">
                        <span class="metric-label">Overall Sentiment</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Fear Keywords</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Greed Keywords</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Recession Mentions</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Fed Policy Score</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                </div>
            </div>

            <!-- 11. Treasury Auctions -->
            <div class="metric-card">
                <h3>üí∞ Treasury Auction Results</h3>
                <div id="treasury-auctions">
                    <div class="metric-item">
                        <span class="metric-label">Last 3M Bid/Cover</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Last 10Y Bid/Cover</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Foreign Participation</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Direct Bidder %</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Next Auction</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                </div>
            </div>

            <!-- 12. Options Flow -->
            <div class="metric-card">
                <h3>üéØ Options Flow Analysis</h3>
                <div id="options-flow">
                    <div class="metric-item">
                        <span class="metric-label">SPY GEX</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">QQQ DIX</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Dark Pool %</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Call Wall</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                    <div class="metric-item">
                        <span class="metric-label">Put Wall</span>
                        <span class="metric-value"><span class="loading"></span></span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Actionable Recommendations Section -->
        <div class="metric-card" style="width: 100%;">
            <h3>üéØ Actionable Recommendations</h3>
            <div id="recommendations">
                <p>Analyzing 650+ metrics to generate recommendations...</p>
            </div>
        </div>
    </div>

    <script>
        // Configuration with CORS-enabled endpoints
        const API_CONFIG = {
            // Your actual API endpoints - replace with your real endpoints
            treasury: {
                url: 'https://api.fiscaldata.treasury.gov/services/api/fiscal_service',
                endpoints: {
                    auctions: '/v2/accounting/od/auct_results',
                    yields: '/v2/accounting/od/avg_interest_rates',
                    debt: '/v2/accounting/od/debt_to_penny'
                }
            },
            fred: {
                url: 'https://api.stlouisfed.org/fred/series/observations',
                apiKey: '2f057499936072679d8843d7fce99989',
                series: {
                    vix: 'VIXCLS',
                    dxy: 'DEXUSEU',
                    unemployment: 'UNRATE',
                    gdp: 'GDP',
                    cpi: 'CPIAUCSL',
                    fed_funds: 'DFF',
                    ten_year: 'DGS10',
                    two_year: 'DGS2',
                    sofr: 'SOFR',
                    ism_mfg: 'MANEMP',
                    ism_services: 'NMFBAI'
                }
            },
            polygon: {
                url: 'https://api.polygon.io/v2',
                apiKey: 'NzhVT5cv5Fgx8dCgl4rIx6NkRLF6kfGl',
                endpoints: {
                    ticker: '/aggs/ticker',
                    snapshot: '/snapshot/locale/us/markets/stocks/tickers'
                }
            },
            // Add your other API configurations here
            alphavantage: {
                url: 'https://www.alphavantage.co/query',
                apiKey: 'YOUR_ALPHAVANTAGE_KEY' // Replace with your key
            }
        };

        // Data storage
        let dashboardData = {
            khalidIndex: null,
            globalLiquidity: {},
            volatility: {},
            manufacturing: {},
            dollar: {},
            bonds: {},
            repo: {},
            labor: {},
            economic: {},
            breadth: {},
            sentiment: {},
            treasury: {},
            options: {}
        };

        // Update frequency (milliseconds)
        const UPDATE_INTERVAL = 60000; // 1 minute

        // Fetch data with CORS handling
        async function fetchWithCORS(url, options = {}) {
            try {
                const response = await fetch(url, {
                    ...options,
                    mode: 'cors',
                    headers: {
                        'Content-Type': 'application/json',
                        ...options.headers
                    }
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                return await response.json();
            } catch (error) {
                console.error(`Error fetching ${url}:`, error);
                return null;
            }
        }

        // Fetch FRED data
        async function fetchFREDData(seriesId) {
            const url = `${API_CONFIG.fred.url}?series_id=${seriesId}&api_key=${API_CONFIG.fred.apiKey}&file_type=json&limit=1&sort_order=desc`;
            const data = await fetchWithCORS(url);
            return data?.observations?.[0]?.value || 'N/A';
        }

        // Fetch Treasury data
        async function fetchTreasuryData() {
            const url = `${API_CONFIG.treasury.url}${API_CONFIG.treasury.endpoints.auctions}?limit=1&sort=-auction_date`;
            const data = await fetchWithCORS(url);
            return data?.data?.[0] || {};
        }

        // Fetch Polygon data
        async function fetchPolygonData(ticker) {
            const yesterday = new Date();
            yesterday.setDate(yesterday.getDate() - 1);
            const date = yesterday.toISOString().split('T')[0];
            
            const url = `${API_CONFIG.polygon.url}${API_CONFIG.polygon.endpoints.ticker}/${ticker}/range/1/day/${date}/${date}?apiKey=${API_CONFIG.polygon.apiKey}`;
            const data = await fetchWithCORS(url);
            return data?.results?.[0] || {};
        }

        // Calculate Khalid Index
        function calculateKhalidIndex() {
            // This would use your proprietary formula
            // For now, using a simplified calculation
            const vix = parseFloat(dashboardData.volatility.vix) || 20;
            const putCall = parseFloat(dashboardData.volatility.putCall) || 1;
            const breadth = parseFloat(dashboardData.breadth.advanceDecline) || 1;
            
            let index = 50; // Neutral baseline
            
            // Adjust based on VIX
            if (vix > 30) index -= 20;
            else if (vix > 20) index -= 10;
            else if (vix < 15) index += 10;
            
            // Adjust based on put/call ratio
            if (putCall > 1.2) index -= 15;
            else if (putCall < 0.8) index += 15;
            
            // Adjust based on market breadth
            if (breadth < 0.5) index -= 10;
            else if (breadth > 1.5) index += 10;
            
            // Ensure index is between 0 and 100
            index = Math.max(0, Math.min(100, index));
            
            return index;
        }

        // Update Khalid Index display
        function updateKhalidIndex(value) {
            const indexElement = document.getElementById('khalid-index');
            const valueElement = document.getElementById('khalid-value');
            
            valueElement.textContent = value.toFixed(1);
            
            // Remove all classes
            indexElement.className = 'khalid-index-value';
            
            // Add appropriate class based on value
            if (value >= 80) {
                indexElement.classList.add('khalid-index-extreme-greed');
            } else if (value >= 60) {
                indexElement.classList.add('khalid-index-greed');
            } else if (value >= 40) {
                indexElement.classList.add('khalid-index-neutral');
            } else if (value >= 20) {
                indexElement.classList.add('khalid-index-fear');
            } else {
                indexElement.classList.add('khalid-index-extreme-fear');
            }
            
            // Update components
            const componentsHtml = `
                <div class="khalid-component">
                    <div class="metric-label">VIX Weight</div>
                    <div class="metric-value">${(dashboardData.volatility.vix || 'N/A')}</div>
                </div>
                <div class="khalid-component">
                    <div class="metric-label">Put/Call Weight</div>
                    <div class="metric-value">${(dashboardData.volatility.putCall || 'N/A')}</div>
                </div>
                <div class="khalid-component">
                    <div class="metric-label">Breadth Weight</div>
                    <div class="metric-value">${(dashboardData.breadth.advanceDecline || 'N/A')}</div>
                </div>
                <div class="khalid-component">
                    <div class="metric-label">Liquidity Weight</div>
                    <div class="metric-value">${(dashboardData.globalLiquidity.combined || 'N/A')}</div>
                </div>
            `;
            document.getElementById('khalid-components').innerHTML = componentsHtml;
        }

        // Update metric displays
        function updateMetricDisplay(elementId, value, isPositive = null) {
            const element = document.querySelector(`#${elementId} .metric-value`);
            if (element) {
                element.innerHTML = value;
                if (isPositive !== null) {
                    element.classList.remove('positive', 'negative', 'neutral');
                    element.classList.add(isPositive ? 'positive' : 'negative');
                }
            }
        }

        // Main data fetching function
        async function fetchAllData() {
            console.log('Fetching all data...');
            
            // Update last update time
            document.getElementById('last-update').textContent = new Date().toLocaleTimeString();
            
            // Fetch volatility data
            dashboardData.volatility.vix = await fetchFREDData('VIXCLS');
            updateMetricDisplay('volatility-metrics', dashboardData.volatility.vix);
            
            // Fetch economic data
            dashboardData.economic.unemployment = await fetchFREDData('UNRATE');
            dashboardData.economic.gdp = await fetchFREDData('GDP');
            
            // Fetch bond data
            dashboardData.bonds.tenYear = await fetchFREDData('DGS10');
            dashboardData.bonds.twoYear = await fetchFREDData('DGS2');
            
            // Calculate and update Khalid Index
            const khalidValue = calculateKhalidIndex();
            dashboardData.khalidIndex = khalidValue;
            updateKhalidIndex(khalidValue);
            
            // Check for risk alerts
            checkRiskAlerts();
            
            // Generate recommendations
            generateRecommendations();
        }

        // Check for risk alerts
        function checkRiskAlerts() {
            const alerts = [];
            
            if (parseFloat(dashboardData.volatility.vix) > 30) {
                alerts.push('High VIX indicates extreme market fear');
            }
            
            if (dashboardData.khalidIndex < 20) {
                alerts.push('Khalid Index shows extreme fear - consider defensive positioning');
            }
            
            if (alerts.length > 0) {
                document.getElementById('risk-alert').style.display = 'block';
                document.getElementById('risk-content').innerHTML = alerts.map(a => `<p>‚Ä¢ ${a}</p>`).join('');
            }
        }

        // Generate recommendations
        function generateRecommendations() {
            const recommendations = [];
            
            if (dashboardData.khalidIndex < 30) {
                recommendations.push('Consider increasing cash allocation');
                recommendations.push('Look for put protection on major indices');
            } else if (dashboardData.khalidIndex > 70) {
                recommendations.push('Market showing signs of exuberance - consider taking profits');
                recommendations.push('Reduce leverage if currently employed');
            }
            
            if (parseFloat(dashboardData.bonds.twoYear) > parseFloat(dashboardData.bonds.tenYear)) {
                recommendations.push('Yield curve inversion detected - recession indicator');
            }
            
            document.getElementById('recommendations').innerHTML = 
                recommendations.map(r => `<p>‚Ä¢ ${r}</p>`).join('') || 
                '<p>Markets appear balanced - maintain current positioning</p>';
        }

        // Initialize dashboard
        async function initDashboard() {
            console.log('Initializing dashboard...');
            
            // Initial data fetch
            await fetchAllData();
            
            // Set up auto-refresh
            setInterval(fetchAllData, UPDATE_INTERVAL);
            
            // Add keyboard shortcuts
            document.addEventListener('keydown', (e) => {
                if (e.key === 'r' && e.ctrlKey) {
                    e.preventDefault();
                    fetchAllData();
                }
            });
        }

        // Start the dashboard when page loads
        document.addEventListener('DOMContentLoaded', initDashboard);

        // Handle visibility change to pause/resume updates
        document.addEventListener('visibilitychange', () => {
            if (document.hidden) {
                console.log('Dashboard paused (tab inactive)');
            } else {
                console.log('Dashboard resumed');
                fetchAllData();
            }
        });

        // Error boundary
        window.addEventListener('error', (e) => {
            console.error('Dashboard error:', e.error);
        });
    </script>
</body>
</html>
