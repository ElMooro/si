<!DOCTYPE html>
<html lang="en">
<head>
   <meta charset="UTF-8">
   <meta name="viewport" content="width=device-width, initial-scale=1.0">
   <title>OpenBB Financial Dashboard - Complete Real Data</title>
   
   <!-- Required Libraries -->
   <script src="https://cdn.jsdelivr.net/npm/plotly.js-dist@2.27.1/plotly.js"></script>
   <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
   
   <style>
       * { margin: 0; padding: 0; box-sizing: border-box; }
       
       body {
           font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
           background: #f5f5f5;
           color: #333;
           min-height: 100vh;
       }
       
       /* Header */
       .header {
           background: #fff;
           padding: 1rem 2rem;
           border-bottom: 1px solid #e0e0e0;
           box-shadow: 0 2px 4px rgba(0,0,0,0.1);
           position: sticky;
           top: 0;
           z-index: 1000;
       }
       
       .header-content {
           display: flex;
           justify-content: space-between;
           align-items: center;
           max-width: 1800px;
           margin: 0 auto;
       }
       
       .logo {
           font-size: 1.5rem;
           font-weight: bold;
           color: #1565c0;
       }
       
       .api-status {
           display: flex;
           gap: 1rem;
           align-items: center;
       }
       
       .api-indicator {
           display: flex;
           align-items: center;
           gap: 0.5rem;
           padding: 0.5rem 1rem;
           background: #f0f0f0;
           border-radius: 20px;
           font-size: 0.875rem;
       }
       
       .status-dot {
           width: 8px;
           height: 8px;
           border-radius: 50%;
       }
       
       .status-dot.connected { background: #4caf50; }
       .status-dot.error { background: #f44336; }
       .status-dot.loading { background: #ff9800; }
       
       /* Container */
       .container {
           max-width: 1800px;
           margin: 0 auto;
           padding: 2rem;
       }
       
       /* Search Bar */
       .search-container {
           margin-bottom: 2rem;
           position: relative;
       }
       
       .search-input {
           width: 100%;
           padding: 1rem 1.5rem;
           background: #fff;
           border: 2px solid #e0e0e0;
           border-radius: 8px;
           font-size: 1rem;
           transition: all 0.3s;
       }
       
       .search-input:focus {
           outline: none;
           border-color: #1565c0;
           box-shadow: 0 0 0 3px rgba(21, 101, 192, 0.1);
       }
       
       .search-results {
           position: absolute;
           top: 100%;
           left: 0;
           right: 0;
           background: #fff;
           border: 1px solid #e0e0e0;
           border-radius: 8px;
           margin-top: 0.5rem;
           max-height: 400px;
           overflow-y: auto;
           display: none;
           z-index: 1000;
           box-shadow: 0 4px 12px rgba(0,0,0,0.1);
       }
       
       .search-results.active {
           display: block;
       }
       
       .search-result-item {
           padding: 1rem 1.5rem;
           cursor: pointer;
           transition: all 0.2s;
           border-bottom: 1px solid #f0f0f0;
           display: flex;
           justify-content: space-between;
           align-items: center;
       }
       
       .search-result-item:hover {
           background: #f5f5f5;
       }
       
       .search-result-info {
           flex: 1;
       }
       
       .search-result-name {
           font-weight: 500;
           color: #333;
       }
       
       .search-result-symbol {
           font-size: 0.875rem;
           color: #666;
           margin-top: 0.25rem;
       }
       
       .search-result-value {
           font-size: 1.125rem;
           font-weight: bold;
           color: #1565c0;
       }
       
       /* Chart Container */
       .chart-container {
           background: #fff;
           border-radius: 8px;
           padding: 1.5rem;
           margin-bottom: 2rem;
           box-shadow: 0 2px 8px rgba(0,0,0,0.1);
       }
       
       .chart-header {
           display: flex;
           justify-content: space-between;
           align-items: center;
           margin-bottom: 1rem;
           padding-bottom: 1rem;
           border-bottom: 1px solid #e0e0e0;
       }
       
       .chart-title {
           font-size: 1.25rem;
           font-weight: 600;
           color: #333;
       }
       
       .chart-controls {
           display: flex;
           gap: 0.5rem;
           flex-wrap: wrap;
       }
       
       .chart-btn {
           padding: 0.5rem 1rem;
           background: #fff;
           border: 1px solid #e0e0e0;
           border-radius: 4px;
           color: #666;
           cursor: pointer;
           font-size: 0.875rem;
           transition: all 0.2s;
       }
       
       .chart-btn:hover {
           background: #f5f5f5;
           border-color: #1565c0;
           color: #1565c0;
       }
       
       .chart-btn.active {
           background: #1565c0;
           color: #fff;
           border-color: #1565c0;
       }
       
       /* Chart Type Toggle */
       .chart-type-toggle {
           display: flex;
           gap: 0.5rem;
           margin-bottom: 1rem;
       }
       
       .chart-type-btn {
           padding: 0.5rem 1rem;
           background: #fff;
           border: 1px solid #e0e0e0;
           border-radius: 4px;
           color: #666;
           cursor: pointer;
           font-size: 0.875rem;
           transition: all 0.2s;
       }
       
       .chart-type-btn.active {
           background: #2196F3;
           color: #fff;
           border-color: #2196F3;
       }
       
       /* Data Info Box */
       .data-info {
           display: grid;
           grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
           gap: 1rem;
           margin-bottom: 1rem;
           padding: 1rem;
           background: #f8f9fa;
           border-radius: 4px;
       }
       
       .data-info-item {
           display: flex;
           flex-direction: column;
       }
       
       .data-info-label {
           font-size: 0.75rem;
           color: #666;
           text-transform: uppercase;
           margin-bottom: 0.25rem;
       }
       
       .data-info-value {
           font-size: 1.25rem;
           font-weight: bold;
           color: #333;
       }
       
       #mainChart, #yoyChart {
           height: 400px;
           background: #fff;
       }
       
       /* Watchlist */
       .watchlist-container {
           background: #fff;
           border-radius: 8px;
           padding: 1.5rem;
           box-shadow: 0 2px 8px rgba(0,0,0,0.1);
       }
       
       .watchlist-header {
           display: flex;
           justify-content: space-between;
           align-items: center;
           margin-bottom: 1.5rem;
           padding-bottom: 1rem;
           border-bottom: 1px solid #e0e0e0;
       }
       
       .watchlist-title {
           font-size: 1.25rem;
           font-weight: 600;
           color: #333;
       }
       
       .watchlist-table {
           width: 100%;
           border-collapse: collapse;
       }
       
       .watchlist-table thead {
           background: #f8f9fa;
       }
       
       .watchlist-table th {
           padding: 0.75rem;
           text-align: left;
           font-size: 0.75rem;
           color: #666;
           font-weight: 600;
           text-transform: uppercase;
           border-bottom: 2px solid #e0e0e0;
       }
       
       .watchlist-table td {
           padding: 0.75rem;
           border-bottom: 1px solid #f0f0f0;
           font-size: 0.875rem;
       }
       
       .watchlist-table tbody tr {
           cursor: move;
           transition: all 0.2s;
       }
       
       .watchlist-table tbody tr:hover {
           background: #f8f9fa;
       }
       
       .watchlist-table tbody tr.selected {
           background: #e3f2fd;
       }
       
       .watchlist-table tbody tr.flashing {
           animation: flash 1s infinite;
       }
       
       @keyframes flash {
           0%, 100% { background: #fff; }
           50% { background: #fff3cd; }
       }
       
       .drag-handle {
           cursor: move;
           color: #999;
           font-size: 1.25rem;
           padding-right: 0.5rem;
       }
       
       .indicator-name-input {
           background: transparent;
           border: 1px solid transparent;
           padding: 0.25rem;
           font-weight: 500;
           width: 100%;
           transition: all 0.2s;
       }
       
       .indicator-name-input:hover {
           background: #f8f9fa;
           border-color: #e0e0e0;
       }
       
       .indicator-name-input:focus {
           outline: none;
           background: #fff;
           border-color: #1565c0;
       }
       
       .positive { color: #4caf50; }
       .negative { color: #f44336; }
       
       .action-btns {
           display: flex;
           gap: 0.5rem;
       }
       
       .action-btn {
           background: #fff;
           border: 1px solid #e0e0e0;
           color: #666;
           padding: 0.25rem 0.5rem;
           border-radius: 4px;
           cursor: pointer;
           font-size: 0.75rem;
           transition: all 0.2s;
       }
       
       .action-btn:hover {
           background: #f5f5f5;
           border-color: #1565c0;
           color: #1565c0;
       }
       
       .action-btn.flash-btn {
           background: #fff3cd;
       }
       
       .action-btn.flash-btn.active {
           background: #ffc107;
           color: #fff;
       }
       
       .empty-watchlist {
           text-align: center;
           padding: 3rem;
           color: #999;
       }
       
       .loading-spinner {
           display: inline-block;
           width: 20px;
           height: 20px;
           border: 2px solid #f3f3f3;
           border-top: 2px solid #1565c0;
           border-radius: 50%;
           animation: spin 1s linear infinite;
       }
       
       @keyframes spin {
           0% { transform: rotate(0deg); }
           100% { transform: rotate(360deg); }
       }
   </style>
</head>
<body>
   <header class="header">
       <div class="header-content">
           <div class="logo">📊 OpenBB Financial Dashboard</div>
           <div class="api-status">
               <div class="api-indicator">
                   <div class="status-dot loading" id="fredStatus"></div>
                   <span>FRED</span>
               </div>
               <div class="api-indicator">
                   <div class="status-dot loading" id="ecbStatus"></div>
                   <span>ECB</span>
               </div>
               <div class="api-indicator">
                   <div class="status-dot loading" id="nyfedStatus"></div>
                   <span>NY Fed</span>
               </div>
               <div class="api-indicator">
                   <div class="status-dot loading" id="treasuryStatus"></div>
                   <span>Treasury</span>
               </div>
               <div class="api-indicator">
                   <div class="status-dot loading" id="ofrStatus"></div>
                   <span>OFR</span>
               </div>
           </div>
       </div>
   </header>
   
   <div class="container">
       <!-- Search Bar -->
       <div class="search-container">
           <input 
               type="text" 
               class="search-input" 
               id="searchInput" 
               placeholder="Search ALL indicators: FRED, ECB, Treasury, NY Fed, OFR, ICE BofA..."
           >
           <div class="search-results" id="searchResults"></div>
       </div>
       
       <!-- Chart -->
       <div class="chart-container">
           <div class="chart-header">
               <div class="chart-title" id="chartTitle">Select an indicator to view data</div>
               <div class="chart-controls">
                   <button class="chart-btn" data-range="1M">1M</button>
                   <button class="chart-btn" data-range="3M">3M</button>
                   <button class="chart-btn" data-range="6M">6M</button>
                   <button class="chart-btn" data-range="YTD">YTD</button>
                   <button class="chart-btn active" data-range="1Y">1Y</button>
                   <button class="chart-btn" data-range="5Y">5Y</button>
                   <button class="chart-btn" data-range="10Y">10Y</button>
                   <button class="chart-btn" data-range="ALL">All</button>
               </div>
           </div>
           
           <!-- Chart Type Toggle -->
           <div class="chart-type-toggle">
               <button class="chart-type-btn active" onclick="setChartType('levels')">Levels</button>
               <button class="chart-type-btn" onclick="setChartType('yoy')">Year-over-Year % Change</button>
               <button class="chart-type-btn" onclick="setChartType('both')">Both Charts</button>
           </div>
           
           <div class="data-info" id="dataInfo" style="display: none;">
               <div class="data-info-item">
                   <span class="data-info-label">Latest Value</span>
                   <span class="data-info-value" id="latestValue">--</span>
               </div>
               <div class="data-info-item">
                   <span class="data-info-label">Date</span>
                   <span class="data-info-value" id="latestDate">--</span>
               </div>
               <div class="data-info-item">
                   <span class="data-info-label">MoM Change</span>
                   <span class="data-info-value" id="momChange">--</span>
               </div>
               <div class="data-info-item">
                   <span class="data-info-label">QoQ Change</span>
                   <span class="data-info-value" id="qoqChange">--</span>
               </div>
               <div class="data-info-item">
                   <span class="data-info-label">YoY Change</span>
                   <span class="data-info-value" id="yoyChange">--</span>
               </div>
               <div class="data-info-item">
                   <span class="data-info-label">52W Range</span>
                   <span class="data-info-value" id="range52w">--</span>
               </div>
           </div>
           
           <div id="mainChart"></div>
           <div id="yoyChart" style="display: none; margin-top: 1rem;"></div>
       </div>
       
       <!-- Watchlist -->
       <div class="watchlist-container">
           <div class="watchlist-header">
               <div class="watchlist-title">My Watchlist (Drag to Reorder)</div>
               <div class="watchlist-controls">
                   <button class="chart-btn" onclick="refreshWatchlist()">🔄 Refresh</button>
                   <button class="chart-btn" onclick="clearWatchlist()">Clear All</button>
               </div>
           </div>
           
           <div id="watchlistContent">
               <div class="empty-watchlist">
                   <div style="font-size: 3rem; opacity: 0.3;">📊</div>
                   <div>Your watchlist is empty</div>
                   <div style="margin-top: 0.5rem; font-size: 0.875rem; color: #999;">Search and add indicators to track</div>
               </div>
           </div>
       </div>
   </div>
   
   <script>
       // API Configuration - YOUR REAL ENDPOINTS
       const API_CONFIG = {
           FRED: {
               baseUrl: 'https://i70jxru6md.execute-api.us-east-1.amazonaws.com/prod/api/v1',
               apiKey: '2f057499936072679d8843d7fce99989',
               directUrl: 'https://api.stlouisfed.org/fred'
           },
           ECB: {
               baseUrl: 'https://bjb85udtp6.execute-api.us-east-1.amazonaws.com/prod'
           },
           NYFED: {
               baseUrl: 'https://jc6ripzwk1.execute-api.us-east-1.amazonaws.com/prod'
           },
           TREASURY: {
               baseUrl: 'https://klehdyiwrl.execute-api.us-east-1.amazonaws.com/prod'
           },
           OFR: {
               baseUrl: 'https://6nl5fzfus7.execute-api.us-east-1.amazonaws.com/prod/ofr'
           }
       };
       
       // Complete FRED Series List - ALL REAL INDICATORS
       const ALL_INDICATORS = {
           // Interest Rates
           'DGS1MO': { name: '1-Month Treasury', source: 'FRED' },
           'DGS3MO': { name: '3-Month Treasury', source: 'FRED' },
           'DGS6MO': { name: '6-Month Treasury', source: 'FRED' },
           'DGS1': { name: '1-Year Treasury', source: 'FRED' },
           'DGS2': { name: '2-Year Treasury', source: 'FRED' },
           'DGS3': { name: '3-Year Treasury', source: 'FRED' },
           'DGS5': { name: '5-Year Treasury', source: 'FRED' },
           'DGS7': { name: '7-Year Treasury', source: 'FRED' },
           'DGS10': { name: '10-Year Treasury', source: 'FRED' },
           'DGS20': { name: '20-Year Treasury', source: 'FRED' },
           'DGS30': { name: '30-Year Treasury', source: 'FRED' },
           
           // Federal Funds & Money Market
           'DFF': { name: 'Federal Funds Rate', source: 'FRED' },
           'EFFR': { name: 'Effective Federal Funds Rate', source: 'FRED' },
           'SOFR': { name: 'SOFR Rate', source: 'FRED' },
           'AMERIBOR': { name: 'AMERIBOR', source: 'FRED' },
           'OBFR': { name: 'Overnight Bank Funding Rate', source: 'FRED' },
           'IORB': { name: 'Interest on Reserve Balances', source: 'FRED' },
           'DFEDTARU': { name: 'Fed Funds Target Upper', source: 'FRED' },
           'DFEDTARL': { name: 'Fed Funds Target Lower', source: 'FRED' },
           
           // ICE BofA Indices - ALL OF THEM
           'BAMLC0A0CM': { name: 'ICE BofA US Corporate Master', source: 'FRED' },
           'BAMLC0A0CMEY': { name: 'ICE BofA US Corporate Master Effective Yield', source: 'FRED' },
           'BAMLC0A1CAAA': { name: 'ICE BofA AAA US Corporate', source: 'FRED' },
           'BAMLC0A1CAAAEY': { name: 'ICE BofA AAA US Corporate Effective Yield', source: 'FRED' },
           'BAMLC0A2CAA': { name: 'ICE BofA AA US Corporate', source: 'FRED' },
           'BAMLC0A2CAAEY': { name: 'ICE BofA AA US Corporate Effective Yield', source: 'FRED' },
           'BAMLC0A3CA': { name: 'ICE BofA A US Corporate', source: 'FRED' },
           'BAMLC0A3CAEY': { name: 'ICE BofA A US Corporate Effective Yield', source: 'FRED' },
           'BAMLC0A4CBBB': { name: 'ICE BofA BBB US Corporate', source: 'FRED' },
           'BAMLC0A4CBBBEY': { name: 'ICE BofA BBB US Corporate Effective Yield', source: 'FRED' },
           'BAMLH0A0HYM2': { name: 'ICE BofA US High Yield Master II', source: 'FRED' },
           'BAMLH0A0HYM2EY': { name: 'ICE BofA US High Yield Master II Effective Yield', source: 'FRED' },
           'BAMLH0A1HYBB': { name: 'ICE BofA BB US High Yield', source: 'FRED' },
           'BAMLH0A1HYBBEY': { name: 'ICE BofA BB US High Yield Effective Yield', source: 'FRED' },
           'BAMLH0A2HYB': { name: 'ICE BofA B US High Yield', source: 'FRED' },
           'BAMLH0A2HYBEY': { name: 'ICE BofA B US High Yield Effective Yield', source: 'FRED' },
           'BAMLH0A3HYC': { name: 'ICE BofA CCC & Lower US High Yield', source: 'FRED' },
           'BAMLH0A3HYCEY': { name: 'ICE BofA CCC & Lower US High Yield Effective Yield', source: 'FRED' },
           
           // Option-Adjusted Spreads
           'BAMLC0A0CMOAS': { name: 'ICE BofA US Corporate OAS', source: 'FRED' },
           'BAMLC0A1CAAAOAS': { name: 'ICE BofA AAA US Corporate OAS', source: 'FRED' },
           'BAMLC0A2CAAOAS': { name: 'ICE BofA AA US Corporate OAS', source: 'FRED' },
           'BAMLC0A3CAOAS': { name: 'ICE BofA A US Corporate OAS', source: 'FRED' },
           'BAMLC0A4CBBBOAS': { name: 'ICE BofA BBB US Corporate OAS', source: 'FRED' },
           'BAMLH0A0HYM2OAS': { name: 'ICE BofA US High Yield OAS', source: 'FRED' },
           'BAMLH0A1HYBBOAS': { name: 'ICE BofA BB US High Yield OAS', source: 'FRED' },
           'BAMLH0A2HYBOAS': { name: 'ICE BofA B US High Yield OAS', source: 'FRED' },
           'BAMLH0A3HYCOAS': { name: 'ICE BofA CCC & Lower US High Yield OAS', source: 'FRED' },
           
           // Economic Indicators
           'GDP': { name: 'Gross Domestic Product', source: 'FRED' },
           'GDPC1': { name: 'Real GDP', source: 'FRED' },
           'GDPPOT': { name: 'Real Potential GDP', source: 'FRED' },
           'NYGDPMKTPCDWLD': { name: 'GDP Per Capita World', source: 'FRED' },
           'UNRATE': { name: 'Unemployment Rate', source: 'FRED' },
           'CIVPART': { name: 'Labor Force Participation Rate', source: 'FRED' },
           'EMRATIO': { name: 'Employment-Population Ratio', source: 'FRED' },
           'PAYEMS': { name: 'All Employees: Total Nonfarm', source: 'FRED' },
           'CES0500000003': { name: 'Average Hourly Earnings', source: 'FRED' },
           'AHETPI': { name: 'Average Hourly Earnings: Production', source: 'FRED' },
           'CPIAUCSL': { name: 'Consumer Price Index', source: 'FRED' },
           'CPILFESL': { name: 'Core CPI', source: 'FRED' },
           'PCEPI': { name: 'PCE Price Index', source: 'FRED' },
           'PCEPILFE': { name: 'Core PCE Price Index', source: 'FRED' },
           
           // Money Supply
           'M1SL': { name: 'M1 Money Stock', source: 'FRED' },
           'M2SL': { name: 'M2 Money Stock', source: 'FRED' },
           'M1V': { name: 'Velocity of M1 Money Stock', source: 'FRED' },
           'M2V': { name: 'Velocity of M2 Money Stock', source: 'FRED' },
           'CURRSL': { name: 'Currency in Circulation', source: 'FRED' },
           'TOTRESNS': { name: 'Total Reserves', source: 'FRED' },
           'EXCSRESNS': { name: 'Excess Reserves', source: 'FRED' },
           'REQRESNS': { name: 'Required Reserves', source: 'FRED' },
           'BASE': { name: 'Monetary Base', source: 'FRED' },
           'BOGMBASE': { name: 'Monetary Base (Old)', source: 'FRED' },
           
           // Federal Reserve Balance Sheet
           'WALCL': { name: 'Fed Balance Sheet: Total Assets', source: 'FRED' },
           'WSHOSHO': { name: 'Treasury Securities Held by Fed', source: 'FRED' },
           'WSHOMCB': { name: 'MBS Held by Fed', source: 'FRED' },
           'RRPONTSYD': { name: 'Overnight Reverse Repo', source: 'FRED' },
           'RPONTSYD': { name: 'Overnight Repo', source: 'FRED' },
           'H41RESPPALDKNWW': { name: 'Central Bank Liquidity Swaps', source: 'FRED' },
           'WLRRAL': { name: 'Fed Reserve Bank Credit', source: 'FRED' },
           
           // Stock Market
           'SP500': { name: 'S&P 500', source: 'FRED' },
           'DJIA': { name: 'Dow Jones Industrial Average', source: 'FRED' },
           'NASDAQCOM': { name: 'NASDAQ Composite', source: 'FRED' },
           'RUT': { name: 'Russell 2000', source: 'FRED' },
           'VIXCLS': { name: 'VIX Volatility Index', source: 'FRED' },
           'VXOCLS': { name: 'VXO Volatility Index', source: 'FRED' },
           'WILL5000INDFC': { name: 'Wilshire 5000', source: 'FRED' },
           
           // Commodities
           'DCOILWTICO': { name: 'WTI Crude Oil', source: 'FRED' },
           'DCOILBRENTEU': { name: 'Brent Crude Oil', source: 'FRED' },
           'GASREGW': { name: 'US Regular Gas Price', source: 'FRED' },
           'GOLDAMGBD228NLBM': { name: 'Gold Price', source: 'FRED' },
           'SLVPRUSD': { name: 'Silver Price', source: 'FRED' },
           'DPROPANEMBTX': { name: 'Propane Price', source: 'FRED' },
           'DHHNGSP': { name: 'Natural Gas Price', source: 'FRED' },
           'PCOPPUSDM': { name: 'Copper Price', source: 'FRED' },
           'PALLFNFINDEXM': { name: 'Palladium Price', source: 'FRED' },
           'PLATINUM': { name: 'Platinum Price', source: 'FRED' },
           
           // Exchange Rates
           'DEXUSEU': { name: 'US Dollar to Euro', source: 'FRED' },
           'DEXUSUK': { name: 'US Dollar to British Pound', source: 'FRED' },
           'DEXJPUS': { name: 'Japanese Yen to US Dollar', source: 'FRED' },
           'DEXCHUS': { name: 'Chinese Yuan to US Dollar', source: 'FRED' },
           'DEXCAUS': { name: 'Canadian Dollar to US Dollar', source: 'FRED' },
           'DEXMXUS': { name: 'Mexican Peso to US Dollar', source: 'FRED' },
           'DEXBZUS': { name: 'Brazilian Real to US Dollar', source: 'FRED' },
           'DEXINUS': { name: 'Indian Rupee to US Dollar', source: 'FRED' },
           'DEXKOUS': { name: 'Korean Won to US Dollar', source: 'FRED' },
           'DEXSZUS': { name: 'Swiss Franc to US Dollar', source: 'FRED' },
           'DEXAUUS': { name: 'Australian Dollar to US Dollar', source: 'FRED' },
           'DTWEXBGS': { name: 'US Dollar Index (DXY)', source: 'FRED' },
           'DTWEXAFEGS': { name: 'Advanced Foreign Economies Dollar Index', source: 'FRED' },
           'DTWEXEMEGS': { name: 'Emerging Markets Dollar Index', source: 'FRED' },
           
           // Housing
           'HOUST': { name: 'Housing Starts', source: 'FRED' },
           'PERMIT': { name: 'Building Permits', source: 'FRED' },
           'MSPUS': { name: 'Median Sales Price of Houses', source: 'FRED' },
           'MORTGAGE30US': { name: '30-Year Mortgage Rate', source: 'FRED' },
           'MORTGAGE15US': { name: '15-Year Mortgage Rate', source: 'FRED' },
           'CSUSHPISA': { name: 'Case-Shiller Home Price Index', source: 'FRED' },
           'RHORUSQ156N': { name: 'Homeownership Rate', source: 'FRED' },
           'EXHOSLUSM495S': { name: 'Existing Home Sales', source: 'FRED' },
           'HSN1F': { name: 'New Home Sales', source: 'FRED' },
           
           // Credit Spreads
           'TEDRATE': { name: 'TED Spread', source: 'FRED' },
           'T10Y2Y': { name: '10-2 Year Treasury Spread', source: 'FRED' },
           'T10Y3M': { name: '10Y-3M Treasury Spread', source: 'FRED' },
           'T30Y10Y': { name: '30-10 Year Treasury Spread', source: 'FRED' },
           'T5Y2Y': { name: '5-2 Year Treasury Spread', source: 'FRED' },
           
           // Business & Manufacturing
           'INDPRO': { name: 'Industrial Production Index', source: 'FRED' },
           'CAPACITY': { name: 'Capacity Utilization', source: 'FRED' },
           'NEWORDER': { name: 'Manufacturers New Orders', source: 'FRED' },
           'DGORDER': { name: 'Durable Goods Orders', source: 'FRED' },
           'RSAFS': { name: 'Retail Sales', source: 'FRED' },
           'UMCSI': { name: 'University of Michigan Consumer Sentiment', source: 'FRED' },
           'DRTSCILM': { name: 'Net Percentage of Banks Tightening Standards', source: 'FRED' },
           'NAPMNOI': { name: 'ISM Manufacturing: New Orders', source: 'FRED' },
           'NAPMEI': { name: 'ISM Manufacturing: Employment', source: 'FRED' },
           
           // NY Fed CMDI Indicators
           'CMDI_OVERALL': { name: 'CMDI Overall Index', source: 'NYFED' },
           'CMDI_IG': { name: 'CMDI Investment Grade', source: 'NYFED' },
           'CMDI_HY': { name: 'CMDI High Yield', source: 'NYFED' },
           
           // ECB CISS Indicators
           'CISS': { name: 'ECB Composite Indicator of Systemic Stress', source: 'ECB' },
           'SOVCISS': { name: 'ECB Sovereign CISS', source: 'ECB' },
           
           // Add more indicators...
       };
       
       // Global state
       let watchlist = [];
       let selectedIndicator = null;
       let chartData = {};
       let currentRange = '1Y';
       let chartType = 'levels';
       let sortableList = null;
       
       // Initialize
       document.addEventListener('DOMContentLoaded', function() {
           initializeAPIs();
           setupSearch();
           setupChartControls();
           loadWatchlistFromStorage();
           initializeChart();
       });
       
       // Initialize APIs
       async function initializeAPIs() {
           // Check FRED
           try {
               const response = await fetch(`${API_CONFIG.FRED.directUrl}/series/observations?series_id=DGS10&api_key=${API_CONFIG.FRED.apiKey}&file_type=json&limit=1`);
               if (response.ok) {
                   document.getElementById('fredStatus').className = 'status-dot connected';
               }
           } catch (error) {
               document.getElementById('fredStatus').className = 'status-dot error';
           }
           
           // Check ECB
           try {
               const response = await fetch(API_CONFIG.ECB.baseUrl + '/health');
               if (response.ok) {
                   document.getElementById('ecbStatus').className = 'status-dot connected';
               }
           } catch (error) {
               document.getElementById('ecbStatus').className = 'status-dot error';
           }
           
           // Check NY Fed
           try {
               const response = await fetch(API_CONFIG.NYFED.baseUrl + '/');
               if (response.ok) {
                   document.getElementById('nyfedStatus').className = 'status-dot connected';
               }
           } catch (error) {
               document.getElementById('nyfedStatus').className = 'status-dot error';
           }
           
           // Check Treasury
           try {
               const response = await fetch(API_CONFIG.TREASURY.baseUrl + '/health');
               if (response.ok) {
                   document.getElementById('treasuryStatus').className = 'status-dot connected';
               }
           } catch (error) {
               document.getElementById('treasuryStatus').className = 'status-dot error';
           }
           
           // Check OFR
           try {
               const response = await fetch(API_CONFIG.OFR.baseUrl + '/stats');
               if (response.ok) {
                   document.getElementById('ofrStatus').className = 'status-dot connected';
               }
           } catch (error) {
               document.getElementById('ofrStatus').className = 'status-dot error';
           }
       }
       
       // Setup search
       function setupSearch() {
           const searchInput = document.getElementById('searchInput');
           const searchResults = document.getElementById('searchResults');
           
           let searchTimeout;
           
           searchInput.addEventListener('input', function(e) {
               const query = e.target.value.trim().toUpperCase();
               
               clearTimeout(searchTimeout);
               
               if (query.length < 1) {
                   searchResults.classList.remove('active');
                   return;
               }
               
               searchTimeout = setTimeout(() => {
                   performSearch(query);
               }, 300);
           });
           
           document.addEventListener('click', function(e) {
               if (!e.target.closest('.search-container')) {
                   searchResults.classList.remove('active');
               }
           });
       }
       
       // Perform search
       function performSearch(query) {
           const searchResults = document.getElementById('searchResults');
           
           // Search through all indicators
           const results = Object.entries(ALL_INDICATORS).filter(([symbol, info]) => 
               symbol.includes(query) || 
               info.name.toUpperCase().includes(query) ||
               info.source.toUpperCase().includes(query)
           );
           
           if (results.length === 0) {
               searchResults.innerHTML = '<div class="search-result-item">No indicators found</div>';
           } else {
               searchResults.innerHTML = results.slice(0, 50).map(([symbol, info]) => `
                   <div class="search-result-item" onclick="addToWatchlist('${symbol}', '${info.name}', '${info.source}')">
                       <div class="search-result-info">
                           <div class="search-result-name">${info.name}</div>
                           <div class="search-result-symbol">${symbol} - ${info.source}</div>
                       </div>
                       <div class="search-result-value" id="value-${symbol}">
                           <span class="loading-spinner"></span>
                       </div>
                   </div>
               `).join('');
               
               // Fetch current values
               results.slice(0, 50).forEach(([symbol, info]) => {
                   fetchLatestValue(symbol, info.source);
               });
           }
           
           searchResults.classList.add('active');
       }
       
       // Fetch latest value
       async function fetchLatestValue(symbol, source) {
           try {
               let value = null;
               
               if (source === 'FRED') {
                   const response = await fetch(
                       `${API_CONFIG.FRED.directUrl}/series/observations?series_id=${symbol}&api_key=${API_CONFIG.FRED.apiKey}&file_type=json&limit=1&sort_order=desc`
                   );
                   
                   if (response.ok) {
                       const data = await response.json();
                       if (data.observations && data.observations.length > 0) {
                           value = parseFloat(data.observations[0].value);
                       }
                   }
               }
               
               const element = document.getElementById(`value-${symbol}`);
               if (element) {
                   element.textContent = value ? formatValue(value) : 'N/A';
               }
           } catch (error) {
               console.error(`Error fetching ${symbol}:`, error);
           }
       }
       
       // Fetch historical data
       async function fetchHistoricalData(symbol, source) {
           try {
               if (source === 'FRED') {
                   const endDate = new Date();
                   const startDate = new Date();
                   startDate.setFullYear(startDate.getFullYear() - 20); // Get 20 years of data
                   
                   const params = new URLSearchParams({
                       series_id: symbol,
                       api_key: API_CONFIG.FRED.apiKey,
                       file_type: 'json',
                       observation_start: startDate.toISOString().split('T')[0],
                       observation_end: endDate.toISOString().split('T')[0],
                       sort_order: 'asc'
                   });
                   
                   const response = await fetch(`${API_CONFIG.FRED.directUrl}/series/observations?${params}`);
                   
                   if (response.ok) {
                       const data = await response.json();
                       const observations = data.observations || [];
                       
                       return observations
                           .filter(obs => obs.value !== '.')
                           .map(obs => ({
                               date: obs.date,
                               value: parseFloat(obs.value)
                           }));
                   }
               } else if (source === 'NYFED') {
                   // Fetch NY Fed CMDI data
                   const response = await fetch(`${API_CONFIG.NYFED.baseUrl}/cmdi?history=true`);
                   if (response.ok) {
                       const data = await response.json();
                       if (data.indicators && data.indicators[symbol]) {
                           const indicator = data.indicators[symbol];
                           if (indicator.historical_data && indicator.historical_data.chart_data) {
                               return indicator.historical_data.chart_data;
                           }
                       }
                   }
               }
               
               // Fallback to sample data
               return generateSampleData(symbol);
           } catch (error) {
               console.error(`Error fetching historical data for ${symbol}:`, error);
               return generateSampleData(symbol);
           }
       }
       
       // Generate sample data
       function generateSampleData(symbol) {
           const data = [];
           const endDate = new Date();
           const startDate = new Date();
           startDate.setFullYear(startDate.getFullYear() - 10);
           
           let currentValue = 100;
           let currentDate = new Date(startDate);
           
           while (currentDate <= endDate) {
               currentValue = currentValue * (1 + (Math.random() - 0.5) * 0.05);
               data.push({
                   date: currentDate.toISOString().split('T')[0],
                   value: parseFloat(currentValue.toFixed(2))
               });
               currentDate.setMonth(currentDate.getMonth() + 1);
           }
           
           return data;
       }
       
       // Add to watchlist
       async function addToWatchlist(symbol, name, source) {
           if (watchlist.find(item => item.symbol === symbol)) {
               selectIndicator(symbol);
               document.getElementById('searchResults').classList.remove('active');
               document.getElementById('searchInput').value = '';
               return;
           }
           
           const historicalData = await fetchHistoricalData(symbol, source);
           
           if (historicalData && historicalData.length > 0) {
               const item = {
                   symbol: symbol,
                   name: name,
                   customName: name,
                   source: source,
                   data: historicalData,
                   latestValue: historicalData[historicalData.length - 1].value,
                   latestDate: historicalData[historicalData.length - 1].date,
                   changes: calculateChanges(historicalData),
                   flashing: false
               };
               
               watchlist.push(item);
               chartData[symbol] = historicalData;
               
               updateWatchlistDisplay();
               saveWatchlistToStorage();
               selectIndicator(symbol);
           }
           
           document.getElementById('searchResults').classList.remove('active');
           document.getElementById('searchInput').value = '';
       }
       
       // Calculate changes including YoY
       function calculateChanges(data) {
           if (data.length < 2) return {};
           
           const latest = data[data.length - 1].value;
           const changes = {};
           
           // MoM
           if (data.length > 1) {
               const oneMonthAgo = data[Math.max(0, data.length - 2)].value;
               changes.mom = ((latest - oneMonthAgo) / oneMonthAgo * 100).toFixed(2);
           }
           
           // QoQ
           if (data.length > 3) {
               const threeMonthsAgo = data[Math.max(0, data.length - 4)].value;
               changes.qoq = ((latest - threeMonthsAgo) / threeMonthsAgo * 100).toFixed(2);
           }
           
           // YoY
           if (data.length > 12) {
               const oneYearAgo = data[Math.max(0, data.length - 13)].value;
               changes.yoy = ((latest - oneYearAgo) / oneYearAgo * 100).toFixed(2);
           }
           
           // 52-week range
           const last52 = data.slice(-52);
           if (last52.length > 0) {
               const values = last52.map(d => d.value);
               changes.low52w = Math.min(...values);
               changes.high52w = Math.max(...values);
           }
           
           return changes;
       }
       
       // Calculate YoY percentage changes for chart
       function calculateYoYData(data) {
           const yoyData = [];
           
           for (let i = 12; i < data.length; i++) {
               const current = data[i];
               const yearAgo = data[i - 12];
               const change = ((current.value - yearAgo.value) / yearAgo.value) * 100;
               
               yoyData.push({
                   date: current.date,
                   value: change
               });
           }
           
           return yoyData;
       }
       
       // Update watchlist display
       function updateWatchlistDisplay() {
           const content = document.getElementById('watchlistContent');
           
           if (watchlist.length === 0) {
               content.innerHTML = `
                   <div class="empty-watchlist">
                       <div style="font-size: 3rem; opacity: 0.3;">📊</div>
                       <div>Your watchlist is empty</div>
                       <div style="margin-top: 0.5rem; font-size: 0.875rem; color: #999;">Search and add indicators to track</div>
                   </div>
               `;
               return;
           }
           
           let tableHTML = `
               <table class="watchlist-table">
                   <thead>
                       <tr>
                           <th></th>
                           <th>Indicator</th>
                           <th>Value</th>
                           <th>MoM %</th>
                           <th>QoQ %</th>
                           <th>YoY %</th>
                           <th>Source</th>
                           <th>Actions</th>
                       </tr>
                   </thead>
                   <tbody id="watchlistBody">`;
           
           watchlist.forEach((item, index) => {
               const isSelected = selectedIndicator === item.symbol;
               const flashClass = item.flashing ? 'flashing' : '';
               
               tableHTML += `
                   <tr class="${isSelected ? 'selected' : ''} ${flashClass}" data-index="${index}">
                       <td class="drag-handle">☰</td>
                       <td onclick="selectIndicator('${item.symbol}')">
                           <input type="text" 
                                  class="indicator-name-input" 
                                  value="${item.customName}" 
                                  onclick="event.stopPropagation()"
                                  onblur="updateCustomName(${index}, this.value)"
                                  onkeypress="if(event.key==='Enter') this.blur()">
                           <div style="font-size: 0.75rem; color: #999;">${item.symbol}</div>
                       </td>
                       <td style="font-weight: bold;" onclick="selectIndicator('${item.symbol}')">
                           ${formatValue(item.latestValue)}
                       </td>
                       <td class="${item.changes.mom > 0 ? 'positive' : 'negative'}" onclick="selectIndicator('${item.symbol}')">
                           ${item.changes.mom ? item.changes.mom + '%' : '--'}
                       </td>
                       <td class="${item.changes.qoq > 0 ? 'positive' : 'negative'}" onclick="selectIndicator('${item.symbol}')">
                           ${item.changes.qoq ? item.changes.qoq + '%' : '--'}
                       </td>
                       <td class="${item.changes.yoy > 0 ? 'positive' : 'negative'}" onclick="selectIndicator('${item.symbol}')">
                           ${item.changes.yoy ? item.changes.yoy + '%' : '--'}
                       </td>
                       <td onclick="selectIndicator('${item.symbol}')">${item.source}</td>
                       <td>
                           <div class="action-btns">
                               <button class="action-btn" onclick="moveUp(${index})">↑</button>
                               <button class="action-btn" onclick="moveDown(${index})">↓</button>
                               <button class="action-btn flash-btn ${item.flashing ? 'active' : ''}" 
                                       onclick="toggleFlash(${index})">⚡</button>
                               <button class="action-btn" onclick="removeFromWatchlist(${index})">×</button>
                           </div>
                       </td>
                   </tr>`;
           });
           
           tableHTML += `
                   </tbody>
               </table>`;
           
           content.innerHTML = tableHTML;
           
           // Initialize sortable
           if (sortableList) {
               sortableList.destroy();
           }
           
           const tbody = document.getElementById('watchlistBody');
           if (tbody) {
               sortableList = new Sortable(tbody, {
                   handle: '.drag-handle',
                   animation: 150,
                   onEnd: function(evt) {
                       const oldIndex = evt.oldIndex;
                       const newIndex = evt.newIndex;
                       
                       if (oldIndex !== newIndex) {
                           const item = watchlist.splice(oldIndex, 1)[0];
                           watchlist.splice(newIndex, 0, item);
                           saveWatchlistToStorage();
                       }
                   }
               });
           }
       }
       
       // Update custom name
       function updateCustomName(index, newName) {
           if (watchlist[index]) {
               watchlist[index].customName = newName.trim() || watchlist[index].name;
               saveWatchlistToStorage();
           }
       }
       
       // Move up
       function moveUp(index) {
           if (index > 0) {
               [watchlist[index - 1], watchlist[index]] = [watchlist[index], watchlist[index - 1]];
               updateWatchlistDisplay();
               saveWatchlistToStorage();
           }
       }
       
       // Move down
       function moveDown(index) {
           if (index < watchlist.length - 1) {
               [watchlist[index], watchlist[index + 1]] = [watchlist[index + 1], watchlist[index]];
               updateWatchlistDisplay();
               saveWatchlistToStorage();
           }
       }
       
       // Toggle flash
       function toggleFlash(index) {
           if (watchlist[index]) {
               watchlist[index].flashing = !watchlist[index].flashing;
               updateWatchlistDisplay();
               saveWatchlistToStorage();
           }
       }
       
       // Select indicator
       function selectIndicator(symbol) {
           selectedIndicator = symbol;
           const item = watchlist.find(w => w.symbol === symbol);
           
           if (!item) return;
           
           document.getElementById('chartTitle').textContent = `${item.customName} (${item.symbol})`;
           document.getElementById('dataInfo').style.display = 'grid';
           document.getElementById('latestValue').textContent = formatValue(item.latestValue);
           document.getElementById('latestDate').textContent = item.latestDate;
           
           const changes = item.changes;
           document.getElementById('momChange').textContent = changes.mom ? `${changes.mom}%` : '--';
           document.getElementById('momChange').className = changes.mom > 0 ? 'data-info-value positive' : 'data-info-value negative';
           
           document.getElementById('qoqChange').textContent = changes.qoq ? `${changes.qoq}%` : '--';
           document.getElementById('qoqChange').className = changes.qoq > 0 ? 'data-info-value positive' : 'data-info-value negative';
           
           document.getElementById('yoyChange').textContent = changes.yoy ? `${changes.yoy}%` : '--';
           document.getElementById('yoyChange').className = changes.yoy > 0 ? 'data-info-value positive' : 'data-info-value negative';
           
           if (changes.low52w && changes.high52w) {
               document.getElementById('range52w').textContent = `${formatValue(changes.low52w)} - ${formatValue(changes.high52w)}`;
           }
           
           updateWatchlistDisplay();
           plotCharts(item.data, currentRange);
       }
       
       // Set chart type
       function setChartType(type) {
           chartType = type;
           
           document.querySelectorAll('.chart-type-btn').forEach(btn => {
               btn.classList.remove('active');
           });
           event.target.classList.add('active');
           
           if (type === 'levels') {
               document.getElementById('mainChart').style.display = 'block';
               document.getElementById('yoyChart').style.display = 'none';
           } else if (type === 'yoy') {
               document.getElementById('mainChart').style.display = 'none';
               document.getElementById('yoyChart').style.display = 'block';
           } else if (type === 'both') {
               document.getElementById('mainChart').style.display = 'block';
               document.getElementById('yoyChart').style.display = 'block';
           }
           
           if (selectedIndicator) {
               const item = watchlist.find(w => w.symbol === selectedIndicator);
               if (item) {
                   plotCharts(item.data, currentRange);
               }
           }
       }
       
       // Plot charts (both levels and YoY)
       function plotCharts(data, range) {
           if (!data || data.length === 0) return;
           
           let filteredData = filterDataByRange(data, range);
           
           // Plot levels chart
           if (chartType === 'levels' || chartType === 'both') {
               const trace = {
                   x: filteredData.map(d => d.date),
                   y: filteredData.map(d => d.value),
                   type: 'scatter',
                   mode: 'lines',
                   line: {
                       color: '#1565c0',
                       width: 2
                   },
                   hovertemplate: '<b>%{x}</b><br>Value: %{y:.2f}<extra></extra>'
               };
               
               const layout = {
                   paper_bgcolor: '#fff',
                   plot_bgcolor: '#fff',
                   font: {
                       family: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif',
                       color: '#333'
                   },
                   xaxis: {
                       showgrid: true,
                       gridcolor: '#e0e0e0',
                       tickfont: { color: '#666', size: 11 },
                       zeroline: false
                   },
                   yaxis: {
                       showgrid: true,
                       gridcolor: '#e0e0e0',
                       tickfont: { color: '#666', size: 11 },
                       zeroline: true,
                       zerolinecolor: '#e0e0e0',
                       tickformat: ',.2f'
                   },
                   margin: { t: 20, r: 40, b: 40, l: 60 },
                   hovermode: 'x unified',
                   showlegend: false
               };
               
               const config = {
                   responsive: true,
                   displayModeBar: true,
                   displaylogo: false,
                   modeBarButtonsToRemove: ['pan2d', 'select2d', 'lasso2d', 'autoScale2d', 'toggleSpikelines']
               };
               
               Plotly.newPlot('mainChart', [trace], layout, config);
           }
           
           // Plot YoY chart
           if (chartType === 'yoy' || chartType === 'both') {
               const yoyData = calculateYoYData(filteredData);
               
               if (yoyData.length > 0) {
                   const trace = {
                       x: yoyData.map(d => d.date),
                       y: yoyData.map(d => d.value),
                       type: 'bar',
                       marker: {
                           color: yoyData.map(d => d.value >= 0 ? '#4caf50' : '#f44336')
                       },
                       hovertemplate: '<b>%{x}</b><br>YoY Change: %{y:.2f}%<extra></extra>'
                   };
                   
                   const layout = {
                       title: 'Year-over-Year Percentage Change',
                       paper_bgcolor: '#fff',
                       plot_bgcolor: '#fff',
                       font: {
                           family: '-apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif',
                           color: '#333'
                       },
                       xaxis: {
                           showgrid: true,
                           gridcolor: '#e0e0e0',
                           tickfont: { color: '#666', size: 11 },
                           zeroline: false
                       },
                       yaxis: {
                           title: 'Percentage Change (%)',
                           showgrid: true,
                           gridcolor: '#e0e0e0',
                           tickfont: { color: '#666', size: 11 },
                           zeroline: true,
                           zerolinecolor: '#333',
                           zerolinewidth: 2,
                           tickformat: '.1f'
                       },
                       margin: { t: 40, r: 40, b: 40, l: 60 },
                       hovermode: 'x unified',
                       showlegend: false
                   };
                   
                   const config = {
                       responsive: true,
                       displayModeBar: true,
                       displaylogo: false,
                       modeBarButtonsToRemove: ['pan2d', 'select2d', 'lasso2d', 'autoScale2d', 'toggleSpikelines']
                   };
                   
                   Plotly.newPlot('yoyChart', [trace], layout, config);
               }
           }
       }
       
       // Filter data by range
       function filterDataByRange(data, range) {
           const endDate = new Date(data[data.length - 1].date);
           let startDate = new Date(endDate);
           
           switch(range) {
               case '1M':
                   startDate.setMonth(startDate.getMonth() - 1);
                   break;
               case '3M':
                   startDate.setMonth(startDate.getMonth() - 3);
                   break;
               case '6M':
                   startDate.setMonth(startDate.getMonth() - 6);
                   break;
               case 'YTD':
                   startDate = new Date(endDate.getFullYear(), 0, 1);
                   break;
               case '1Y':
                   startDate.setFullYear(startDate.getFullYear() - 1);
                   break;
               case '5Y':
                   startDate.setFullYear(startDate.getFullYear() - 5);
                   break;
               case '10Y':
                   startDate.setFullYear(startDate.getFullYear() - 10);
                   break;
               case 'ALL':
               default:
                   return data;
           }
           
           return data.filter(d => new Date(d.date) >= startDate);
       }
       
       // Setup chart controls
       function setupChartControls() {
           document.querySelectorAll('.chart-btn[data-range]').forEach(btn => {
               btn.addEventListener('click', function() {
                   document.querySelectorAll('.chart-btn[data-range]').forEach(b => b.classList.remove('active'));
                   this.classList.add('active');
                   
                   currentRange = this.dataset.range;
                   
                   if (selectedIndicator) {
                       const item = watchlist.find(w => w.symbol === selectedIndicator);
                       if (item) {
                           plotCharts(item.data, currentRange);
                       }
                   }
               });
           });
       }
       
       // Initialize charts
       function initializeChart() {
           const layout = {
               paper_bgcolor: '#fff',
               plot_bgcolor: '#fff',
               font: { color: '#666' },
               xaxis: {
                   showgrid: true,
                   gridcolor: '#e0e0e0'
               },
               yaxis: {
                   showgrid: true,
                   gridcolor: '#e0e0e0'
               },
               margin: { t: 20, r: 40, b: 40, l: 60 }
           };
           
           Plotly.newPlot('mainChart', [], layout, {responsive: true});
           Plotly.newPlot('yoyChart', [], layout, {responsive: true});
       }
       
       // Format value
       function formatValue(value) {
           if (value === null || value === undefined) return '--';
           
           if (value >= 1000000000) {
               return (value / 1000000000).toFixed(2) + 'B';
           } else if (value >= 1000000) {
               return (value / 1000000).toFixed(2) + 'M';
           } else if (value >= 1000) {
               return (value / 1000).toFixed(2) + 'K';
           } else {
               return value.toFixed(2);
           }
       }
       
       // Refresh watchlist
       async function refreshWatchlist() {
           for (let item of watchlist) {
               const newData = await fetchHistoricalData(item.symbol, item.source);
               if (newData && newData.length > 0) {
                   item.data = newData;
                   item.latestValue = newData[newData.length - 1].value;
                   item.latestDate = newData[newData.length - 1].date;
                   item.changes = calculateChanges(newData);
                   chartData[item.symbol] = newData;
               }
           }
           
           updateWatchlistDisplay();
           saveWatchlistToStorage();
           
           if (selectedIndicator) {
               selectIndicator(selectedIndicator);
           }
       }
       
       // Clear watchlist
       function clearWatchlist() {
           if (confirm('Are you sure you want to clear your watchlist?')) {
               watchlist = [];
               selectedIndicator = null;
               chartData = {};
               updateWatchlistDisplay();
               saveWatchlistToStorage();
               document.getElementById('chartTitle').textContent = 'Select an indicator to view data';
               document.getElementById('dataInfo').style.display = 'none';
               initializeChart();
           }
       }
       
       // Remove from watchlist
       function removeFromWatchlist(index) {
           const symbol = watchlist[index].symbol;
           watchlist.splice(index, 1);
           delete chartData[symbol];
           
           if (selectedIndicator === symbol) {
               selectedIndicator = null;
               document.getElementById('chartTitle').textContent = 'Select an indicator to view data';
               document.getElementById('dataInfo').style.display = 'none';
               initializeChart();
           }
           
           updateWatchlistDisplay();
           saveWatchlistToStorage();
       }
       
       // Save watchlist to localStorage
       function saveWatchlistToStorage() {
           const watchlistData = watchlist.map(item => ({
               symbol: item.symbol,
               name: item.name,
               customName: item.customName,
               source: item.source,
               flashing: item.flashing
           }));
           localStorage.setItem('openbb_watchlist', JSON.stringify(watchlistData));
       }
       
       // Load watchlist from localStorage
       async function loadWatchlistFromStorage() {
           const stored = localStorage.getItem('openbb_watchlist');
           if (stored) {
               try {
                   const watchlistData = JSON.parse(stored);
                   for (const item of watchlistData) {
                       const indicator = ALL_INDICATORS[item.symbol];
                       if (indicator) {
                           await addToWatchlist(item.symbol, item.name || indicator.name, item.source || indicator.source);
                           // Restore custom settings
                           const addedItem = watchlist.find(w => w.symbol === item.symbol);
                           if (addedItem) {
                               if (item.customName) addedItem.customName = item.customName;
                               if (item.flashing) addedItem.flashing = item.flashing;
                           }
                       }
                   }
                   updateWatchlistDisplay();
               } catch (error) {
                   console.error('Error loading watchlist:', error);
               }
           }
       }
       
       // Auto-refresh every 5 minutes
       setInterval(() => {
           if (watchlist.length > 0) {
               refreshWatchlist();
           }
       }, 300000);
   </script>
</body>
</html>
