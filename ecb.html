<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ECB Systemic Risk Monitor - Real-Time Crisis Detection</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: #0a0e27;
            color: #ffffff;
        }
        
        .header {
            background: linear-gradient(180deg, #1a1f3a 0%, #0a0e27 100%);
            padding: 20px;
            border-bottom: 2px solid #ff0000;
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        h1 {
            font-size: 28px;
            color: #ffffff;
        }
        
        .status-box {
            text-align: right;
        }
        
        .status-label {
            font-size: 12px;
            color: #7a8bb7;
        }
        
        .status-value {
            font-size: 18px;
            font-weight: bold;
            color: #00ff00;
        }
        
        .status-value.error {
            color: #ff0000;
        }
        
        .ai-alert {
            background: linear-gradient(90deg, #ff0000, #ff6b00);
            padding: 15px;
            margin: 20px;
            border-radius: 10px;
            display: none;
        }
        
        .ai-alert.active {
            display: block;
        }
        
        .tabs {
            background: #0f1426;
            padding: 0 20px;
            display: flex;
            gap: 5px;
            overflow-x: auto;
        }
        
        .tab {
            padding: 15px 25px;
            background: transparent;
            border: none;
            color: #7a8bb7;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .tab:hover {
            color: #ffffff;
            background: rgba(59, 130, 246, 0.1);
        }
        
        .tab.active {
            color: #ffffff;
            background: rgba(59, 130, 246, 0.2);
            border-bottom: 3px solid #3b82f6;
        }
        
        .tab-content {
            display: none;
            padding: 20px;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .card {
            background: linear-gradient(135deg, #1a1f3a 0%, #0f1426 100%);
            border: 1px solid #2a3f5f;
            border-radius: 12px;
            padding: 20px;
            transition: all 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(59, 130, 246, 0.2);
        }
        
        .card.critical {
            border-color: #ff0000;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 20px rgba(255,0,0,0.3); }
            50% { box-shadow: 0 0 40px rgba(255,0,0,0.6); }
        }
        
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .card-title {
            font-size: 16px;
            font-weight: 600;
        }
        
        .badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .badge-critical {
            background: #ff0000;
            color: #ffffff;
        }
        
        .badge-high {
            background: #ff6b00;
            color: #ffffff;
        }
        
        .badge-medium {
            background: #ffd700;
            color: #000000;
        }
        
        .badge-low {
            background: #00ff00;
            color: #000000;
        }
        
        .value {
            font-size: 32px;
            font-weight: 700;
            margin: 10px 0;
            color: #3b82f6;
        }
        
        .chart-container {
            background: #1a1f3a;
            border: 1px solid #2a3f5f;
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            height: 400px;
            position: relative;
        }
        
        .loading {
            text-align: center;
            padding: 50px;
            color: #7a8bb7;
        }
        
        .spinner {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 3px solid #2a3f5f;
            border-top: 3px solid #3b82f6;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .country-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .country-card {
            background: rgba(0,0,0,0.3);
            border: 1px solid #2a3f5f;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .country-card:hover {
            transform: scale(1.05);
            border-color: #3b82f6;
        }
        
        .country-flag {
            font-size: 32px;
            margin-bottom: 5px;
        }
        
        .country-code {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 5px;
        }
        
        .country-value {
            font-size: 20px;
            font-weight: 700;
        }
        
        .feed {
            background: rgba(0,0,0,0.3);
            border: 1px solid #2a3f5f;
            border-radius: 8px;
            padding: 15px;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .feed-item {
            padding: 10px;
            border-bottom: 1px solid rgba(42,63,95,0.5);
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .feed-time {
            font-size: 11px;
            color: #7a8bb7;
            min-width: 60px;
        }
        
        .feed-icon {
            font-size: 20px;
        }
        
        .feed-message {
            flex: 1;
            font-size: 13px;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <h1>üè¶ ECB SYSTEMIC RISK MONITOR</h1>
            <div class="status-box">
                <div class="status-label">System Status</div>
                <div class="status-value" id="system-status">LOADING...</div>
                <div class="status-label">Last Update</div>
                <div class="status-value" id="last-update">--:--:--</div>
            </div>
        </div>
    </div>
    
    <div class="ai-alert" id="ai-alert">
        <h3 id="ai-alert-title">üö® AI CRISIS WARNING</h3>
        <p id="ai-alert-message">Multiple risk indicators showing critical levels</p>
    </div>
    
    <div class="tabs">
        <button class="tab active" onclick="switchTab('overview', this)">üè† Overview</button>
        <button class="tab" onclick="switchTab('systemic', this)">‚ö†Ô∏è Systemic Risk</button>
        <button class="tab" onclick="switchTab('dollar', this)">üíµ Dollar Shortage</button>
        <button class="tab" onclick="switchTab('crisis', this)">üî• Financial Crisis</button>
        <button class="tab" onclick="switchTab('country', this)">üåç Country Risk</button>
        <button class="tab" onclick="switchTab('liquidity', this)">üíß Liquidity</button>
        <button class="tab" onclick="switchTab('rates', this)">üìà Interest Rates</button>
        <button class="tab" onclick="switchTab('unemployment', this)">üë• Unemployment</button>
    </div>
    
    <!-- Overview Tab -->
    <div class="tab-content active" id="overview-tab">
        <div class="grid" id="overview-grid">
            <div class="loading">
                <div class="spinner"></div>
                <p>Loading ECB data...</p>
            </div>
        </div>
        <div class="chart-container">
            <canvas id="overview-chart"></canvas>
        </div>
    </div>
    
    <!-- Systemic Risk Tab -->
    <div class="tab-content" id="systemic-tab">
        <div class="grid" id="systemic-grid"></div>
        <div class="chart-container">
            <canvas id="systemic-chart"></canvas>
        </div>
    </div>
    
    <!-- Dollar Shortage Tab -->
    <div class="tab-content" id="dollar-tab">
        <div class="grid" id="dollar-grid"></div>
        <div class="chart-container">
            <canvas id="dollar-chart"></canvas>
        </div>
    </div>
    
    <!-- Financial Crisis Tab -->
    <div class="tab-content" id="crisis-tab">
        <div class="grid" id="crisis-grid"></div>
        <div class="chart-container">
            <canvas id="crisis-chart"></canvas>
        </div>
    </div>
    
    <!-- Country Risk Tab -->
    <div class="tab-content" id="country-tab">
        <div class="country-grid" id="country-grid"></div>
        <div class="chart-container">
            <canvas id="country-chart"></canvas>
        </div>
    </div>
    
    <!-- Liquidity Tab -->
    <div class="tab-content" id="liquidity-tab">
        <div class="grid" id="liquidity-grid"></div>
        <div class="chart-container">
            <canvas id="liquidity-chart"></canvas>
        </div>
    </div>
    
    <!-- Interest Rates Tab -->
    <div class="tab-content" id="rates-tab">
        <div class="grid" id="rates-grid"></div>
        <div class="chart-container">
            <canvas id="rates-chart"></canvas>
        </div>
    </div>
    
    <!-- Unemployment Tab -->
    <div class="tab-content" id="unemployment-tab">
        <div class="country-grid" id="unemployment-grid"></div>
        <div class="chart-container">
            <canvas id="unemployment-chart"></canvas>
        </div>
    </div>
    
    <script>
        // API Configuration
        const API_BASE = 'https://dv7wxb807j.execute-api.us-east-1.amazonaws.com/prod';
        
        // Global data storage
        let ecbData = {
            indicators: [],
            riskAssessment: null,
            historical: {},
            charts: {}
        };
        
        // Country flags
        const flags = {
            'DE': 'üá©üá™', 'IT': 'üáÆüáπ', 'ES': 'üá™üá∏', 'FR': 'üá´üá∑',
            'GR': 'üá¨üá∑', 'PT': 'üáµüáπ', 'IE': 'üáÆüá™', 'NL': 'üá≥üá±',
            'BE': 'üáßüá™', 'AT': 'üá¶üáπ', 'FI': 'üá´üáÆ', 'LU': 'üá±üá∫'
        };
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Initializing ECB Dashboard...');
            loadAllData();
            setInterval(updateTime, 1000);
            setInterval(loadAllData, 60000); // Refresh every minute
        });
        
        // Load all ECB data
        async function loadAllData() {
            console.log('Loading ECB data from API...');
            
            try {
                // Update status
                document.getElementById('system-status').textContent = 'LOADING...';
                document.getElementById('system-status').className = 'status-value';
                
                // Fetch indicators list
                const listResponse = await fetch(`${API_BASE}/list?limit=200`);
                console.log('List response status:', listResponse.status);
                
                if (!listResponse.ok) {
                    throw new Error(`HTTP error! status: ${listResponse.status}`);
                }
                
                const listData = await listResponse.json();
                console.log('Received indicators:', listData.total || 0);
                
                ecbData.indicators = listData.indicators || [];
                
                // Fetch risk assessment
                try {
                    const riskResponse = await fetch(`${API_BASE}/risk-assessment`);
                    if (riskResponse.ok) {
                        ecbData.riskAssessment = await riskResponse.json();
                        console.log('Risk assessment loaded');
                    }
                } catch (e) {
                    console.log('Risk assessment not available');
                }
                
                // Load some historical data for key indicators
                await loadKeyHistoricalData();
                
                // Update all tabs
                updateAllTabs();
                
                // Update status to show success
                const riskLevel = ecbData.riskAssessment?.systemic_risk || 'MONITORING';
                document.getElementById('system-status').textContent = riskLevel;
                document.getElementById('system-status').className = 
                    riskLevel === 'CRITICAL' ? 'status-value error' : 'status-value';
                
                // Check for alerts
                checkForAlerts();
                
                console.log('Data loading complete');
                
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('system-status').textContent = 'ERROR';
                document.getElementById('system-status').className = 'status-value error';
                
                // Show error in overview
                document.getElementById('overview-grid').innerHTML = `
                    <div class="card">
                        <div class="card-header">
                            <div class="card-title">Connection Error</div>
                        </div>
                        <p>Unable to load ECB data. Please check your connection and refresh.</p>
                        <p style="color: #ff6b00; margin-top: 10px;">Error: ${error.message}</p>
                    </div>
                `;
            }
        }
        
        // Load historical data for key indicators
        async function loadKeyHistoricalData() {
            const keySymbols = [
                'ECB.CISS.M.DE.Z0Z.4F.EC.SOV_CI.IDX',
                'ECB.CISS.M.IT.Z0Z.4F.EC.SOV_CI.IDX',
                'ECB.CISS.M.ES.Z0Z.4F.EC.SOV_CI.IDX'
            ];
            
            for (const symbol of keySymbols) {
                try {
                    const response = await fetch(`${API_BASE}/historical/${symbol}`);
                    if (response.ok) {
                        ecbData.historical[symbol] = await response.json();
                    }
                } catch (e) {
                    console.log(`Could not load historical for ${symbol}`);
                }
            }
        }
        
        // Update all tabs with data
        function updateAllTabs() {
            updateOverview();
            updateSystemicRisk();
            updateDollarShortage();
            updateFinancialCrisis();
            updateCountryRisk();
            updateLiquidity();
            updateInterestRates();
            updateUnemployment();
        }
        
        // Update Overview
        function updateOverview() {
            const grid = document.getElementById('overview-grid');
            
            // Group data by dataset
            const ciss = ecbData.indicators.filter(i => i.dataset === 'CISS');
            const unemployment = ecbData.indicators.filter(i => i.dataset === 'UNEMPLOYMENT');
            const ilm = ecbData.indicators.filter(i => i.dataset === 'ILM');
            
            // Calculate averages
            const avgStress = ecbData.riskAssessment?.average_stress || 0;
            const avgUnemployment = unemployment.length > 0 
                ? unemployment.reduce((sum, i) => sum + (i.value || 0), 0) / unemployment.length 
                : 0;
            
            grid.innerHTML = `
                <div class="card ${avgStress > 0.15 ? 'critical' : ''}">
                    <div class="card-header">
                        <div class="card-title">Systemic Stress</div>
                        <div class="badge badge-${getRiskBadge(avgStress)}">${getRiskLevel(avgStress)}</div>
                    </div>
                    <div class="value">${(avgStress * 100).toFixed(2)}%</div>
                    <p>Countries monitored: ${ciss.length}</p>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Total Indicators</div>
                        <div class="badge badge-low">ACTIVE</div>
                    </div>
                    <div class="value">${ecbData.indicators.length}</div>
                    <p>Last update: ${new Date().toLocaleTimeString()}</p>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Avg Unemployment</div>
                        <div class="badge badge-${avgUnemployment > 10 ? 'high' : 'medium'}">${avgUnemployment > 10 ? 'HIGH' : 'MODERATE'}</div>
                    </div>
                    <div class="value">${avgUnemployment.toFixed(1)}%</div>
                    <p>Euro Area average</p>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Liquidity Monitor</div>
                        <div class="badge badge-medium">WATCH</div>
                    </div>
                    <div class="value">${ilm[0]?.value?.toLocaleString() || 'N/A'}</div>
                    <p>Claims on euro residents</p>
                </div>
            `;
            
            // Update chart
            updateOverviewChart();
        }
        
        // Update Systemic Risk
        function updateSystemicRisk() {
            const grid = document.getElementById('systemic-grid');
            const cissData = ecbData.indicators.filter(i => 
                i.dataset === 'CISS' && i.name?.includes('Sovereign Stress')
            ).slice(0, 12);
            
            if (cissData.length === 0) {
                grid.innerHTML = '<div class="card"><p>No CISS data available</p></div>';
                return;
            }
            
            grid.innerHTML = cissData.map(indicator => `
                <div class="card ${indicator.value > 0.2 ? 'critical' : ''}">
                    <div class="card-header">
                        <div class="card-title">${flags[indicator.country] || ''} ${indicator.country || 'N/A'}</div>
                        <div class="badge badge-${getRiskBadge(indicator.value)}">${getRiskLevel(indicator.value)}</div>
                    </div>
                    <div class="value">${(indicator.value * 100).toFixed(3)}%</div>
                    <p>Date: ${indicator.date || 'N/A'}</p>
                </div>
            `).join('');
            
            updateSystemicChart();
        }
        
        // Update Dollar Shortage
        function updateDollarShortage() {
            const grid = document.getElementById('dollar-grid');
            const ilmData = ecbData.indicators.filter(i => i.dataset === 'ILM');
            
            const dollarStress = calculateDollarStress();
            
            grid.innerHTML = `
                <div class="card ${dollarStress > 70 ? 'critical' : ''}">
                    <div class="card-header">
                        <div class="card-title">Dollar Funding Stress</div>
                        <div class="badge badge-${dollarStress > 70 ? 'critical' : 'high'}">${dollarStress > 70 ? 'CRITICAL' : 'ELEVATED'}</div>
                    </div>
                    <div class="value">${dollarStress.toFixed(0)}%</div>
                    <p>Funding pressure indicator</p>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Euro Area Claims</div>
                    </div>
                    <div class="value">${ilmData[0]?.value?.toLocaleString() || 'N/A'}</div>
                    <p>Weekly data</p>
                </div>
            `;
            
            if (dollarStress > 70) {
                showAlert('DOLLAR SHORTAGE DETECTED', 'Severe funding stress in dollar markets');
            }
        }
        
        // Update Financial Crisis
        function updateFinancialCrisis() {
            const grid = document.getElementById('crisis-grid');
            const crisisProbability = calculateCrisisProbability();
            
            grid.innerHTML = `
                <div class="card ${crisisProbability > 60 ? 'critical' : ''}">
                    <div class="card-header">
                        <div class="card-title">Crisis Probability</div>
                        <div class="badge badge-${crisisProbability > 60 ? 'critical' : 'high'}">
                            ${crisisProbability > 60 ? 'IMMINENT' : 'ELEVATED'}
                        </div>
                    </div>
                    <div class="value">${crisisProbability.toFixed(1)}%</div>
                    <p>Based on multiple indicators</p>
                </div>
                
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">Risk Indicators</div>
                    </div>
                    <div class="value">${ecbData.indicators.length}</div>
                    <p>Total monitored</p>
                </div>
            `;
            
            if (crisisProbability > 60) {
                showAlert('FINANCIAL CRISIS WARNING', `Crisis probability at ${crisisProbability.toFixed(1)}%`);
            }
        }
        
        // Update Country Risk
        function updateCountryRisk() {
            const grid = document.getElementById('country-grid');
            const countries = ecbData.riskAssessment?.country_risks || [];
            
            if (countries.length === 0) {
                // Use CISS data as fallback
                const cissData = ecbData.indicators.filter(i => 
                    i.dataset === 'CISS' && i.country
                );
                
                grid.innerHTML = cissData.slice(0, 20).map(indicator => `
                    <div class="country-card">
                        <div class="country-flag">${flags[indicator.country] || 'üè≥Ô∏è'}</div>
                        <div class="country-code">${indicator.country}</div>
                        <div class="country-value" style="color: ${getValueColor(indicator.value)}">
                            ${(indicator.value * 100).toFixed(2)}%
                        </div>
                    </div>
                `).join('');
            } else {
                grid.innerHTML = countries.map(country => `
                    <div class="country-card">
                        <div class="country-flag">${flags[country.country] || 'üè≥Ô∏è'}</div>
                        <div class="country-code">${country.country}</div>
                        <div class="country-value" style="color: ${getValueColor(country.value)}">
                            ${(country.value * 100).toFixed(2)}%
                        </div>
                    </div>
                `).join('');
            }
        }
        
        // Update Liquidity
        function updateLiquidity() {
            const grid = document.getElementById('liquidity-grid');
            const bsiData = ecbData.indicators.filter(i => i.dataset === 'BSI').slice(0, 6);
            
            if (bsiData.length === 0) {
                grid.innerHTML = '<div class="card"><p>No liquidity data available</p></div>';
                return;
            }
            
            grid.innerHTML = bsiData.map(indicator => `
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">${flags[indicator.country] || ''} ${indicator.country}</div>
                    </div>
                    <div class="value">${indicator.value?.toLocaleString() || 'N/A'}</div>
                    <p>Bank liabilities</p>
                </div>
            `).join('');
        }
        
        // Update Interest Rates
        function updateInterestRates() {
            const grid = document.getElementById('rates-grid');
            const mirData = ecbData.indicators.filter(i => i.dataset === 'MIR').slice(0, 6);
            
            if (mirData.length === 0) {
                grid.innerHTML = '<div class="card"><p>No interest rate data available</p></div>';
                return;
            }
            
            grid.innerHTML = mirData.map(indicator => `
                <div class="card">
                    <div class="card-header">
                        <div class="card-title">${flags[indicator.country] || ''} ${indicator.country}</div>
                    </div>
                    <div class="value">${indicator.value?.toFixed(2)}%</div>
                    <p>${indicator.name?.includes('Deposit') ? 'Deposit rate' : 'Lending rate'}</p>
                </div>
            `).join('');
        }
        
        // Update Unemployment
        function updateUnemployment() {
            const grid = document.getElementById('unemployment-grid');
            const unemploymentData = ecbData.indicators.filter(i => i.dataset === 'UNEMPLOYMENT');
            
            if (unemploymentData.length === 0) {
                grid.innerHTML = '<div class="card"><p>No unemployment data available</p></div>';
                return;
            }
            
            grid.innerHTML = unemploymentData.map(indicator => `
                <div class="country-card">
                    <div class="country-flag">${flags[indicator.country] || 'üè≥Ô∏è'}</div>
                    <div class="country-code">${indicator.country}</div>
                    <div class="country-value" style="color: ${indicator.value > 10 ? '#ff0000' : indicator.value > 7 ? '#ffd700' : '#00ff00'}">
                        ${indicator.value?.toFixed(1)}%
                    </div>
                </div>
            `).join('');
        }
        
        // Chart functions
        function updateOverviewChart() {
            const ctx = document.getElementById('overview-chart');
            if (!ctx) return;
            
            const historical = Object.values(ecbData.historical)[0];
            if (!historical?.historical_data) return;
            
            const data = historical.historical_data.slice(-30);
            
            if (ecbData.charts.overview) {
                ecbData.charts.overview.destroy();
            }
            
            ecbData.charts.overview = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: data.map(d => d.date),
                    datasets: [{
                        label: 'Systemic Stress Trend',
                        data: data.map(d => d.value * 100),
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4
                    }]
                },
                options: getChartOptions()
            });
        }
        
        function updateSystemicChart() {
            const ctx = document.getElementById('systemic-chart');
            if (!ctx) return;
            
            const cissData = ecbData.indicators.filter(i => 
                i.dataset === 'CISS' && i.name?.includes('Sovereign Stress')
            ).slice(0, 10);
            
            if (cissData.length === 0) return;
            
            if (ecbData.charts.systemic) {
                ecbData.charts.systemic.destroy();
            }
            
            ecbData.charts.systemic = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: cissData.map(d => d.country || 'N/A'),
                    datasets: [{
                        label: 'CISS Stress Level (%)',
                        data: cissData.map(d => (d.value || 0) * 100),
                        backgroundColor: cissData.map(d => 
                            d.value > 0.2 ? 'rgba(255,0,0,0.6)' :
                            d.value > 0.1 ? 'rgba(255,215,0,0.6)' :
                            'rgba(0,255,0,0.6)'
                        )
                    }]
                },
                options: getChartOptions()
            });
        }
        
        function getChartOptions() {
            return {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        labels: { color: '#ffffff' }
                    }
                },
                scales: {
                    x: {
                        ticks: { color: '#7a8bb7' },
                        grid: { color: 'rgba(255,255,255,0.1)' }
                    },
                    y: {
                        ticks: { color: '#7a8bb7' },
                        grid: { color: 'rgba(255,255,255,0.1)' }
                    }
                }
            };
        }
        
        // Helper functions
        function switchTab(tabName, button) {
            // Hide all tabs
            document.querySelectorAll('.tab-content').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Remove active from all buttons
            document.querySelectorAll('.tab').forEach(btn => {
                btn.classList.remove('active');
            });
            
            // Show selected tab
            document.getElementById(`${tabName}-tab`).classList.add('active');
            button.classList.add('active');
        }
        
        function getRiskLevel(value) {
            if (value > 0.3) return 'CRITICAL';
            if (value > 0.2) return 'HIGH';
            if (value > 0.1) return 'MEDIUM';
            return 'LOW';
        }
        
        function getRiskBadge(value) {
            if (value > 0.3) return 'critical';
            if (value > 0.2) return 'high';
            if (value > 0.1) return 'medium';
            return 'low';
        }
        
        function getValueColor(value) {
            if (value > 0.3) return '#ff0000';
            if (value > 0.2) return '#ff6b00';
            if (value > 0.1) return '#ffd700';
            return '#00ff00';
        }
        
        function calculateDollarStress() {
            const ilm = ecbData.indicators.find(i => i.dataset === 'ILM');
            if (!ilm) return 50;
            
            // Simple calculation based on ILM value
            const baseline = 20000;
            const current = ilm.value || baseline;
            const stress = Math.max(0, Math.min(100, ((baseline - current) / baseline) * 200));
            return stress;
        }
        
        function calculateCrisisProbability() {
            const avgStress = ecbData.riskAssessment?.average_stress || 0;
            const unemployment = ecbData.indicators.filter(i => i.dataset === 'UNEMPLOYMENT');
            const avgUnemployment = unemployment.length > 0
                ? unemployment.reduce((sum, i) => sum + (i.value || 0), 0) / unemployment.length
                : 5;
            
            // Simple crisis probability calculation
            const probability = (avgStress * 200) + (avgUnemployment * 3) + 20;
            return Math.min(100, Math.max(0, probability));
        }
        
        function checkForAlerts() {
            const avgStress = ecbData.riskAssessment?.average_stress || 0;
            const crisisProbability = calculateCrisisProbability();
            const dollarStress = calculateDollarStress();
            
            if (avgStress > 0.2) {
                showAlert('SYSTEMIC STRESS WARNING', `Stress level at ${(avgStress * 100).toFixed(2)}%`);
            } else if (crisisProbability > 60) {
                showAlert('CRISIS PROBABILITY HIGH', `${crisisProbability.toFixed(1)}% probability detected`);
            } else if (dollarStress > 70) {
                showAlert('DOLLAR SHORTAGE', 'Funding stress detected');
            }
        }
        
        function showAlert(title, message) {
            const alertDiv = document.getElementById('ai-alert');
            document.getElementById('ai-alert-title').textContent = 'üö® ' + title;
            document.getElementById('ai-alert-message').textContent = message;
            alertDiv.classList.add('active');
            
            setTimeout(() => {
                alertDiv.classList.remove('active');
            }, 10000);
        }
        
        function updateTime() {
            document.getElementById('last-update').textContent = 
                new Date().toLocaleTimeString();
        }
    </script>
</body>
</html>