<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fed Liquidity Dashboard - Complete 62 Indicators</title>
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #151932 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }
        
        .header {
            background: rgba(20, 24, 44, 0.95);
            backdrop-filter: blur(10px);
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            border: 1px solid rgba(0, 255, 136, 0.2);
        }
        
        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .title {
            font-size: 2rem;
            font-weight: bold;
            background: linear-gradient(45deg, #00ff88, #00ccff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .api-status {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
        }
        
        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .status-dot.connected {
            background: #00ff88;
        }
        
        .status-dot.loading {
            background: #ffaa00;
        }
        
        .status-dot.error {
            background: #ff4444;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .stats-bar {
            display: flex;
            gap: 2rem;
            margin-top: 1rem;
            flex-wrap: wrap;
        }
        
        .stat-item {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }
        
        .stat-value {
            font-size: 1.5rem;
            font-weight: bold;
            color: #00ff88;
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: #888;
            text-transform: uppercase;
        }
        
        .controls {
            background: rgba(20, 24, 44, 0.95);
            padding: 1rem;
            border-radius: 12px;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .category-tabs {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }
        
        .tab-btn {
            padding: 0.75rem 1.5rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            color: #888;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 0.875rem;
        }
        
        .tab-btn:hover {
            background: rgba(0, 255, 136, 0.1);
            border-color: #00ff88;
            color: #fff;
        }
        
        .tab-btn.active {
            background: #00ff88;
            color: #000;
            font-weight: bold;
        }
        
        .search-bar {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .search-input {
            flex: 1;
            padding: 0.75rem;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            color: #fff;
            font-size: 1rem;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #00ff88;
            background: rgba(0, 255, 136, 0.05);
        }
        
        .refresh-btn {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, #00ff88, #00ccff);
            border: none;
            border-radius: 8px;
            color: #000;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .refresh-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 30px rgba(0, 255, 136, 0.3);
        }
        
        .refresh-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        .cors-notice {
            background: rgba(255, 170, 0, 0.1);
            border: 1px solid #ffaa00;
            color: #ffaa00;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
        }
        
        .cors-notice h3 {
            margin-bottom: 1rem;
        }
        
        .cors-notice code {
            background: rgba(0, 0, 0, 0.3);
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-family: monospace;
        }
        
        .test-api-btn {
            margin-top: 1rem;
            padding: 0.75rem 1.5rem;
            background: #ffaa00;
            border: none;
            border-radius: 8px;
            color: #000;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .test-api-btn:hover {
            background: #ffcc00;
        }
        
        .indicators-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .indicator-card {
            background: rgba(20, 24, 44, 0.95);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 1.5rem;
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        .indicator-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0, 255, 136, 0.2);
            border-color: #00ff88;
        }
        
        .indicator-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 1rem;
        }
        
        .indicator-title {
            font-size: 0.875rem;
            color: #00ff88;
            font-weight: bold;
            word-break: break-word;
            flex: 1;
            margin-right: 1rem;
        }
        
        .indicator-symbol {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            background: rgba(0, 255, 136, 0.2);
            border-radius: 4px;
            color: #00ff88;
            white-space: nowrap;
        }
        
        .indicator-value {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 1rem;
            color: #fff;
        }
        
        .indicator-date {
            font-size: 0.75rem;
            color: #666;
            margin-bottom: 1rem;
        }
        
        .changes-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
        }
        
        .change-item {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            padding: 0.5rem;
            text-align: center;
        }
        
        .change-period {
            font-size: 0.625rem;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 0.25rem;
        }
        
        .change-value {
            font-size: 1.125rem;
            font-weight: bold;
        }
        
        .positive { color: #00ff88; }
        .negative { color: #ff4444; }
        .neutral { color: #888; }
        
        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(0, 255, 136, 0.3);
            border-top-color: #00ff88;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .error-message {
            background: rgba(255, 68, 68, 0.1);
            border: 1px solid #ff4444;
            color: #ff6666;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }
        
        .debug-info {
            background: rgba(0, 0, 0, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
            font-family: monospace;
            font-size: 0.875rem;
            white-space: pre-wrap;
            word-break: break-all;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .last-update {
            text-align: center;
            font-size: 0.875rem;
            color: #666;
            margin-top: 2rem;
            padding: 1rem;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
        }
        
        .category-header {
            grid-column: 1 / -1;
            background: linear-gradient(90deg, rgba(0, 255, 136, 0.1), transparent);
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
            font-size: 1.125rem;
            font-weight: bold;
            color: #00ff88;
            border-left: 4px solid #00ff88;
        }
        
        @media (max-width: 768px) {
            .indicators-grid {
                grid-template-columns: 1fr;
            }
            
            .title {
                font-size: 1.5rem;
            }
            
            .changes-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <h1 class="title">Fed Liquidity Dashboard</h1>
            <div class="api-status">
                <div class="status-dot loading" id="apiStatus"></div>
                <span id="statusText">Connecting...</span>
            </div>
        </div>
        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-value" id="totalIndicators">0</div>
                <div class="stat-label">Total Indicators</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="fedBalance">-</div>
                <div class="stat-label">Fed Balance Sheet</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="reserveBalances">-</div>
                <div class="stat-label">Reserve Balances</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="overnightRRP">-</div>
                <div class="stat-label">Overnight RRP</div>
            </div>
        </div>
    </div>
    
    <div class="cors-notice" id="corsNotice" style="display: none;">
        <h3>‚ö†Ô∏è CORS Security Notice</h3>
        <p>The Fed Liquidity API cannot be accessed directly from a browser due to CORS restrictions. To use this dashboard:</p>
        <ol style="margin: 1rem 0; padding-left: 2rem;">
            <li><strong>Option 1 - Proxy Server:</strong> Run a local proxy server to bypass CORS:
                <div style="margin: 0.5rem 0;">
                    <code>npx cors-anywhere</code> or use Chrome with <code>--disable-web-security</code>
                </div>
            </li>
            <li><strong>Option 2 - Backend Server:</strong> Host this HTML on a server that can make backend API calls</li>
            <li><strong>Option 3 - Browser Extension:</strong> Install a CORS unblocking extension (for development only)</li>
            <li><strong>Option 4 - Direct API Access:</strong> Access the API directly in your browser:
                <div style="margin: 0.5rem 0;">
                    <code id="apiUrl">https://nmkverrwjnxsmgnogzckkoyuce0bqxyk.lambda-url.us-east-1.on.aws/?series=summary</code>
                </div>
            </li>
        </ol>
        <button class="test-api-btn" onclick="testDirectAPI()">Test Direct API Access</button>
        <div class="debug-info" id="debugInfo" style="display: none;"></div>
    </div>
    
    <div class="controls">
        <div class="category-tabs">
            <button class="tab-btn active" data-category="all">All Indicators</button>
            <button class="tab-btn" data-category="reserves">Reserves</button>
            <button class="tab-btn" data-category="currency">Currency</button>
            <button class="tab-btn" data-category="treasury_account">Treasury</button>
            <button class="tab-btn" data-category="repo_operations">Repo Ops</button>
            <button class="tab-btn" data-category="securities">Securities</button>
            <button class="tab-btn" data-category="lending_facilities">Lending</button>
            <button class="tab-btn" data-category="balance_sheet">Balance Sheet</button>
            <button class="tab-btn" data-category="other_assets">Other</button>
        </div>
        <div class="search-bar">
            <input type="text" class="search-input" id="searchInput" placeholder="Search indicators (e.g., WALCL, Reserve, Balance)">
            <button class="refresh-btn" id="refreshBtn" onclick="loadAllData()">Refresh Data</button>
        </div>
    </div>
    
    <div class="indicators-grid" id="indicatorsGrid">
        <div style="grid-column: 1 / -1; text-align: center; padding: 3rem;">
            <div class="loading-spinner"></div>
            <p style="margin-top: 1rem;">Attempting to connect to Fed Liquidity API...</p>
        </div>
    </div>
    
    <div class="last-update" id="lastUpdate">
        Last Updated: Never
    </div>
    
    <script>
        // Fed Liquidity API Configuration
        const FED_API_URL = 'https://nmkverrwjnxsmgnogzckkoyuce0bqxyk.lambda-url.us-east-1.on.aws';
        
        // Categories from the API documentation
        const FED_LIQUIDITY_CATEGORIES = {
            "reserves": ["WRBWFRBL", "RESBALNS", "RESBALNSW", "REQRESNS", "EXCSRESNS", "TOTRESNS"],
            "currency": ["WCURCIR", "CURRCIR", "BOGMBBM"],
            "treasury_account": ["WTREGEN", "TREASURY"],
            "repo_operations": ["WREPODEL", "WREPOFOR", "RRPONTSYD", "RPONTSYD", "H41RESPPREPO", "H41RESPPFIMA"],
            "securities": ["WSHOTSL", "WSHOSHO", "WSHOTS", "WSHOMCB", "WSHOFDEB", "TREAST", "TREASLT5", "TREASG5T10", "TREASG10", "TIPS", "FPCPN", "MBST", "CMBS"],
            "lending_facilities": ["WLCFLL", "WPCREDIT", "DISCBORR", "WSCREDIT", "PDCB", "TAF", "H41RESPPBTFP"],
            "emergency_programs": ["RESPPALLEX", "PPPLF", "MSLP", "MLF", "CPFF", "PMCCF", "SMCCF", "TALF", "MMLF"],
            "balance_sheet": ["WALCL", "RESPPANWW", "BOGMBASE", "WOTHLL"],
            "other_assets": ["WFCDA", "WUPSHO", "WUDSON", "SWPT", "CLBSWP", "WORAL", "WGCAL", "WSDRAL", "COINAL", "WDTGAL", "TERMAUC"]
        };
        
        // Global state
        let allIndicatorData = {};
        let currentCategory = 'all';
        let searchTerm = '';
        let autoRefreshInterval = null;
        
        // Initialize the dashboard
        async function initDashboard() {
            console.log('Initializing Fed Liquidity Dashboard...');
            console.log('API URL:', FED_API_URL);
            
            // Set up event listeners
            setupEventListeners();
            
            // Load initial data
            await loadAllData();
            
            // Set up auto-refresh (twice weekly: Wednesday and Saturday at 9 AM)
            setupAutoRefresh();
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Category tabs
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    currentCategory = e.target.dataset.category;
                    filterAndDisplayIndicators();
                });
            });
            
            // Search input
            document.getElementById('searchInput').addEventListener('input', (e) => {
                searchTerm = e.target.value.toLowerCase();
                filterAndDisplayIndicators();
            });
        }
        
        // Test direct API access
        async function testDirectAPI() {
            const debugInfo = document.getElementById('debugInfo');
            debugInfo.style.display = 'block';
            debugInfo.textContent = 'Testing API connection...\n\n';
            
            try {
                debugInfo.textContent += `Attempting to fetch: ${FED_API_URL}/?series=summary\n\n`;
                
                const response = await fetch(`${FED_API_URL}/?series=summary`, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                    },
                    mode: 'cors'
                });
                
                debugInfo.textContent += `Response Status: ${response.status}\n`;
                debugInfo.textContent += `Response OK: ${response.ok}\n\n`;
                
                if (response.ok) {
                    const data = await response.json();
                    debugInfo.textContent += 'SUCCESS! Data received:\n';
                    debugInfo.textContent += JSON.stringify(data, null, 2).substring(0, 500) + '...';
                } else {
                    debugInfo.textContent += `Error: HTTP ${response.status}\n`;
                }
            } catch (error) {
                debugInfo.textContent += `CORS Error Detected:\n${error.message}\n\n`;
                debugInfo.textContent += 'This is expected. The API is working but browser security blocks it.\n';
                debugInfo.textContent += 'Copy this URL and paste it in a new browser tab to see the data:\n';
                debugInfo.textContent += `${FED_API_URL}/?series=summary`;
            }
        }
        
        // Load all data from the Fed API
        async function loadAllData() {
            const refreshBtn = document.getElementById('refreshBtn');
            refreshBtn.disabled = true;
            refreshBtn.textContent = 'Loading...';
            
            updateStatus('loading', 'Connecting to API...');
            
            try {
                console.log('Fetching from:', `${FED_API_URL}/?series=summary`);
                
                // Try to fetch with CORS mode
                const testResponse = await fetch(`${FED_API_URL}/?series=summary`, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                    },
                    mode: 'cors' // This will likely fail due to CORS
                });
                
                if (!testResponse.ok) {
                    throw new Error(`HTTP error! status: ${testResponse.status}`);
                }
                
                const summaryData = await testResponse.json();
                console.log('Data received:', summaryData);
                
                // Process summary data
                if (summaryData.metrics) {
                    summaryData.metrics.forEach(metric => {
                        allIndicatorData[metric.series] = {
                            name: metric.name,
                            value: metric.latest_value,
                            date: metric.latest_date,
                            week_change: metric.week_change || 0,
                            cached: metric.cached
                        };
                    });
                }
                
                // Load percentage changes for all indicators
                await loadPercentageChanges();
                
                // Update header stats
                updateHeaderStats();
                
                // Display all indicators
                filterAndDisplayIndicators();
                
                // Update status
                updateStatus('connected', 'Connected');
                
                // Hide CORS notice
                document.getElementById('corsNotice').style.display = 'none';
                
                // Update last update time
                document.getElementById('lastUpdate').textContent = 
                    `Last Updated: ${new Date().toLocaleString()} | Auto-refresh: Wed & Sat 9 AM ET`;
                
                // Update total indicators count
                document.getElementById('totalIndicators').textContent = 
                    Object.keys(allIndicatorData).length;
                
            } catch (error) {
                console.error('Error loading data:', error);
                
                // Show CORS notice
                document.getElementById('corsNotice').style.display = 'block';
                
                updateStatus('error', 'CORS blocked - See notice above');
                
                // Show error in grid
                const grid = document.getElementById('indicatorsGrid');
                grid.innerHTML = `
                    <div style="grid-column: 1 / -1;">
                        <div class="error-message">
                            <h3>Cannot Connect Due to Browser Security (CORS)</h3>
                            <p>The Fed Liquidity API is working but browser security prevents direct access.</p>
                            <p style="margin-top: 1rem;">Please see the instructions above to access the data.</p>
                        </div>
                    </div>
                `;
                
                // Try to load demo data as fallback
                loadDemoData();
            } finally {
                refreshBtn.disabled = false;
                refreshBtn.textContent = 'Refresh Data';
            }
        }
        
        // Load demo data as fallback
        function loadDemoData() {
            console.log('Loading demo data for visualization...');
            
            // Demo data structure matching real API
            const demoData = {
                "WRBWFRBL": { name: "Reserve Balances (Weekly)", value: 3167905, date: "2025-09-03", week_change: -1.52, month_change: -2.1, quarter_change: -4.3, year_change: -8.7 },
                "WALCL": { name: "Fed Total Assets (Weekly)", value: 6602071, date: "2025-09-03", week_change: -0.02, month_change: -0.58, quarter_change: -1.06, year_change: -7.18 },
                "WCURCIR": { name: "Currency in Circulation (Weekly)", value: 2410000, date: "2025-09-03", week_change: 0.26, month_change: 0.8, quarter_change: 1.5, year_change: 3.2 },
                "WTREGEN": { name: "Treasury General Account (Weekly)", value: 598000, date: "2025-09-03", week_change: 1.27, month_change: 2.5, quarter_change: -3.1, year_change: 15.3 },
                "RRPONTSYD": { name: "Overnight RRP (Daily)", value: 21000, date: "2025-09-03", week_change: -73.05, month_change: -65.2, quarter_change: -80.1, year_change: -95.2 }
            };
            
            // Add demo data for all categories
            Object.keys(FED_LIQUIDITY_CATEGORIES).forEach(category => {
                FED_LIQUIDITY_CATEGORIES[category].forEach(series => {
                    if (!demoData[series]) {
                        demoData[series] = {
                            name: series.replace(/_/g, ' '),
                            value: Math.random() * 100000,
                            date: "2025-09-03",
                            week_change: (Math.random() - 0.5) * 10,
                            month_change: (Math.random() - 0.5) * 15,
                            quarter_change: (Math.random() - 0.5) * 20,
                            year_change: (Math.random() - 0.5) * 30
                        };
                    }
                });
            });
            
            allIndicatorData = demoData;
            
            // Update display
            updateHeaderStats();
            filterAndDisplayIndicators();
            
            document.getElementById('totalIndicators').textContent = Object.keys(allIndicatorData).length;
            
            // Add demo notice to grid
            const grid = document.getElementById('indicatorsGrid');
            const notice = document.createElement('div');
            notice.style.gridColumn = '1 / -1';
            notice.innerHTML = `
                <div style="background: rgba(255, 170, 0, 0.1); border: 1px solid #ffaa00; padding: 1rem; border-radius: 8px; margin-bottom: 1rem;">
                    <strong>Demo Mode:</strong> Showing sample data structure. For real data, see instructions above or access the API directly.
                </div>
            `;
            grid.prepend(notice);
        }
        
        // Load percentage changes for all key indicators
        async function loadPercentageChanges() {
            // Implementation remains the same but with better error handling
            const keySeriesList = [
                'WRBWFRBL', 'WALCL', 'WCURCIR', 'WTREGEN', 'RRPONTSYD',
                'TOTRESNS', 'WSHOTSL', 'WLCFLL', 'BOGMBASE', 'RESPPANWW'
            ];
            
            for (const series of keySeriesList) {
                try {
                    const changesResponse = await fetch(
                        `${FED_API_URL}/?action=changes&series=${series}&period=all`,
                        { mode: 'cors' }
                    );
                    
                    if (changesResponse.ok) {
                        const changesData = await changesResponse.json();
                        
                        if (!changesData.error) {
                            if (!allIndicatorData[series]) {
                                allIndicatorData[series] = {};
                            }
                            
                            allIndicatorData[series] = {
                                ...allIndicatorData[series],
                                name: changesData.name || allIndicatorData[series]?.name || series,
                                value: changesData.latest_value,
                                date: changesData.latest_date,
                                week_change: changesData.week_change?.percentage || 0,
                                month_change: changesData.month_change?.percentage || 0,
                                quarter_change: changesData.quarter_change?.percentage || 0,
                                year_change: changesData.year_change?.percentage || 0
                            };
                        }
                    }
                } catch (error) {
                    console.log(`Could not load changes for ${series}:`, error.message);
                }
            }
        }
        
        // Update header statistics
        function updateHeaderStats() {
            // Fed Balance Sheet (WALCL)
            if (allIndicatorData.WALCL) {
                const value = allIndicatorData.WALCL.value;
                const formatted = value ? `$${(value / 1000000).toFixed(2)}T` : '-';
                document.getElementById('fedBalance').textContent = formatted;
            }
            
            // Reserve Balances (WRBWFRBL)
            if (allIndicatorData.WRBWFRBL) {
                const value = allIndicatorData.WRBWFRBL.value;
                const formatted = value ? `$${(value / 1000000).toFixed(2)}T` : '-';
                document.getElementById('reserveBalances').textContent = formatted;
            }
            
            // Overnight RRP (RRPONTSYD)
            if (allIndicatorData.RRPONTSYD) {
                const value = allIndicatorData.RRPONTSYD.value;
                const formatted = value ? `$${value.toFixed(0)}B` : '-';
                document.getElementById('overnightRRP').textContent = formatted;
            }
        }
        
        // Filter and display indicators based on category and search
        function filterAndDisplayIndicators() {
            const grid = document.getElementById('indicatorsGrid');
            
            // Clear existing content except for demo notice
            const existingNotice = grid.querySelector('div[style*="Demo Mode"]');
            grid.innerHTML = '';
            if (existingNotice) {
                grid.appendChild(existingNotice.parentElement);
            }
            
            if (currentCategory === 'all') {
                // Show all indicators grouped by category
                Object.keys(FED_LIQUIDITY_CATEGORIES).forEach(category => {
                    const categoryIndicators = FED_LIQUIDITY_CATEGORIES[category];
                    
                    // Add category header
                    const header = document.createElement('div');
                    header.className = 'category-header';
                    header.textContent = getCategoryDisplayName(category);
                    grid.appendChild(header);
                    
                    // Add indicators for this category
                    categoryIndicators.forEach(series => {
                        if (shouldShowIndicator(series)) {
                            const card = createIndicatorCard(series);
                            if (card) grid.appendChild(card);
                        }
                    });
                });
            } else {
                // Show specific category
                const categoryIndicators = FED_LIQUIDITY_CATEGORIES[currentCategory] || [];
                categoryIndicators.forEach(series => {
                    if (shouldShowIndicator(series)) {
                        const card = createIndicatorCard(series);
                        if (card) grid.appendChild(card);
                    }
                });
            }
            
            if (grid.children.length === 0 || (grid.children.length === 1 && existingNotice)) {
                const noDataDiv = document.createElement('div');
                noDataDiv.style.gridColumn = '1 / -1';
                noDataDiv.style.textAlign = 'center';
                noDataDiv.style.padding = '2rem';
                noDataDiv.textContent = 'No indicators found matching your criteria.';
                grid.appendChild(noDataDiv);
            }
        }
        
        // Check if indicator should be shown based on search
        function shouldShowIndicator(series) {
            if (!searchTerm) return true;
            
            const data = allIndicatorData[series];
            if (!data) return false;
            
            return series.toLowerCase().includes(searchTerm) ||
                   data.name.toLowerCase().includes(searchTerm);
        }
        
        // Create indicator card element
        function createIndicatorCard(series) {
            const data = allIndicatorData[series];
            if (!data) return null;
            
            const card = document.createElement('div');
            card.className = 'indicator-card';
            
            // Format value
            let formattedValue = '-';
            if (data.value !== null && data.value !== undefined) {
                if (series.includes('WALCL') || series.includes('BALANCE') || 
                    series.includes('WRBWFRBL') || series.includes('TOTRESNS')) {
                    // Large values in trillions
                    formattedValue = `$${(data.value / 1000000).toFixed(3)}T`;
                } else if (series.includes('RATE') || series.includes('DGS')) {
                    // Rates as percentages
                    formattedValue = `${data.value.toFixed(3)}%`;
                } else if (data.value > 1000000) {
                    // Large values in trillions
                    formattedValue = `$${(data.value / 1000000).toFixed(3)}T`;
                } else if (data.value > 1000) {
                    // Values in billions
                    formattedValue = `$${(data.value / 1000).toFixed(1)}B`;
                } else {
                    formattedValue = data.value.toFixed(2);
                }
            }
            
            card.innerHTML = `
                <div class="indicator-header">
                    <div class="indicator-title">${data.name || series}</div>
                    <div class="indicator-symbol">${series}</div>
                </div>
                <div class="indicator-value">${formattedValue}</div>
                <div class="indicator-date">Latest: ${data.date || 'N/A'}</div>
                <div class="changes-grid">
                    <div class="change-item">
                        <div class="change-period">Week</div>
                        <div class="change-value ${getChangeClass(data.week_change)}">
                            ${formatChange(data.week_change)}
                        </div>
                    </div>
                    <div class="change-item">
                        <div class="change-period">Month</div>
                        <div class="change-value ${getChangeClass(data.month_change)}">
                            ${formatChange(data.month_change)}
                        </div>
                    </div>
                    <div class="change-item">
                        <div class="change-period">Quarter</div>
                        <div class="change-value ${getChangeClass(data.quarter_change)}">
                            ${formatChange(data.quarter_change)}
                        </div>
                    </div>
                    <div class="change-item">
                        <div class="change-period">Year</div>
                        <div class="change-value ${getChangeClass(data.year_change)}">
                            ${formatChange(data.year_change)}
                        </div>
                    </div>
                </div>
            `;
            
            return card;
        }
        
        // Get category display name
        function getCategoryDisplayName(category) {
            const names = {
                'reserves': 'üè¶ RESERVES',
                'currency': 'üíµ CURRENCY',
                'treasury_account': 'üèõÔ∏è TREASURY ACCOUNT',
                'repo_operations': 'üîÑ REPO OPERATIONS',
                'securities': 'üìä SECURITIES',
                'lending_facilities': 'üí∞ LENDING FACILITIES',
                'emergency_programs': 'üö® EMERGENCY PROGRAMS',
                'balance_sheet': 'üìà BALANCE SHEET',
                'other_assets': 'üì¶ OTHER ASSETS'
            };
            return names[category] || category.toUpperCase();
        }
        
        // Format percentage change
        function formatChange(change) {
            if (change === null || change === undefined || change === 0) {
                return '0.00%';
            }
            const sign = change > 0 ? '+' : '';
            return `${sign}${change.toFixed(2)}%`;
        }
        
        // Get CSS class for change value
        function getChangeClass(change) {
            if (change === null || change === undefined) return 'neutral';
            if (change > 0) return 'positive';
            if (change < 0) return 'negative';
            return 'neutral';
        }
        
        // Update status indicator
        function updateStatus(status, text) {
            const statusDot = document.getElementById('apiStatus');
            const statusText = document.getElementById('statusText');
            
            statusDot.className = `status-dot ${status}`;
            statusText.textContent = text;
        }
        
        // Setup auto-refresh (twice weekly)
        function setupAutoRefresh() {
            // Clear existing interval if any
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
            }
            
            // Check every hour if it's time to refresh
            autoRefreshInterval = setInterval(() => {
                const now = new Date();
                const day = now.getDay();
                const hour = now.getHours();
                
                // Refresh on Wednesday (3) and Saturday (6) at 9 AM
                if ((day === 3 || day === 6) && hour === 9) {
                    console.log('Auto-refreshing data...');
                    loadAllData();
                }
            }, 3600000); // Check every hour
        }
        
        // Initialize dashboard on page load
        document.addEventListener('DOMContentLoaded', initDashboard);
    </script>
</body>
</html>
