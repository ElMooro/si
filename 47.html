<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Federal Reserve Liquidity Dashboard - Live Data</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #1a1f3a 100%);
            color: #e0e0e0;
            min-height: 100vh;
            padding: 20px;
        }

        .dashboard {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
            backdrop-filter: blur(10px);
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 15px;
        }

        .header h1 {
            font-size: 28px;
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .status-bar {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 15px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            font-size: 14px;
        }

        .status-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-indicator.live {
            background: #00ff88;
        }

        .status-indicator.error {
            background: #ff4757;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .refresh-btn {
            padding: 10px 20px;
            background: linear-gradient(90deg, #4facfe 0%, #00f2fe 100%);
            border: none;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.2s;
        }

        .refresh-btn:hover {
            transform: scale(1.05);
        }

        .refresh-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .summary-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
            transition: transform 0.2s, border-color 0.2s;
        }

        .metric-card:hover {
            transform: translateY(-5px);
            border-color: rgba(79, 172, 254, 0.5);
        }

        .metric-label {
            font-size: 12px;
            color: #888;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 8px;
        }

        .metric-value {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 8px;
            background: linear-gradient(90deg, #fff 0%, #e0e0e0 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .metric-change {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-top: 10px;
        }

        .change-item {
            font-size: 13px;
            padding: 4px 8px;
            border-radius: 4px;
            background: rgba(255, 255, 255, 0.05);
        }

        .change-positive {
            color: #00ff88;
        }

        .change-negative {
            color: #ff4757;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 10px;
            overflow-x: auto;
        }

        .tab {
            padding: 10px 20px;
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 8px 8px 0 0;
            color: #888;
            cursor: pointer;
            transition: all 0.2s;
            white-space: nowrap;
        }

        .tab:hover {
            color: #fff;
            border-color: rgba(79, 172, 254, 0.5);
        }

        .tab.active {
            background: rgba(79, 172, 254, 0.1);
            color: #4facfe;
            border-color: #4facfe;
        }

        .tab-content {
            display: none;
            animation: fadeIn 0.3s;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .series-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .series-item {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.08);
            border-radius: 8px;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }

        .series-item:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(79, 172, 254, 0.3);
        }

        .series-info {
            flex: 1;
        }

        .series-code {
            font-size: 12px;
            color: #4facfe;
            font-weight: 600;
            margin-bottom: 4px;
        }

        .series-name {
            font-size: 13px;
            color: #aaa;
        }

        .series-value {
            text-align: right;
        }

        .series-amount {
            font-size: 18px;
            font-weight: 600;
            color: #fff;
        }

        .series-date {
            font-size: 11px;
            color: #666;
            margin-top: 4px;
        }

        .loading {
            text-align: center;
            padding: 40px;
            font-size: 18px;
            color: #4facfe;
        }

        .error {
            background: rgba(255, 71, 87, 0.1);
            border: 1px solid rgba(255, 71, 87, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            color: #ff4757;
        }

        .auto-update-info {
            background: rgba(79, 172, 254, 0.1);
            border: 1px solid rgba(79, 172, 254, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
        }

        .percentage-table {
            width: 100%;
            margin-top: 20px;
            border-collapse: collapse;
        }

        .percentage-table th,
        .percentage-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .percentage-table th {
            background: rgba(255, 255, 255, 0.03);
            font-size: 12px;
            text-transform: uppercase;
            letter-spacing: 1px;
            color: #666;
        }

        .percentage-table td {
            font-size: 14px;
        }

        .loader {
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            border-top: 3px solid #4facfe;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                text-align: center;
            }
            
            .metric-value {
                font-size: 24px;
            }
            
            .tabs {
                flex-wrap: wrap;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard">
        <div class="header">
            <h1>üèõÔ∏è Federal Reserve Liquidity Dashboard</h1>
            <div class="status-bar">
                <div class="status-item">
                    <div class="status-indicator live" id="statusIndicator"></div>
                    <span id="statusText">Connecting...</span>
                </div>
                <div class="status-item">
                    <span id="lastUpdate">Never</span>
                </div>
                <button class="refresh-btn" onclick="refreshData()">üîÑ Refresh</button>
            </div>
        </div>

        <div class="auto-update-info">
            üìÖ Auto-updates: Monday, Wednesday, Friday at 9:00 AM ET | Next: <span id="nextUpdate"></span>
        </div>

        <div id="summarySection" class="summary-grid">
            <div class="loading">
                <div class="loader"></div>
                Loading Fed data via proxy...
            </div>
        </div>

        <div class="tabs">
            <div class="tab active" onclick="switchTab('changes')">üìä Percentage Changes</div>
            <div class="tab" onclick="switchTab('reserves')">üí∞ Reserves</div>
            <div class="tab" onclick="switchTab('currency')">üíµ Currency</div>
            <div class="tab" onclick="switchTab('treasury')">üè¶ Treasury</div>
            <div class="tab" onclick="switchTab('repo')">üîÑ Repo Operations</div>
            <div class="tab" onclick="switchTab('securities')">üìà Securities</div>
            <div class="tab" onclick="switchTab('lending')">üí≥ Lending</div>
            <div class="tab" onclick="switchTab('balance')">‚öñÔ∏è Balance Sheet</div>
            <div class="tab" onclick="switchTab('all')">üìã All Series</div>
        </div>

        <div id="changes" class="tab-content active">
            <h2 style="margin-bottom: 20px;">üìä Key Metric Percentage Changes</h2>
            <div id="changesContent">
                <div class="loading">Loading percentage changes for all key indicators...</div>
            </div>
        </div>

        <div id="reserves" class="tab-content">
            <h2 style="margin-bottom: 20px;">üí∞ Reserve Indicators - 6 Series</h2>
            <p style="color: #888; margin-bottom: 15px;">WRBWFRBL, RESBALNS, RESBALNSW, REQRESNS, EXCSRESNS, TOTRESNS</p>
            <div id="reservesContent" class="series-grid"></div>
        </div>

        <div id="currency" class="tab-content">
            <h2 style="margin-bottom: 20px;">üíµ Currency Indicators - 3 Series</h2>
            <p style="color: #888; margin-bottom: 15px;">WCURCIR, CURRCIR, BOGMBBM</p>
            <div id="currencyContent" class="series-grid"></div>
        </div>

        <div id="treasury" class="tab-content">
            <h2 style="margin-bottom: 20px;">üè¶ Treasury Account - 2 Series</h2>
            <p style="color: #888; margin-bottom: 15px;">WTREGEN, TREASURY</p>
            <div id="treasuryContent" class="series-grid"></div>
        </div>

        <div id="repo" class="tab-content">
            <h2 style="margin-bottom: 20px;">üîÑ Repo Operations - 6 Series</h2>
            <p style="color: #888; margin-bottom: 15px;">RRPONTSYD, RPONTSYD, WREPODEL, WREPOFOR, H41RESPPREPO, H41RESPPFIMA</p>
            <div id="repoContent" class="series-grid"></div>
        </div>

        <div id="securities" class="tab-content">
            <h2 style="margin-bottom: 20px;">üìà Securities Holdings - 14 Series</h2>
            <p style="color: #888; margin-bottom: 15px;">WALCL, WSHOTSL, WSHOTS, WSHOMCB, TREAST, MBST, and more...</p>
            <div id="securitiesContent" class="series-grid"></div>
        </div>

        <div id="lending" class="tab-content">
            <h2 style="margin-bottom: 20px;">üí≥ Lending Facilities - 7 Series</h2>
            <p style="color: #888; margin-bottom: 15px;">WLCFLL, WPCREDIT, DISCBORR, H41RESPPBTFP, and more...</p>
            <div id="lendingContent" class="series-grid"></div>
        </div>

        <div id="balance" class="tab-content">
            <h2 style="margin-bottom: 20px;">‚öñÔ∏è Balance Sheet Items - 4 Series</h2>
            <p style="color: #888; margin-bottom: 15px;">RESPPANWW, BOGMBASE, WOTHLL, BOGMBBR</p>
            <div id="balanceContent" class="series-grid"></div>
        </div>

        <div id="all" class="tab-content">
            <h2 style="margin-bottom: 20px;">üìã All 62 Fed Liquidity Indicators with Percentage Changes</h2>
            <div id="allContent" class="series-grid"></div>
        </div>
    </div>

    <script>
        // Using CORS proxy to bypass CORS restrictions
        const API_URL = 'https://nmkverrwjnxsmgnogzckkoyuce0bqxyk.lambda-url.us-east-1.on.aws/';
        const PROXY_URL = 'https://corsproxy.io/?';
        let isLoading = false;

        // Helper function to make API calls through proxy
        function getProxyUrl(endpoint) {
            return PROXY_URL + encodeURIComponent(API_URL + endpoint);
        }

        // Format large numbers
        function formatValue(value, seriesId) {
            if (value === null || value === undefined) return 'N/A';
            
            const num = parseFloat(value);
            if (isNaN(num)) return 'N/A';
            
            // Different series use different units
            const billionSeries = ['WCURCIR', 'WTREGEN', 'RRPONTSYD', 'TOTRESNS', 'CURRCIR'];
            const isInBillions = billionSeries.includes(seriesId);
            
            if (isInBillions) {
                if (num >= 1000) {
                    return '$' + (num / 1000).toFixed(2) + 'T';
                } else {
                    return '$' + num.toFixed(1) + 'B';
                }
            } else {
                if (num >= 1000000) {
                    return '$' + (num / 1000000).toFixed(2) + 'T';
                } else if (num >= 1000) {
                    return '$' + (num / 1000).toFixed(2) + 'B';
                } else {
                    return '$' + num.toFixed(1) + 'M';
                }
            }
        }

        // Format percentage
        function formatPercentage(value) {
            if (value === null || value === undefined) return 'N/A';
            const num = parseFloat(value);
            if (isNaN(num)) return 'N/A';
            
            const formatted = num.toFixed(2) + '%';
            if (num > 0) {
                return `<span class="change-positive">+${formatted}</span>`;
            } else if (num < 0) {
                return `<span class="change-negative">${formatted}</span>`;
            }
            return formatted;
        }

        // Calculate next update time
        function getNextUpdateTime() {
            const now = new Date();
            const days = [1, 3, 5]; // Monday, Wednesday, Friday
            const hour = 9; // 9 AM ET
            
            let nextUpdate = new Date();
            nextUpdate.setHours(hour, 0, 0, 0);
            
            while (!days.includes(nextUpdate.getDay()) || nextUpdate <= now) {
                nextUpdate.setDate(nextUpdate.getDate() + 1);
            }
            
            return nextUpdate.toLocaleString('en-US', {
                weekday: 'long',
                month: 'short',
                day: 'numeric',
                hour: 'numeric',
                minute: '2-digit',
                timeZoneName: 'short'
            });
        }

        // Load summary data
        async function loadSummary() {
            try {
                const response = await fetch(getProxyUrl('?series=summary'));
                const data = await response.json();
                
                if (data.metrics) {
                    const summaryHTML = data.metrics.map(metric => `
                        <div class="metric-card">
                            <div class="metric-label">${metric.name}</div>
                            <div class="metric-value">${formatValue(metric.latest_value, metric.series)}</div>
                            <div class="series-date">Last: ${metric.latest_date}</div>
                            <div class="metric-change">
                                <div class="change-item">
                                    Week: ${formatPercentage(metric.week_change)}
                                </div>
                                <div class="change-item">
                                    ${metric.cached ? 'üì¶ Cached' : 'üîÑ Live'}
                                </div>
                            </div>
                        </div>
                    `).join('');
                    
                    document.getElementById('summarySection').innerHTML = summaryHTML;
                    updateStatus('live', 'Connected via Proxy');
                }
            } catch (error) {
                console.error('Error loading summary:', error);
                document.getElementById('summarySection').innerHTML = `
                    <div class="error">Error loading data: ${error.message}</div>
                `;
                updateStatus('error', 'Connection Error');
            }
        }

        // Load percentage changes
        async function loadChanges() {
            try {
                const response = await fetch(getProxyUrl('?action=changes&series=all&period=all'));
                const data = await response.json();
                
                if (data.changes) {
                    const tableHTML = `
                        <table class="percentage-table">
                            <thead>
                                <tr>
                                    <th>Metric</th>
                                    <th>Current Value</th>
                                    <th>Week</th>
                                    <th>Month</th>
                                    <th>Quarter</th>
                                    <th>Year</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${data.changes.map(item => `
                                    <tr>
                                        <td>
                                            <div class="series-code">${item.series_id}</div>
                                            <div class="series-name">${item.name}</div>
                                        </td>
                                        <td>${formatValue(item.latest_value, item.series_id)}</td>
                                        <td>${formatPercentage(item.week_change?.percentage)}</td>
                                        <td>${formatPercentage(item.month_change?.percentage)}</td>
                                        <td>${formatPercentage(item.quarter_change?.percentage)}</td>
                                        <td>${formatPercentage(item.year_change?.percentage)}</td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    `;
                    
                    document.getElementById('changesContent').innerHTML = tableHTML;
                }
            } catch (error) {
                console.error('Error loading changes:', error);
                document.getElementById('changesContent').innerHTML = `
                    <div class="error">Error loading changes: ${error.message}</div>
                `;
            }
        }

        // Load category data
        async function loadCategory(category, elementId) {
            try {
                const response = await fetch(getProxyUrl(`?category=${category}`));
                const data = await response.json();
                
                if (data.data) {
                    const html = data.data.map(series => {
                        if (series.latest) {
                            return `
                                <div class="series-item">
                                    <div class="series-info">
                                        <div class="series-code">${series.series_id}</div>
                                        <div class="series-name">${series.name}</div>
                                    </div>
                                    <div class="series-value">
                                        <div class="series-amount">${formatValue(series.latest.value, series.series_id)}</div>
                                        <div class="series-date">${series.latest.date}</div>
                                    </div>
                                </div>
                            `;
                        }
                        return '';
                    }).join('');
                    
                    document.getElementById(elementId).innerHTML = html || '<div class="error">No data available</div>';
                }
            } catch (error) {
                console.error(`Error loading ${category}:`, error);
                document.getElementById(elementId).innerHTML = `
                    <div class="error">Error loading ${category}: ${error.message}</div>
                `;
            }
        }

        // Load all series
        async function loadAllSeries() {
            try {
                const response = await fetch(getProxyUrl('?series=all'));
                const data = await response.json();
                
                if (data.series) {
                    const html = Object.entries(data.series).map(([code, name]) => `
                        <div class="series-item">
                            <div class="series-info">
                                <div class="series-code">${code}</div>
                                <div class="series-name">${name}</div>
                            </div>
                        </div>
                    `).join('');
                    
                    document.getElementById('allContent').innerHTML = html;
                }
            } catch (error) {
                console.error('Error loading all series:', error);
                document.getElementById('allContent').innerHTML = `
                    <div class="error">Error loading series: ${error.message}</div>
                `;
            }
        }

        // Switch tabs
        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
            
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.getElementById(tabName).classList.add('active');
            
            // Load data for the tab if needed
            if (tabName === 'reserves' && !document.getElementById('reservesContent').innerHTML) {
                loadCategory('reserves', 'reservesContent');
            } else if (tabName === 'currency' && !document.getElementById('currencyContent').innerHTML) {
                loadCategory('currency', 'currencyContent');
            } else if (tabName === 'treasury' && !document.getElementById('treasuryContent').innerHTML) {
                loadCategory('treasury_account', 'treasuryContent');
            } else if (tabName === 'repo' && !document.getElementById('repoContent').innerHTML) {
                loadCategory('repo_operations', 'repoContent');
            } else if (tabName === 'securities' && !document.getElementById('securitiesContent').innerHTML) {
                loadCategory('securities', 'securitiesContent');
            } else if (tabName === 'lending' && !document.getElementById('lendingContent').innerHTML) {
                loadCategory('lending_facilities', 'lendingContent');
            } else if (tabName === 'balance' && !document.getElementById('balanceContent').innerHTML) {
                loadCategory('balance_sheet', 'balanceContent');
            } else if (tabName === 'all' && !document.getElementById('allContent').innerHTML) {
                loadAllSeries();
            }
        }

        // Refresh all data
        async function refreshData() {
            if (isLoading) return;
            
            isLoading = true;
            const btn = document.querySelector('.refresh-btn');
            btn.disabled = true;
            btn.textContent = '‚è≥ Loading...';
            
            try {
                await Promise.all([
                    loadSummary(),
                    loadChanges()
                ]);
                
                // Clear cached category data to force reload
                ['reservesContent', 'currencyContent', 'treasuryContent', 'repoContent', 
                 'securitiesContent', 'lendingContent', 'balanceContent', 'allContent'].forEach(id => {
                    document.getElementById(id).innerHTML = '';
                });
                
                document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString();
                
            } catch (error) {
                console.error('Error refreshing data:', error);
                updateStatus('error', 'Connection Error');
            } finally {
                isLoading = false;
                btn.disabled = false;
                btn.textContent = 'üîÑ Refresh';
            }
        }

        // Update status indicator
        function updateStatus(type, text) {
            const indicator = document.getElementById('statusIndicator');
            const statusText = document.getElementById('statusText');
            
            indicator.className = 'status-indicator ' + type;
            statusText.textContent = text;
        }

        // Check if it's time for auto-update
        function checkAutoUpdate() {
            const now = new Date();
            const day = now.getDay();
            const hour = now.getHours();
            const minute = now.getMinutes();
            
            if ([1, 3, 5].includes(day) && hour === 9 && minute === 0) {
                console.log('Auto-update triggered');
                refreshData();
            }
        }

        // Initialize dashboard
        async function init() {
            document.getElementById('nextUpdate').textContent = getNextUpdateTime();
            
            await refreshData();
            
            // Set up auto-update check every minute
            setInterval(() => {
                checkAutoUpdate();
            }, 60000);
            
            // Auto-refresh every 5 minutes
            setInterval(() => {
                refreshData();
            }, 300000);
        }

        // Start the dashboard
        window.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
