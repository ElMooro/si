<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Options Flow & Sentiment â€” JustHodl.AI</title>
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 32 32'><text y='28' font-size='28'>ðŸ“Š</text></svg>">
<style>
:root{--bg:#0a0b0f;--bg2:#12131a;--bg3:#1a1b25;--bg4:#22232f;--border:#2a2b38;--tx:#e2e4ea;--tx2:#9395a5;--tx3:#6b6d7e;--green:#00e68a;--red:#ff4757;--amber:#ffb347;--blue:#4facfe;--purple:#a78bfa;--cyan:#22d3ee;--pink:#f472b6;--gold:#fbbf24;--orange:#fb923c;--card:rgba(18,19,26,0.85);--glow:rgba(0,230,138,0.08);--glow-r:rgba(255,71,87,0.08)}
*{margin:0;padding:0;box-sizing:border-box}
html{font-size:13px;scroll-behavior:smooth}
body{font-family:'SF Pro Display',-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg);color:var(--tx);overflow-x:hidden;min-height:100vh}
.topnav{position:sticky;top:0;z-index:999;background:rgba(10,11,15,0.92);backdrop-filter:blur(20px);border-bottom:1px solid var(--border);padding:0 20px;display:flex;align-items:center;height:48px;gap:20px}
.topnav .logo{font-weight:800;font-size:16px;background:linear-gradient(135deg,var(--green),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent;text-decoration:none;white-space:nowrap}
.topnav .nav-links{display:flex;gap:4px;flex:1;overflow-x:auto}
.topnav .nav-links::-webkit-scrollbar{display:none}
.topnav a.nl{color:var(--tx2);text-decoration:none;font-size:12px;padding:6px 12px;border-radius:6px;white-space:nowrap;transition:all 0.2s}
.topnav a.nl:hover{color:var(--tx);background:var(--bg3)}
.topnav a.nl.active{color:var(--green);background:rgba(0,230,138,0.1)}
.topnav .status{font-size:11px;color:var(--tx3);display:flex;align-items:center;gap:6px;white-space:nowrap}
.topnav .status .dot{width:7px;height:7px;border-radius:50%;background:var(--green);animation:pulse-dot 2s infinite}
@keyframes pulse-dot{0%,100%{opacity:1}50%{opacity:0.3}}
.hero{padding:24px 20px 16px;max-width:1600px;margin:0 auto}
.hero h1{font-size:22px;font-weight:800;letter-spacing:-0.5px;margin-bottom:4px}
.hero h1 span{background:linear-gradient(135deg,var(--green),var(--cyan));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.hero .sub{color:var(--tx2);font-size:12px}
.hero .badges{display:flex;gap:8px;margin-top:10px;flex-wrap:wrap}
.hero .badge{font-size:10px;font-weight:700;padding:4px 10px;border-radius:20px;text-transform:uppercase;letter-spacing:0.5px}
.gauges-row{display:grid;grid-template-columns:repeat(auto-fit,minmax(200px,1fr));gap:12px;padding:0 20px 16px;max-width:1600px;margin:0 auto}
.gauge-card{background:var(--card);border:1px solid var(--border);border-radius:12px;padding:16px;position:relative;overflow:hidden}
.gauge-card .gc-label{font-size:10px;color:var(--tx3);text-transform:uppercase;letter-spacing:1px;font-weight:700;margin-bottom:8px}
.gauge-card .gc-value{font-size:28px;font-weight:800;letter-spacing:-1px}
.gauge-card .gc-sub{font-size:11px;color:var(--tx2);margin-top:4px}
.gauge-card .gc-bar{height:4px;background:var(--bg);border-radius:2px;margin-top:10px;overflow:hidden}
.gauge-card .gc-bar-fill{height:100%;border-radius:2px;transition:width 1s ease}
.tabs{display:flex;gap:2px;padding:0 20px;max-width:1600px;margin:0 auto 16px;overflow-x:auto;-webkit-overflow-scrolling:touch}
.tabs::-webkit-scrollbar{display:none}
.tab-btn{padding:10px 18px;font-size:12px;font-weight:600;color:var(--tx2);background:transparent;border:none;cursor:pointer;border-radius:8px 8px 0 0;border-bottom:2px solid transparent;white-space:nowrap;transition:all 0.2s}
.tab-btn:hover{color:var(--tx);background:var(--bg2)}
.tab-btn.active{color:var(--green);border-bottom-color:var(--green);background:var(--bg2)}
.panel{display:none;padding:0 20px;max-width:1600px;margin:0 auto}
.panel.active{display:block}
.sec-hdr{display:flex;align-items:center;gap:10px;margin-bottom:14px;padding-bottom:8px;border-bottom:1px solid var(--border)}
.sec-hdr h2{font-size:15px;font-weight:700;letter-spacing:-0.3px}
.sec-hdr .sec-badge{font-size:9px;font-weight:700;padding:3px 8px;border-radius:4px;text-transform:uppercase;letter-spacing:0.5px}
.grid-2{display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-bottom:20px}
.grid-3{display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;margin-bottom:20px}
.grid-4{display:grid;grid-template-columns:repeat(4,1fr);gap:12px;margin-bottom:20px}
@media(max-width:1000px){.grid-2,.grid-3,.grid-4{grid-template-columns:1fr 1fr}}
@media(max-width:640px){.grid-2,.grid-3,.grid-4{grid-template-columns:1fr}}
.card{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:16px;transition:border-color 0.3s}
.card:hover{border-color:var(--bg4)}
.card .c-hdr{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}
.card .c-title{font-size:11px;color:var(--tx3);text-transform:uppercase;letter-spacing:0.8px;font-weight:700}
.card .c-signal{font-size:10px;font-weight:700;padding:2px 8px;border-radius:4px}
.card .c-value{font-size:24px;font-weight:800;letter-spacing:-0.5px}
.card .c-value.sm{font-size:18px}
.card .c-sub{font-size:11px;color:var(--tx2);margin-top:4px}
.card .c-row{display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px solid rgba(42,43,56,0.5)}
.card .c-row:last-child{border-bottom:none}
.card .c-row .c-label{font-size:11px;color:var(--tx2)}
.card .c-row .c-val{font-size:12px;font-weight:600}
.tbl-wrap{overflow-x:auto;margin-bottom:20px;border-radius:10px;border:1px solid var(--border);background:var(--card)}
table{width:100%;border-collapse:collapse;font-size:12px}
thead{background:var(--bg3)}
th{padding:10px 12px;text-align:left;font-weight:700;color:var(--tx2);text-transform:uppercase;font-size:10px;letter-spacing:0.5px;white-space:nowrap;border-bottom:1px solid var(--border)}
td{padding:8px 12px;border-bottom:1px solid rgba(42,43,56,0.3);white-space:nowrap}
tr:hover td{background:rgba(255,255,255,0.02)}
.ticker{font-weight:800;color:var(--cyan)}
.positive{color:var(--green)}
.negative{color:var(--red)}
.neutral{color:var(--tx2)}
.highlight{background:rgba(0,230,138,0.05)}
.mono{font-family:'SF Mono','Fira Code',monospace;font-size:11px}
.fg-gauge{display:flex;flex-direction:column;align-items:center;padding:24px}
.fg-circle{width:180px;height:180px;border-radius:50%;position:relative;display:flex;align-items:center;justify-content:center;flex-direction:column}
.fg-circle .fg-val{font-size:48px;font-weight:900;letter-spacing:-2px}
.fg-circle .fg-label{font-size:13px;font-weight:700;text-transform:uppercase;letter-spacing:1px;margin-top:2px}
.fg-components{display:grid;grid-template-columns:1fr 1fr;gap:8px;width:100%;margin-top:20px}
.fg-comp{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;background:var(--bg);border-radius:6px;border-left:3px solid}
.fg-comp .fc-name{font-size:11px;color:var(--tx2)}
.fg-comp .fc-score{font-size:13px;font-weight:700}
.mini-chart{width:100%;height:60px;position:relative;margin-top:8px}
.signal-card{background:var(--card);border:1px solid var(--border);border-radius:10px;padding:14px;margin-bottom:8px;border-left:4px solid}
.signal-card .sig-type{font-size:10px;font-weight:800;text-transform:uppercase;letter-spacing:1px;margin-bottom:4px}
.signal-card .sig-msg{font-size:12px;color:var(--tx);line-height:1.5}
.signal-card .sig-meta{display:flex;gap:12px;margin-top:8px;font-size:10px;color:var(--tx3)}
.signal-card .sig-conf{font-weight:700}
.news-item{padding:10px 0;border-bottom:1px solid rgba(42,43,56,0.3)}
.news-item:last-child{border-bottom:none}
.news-item .ni-title{font-size:12px;font-weight:600;color:var(--tx);cursor:pointer}
.news-item .ni-title:hover{color:var(--cyan)}
.news-item .ni-meta{font-size:10px;color:var(--tx3);margin-top:3px;display:flex;gap:8px}
.news-item .ni-sent{font-weight:700;padding:1px 6px;border-radius:3px;font-size:9px}
.heatmap{display:grid;grid-template-columns:repeat(auto-fill,minmax(80px,1fr));gap:4px;margin-bottom:20px}
.hm-cell{padding:10px 6px;border-radius:6px;text-align:center;cursor:pointer;transition:transform 0.2s}
.hm-cell:hover{transform:scale(1.05)}
.hm-cell .hm-tk{font-size:11px;font-weight:800}
.hm-cell .hm-val{font-size:10px;margin-top:2px}
.loading{display:flex;align-items:center;justify-content:center;padding:60px;flex-direction:column;gap:12px}
.spinner{width:32px;height:32px;border:3px solid var(--border);border-top:3px solid var(--green);border-radius:50%;animation:spin 0.8s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.loading-text{font-size:12px;color:var(--tx3)}
.footer{text-align:center;padding:24px 20px;color:var(--tx3);font-size:11px;border-top:1px solid var(--border);margin-top:40px}
.footer a{color:var(--cyan);text-decoration:none}
::-webkit-scrollbar{width:6px;height:6px}
::-webkit-scrollbar-track{background:var(--bg)}
::-webkit-scrollbar-thumb{background:var(--bg4);border-radius:3px}
</style>
</head>
<body>
<nav class="topnav">
<a href="index.html" class="logo">JustHodl.AI</a>
<div class="nav-links">
<a href="index.html" class="nl">Dashboard</a>
<a href="pro.html" class="nl">Pro Terminal</a>
<a href="charts.html" class="nl">Charts</a>
<a href="intelligence.html" class="nl">Intelligence</a>
<a href="flow.html" class="nl active">Options Flow</a>
</div>
<div class="status"><span class="dot"></span><span id="statusText">Connecting...</span></div>
</nav>
<div class="hero">
<h1>Options Flow & <span>Sentiment Intelligence</span></h1>
<div class="sub">Institutional-grade derivatives positioning â€¢ Fund flows â€¢ Market sentiment â€¢ Real-time data from CBOE, FRED, Polygon & AlphaVantage</div>
<div class="badges" id="heroBadges"></div>
</div>
<div class="gauges-row" id="gaugesRow"><div class="loading"><div class="spinner"></div><div class="loading-text">Loading market data...</div></div></div>
<div class="tabs" id="mainTabs">
<button class="tab-btn active" data-tab="overview" onclick="switchTab(this)">Overview</button>
<button class="tab-btn" data-tab="vix" onclick="switchTab(this)">VIX Complex</button>
<button class="tab-btn" data-tab="options" onclick="switchTab(this)">Options Flow</button>
<button class="tab-btn" data-tab="gamma" onclick="switchTab(this)">Gamma Exposure</button>
<button class="tab-btn" data-tab="flows" onclick="switchTab(this)">Fund Flows</button>
<button class="tab-btn" data-tab="sentiment" onclick="switchTab(this)">Sentiment</button>
<button class="tab-btn" data-tab="unusual" onclick="switchTab(this)">Unusual Activity</button>
<button class="tab-btn" data-tab="signals" onclick="switchTab(this)">Trading Signals</button>
<button class="tab-btn" data-tab="news" onclick="switchTab(this)">News Sentiment</button>
<button class="tab-btn" data-tab="internals" onclick="switchTab(this)">Market Internals</button>
</div>
<div class="panel active" id="p-overview"></div>
<div class="panel" id="p-vix"></div>
<div class="panel" id="p-options"></div>
<div class="panel" id="p-gamma"></div>
<div class="panel" id="p-flows"></div>
<div class="panel" id="p-sentiment"></div>
<div class="panel" id="p-unusual"></div>
<div class="panel" id="p-signals"></div>
<div class="panel" id="p-news"></div>
<div class="panel" id="p-internals"></div>
<div class="footer"><strong>JustHodl.AI</strong> â€” Options Flow & Sentiment Engine v1.0 | Data: FRED â€¢ Polygon â€¢ AlphaVantage â€¢ CBOE | Auto-refreshes every 5 min | Last update: <span id="lastUpdate">â€”</span> | <a href="pro.html">Back to Pro Terminal</a></div>
<script>
const API_URL='https://g65enkjk3uu4woaoy764ow3q340sppvg.lambda-url.us-east-1.on.aws/';
const S3_URL='https://justhodl-dashboard-live.s3.amazonaws.com/flow-data.json';
let DATA=null;
function fmt(n,dec=2){return n!=null?Number(n).toFixed(dec):'â€”'}
function fmtK(n){if(!n)return'â€”';if(Math.abs(n)>=1e9)return(n/1e9).toFixed(1)+'B';if(Math.abs(n)>=1e6)return(n/1e6).toFixed(1)+'M';if(Math.abs(n)>=1e3)return(n/1e3).toFixed(1)+'K';return fmt(n,0)}
function fmtPct(n){if(n==null)return'â€”';let s=Number(n).toFixed(2);return(n>0?'+':'')+s+'%'}
function clr(v,inv=false){if(v==null)return'var(--tx2)';let pos=inv?v<0:v>0;return pos?'var(--green)':(v<0==inv?'var(--red)':'var(--tx2)')}
function sentClr(s){if(s<=20)return'var(--red)';if(s<=35)return'#ef4444';if(s<=45)return'var(--amber)';if(s<=55)return'var(--tx2)';if(s<=65)return'#84cc16';if(s<=80)return'var(--green)';return'#16a34a'}
function badge(text,color){return'<span class="badge" style="background:'+color+'22;color:'+color+';border:1px solid '+color+'44">'+text+'</span>'}
function sigBadge(text,color){return'<span class="c-signal" style="background:'+color+'22;color:'+color+'">'+text+'</span>'}
function switchTab(el){document.querySelectorAll('.tab-btn').forEach(t=>t.classList.remove('active'));document.querySelectorAll('.panel').forEach(p=>p.classList.remove('active'));el.classList.add('active');document.getElementById('p-'+el.dataset.tab).classList.add('active')}
function sparkline(container,data,color='#00e68a'){if(!data||!data.length)return;let vals=data.map(d=>typeof d==='object'?d.value:d).filter(v=>v!=null);if(!vals.length)return;let canvas=document.createElement('canvas');canvas.width=container.offsetWidth||200;canvas.height=50;container.innerHTML='';container.appendChild(canvas);let ctx=canvas.getContext('2d');let w=canvas.width,h=canvas.height;let min=Math.min(...vals),max=Math.max(...vals);let range=max-min||1;ctx.beginPath();ctx.strokeStyle=color;ctx.lineWidth=1.5;vals.reverse();for(let i=0;i<vals.length;i++){let x=(i/(vals.length-1))*w;let y=h-((vals[i]-min)/range)*(h-4)-2;if(i===0)ctx.moveTo(x,y);else ctx.lineTo(x,y)}ctx.stroke();let last=vals.length-1;ctx.lineTo(w,h);ctx.lineTo(0,h);ctx.closePath();let grad=ctx.createLinearGradient(0,0,0,h);grad.addColorStop(0,color+'30');grad.addColorStop(1,color+'05');ctx.fillStyle=grad;ctx.fill()}
function renderGauges(d){let html='';let fg=d.sentiment?.composite||{};let fgScore=fg.score??50;let fgColor=sentClr(fgScore);html+='<div class="gauge-card" style="border-top:3px solid '+fgColor+'"><div class="gc-label">Fear & Greed Index</div><div class="gc-value" style="color:'+fgColor+'">'+fmt(fgScore,0)+'</div><div class="gc-sub">'+(fg.label||'N/A')+' â€” '+(fg.components||0)+' components</div><div class="gc-bar"><div class="gc-bar-fill" style="width:'+fgScore+'%;background:'+fgColor+'"></div></div></div>';let vix=d.vix_complex?.vix||{};let vixColor=vix.regime_color||'var(--blue)';html+='<div class="gauge-card" style="border-top:3px solid '+vixColor+'"><div class="gc-label">CBOE VIX</div><div class="gc-value" style="color:'+vixColor+'">'+fmt(vix.current,1)+'</div><div class="gc-sub">'+(vix.regime||'N/A')+' â€” '+fmtPct(vix.change_pct)+' today</div><div class="gc-bar"><div class="gc-bar-fill" style="width:'+Math.min(100,(vix.current||0)/50*100)+'%;background:'+vixColor+'"></div></div></div>';let pc=d.put_call||{};let pcColor=pc.pc_color||'var(--blue)';html+='<div class="gauge-card" style="border-top:3px solid '+pcColor+'"><div class="gc-label">Put/Call Ratio</div><div class="gc-value" style="color:'+pcColor+'">'+fmt(pc.total_put_call_ratio,3)+'</div><div class="gc-sub">'+(pc.pc_signal||'N/A')+' â€” Calls: '+fmtK(pc.total_call_volume)+' / Puts: '+fmtK(pc.total_put_volume)+'</div><div class="gc-bar"><div class="gc-bar-fill" style="width:'+Math.min(100,(pc.total_put_call_ratio||0)/2*100)+'%;background:'+pcColor+'"></div></div></div>';let gex=d.gamma_exposure||{};let gexColor=gex.color||'var(--blue)';html+='<div class="gauge-card" style="border-top:3px solid '+gexColor+'"><div class="gc-label">Gamma Exposure (GEX)</div><div class="gc-value" style="color:'+gexColor+'">'+fmtK(gex.total_gex)+'</div><div class="gc-sub">'+(gex.regime||'N/A')+'</div><div class="gc-bar"><div class="gc-bar-fill" style="width:50%;background:'+gexColor+'"></div></div></div>';let skew=d.skew||{};let skewColor=skew.color||'var(--blue)';html+='<div class="gauge-card" style="border-top:3px solid '+skewColor+'"><div class="gc-label">CBOE SKEW</div><div class="gc-value" style="color:'+skewColor+'">'+fmt(skew.current,0)+'</div><div class="gc-sub">'+(skew.signal||'N/A')+' â€” Pctl: '+fmt(skew.percentile_1y,0)+'%</div><div class="gc-bar"><div class="gc-bar-fill" style="width:'+Math.min(100,((skew.current||100)-100)/80*100)+'%;background:'+skewColor+'"></div></div></div>';let risk=d.fund_flows?.risk_appetite||{};let riskColor=risk.regime==='RISK_ON'?'var(--green)':(risk.regime==='RISK_OFF'?'var(--red)':'var(--amber)');html+='<div class="gauge-card" style="border-top:3px solid '+riskColor+'"><div class="gc-label">Risk Appetite</div><div class="gc-value" style="color:'+riskColor+'">'+(risk.regime||'N/A')+'</div><div class="gc-sub">Risk-On: '+fmt(risk.risk_on_score,1)+' | Risk-Off: '+fmt(risk.risk_off_score,1)+'</div><div class="gc-bar"><div class="gc-bar-fill" style="width:'+Math.min(100,Math.max(0,50+((risk.net_risk||0)*5)))+'%;background:'+riskColor+'"></div></div></div>';document.getElementById('gaugesRow').innerHTML=html}
function renderHeroBadges(d){let badges=[];let ts=d.vix_complex?.term_structure;if(ts)badges.push(badge(ts.state,ts.signal==='BULLISH'?'var(--green)':ts.signal==='BEARISH'?'var(--red)':'var(--amber)'));let rot=d.fund_flows?.sector_rotation?.rotation_signal;if(rot)badges.push(badge(rot.phase,rot.phase==='DEFENSIVE'?'var(--red)':'var(--cyan)'));let sig=d.trading_signals;if(sig&&sig.length)badges.push(badge(sig.length+' ACTIVE SIGNALS','var(--gold)'));let ua=d.unusual_activity;if(ua&&ua.length)badges.push(badge(ua.length+' UNUSUAL','var(--purple)'));document.getElementById('heroBadges').innerHTML=badges.join('')}
function renderOverview(d){let html='';let sigs=d.trading_signals||[];if(sigs.length){html+='<div class="sec-hdr"><h2>âš¡ Active Trading Signals</h2>'+sigBadge(sigs.length+' signals','var(--gold)')+'</div>';for(let s of sigs.slice(0,5)){let bColor=s.type.includes('BUY')?'var(--green)':s.type.includes('SELL')?'var(--red)':'var(--amber)';html+='<div class="signal-card" style="border-left-color:'+bColor+'"><div class="sig-type" style="color:'+bColor+'">'+s.type+' â€” '+s.source+'</div><div class="sig-msg">'+s.message+'</div><div class="sig-meta"><span class="sig-conf" style="color:'+bColor+'">Confidence: '+s.confidence+'%</span><span>Strength: '+s.strength+'</span></div></div>'}}html+='<div style="margin-top:20px"></div>';html+='<div class="grid-3">';let vix=d.vix_complex?.vix||{};html+='<div class="card"><div class="c-hdr"><span class="c-title">VIX Index</span>'+sigBadge(vix.regime||'â€”',vix.regime_color||'var(--blue)')+'</div><div class="c-value" style="color:'+(vix.regime_color||'var(--tx)')+'">'+fmt(vix.current,2)+'</div><div class="c-sub">Change: <span style="color:'+clr(vix.change)+'">'+fmtPct(vix.change_pct)+'</span> | 52W: '+fmt(vix.low_52w,1)+'â€“'+fmt(vix.high_52w,1)+'</div><div class="c-row"><span class="c-label">SMA(10)</span><span class="c-val">'+fmt(vix.sma_10,1)+'</span></div><div class="c-row"><span class="c-label">SMA(20)</span><span class="c-val">'+fmt(vix.sma_20,1)+'</span></div><div class="c-row"><span class="c-label">Percentile</span><span class="c-val">'+fmt(vix.percentile_1y,0)+'%</span></div><div class="c-row"><span class="c-label">Z-Score</span><span class="c-val">'+fmt(vix.zscore,2)+'</span></div><div class="mini-chart" id="mc-vix"></div></div>';let ts=d.vix_complex?.term_structure||{};let tsColor=ts.signal==='BULLISH'?'var(--green)':ts.signal==='BEARISH'?'var(--red)':'var(--amber)';html+='<div class="card"><div class="c-hdr"><span class="c-title">Term Structure</span>'+sigBadge(ts.state||'â€”',tsColor)+'</div><div class="c-value" style="color:'+tsColor+'">'+fmt(ts.vix_vix3m_ratio,4)+'</div><div class="c-sub">'+(ts.description||'')+'</div><div class="c-row"><span class="c-label">VIX/VIX3M Spread</span><span class="c-val">'+fmt(ts.spread,2)+'</span></div><div class="c-row"><span class="c-label">Signal</span><span class="c-val" style="color:'+tsColor+'">'+(ts.signal||'â€”')+'</span></div></div>';let skew=d.skew||{};html+='<div class="card"><div class="c-hdr"><span class="c-title">CBOE SKEW</span>'+sigBadge(skew.signal||'â€”',skew.color||'var(--blue)')+'</div><div class="c-value" style="color:'+(skew.color||'var(--tx)')+'">'+fmt(skew.current,1)+'</div><div class="c-sub">'+(skew.description||'')+'</div><div class="c-row"><span class="c-label">SMA(20)</span><span class="c-val">'+fmt(skew.sma_20,1)+'</span></div><div class="c-row"><span class="c-label">Percentile</span><span class="c-val">'+fmt(skew.percentile_1y,0)+'%</span></div><div class="c-row"><span class="c-label">52W Range</span><span class="c-val">'+fmt(skew.low_52w,0)+'â€“'+fmt(skew.high_52w,0)+'</span></div><div class="mini-chart" id="mc-skew"></div></div>';html+='</div>';let flows=d.fund_flows?.etf_flows||[];if(flows.length){html+='<div class="sec-hdr"><h2>ðŸ’° Fund Flow Heatmap</h2></div><div class="heatmap">';for(let f of flows){let bg,tx;let chg=f.change_5d||0;if(chg>3){bg='rgba(0,230,138,0.3)';tx='var(--green)'}else if(chg>1){bg='rgba(0,230,138,0.15)';tx='var(--green)'}else if(chg>0){bg='rgba(0,230,138,0.08)';tx='#86efac'}else if(chg>-1){bg='rgba(255,71,87,0.08)';tx='#fca5a5'}else if(chg>-3){bg='rgba(255,71,87,0.15)';tx='var(--red)'}else{bg='rgba(255,71,87,0.3)';tx='var(--red)'}html+='<div class="hm-cell" style="background:'+bg+'" title="'+f.name+': '+fmtPct(f.change_5d)+' 5d"><div class="hm-tk" style="color:'+tx+'">'+f.ticker+'</div><div class="hm-val" style="color:'+tx+'">'+fmtPct(f.change_5d)+'</div></div>'}html+='</div>'}let sent=d.sentiment||{};if(sent.composite){let cs=sent.composite;html+='<div class="sec-hdr"><h2>ðŸ§  Sentiment Composite</h2>'+sigBadge(cs.label,cs.color)+'</div>';html+='<div class="grid-2"><div class="card"><div class="fg-gauge">';html+='<div class="fg-circle" style="background:radial-gradient(circle,'+cs.color+'15,transparent 70%);border:3px solid '+cs.color+'40"><div class="fg-val" style="color:'+cs.color+'">'+fmt(cs.score,0)+'</div><div class="fg-label" style="color:'+cs.color+'">'+cs.label+'</div></div>';html+='<div class="fg-components">';let components=[{name:'VIX Sentiment',data:sent.vix_sentiment},{name:'Credit Spread',data:sent.credit_sentiment},{name:'Yield Curve',data:sent.curve_sentiment},{name:'High Yield',data:sent.hy_sentiment},{name:'Market Breadth',data:sent.breadth_sentiment},{name:'Momentum (RSI)',data:sent.momentum_sentiment},{name:'News Sentiment',data:sent.news_sentiment}];for(let c of components){if(!c.data)continue;let sc=c.data.score;let col=sentClr(sc);html+='<div class="fg-comp" style="border-left-color:'+col+'"><span class="fc-name">'+c.name+'</span><span class="fc-score" style="color:'+col+'">'+fmt(sc,0)+'</span></div>'}html+='</div></div></div>';html+='<div class="card"><div class="c-hdr"><span class="c-title">Key Positioning Metrics</span></div>';let pcm=d.put_call||{};let gexm=d.gamma_exposure||{};html+='<div class="c-row"><span class="c-label">Put/Call Ratio</span><span class="c-val" style="color:'+(pcm.pc_color||'var(--tx)')+'">'+fmt(pcm.total_put_call_ratio,3)+'</span></div>';html+='<div class="c-row"><span class="c-label">P/C Signal</span><span class="c-val" style="color:'+(pcm.pc_color||'var(--tx)')+'">'+(pcm.pc_signal||'â€”')+'</span></div>';html+='<div class="c-row"><span class="c-label">Total Call Volume</span><span class="c-val">'+fmtK(pcm.total_call_volume)+'</span></div>';html+='<div class="c-row"><span class="c-label">Total Put Volume</span><span class="c-val">'+fmtK(pcm.total_put_volume)+'</span></div>';html+='<div class="c-row"><span class="c-label">Net GEX</span><span class="c-val" style="color:'+(gexm.color||'var(--tx)')+'">'+fmtK(gexm.total_gex)+'</span></div>';html+='<div class="c-row"><span class="c-label">GEX Regime</span><span class="c-val" style="color:'+(gexm.color||'var(--tx)')+'">'+(gexm.regime||'â€”')+'</span></div>';html+='<div class="c-row"><span class="c-label">Max Gamma Strike</span><span class="c-val">'+(gexm.max_gamma_strike?'$'+fmt(gexm.max_gamma_strike,0):'â€”')+'</span></div>';let rot=d.fund_flows?.sector_rotation?.rotation_signal||{};html+='<div class="c-row"><span class="c-label">Sector Rotation</span><span class="c-val" style="color:var(--cyan)">'+(rot.phase||'â€”')+'</span></div>';let ra=d.fund_flows?.risk_appetite||{};html+='<div class="c-row"><span class="c-label">Risk Regime</span><span class="c-val" style="color:'+(ra.regime==='RISK_ON'?'var(--green)':ra.regime==='RISK_OFF'?'var(--red)':'var(--amber)')+'">'+(ra.regime||'â€”')+'</span></div>';html+='</div></div>'}document.getElementById('p-overview').innerHTML=html;setTimeout(()=>{if(d.vix_complex?.vix?.history_30d){let el=document.getElementById('mc-vix');if(el)sparkline(el,d.vix_complex.vix.history_30d,vix.regime_color||'#4facfe')}if(d.skew?.history_30d){let el=document.getElementById('mc-skew');if(el)sparkline(el,d.skew.history_30d,skew.color||'#a78bfa')}},100)}
function renderVix(d){let v=d.vix_complex||{};let vix=v.vix||{};let vix3m=v.vix3m||{};let ts=v.term_structure||{};let html='<div class="sec-hdr"><h2>VIX Volatility Complex</h2>'+sigBadge(vix.regime||'â€”',vix.regime_color||'var(--blue)')+'</div><div class="grid-3">';html+='<div class="card"><div class="c-hdr"><span class="c-title">VIX (CBOE)</span></div><div class="c-value" style="color:'+(vix.regime_color||'var(--tx)')+'">'+fmt(vix.current,2)+'</div><div class="c-sub">As of '+(vix.date||'â€”')+'</div><div class="c-row"><span class="c-label">Previous Close</span><span class="c-val">'+fmt(vix.prev_close,2)+'</span></div><div class="c-row"><span class="c-label">Change</span><span class="c-val" style="color:'+clr(vix.change,true)+'">'+fmt(vix.change,2)+' ('+fmtPct(vix.change_pct)+')</span></div><div class="c-row"><span class="c-label">52W High</span><span class="c-val">'+fmt(vix.high_52w,2)+'</span></div><div class="c-row"><span class="c-label">52W Low</span><span class="c-val">'+fmt(vix.low_52w,2)+'</span></div><div class="c-row"><span class="c-label">Percentile (1Y)</span><span class="c-val">'+fmt(vix.percentile_1y,0)+'%</span></div><div class="c-row"><span class="c-label">Z-Score</span><span class="c-val">'+fmt(vix.zscore,2)+'</span></div><div class="mini-chart" id="mc-vix2"></div></div>';html+='<div class="card"><div class="c-hdr"><span class="c-title">VIX Moving Averages</span></div><div class="c-row"><span class="c-label">SMA(10)</span><span class="c-val" style="color:'+((vix.current||0)>(vix.sma_10||0)?'var(--red)':'var(--green)')+'">'+fmt(vix.sma_10,2)+'</span></div><div class="c-row"><span class="c-label">SMA(20)</span><span class="c-val" style="color:'+((vix.current||0)>(vix.sma_20||0)?'var(--red)':'var(--green)')+'">'+fmt(vix.sma_20,2)+'</span></div><div class="c-row"><span class="c-label">SMA(50)</span><span class="c-val" style="color:'+((vix.current||0)>(vix.sma_50||0)?'var(--red)':'var(--green)')+'">'+fmt(vix.sma_50,2)+'</span></div><div style="margin-top:12px;padding:10px;background:var(--bg);border-radius:8px"><div style="font-size:10px;color:var(--tx3);margin-bottom:6px">VIX REGIME GUIDE</div><div class="c-row"><span class="c-label" style="color:#22c55e">&lt; 15 Complacency</span><span class="c-val" style="color:#22c55e">Sell vol</span></div><div class="c-row"><span class="c-label" style="color:#3b82f6">15-20 Normal</span><span class="c-val" style="color:#3b82f6">Neutral</span></div><div class="c-row"><span class="c-label" style="color:#f59e0b">20-25 Elevated</span><span class="c-val" style="color:#f59e0b">Hedge</span></div><div class="c-row"><span class="c-label" style="color:#f97316">25-35 High Vol</span><span class="c-val" style="color:#f97316">Reduce</span></div><div class="c-row"><span class="c-label" style="color:#ef4444">&gt; 35 Extreme Fear</span><span class="c-val" style="color:#ef4444">Buy dips</span></div></div></div>';let tsColor=ts.signal==='BULLISH'?'var(--green)':ts.signal==='BEARISH'?'var(--red)':'var(--amber)';html+='<div class="card"><div class="c-hdr"><span class="c-title">Term Structure</span>'+sigBadge(ts.state||'â€”',tsColor)+'</div><div class="c-value" style="color:'+tsColor+'">'+fmt(ts.vix_vix3m_ratio,4)+'</div><div class="c-sub">'+(ts.description||'')+'</div><div class="c-row"><span class="c-label">VIX</span><span class="c-val">'+fmt(vix.current,2)+'</span></div><div class="c-row"><span class="c-label">VIX3M</span><span class="c-val">'+fmt(vix3m.current,2)+'</span></div><div class="c-row"><span class="c-label">Spread</span><span class="c-val">'+fmt(ts.spread,2)+'</span></div><div class="c-row"><span class="c-label">Signal</span><span class="c-val" style="color:'+tsColor+'">'+(ts.signal||'â€”')+'</span></div><div style="margin-top:12px;padding:10px;background:var(--bg);border-radius:8px;font-size:11px;color:var(--tx2);line-height:1.6"><strong style="color:var(--amber)">Key Insight:</strong> When VIX > VIX3M (backwardation), it signals near-term fear exceeding long-term expectations. This has preceded 70%+ of major market declines.</div></div>';html+='</div>';document.getElementById('p-vix').innerHTML=html;setTimeout(()=>{let el=document.getElementById('mc-vix2');if(el&&vix.history_90d)sparkline(el,vix.history_90d,vix.regime_color||'#4facfe')},100)}
function renderOptions(d){let pc=d.put_call||{};let flow=pc.options_flow||[];let html='<div class="sec-hdr"><h2>Options Flow Analysis</h2>'+sigBadge(pc.pc_signal||'â€”',pc.pc_color||'var(--blue)')+'</div><div class="grid-4">';html+='<div class="card"><div class="c-title">Total P/C Ratio</div><div class="c-value" style="color:'+(pc.pc_color||'var(--tx)')+'">'+fmt(pc.total_put_call_ratio,3)+'</div><div class="c-sub">'+(pc.pc_description||'')+'</div></div>';html+='<div class="card"><div class="c-title">Call Volume</div><div class="c-value positive">'+fmtK(pc.total_call_volume)+'</div></div>';html+='<div class="card"><div class="c-title">Put Volume</div><div class="c-value negative">'+fmtK(pc.total_put_volume)+'</div></div>';html+='<div class="card"><div class="c-title">Net Premium</div><div class="c-value" style="color:'+((pc.total_call_volume||0)>(pc.total_put_volume||0)?'var(--green)':'var(--red)')+'">$'+fmtK(Math.abs((pc.total_call_volume||0)-(pc.total_put_volume||0)))+'</div></div>';html+='</div>';if(flow.length){html+='<div class="tbl-wrap"><table><thead><tr><th>Ticker</th><th>Call Vol</th><th>Put Vol</th><th>P/C Ratio</th><th>Call OI</th><th>Put OI</th><th>Call Prem</th><th>Put Prem</th><th>Net Prem</th><th>Sentiment</th></tr></thead><tbody>';for(let f of flow){let sentColor=f.sentiment==='BULLISH'?'var(--green)':f.sentiment==='BEARISH'?'var(--red)':'var(--tx2)';html+='<tr><td class="ticker">'+f.ticker+'</td><td class="positive">'+fmtK(f.call_volume)+'</td><td class="negative">'+fmtK(f.put_volume)+'</td><td style="color:'+(f.pc_ratio>1?'var(--red)':f.pc_ratio<0.7?'var(--green)':'var(--tx)')+'">'+fmt(f.pc_ratio,3)+'</td><td>'+fmtK(f.call_oi)+'</td><td>'+fmtK(f.put_oi)+'</td><td class="positive">$'+fmtK(f.call_premium)+'</td><td class="negative">$'+fmtK(f.put_premium)+'</td><td style="color:'+(f.net_premium>0?'var(--green)':'var(--red)')+'">$'+fmtK(f.net_premium)+'</td><td style="color:'+sentColor+';font-weight:700">'+f.sentiment+'</td></tr>'}html+='</tbody></table></div>'}document.getElementById('p-options').innerHTML=html}
function renderGamma(d){let gex=d.gamma_exposure||{};let html='<div class="sec-hdr"><h2>Gamma Exposure (GEX)</h2>'+sigBadge(gex.regime||'â€”',gex.color||'var(--blue)')+'</div><div class="grid-3">';html+='<div class="card"><div class="c-title">Net GEX</div><div class="c-value" style="color:'+(gex.color||'var(--tx)')+'">'+fmtK(gex.total_gex)+'</div><div class="c-sub">'+(gex.description||'')+'</div></div>';html+='<div class="card"><div class="c-title">Call GEX</div><div class="c-value positive">'+fmtK(gex.call_gex)+'</div></div>';html+='<div class="card"><div class="c-title">Put GEX</div><div class="c-value negative">'+fmtK(gex.put_gex)+'</div></div></div>';if(gex.max_gamma_strike){html+='<div class="card" style="margin-bottom:16px"><div class="c-title">MAX GAMMA STRIKE (PIN LEVEL)</div><div class="c-value" style="color:var(--gold);font-size:36px">$'+fmt(gex.max_gamma_strike,0)+'</div><div class="c-sub">Price gravitates toward this level during opex weeks</div></div>'}let strikes=gex.strike_levels||[];if(strikes.length){html+='<div class="sec-hdr"><h2>Top GEX Strikes</h2></div><div class="tbl-wrap"><table><thead><tr><th>Strike</th><th>Net GEX</th><th>Direction</th><th>Significance</th></tr></thead><tbody>';let maxG=Math.max(...strikes.map(s=>Math.abs(s.gex)));for(let s of strikes.slice(0,15)){let pct=Math.abs(s.gex)/maxG*100;let col=s.gex>0?'var(--green)':'var(--red)';html+='<tr><td class="mono">$'+fmt(s.strike,0)+'</td><td style="color:'+col+';font-weight:700">'+fmtK(s.gex)+'</td><td style="color:'+col+'">'+(s.gex>0?'SUPPORT':'RESISTANCE')+'</td><td><div style="background:var(--bg);border-radius:2px;height:6px;width:100%"><div style="height:100%;width:'+pct+'%;background:'+col+';border-radius:2px"></div></div></td></tr>'}html+='</tbody></table></div>'}html+='<div class="card" style="margin-top:12px"><div class="c-title">GEX GUIDE</div><div style="font-size:12px;color:var(--tx2);line-height:1.7;margin-top:8px"><strong style="color:var(--green)">Positive GEX:</strong> Dealers sell rallies/buy dips. Suppresses vol. Good for selling premium.<br><br><strong style="color:var(--red)">Negative GEX:</strong> Dealers buy rallies/sell dips. Amplifies moves. Increase hedging.<br><br><strong style="color:var(--gold)">Max Gamma Strike:</strong> Highest gamma = price magnet during OPEX.</div></div>';document.getElementById('p-gamma').innerHTML=html}
function renderFlows(d){let ff=d.fund_flows||{};let flows=ff.etf_flows||[];let rot=ff.sector_rotation?.rotation_signal||{};let risk=ff.risk_appetite||{};let html='<div class="sec-hdr"><h2>ETF Fund Flows & Sector Rotation</h2></div><div class="grid-3">';let rotColor=rot.phase==='DEFENSIVE'?'var(--red)':rot.phase==='LATE_CYCLE'?'var(--amber)':'var(--green)';html+='<div class="card"><div class="c-hdr"><span class="c-title">Rotation Phase</span></div><div class="c-value sm" style="color:'+rotColor+'">'+(rot.phase||'â€”')+'</div><div class="c-sub">'+(rot.description||'')+'</div>';if(rot.scores){for(let[k,v]of Object.entries(rot.scores)){html+='<div class="c-row"><span class="c-label">'+k.replace('_',' ')+'</span><span class="c-val">'+fmt(v,2)+'</span></div>'}}html+='</div>';let riskColor=risk.regime==='RISK_ON'?'var(--green)':risk.regime==='RISK_OFF'?'var(--red)':'var(--amber)';html+='<div class="card"><div class="c-hdr"><span class="c-title">Risk Appetite</span></div><div class="c-value sm" style="color:'+riskColor+'">'+(risk.regime||'â€”')+'</div><div class="c-row"><span class="c-label">Risk-On</span><span class="c-val positive">'+fmt(risk.risk_on_score,2)+'</span></div><div class="c-row"><span class="c-label">Risk-Off</span><span class="c-val negative">'+fmt(risk.risk_off_score,2)+'</span></div><div class="c-row"><span class="c-label">Net</span><span class="c-val" style="color:'+riskColor+'">'+fmt(risk.net_risk,2)+'</span></div></div>';let topIn=ff.sector_rotation||{};html+='<div class="card"><div class="c-hdr"><span class="c-title">Rotation Leaders</span></div><div class="c-row"><span class="c-label">Top Inflow</span><span class="c-val positive">'+(topIn.top_inflow||'â€”')+' ('+(topIn.top_inflow_name||'')+')</span></div><div class="c-row"><span class="c-label">Top Outflow</span><span class="c-val negative">'+(topIn.top_outflow||'â€”')+' ('+(topIn.top_outflow_name||'')+')</span></div></div></div>';if(flows.length){html+='<div class="tbl-wrap"><table><thead><tr><th>ETF</th><th>Name</th><th>Cat</th><th>Price</th><th>1D%</th><th>5D%</th><th>20D%</th><th>Volume</th><th>RelVol</th><th>Flow</th><th>Dir</th></tr></thead><tbody>';for(let f of flows){let dirColor=f.flow_direction==='INFLOW'?'var(--green)':f.flow_direction==='OUTFLOW'?'var(--red)':'var(--tx2)';html+='<tr><td class="ticker">'+f.ticker+'</td><td>'+f.name+'</td><td style="font-size:10px;color:var(--tx3)">'+f.category+'</td><td class="mono">$'+fmt(f.price,2)+'</td><td style="color:'+clr(f.change_1d)+'">'+fmtPct(f.change_1d)+'</td><td style="color:'+clr(f.change_5d)+'">'+fmtPct(f.change_5d)+'</td><td style="color:'+clr(f.change_20d)+'">'+fmtPct(f.change_20d)+'</td><td>'+fmtK(f.volume)+'</td><td style="color:'+(f.relative_volume>1.5?'var(--gold)':'var(--tx)')+'">'+fmt(f.relative_volume,2)+'x</td><td style="color:'+clr(f.flow_score)+';font-weight:700">'+fmt(f.flow_score,2)+'</td><td style="color:'+dirColor+';font-weight:700">'+f.flow_direction+'</td></tr>'}html+='</tbody></table></div>'}document.getElementById('p-flows').innerHTML=html}
function renderSentiment(d){let sent=d.sentiment||{};let cs=sent.composite||{};let html='<div class="sec-hdr"><h2>Multi-Factor Sentiment</h2>'+sigBadge(cs.label||'â€”',cs.color||'var(--blue)')+'</div>';html+='<div class="card" style="margin-bottom:16px;text-align:center;padding:30px"><div style="font-size:64px;font-weight:900;color:'+(cs.color||'var(--tx)')+';letter-spacing:-3px">'+fmt(cs.score,0)+'</div><div style="font-size:18px;font-weight:700;color:'+(cs.color||'var(--tx)')+';text-transform:uppercase;letter-spacing:2px;margin-top:4px">'+(cs.label||'N/A')+'</div><div style="margin-top:16px;height:8px;background:linear-gradient(to right,#dc2626,#ef4444,#f97316,#f59e0b,#84cc16,#22c55e,#16a34a);border-radius:4px;position:relative"><div style="position:absolute;top:-4px;left:'+(cs.score||50)+'%;transform:translateX(-50%);width:4px;height:16px;background:white;border-radius:2px;box-shadow:0 0 6px rgba(255,255,255,0.5)"></div></div><div style="display:flex;justify-content:space-between;margin-top:6px;font-size:10px;color:var(--tx3)"><span>EXTREME FEAR</span><span>FEAR</span><span>NEUTRAL</span><span>GREED</span><span>EXTREME GREED</span></div></div>';html+='<div class="grid-3">';let comps=[{key:'vix_sentiment',name:'VIX Sentiment',desc:'VIX percentile rank'},{key:'credit_sentiment',name:'Credit Spread',desc:'TED spread gauge'},{key:'curve_sentiment',name:'Yield Curve',desc:'10Y-2Y signal'},{key:'hy_sentiment',name:'High Yield',desc:'ICE BofA HY'},{key:'breadth_sentiment',name:'Market Breadth',desc:'A/D proxy'},{key:'momentum_sentiment',name:'Momentum (RSI)',desc:'SPY RSI'},{key:'news_sentiment',name:'News Sentiment',desc:'AlphaVantage NLP'}];for(let c of comps){let data=sent[c.key];if(!data)continue;let col=sentClr(data.score);html+='<div class="card"><div class="c-hdr"><span class="c-title">'+c.name+'</span>'+sigBadge(data.label||'â€”',col)+'</div><div class="c-value" style="color:'+col+'">'+fmt(data.score,0)+'</div><div class="c-sub">'+c.desc+'</div><div class="gc-bar" style="margin-top:8px"><div class="gc-bar-fill" style="width:'+data.score+'%;background:'+col+'"></div></div></div>'}html+='</div>';document.getElementById('p-sentiment').innerHTML=html}
function renderUnusual(d){let unusual=d.unusual_activity||[];let html='<div class="sec-hdr"><h2>Unusual Volume Activity</h2>'+sigBadge(unusual.length+' detected','var(--purple)')+'</div>';if(unusual.length){html+='<div class="tbl-wrap"><table><thead><tr><th>Ticker</th><th>Price</th><th>Change</th><th>Volume</th><th>Avg Vol</th><th>Rel Vol</th><th>Signal</th></tr></thead><tbody>';for(let u of unusual){let sigColor=u.signal.includes('BULLISH')?'var(--green)':u.signal.includes('BEARISH')?'var(--red)':'var(--amber)';html+='<tr class="'+(u.relative_volume>2?'highlight':'')+'"><td class="ticker">'+u.ticker+'</td><td class="mono">$'+fmt(u.price,2)+'</td><td style="color:'+clr(u.change_pct)+'">'+fmtPct(u.change_pct)+'</td><td class="mono">'+fmtK(u.volume)+'</td><td class="mono">'+fmtK(u.avg_volume)+'</td><td style="color:var(--gold);font-weight:700">'+fmt(u.relative_volume,2)+'x</td><td style="color:'+sigColor+';font-weight:700">'+u.signal+'</td></tr>'}html+='</tbody></table></div>'}else{html+='<div class="card"><div style="text-align:center;padding:40px;color:var(--tx3)">No unusual activity detected</div></div>'}document.getElementById('p-unusual').innerHTML=html}
function renderSignals(d){let signals=d.trading_signals||[];let html='<div class="sec-hdr"><h2>AI Trading Signals</h2>'+sigBadge(signals.length+' active','var(--gold)')+'</div>';if(signals.length){for(let s of signals){let bColor=s.type.includes('BUY')?'var(--green)':s.type.includes('SELL')?'var(--red)':s.type.includes('WARNING')?'var(--amber)':'var(--blue)';html+='<div class="signal-card" style="border-left-color:'+bColor+'"><div class="sig-type" style="color:'+bColor+'">'+s.type+'</div><div class="sig-msg">'+s.message+'</div><div class="sig-meta"><span>Source: <strong>'+s.source+'</strong></span><span>Strength: <strong>'+s.strength+'</strong></span><span class="sig-conf" style="color:'+bColor+'">Confidence: '+s.confidence+'%</span></div></div>'}}else{html+='<div class="card"><div style="text-align:center;padding:40px;color:var(--tx3)">No active signals</div></div>'}document.getElementById('p-signals').innerHTML=html}
function renderNews(d){let news=d.sentiment?.news_sentiment||{};let articles=news.top_articles||[];let html='<div class="sec-hdr"><h2>News Sentiment</h2>'+sigBadge(news.label||'â€”',sentClr(news.score||50))+'</div><div class="grid-4">';html+='<div class="card"><div class="c-title">Score</div><div class="c-value" style="color:'+sentClr(news.score||50)+'">'+fmt(news.score,0)+'</div></div>';html+='<div class="card"><div class="c-title">Bullish</div><div class="c-value positive">'+(news.bullish_count||0)+'</div></div>';html+='<div class="card"><div class="c-title">Bearish</div><div class="c-value negative">'+(news.bearish_count||0)+'</div></div>';html+='<div class="card"><div class="c-title">Analyzed</div><div class="c-value">'+(news.article_count||0)+'</div></div></div>';if(articles.length){html+='<div class="card"><div class="c-title" style="margin-bottom:10px">NEWS FEED</div>';for(let a of articles){let sc=a.sentiment_score;let sentColor=sc>0.1?'var(--green)':sc<-0.1?'var(--red)':'var(--tx2)';let sentBg=sc>0.1?'rgba(0,230,138,0.15)':sc<-0.1?'rgba(255,71,87,0.15)':'rgba(147,149,165,0.15)';html+='<div class="news-item"><div class="ni-title" onclick="window.open(\''+a.url+'\',\'_blank\')">'+a.title+'</div><div class="ni-meta"><span>'+a.source+'</span><span class="ni-sent" style="color:'+sentColor+';background:'+sentBg+'">'+a.sentiment_label+' ('+fmt(sc,3)+')</span></div></div>'}html+='</div>'}document.getElementById('p-news').innerHTML=html}
function renderInternals(d){let mi=d.market_internals||{};let html='<div class="sec-hdr"><h2>Market Internals</h2></div><div class="grid-3">';let items=[{key:'fed_funds_rate',name:'Fed Funds Rate',s:'%'},{key:'treasury_10y',name:'10Y Treasury',s:'%'},{key:'treasury_2y',name:'2Y Treasury',s:'%'},{key:'ted_spread',name:'TED Spread',s:'%'},{key:'hy_spread',name:'HY OAS Spread',s:'%'},{key:'ig_spread',name:'IG OAS Spread',s:'%'},{key:'yield_curve_10y2y',name:'10Y-2Y Spread',s:'%'},{key:'yield_curve_10y3m',name:'10Y-3M Spread',s:'%'},{key:'breakeven_5y',name:'5Y Breakeven',s:'%'},{key:'breakeven_10y',name:'10Y Breakeven',s:'%'}];for(let item of items){let data=mi[item.key];if(!data)continue;let val=data.value;let isNeg=item.key.includes('curve')&&val<0;let col=isNeg?'var(--red)':item.key.includes('spread')?(val>1?'var(--amber)':'var(--green)'):'var(--tx)';html+='<div class="card"><div class="c-title">'+item.name+'</div><div class="c-value sm" style="color:'+col+'">'+fmt(val,3)+item.s+'</div><div class="c-sub">As of '+(data.date||'â€”')+'</div></div>'}html+='</div>';document.getElementById('p-internals').innerHTML=html}
async function loadData(){document.getElementById('statusText').textContent='Fetching...';try{let resp;try{resp=await fetch(API_URL)}catch(e){resp=await fetch(S3_URL)}let json;if(resp.ok){json=await resp.json()}else{let r2=await fetch(S3_URL);json=await r2.json()}if(json.success&&json.data){DATA=json.data}else if(json.data){DATA=json.data}else{DATA=json}renderGauges(DATA);renderHeroBadges(DATA);renderOverview(DATA);renderVix(DATA);renderOptions(DATA);renderGamma(DATA);renderFlows(DATA);renderSentiment(DATA);renderUnusual(DATA);renderSignals(DATA);renderNews(DATA);renderInternals(DATA);document.getElementById('statusText').textContent='Live';document.getElementById('lastUpdate').textContent=new Date().toLocaleString()}catch(err){console.error(err);document.getElementById('statusText').textContent='Error';document.getElementById('gaugesRow').innerHTML='<div class="card" style="grid-column:1/-1;text-align:center;padding:40px"><div style="color:var(--red);font-weight:700;margin-bottom:8px">Data Load Error</div><div style="color:var(--tx2);font-size:12px">'+err.message+'</div><div style="margin-top:12px"><button onclick="loadData()" style="padding:8px 20px;background:var(--green);color:var(--bg);border:none;border-radius:6px;font-weight:700;cursor:pointer">Retry</button></div></div>'}}
setInterval(()=>{let now=new Date();let et=new Date(now.toLocaleString('en-US',{timeZone:'America/New_York'}));let h=et.getHours(),m=et.getMinutes(),dow=et.getDay();if(dow>=1&&dow<=5&&((h===9&&m>=30)||(h>=10&&h<16)||(h===16&&m<=30)))loadData()},300000);
loadData();
</script>
</body>
</html>
