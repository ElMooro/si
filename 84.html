<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JustHODL.AI - Ultimate Macro Financial Dashboard | 500+ Metrics</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            background: linear-gradient(135deg, #0a0e1a 0%, #1a1f2e 100%);
            color: #ffffff;
            overflow-x: hidden;
        }

        .header {
            background: linear-gradient(90deg, #1e3c72 0%, #2a5298 100%);
            padding: 20px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.3);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            max-width: 1800px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo h1 {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(45deg, #00ff88, #00d4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .status-bar {
            display: flex;
            gap: 20px;
            align-items: center;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: rgba(255,255,255,0.1);
            border-radius: 20px;
            font-size: 14px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-dot.active { background: #00ff88; }
        .status-dot.warning { background: #ffaa00; }
        .status-dot.error { background: #ff4444; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .container {
            max-width: 1800px;
            margin: 20px auto;
            padding: 0 20px;
        }

        .crisis-dashboard {
            background: linear-gradient(135deg, rgba(255,0,0,0.1) 0%, rgba(255,100,0,0.05) 100%);
            border: 1px solid rgba(255,0,0,0.3);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 30px;
            animation: alertPulse 3s infinite;
        }

        @keyframes alertPulse {
            0%, 100% { box-shadow: 0 0 20px rgba(255,0,0,0.2); }
            50% { box-shadow: 0 0 30px rgba(255,0,0,0.4); }
        }

        .khalid-index {
            text-align: center;
            margin-bottom: 20px;
        }

        .khalid-index h2 {
            font-size: 32px;
            margin-bottom: 10px;
            color: #ffaa00;
        }

        .index-meter {
            width: 100%;
            max-width: 600px;
            height: 40px;
            background: linear-gradient(90deg, #00ff00 0%, #ffff00 35%, #ffaa00 65%, #ff0000 100%);
            border-radius: 20px;
            position: relative;
            margin: 20px auto;
        }

        .index-pointer {
            position: absolute;
            top: -10px;
            width: 4px;
            height: 60px;
            background: #ffffff;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            transition: left 0.5s ease;
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 12px;
            padding: 20px;
            transition: transform 0.3s, box-shadow 0.3s;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
        }

        .metric-value {
            font-size: 24px;
            font-weight: 700;
            margin: 10px 0;
        }

        .metric-change {
            display: flex;
            gap: 10px;
            font-size: 12px;
            flex-wrap: wrap;
        }

        .change-item {
            padding: 3px 6px;
            border-radius: 4px;
            background: rgba(255,255,255,0.1);
        }

        .positive { color: #00ff88; }
        .negative { color: #ff4444; }
        .neutral { color: #ffaa00; }

        .section {
            background: rgba(255,255,255,0.03);
            border-radius: 12px;
            padding: 20px;
            margin: 30px 0;
        }

        .section-header {
            font-size: 22px;
            font-weight: 700;
            margin-bottom: 20px;
            padding: 15px;
            background: linear-gradient(90deg, rgba(255,255,255,0.1) 0%, transparent 100%);
            border-left: 4px solid #00d4ff;
        }

        .agent-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }

        .agent-card {
            background: rgba(255,255,255,0.08);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 8px;
            padding: 15px;
            position: relative;
            overflow: hidden;
        }

        .agent-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: #00ff88;
        }

        .agent-card.warning::before { background: #ffaa00; }
        .agent-card.error::before { background: #ff4444; }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 14px;
        }

        .data-table th {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            text-align: left;
            font-weight: 600;
            border-bottom: 2px solid rgba(255,255,255,0.2);
        }

        .data-table td {
            padding: 8px 10px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .data-table tbody tr:hover {
            background: rgba(255,255,255,0.05);
        }

        .chart-container {
            background: rgba(255,255,255,0.05);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
            height: 400px;
            position: relative;
        }

        .trades-container {
            background: rgba(0,255,136,0.05);
            border: 1px solid rgba(0,255,136,0.2);
            border-radius: 12px;
            padding: 20px;
            margin: 20px 0;
        }

        .trade-row {
            display: grid;
            grid-template-columns: 50px 2fr 1fr 1fr 1fr 100px;
            gap: 10px;
            padding: 10px;
            margin: 8px 0;
            background: rgba(255,255,255,0.05);
            border-radius: 8px;
            align-items: center;
            font-size: 14px;
        }

        .confidence-bar {
            height: 6px;
            background: rgba(255,255,255,0.1);
            border-radius: 3px;
            overflow: hidden;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff4444 0%, #ffaa00 50%, #00ff88 100%);
        }

        .alert-box {
            background: rgba(255,170,0,0.1);
            border: 1px solid rgba(255,170,0,0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }

        .critical-box {
            background: rgba(255,0,0,0.1);
            border: 1px solid rgba(255,0,0,0.3);
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
        }

        .refresh-timer {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(0,0,0,0.8);
            padding: 15px 20px;
            border-radius: 8px;
            border: 1px solid rgba(255,255,255,0.2);
            font-size: 14px;
        }

        .iframe-container {
            width: 100%;
            height: 800px;
            border: 2px solid rgba(255,255,255,0.2);
            border-radius: 12px;
            overflow: hidden;
            margin: 20px 0;
        }

        iframe {
            width: 100%;
            height: 100%;
            border: none;
        }

        .indicator-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 8px;
        }

        .badge-critical { background: rgba(255,0,0,0.2); color: #ff4444; }
        .badge-warning { background: rgba(255,170,0,0.2); color: #ffaa00; }
        .badge-normal { background: rgba(0,255,136,0.2); color: #00ff88; }

        .mini-chart {
            height: 60px;
            margin-top: 10px;
        }

        .loading {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: #00ff88;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes fadeOut {
            0% { opacity: 1; }
            70% { opacity: 1; }
            100% { opacity: 0; }
        }

        .update-counter {
            position: fixed;
            top: 80px;
            left: 20px;
            background: rgba(0,0,0,0.8);
            color: #00ff88;
            padding: 10px 15px;
            border-radius: 8px;
            border: 1px solid #00ff88;
            font-size: 14px;
            z-index: 10000;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="logo">
                <h1>JustHODL.AI</h1>
                <span style="color: #00ff88;">ULTIMATE MACRO FINANCIAL DASHBOARD | 500+ METRICS</span>
            </div>
            <div class="status-bar">
                <div class="status-indicator">
                    <span class="status-dot active"></span>
                    <span>Live Data</span>
                </div>
                <div class="status-indicator">
                    <span class="status-dot active" id="agentStatus"></span>
                    <span id="activeAgents">14/14 Agents</span>
                </div>
                <div class="status-indicator">
                    <span id="currentTime"></span>
                </div>
            </div>
        </div>
    </div>

    <div class="container">
        <!-- SECTION 1: EXECUTIVE CRISIS DASHBOARD -->
        <div class="crisis-dashboard">
            <div class="khalid-index">
                <h2>‚ö†Ô∏è KHALID INDEX: <span id="khalidIndexValue">45</span>/100 - <span id="khalidSignal">HOLD</span></h2>
                <p>Market Regime: <span id="marketRegime">LATE CYCLE DISTRIBUTION</span> | Crisis Distance: <span id="crisisDistance">45%</span></p>
                <div class="index-meter">
                    <div class="index-pointer" id="indexPointer" style="left: 45%;"></div>
                </div>
            </div>

            <div class="grid" id="crisisMetrics">
                <!-- Crisis metrics will be populated here -->
            </div>
        </div>

        <!-- SECTION 2: KEY RECENT DEVELOPMENTS -->
        <section class="section">
            <h2 class="section-header">‚ö° SECTION 2: KEY RECENT DEVELOPMENTS</h2>
            <div class="grid" id="recentDevelopments"></div>
        </section>

        <!-- SECTION 3: DARK POOL & OPTIONS FLOW -->
        <section class="section">
            <h2 class="section-header">üéØ SECTION 3: DARK POOL & OPTIONS FLOW - INSTITUTIONAL POSITIONING</h2>
            <div class="grid" id="darkPoolMetrics"></div>
            <div class="chart-container">
                <canvas id="darkPoolChart"></canvas>
            </div>
            <table class="data-table" id="optionsFlowTable">
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>Current</th>
                        <th>Percentile</th>
                        <th>Signal</th>
                    </tr>
                </thead>
                <tbody id="optionsFlowBody"></tbody>
            </table>
        </section>

        <!-- SECTION 4: TREASURY AUCTION FORENSICS -->
        <section class="section">
            <h2 class="section-header">üìä SECTION 4: TREASURY AUCTION FORENSICS</h2>
            <div class="alert-box">
                <strong>üìä China Treasury Holdings Crisis Watch</strong><br>
                Current: $782B | Monthly Sales: -$17B | Crisis Level: $700B | Distance: 11.7%<br>
                <strong>Months to Crisis: 5</strong>
            </div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Auction</th>
                        <th>Grade</th>
                        <th>Bid-Cover</th>
                        <th>Indirect %</th>
                        <th>Tail (bp)</th>
                        <th>Analysis</th>
                    </tr>
                </thead>
                <tbody id="auctionBody"></tbody>
            </table>
        </section>

        <!-- SECTION 5: MARKET MICROSTRUCTURE -->
        <section class="section">
            <h2 class="section-header">‚öôÔ∏è SECTION 5: MARKET MICROSTRUCTURE</h2>
            <div class="grid" id="microstructureMetrics"></div>
        </section>

        <!-- SECTION 6: LIQUIDITY PLUMBING CRISIS METRICS -->
        <section class="section">
            <h2 class="section-header">üíß SECTION 6: LIQUIDITY PLUMBING CRISIS METRICS</h2>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>Current</th>
                        <th>Normal</th>
                        <th>Crisis</th>
                        <th>Multiple</th>
                        <th>Status</th>
                        <th>Market Impact</th>
                    </tr>
                </thead>
                <tbody id="liquidityBody"></tbody>
            </table>
        </section>

        <!-- SECTION 7: GLOBAL CENTRAL BANK LIQUIDITY -->
        <section class="section">
            <h2 class="section-header">üåç SECTION 7: GLOBAL CENTRAL BANK LIQUIDITY OPERATIONS</h2>
            <div class="critical-box">
                <strong>G4 TOTAL: $24.8T | -$45B/week | -$180B/month | -$2.16T/year</strong><br>
                FASTEST DRAIN SINCE 2018 (-20% crash)
            </div>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Central Bank</th>
                        <th>Balance Sheet</th>
                        <th>Weekly Œî</th>
                        <th>Monthly Œî</th>
                        <th>YoY Œî</th>
                        <th>Policy</th>
                        <th>Market Impact</th>
                    </tr>
                </thead>
                <tbody id="centralBankBody"></tbody>
            </table>
            <div class="chart-container">
                <canvas id="centralBankChart"></canvas>
            </div>
        </section>

        <!-- SECTION 8: LABOR MARKET WITH SAHM RULE -->
        <section class="section">
            <h2 class="section-header">üíº SECTION 8: LABOR MARKET WITH SAHM RULE</h2>
            <div class="alert-box">
                <strong>‚ö†Ô∏è SAHM RULE ALERT</strong><br>
                Current: <span id="sahmCurrent">0.33</span> | Trigger: 0.50 | Distance: <span id="sahmDistance">0.17pp</span><br>
                Time to Trigger: <span id="sahmTime">3-4 months</span><br>
                <em>The Sahm Rule has NEVER failed. 100% recession accuracy since 1960.</em>
            </div>
            <div class="grid" id="laborMetrics"></div>
        </section>

        <!-- SECTION 9: GLOBAL MANUFACTURING PMI -->
        <section class="section">
            <h2 class="section-header">üè≠ SECTION 9: GLOBAL MANUFACTURING PMI</h2>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Country</th>
                        <th>PMI</th>
                        <th>New Orders</th>
                        <th>1M Œî</th>
                        <th>3M Œî</th>
                        <th>Status</th>
                        <th>Interpretation</th>
                    </tr>
                </thead>
                <tbody id="pmiBody"></tbody>
            </table>
        </section>

        <!-- SECTION 10: ICE BOFA CREDIT SPREADS -->
        <section class="section">
            <h2 class="section-header">üìà SECTION 10: ICE BOFA CREDIT SPREADS</h2>
            <div class="grid" id="creditSpreads"></div>
            <div class="chart-container">
                <canvas id="creditChart"></canvas>
            </div>
        </section>

        <!-- SECTION 11: EQUITY MARKET INTERNALS -->
        <section class="section">
            <h2 class="section-header">üìä SECTION 11: EQUITY MARKET INTERNALS</h2>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Metric</th>
                        <th>SPX</th>
                        <th>NDX</th>
                        <th>RUT</th>
                        <th>Signal</th>
                    </tr>
                </thead>
                <tbody id="internalsBody"></tbody>
            </table>
        </section>

        <!-- SECTION 12: SENTIMENT & POSITIONING EXTREMES -->
        <section class="section">
            <h2 class="section-header">üé≠ SECTION 12: SENTIMENT & POSITIONING EXTREMES</h2>
            <div class="grid" id="sentimentMetrics"></div>
        </section>

        <!-- SECTION 13: INSIDER & CONGRESSIONAL TRADING -->
        <section class="section">
            <h2 class="section-header">üï¥Ô∏è SECTION 13: INSIDER & CONGRESSIONAL TRADING</h2>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Entity</th>
                        <th>Action</th>
                        <th>Sector</th>
                        <th>Amount</th>
                        <th>Signal</th>
                        <th>Interpretation</th>
                    </tr>
                </thead>
                <tbody id="insiderBody"></tbody>
            </table>
        </section>

        <!-- SECTION 14: CRITICAL TECHNICAL LEVELS -->
        <section class="section">
            <h2 class="section-header">üî¥ SECTION 14: CRITICAL TECHNICAL LEVELS</h2>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Level</th>
                        <th>Current</th>
                        <th>Critical</th>
                        <th>Distance</th>
                        <th>Impact if Broken</th>
                    </tr>
                </thead>
                <tbody id="technicalBody"></tbody>
            </table>
        </section>

        <!-- SECTION 15: INTERMARKET RELATIONSHIPS -->
        <section class="section">
            <h2 class="section-header">üîó SECTION 15: INTERMARKET RELATIONSHIPS</h2>
            <table class="data-table">
                <thead>
                    <tr>
                        <th>Relationship</th>
                        <th>Current</th>
                        <th>Normal</th>
                        <th>Signal</th>
                        <th>Interpretation</th>
                    </tr>
                </thead>
                <tbody id="intermarketBody"></tbody>
            </table>
        </section>

        <!-- TOP 5 HIGHEST CONVICTION TRADES -->
        <section class="section">
            <h2 class="section-header">üéØ TOP 5 HIGHEST CONVICTION TRADES (30-DAY HORIZON)</h2>
            <div class="trades-container">
                <div class="trade-row" style="font-weight: 600;">
                    <span>Rank</span>
                    <span>Trade</span>
                    <span>Entry</span>
                    <span>Target</span>
                    <span>Stop</span>
                    <span>Confidence</span>
                </div>
                <div id="tradesBody"></div>
            </div>
        </section>

        <!-- BLACK SWAN RISKS -->
        <section class="section">
            <h2 class="section-header">‚ö†Ô∏è BLACK SWAN RISKS (Low Probability, High Impact)</h2>
            <div id="blackSwanRisks"></div>
        </section>

        <!-- DATA AGENT STATUS -->
        <section class="section">
            <h2 class="section-header">üöÄ LIVE DATA AGENTS STATUS (14/14 OPERATIONAL)</h2>
            <div class="agent-grid" id="agentGrid"></div>
        </section>

        <!-- PROFESSIONAL TRADING TERMINAL -->
        <section class="section">
            <h2 class="section-header">üìä PROFESSIONAL TRADING TERMINAL</h2>
            <div class="iframe-container">
                <iframe src="https://crnxxeqwehqjgiu5voi2p5jiee0kzzln.lambda-url.us-east-1.on.aws/" 
                        title="Professional Trading Terminal"></iframe>
            </div>
        </section>
    </div>

    <div class="refresh-timer">
        Next refresh in: <span id="refreshCountdown">30</span>s
    </div>

    <script>
        // Global variables
        let allData = {};
        let charts = {};
        let refreshInterval = 30;

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Initializing Ultimate Macro Dashboard...');
            initializeDashboard();
            fetchData();
            setupAutoRefresh();
            updateTime();
        });

        function initializeDashboard() {
            renderAllSections();
            initializeAllCharts();
        }

        function renderAllSections() {
            // SECTION 1: Crisis Metrics
            const crisisMetrics = [
                { id: 'vix', title: 'VIX Index', value: '18.50', status: 'warning', changes: {week: '+12.3%', month: '+5.2%', year: '-15.8%'}, distance: '76.8%' },
                { id: 'liquidity', title: 'Liquidity Pressure', value: '52/100', status: 'error', changes: {week: '+8.2%', month: '+18.5%', year: '+85%'}, distance: '31%' },
                { id: 'stress', title: 'Stress Index', value: '0.18', status: 'normal', changes: {week: '+0.03', month: '+0.08', year: '+0.15'}, distance: '93%' },
                { id: 'sp500', title: 'S&P 500', value: '6,664.36', status: 'active', changes: {week: '+1.2%', month: '-2.3%', year: '+18.5%'} },
                { id: 'bitcoin', title: 'Bitcoin', value: '$115,376', status: 'active', changes: {day: '+3.2%', week: '+8.5%', month: '+45.2%'} },
                { id: 'fed', title: 'Fed Balance', value: '$6.6T', status: 'warning', changes: {week: '-$22B', month: '-$95B', QT: '-$95B/mo'} },
                { id: 'treasury10y', title: '10Y Treasury', value: '4.11%', status: 'active', changes: {week: '+8bp', month: '+15bp', spread: '57bp'} },
                { id: 'dollar', title: 'Dollar Index', value: '105.2', status: 'active', changes: {week: '+0.8%', month: '+2.1%', year: '+4.5%'} },
                { id: 'repo', title: 'Repo Fails', value: '$285B/day', status: 'error', distance: '2.85x normal' }
            ];

            document.getElementById('crisisMetrics').innerHTML = crisisMetrics.map(m => createMetricCard(m)).join('');

            // SECTION 2: Recent Developments
            const developments = [
                { title: 'Fed SRF Usage', value: 'Record $18.5B', impact: 'Corporate tax deadline creating severe funding stress', timeline: 'Immediate' },
                { title: 'SOFR Elevation', value: '4.42% (+20bp)', impact: 'Secured funding stress intensifying', timeline: 'Accelerating' },
                { title: 'ON RRP Collapse', value: '$18.8B from $2.6T', impact: 'Excess liquidity completely absorbed', timeline: 'Critical' },
                { title: 'TGA Surge', value: '$870B rising', impact: 'Every $100B drains reserves', timeline: 'Q4 pressure' },
                { title: 'China Treasury Sales', value: '$782B (-$17B/mo)', impact: 'Crisis at $700B level', timeline: '5 months' }
            ];

            document.getElementById('recentDevelopments').innerHTML = developments.map(d => 
                `<div class="card">
                    <div class="card-header"><span class="card-title">${d.title}</span></div>
                    <div class="metric-value">${d.value}</div>
                    <div style="font-size: 12px; color: rgba(255,255,255,0.7); margin: 10px 0;">${d.impact}</div>
                    <div class="change-item neutral">Timeline: ${d.timeline}</div>
                </div>`
            ).join('');

            // Initialize all tables
            renderDarkPoolMetrics();
            renderAuctionTable();
            renderLiquidityTable();
            renderCentralBankTable();
            renderLaborMetrics();
            renderPMITable();
            renderCreditSpreads();
            renderEquityInternals();
            renderSentimentMetrics();
            renderInsiderTrading();
            renderTechnicalLevels();
            renderIntermarketRelationships();
            renderTrades();
            renderBlackSwanRisks();
            renderAgentGrid();
        }

        function createMetricCard(metric) {
            const changeItems = Object.entries(metric.changes || {}).map(([key, value]) => 
                `<span class="change-item ${value.startsWith('+') ? 'positive' : value.startsWith('-') ? 'negative' : 'neutral'}">${key}: ${value}</span>`
            ).join('');

            return `
                <div class="card">
                    <div class="card-header">
                        <span class="card-title">${metric.title}</span>
                        <span class="status-dot ${metric.status}"></span>
                    </div>
                    <div class="metric-value" id="${metric.id}-value">${metric.value}</div>
                    ${metric.distance ? `<div style="font-size: 11px; margin: 5px 0;">Distance: ${metric.distance}</div>` : ''}
                    <div class="metric-change">${changeItems}</div>
                </div>
            `;
        }

        function renderDarkPoolMetrics() {
            const darkPool = [
                { symbol: 'SPY', volume: '$2.3B', price: '449.50', vwap: '-0.3%', avg: '+180%', signal: 'ACCUMULATION' },
                { symbol: 'QQQ', volume: '$850M', price: '382.00', vwap: '+0.5%', avg: '+45%', signal: 'DISTRIBUTION' },
                { symbol: 'NVDA', volume: '$1.2B', price: '485.00', vwap: '+0.8%', avg: '+220%', signal: 'HEAVY DISTRIBUTION' }
            ];

            document.getElementById('darkPoolMetrics').innerHTML = darkPool.map(d => 
                `<div class="card">
                    <div class="card-header"><span class="card-title">${d.symbol}</span></div>
                    <div class="metric-value">${d.volume}</div>
                    <div class="metric-change">
                        <span class="change-item">Price: ${d.price}</span>
                        <span class="change-item ${d.vwap.startsWith('+') ? 'positive' : 'negative'}">VWAP: ${d.vwap}</span>
                        <span class="change-item positive">vs Avg: ${d.avg}</span>
                    </div>
                    <div style="margin-top: 8px;">
                        <span class="indicator-badge ${d.signal.includes('ACCUMULATION') ? 'badge-normal' : 'badge-critical'}">${d.signal}</span>
                    </div>
                </div>`
            ).join('');

            // Options Flow Table
            const optionsFlow = [
                { metric: 'Put/Call Ratio', current: '1.35', percentile: '85th', signal: 'Heavy hedging' },
                { metric: 'Large Blocks (>$1M)', current: '185 Puts vs 125 Calls', percentile: '90th', signal: 'Institutional protection' },
                { metric: 'SPX 4200 Puts', current: '$82M premium', percentile: '95th', signal: 'Massive downside hedge' },
                { metric: 'VIX 30 Calls', current: '$28M premium', percentile: '88th', signal: 'Volatility explosion bet' }
            ];

            document.getElementById('optionsFlowBody').innerHTML = optionsFlow.map(o => 
                `<tr>
                    <td>${o.metric}</td>
                    <td>${o.current}</td>
                    <td>${o.percentile}</td>
                    <td class="${o.signal.includes('hedge') || o.signal.includes('protection') ? 'negative' : 'neutral'}">${o.signal}</td>
                </tr>`
            ).join('');
        }

        function renderAuctionTable() {
            const auctions = [
                { auction: '10Y Treasury', grade: 'C+', bidCover: '2.42', indirect: '62%', tail: '3.2', analysis: 'Weakest in 8 months. Foreign buyers abandoning. China selling $17B/month.' },
                { auction: '30Y Treasury', grade: 'D', bidCover: '2.21', indirect: '58%', tail: '4.1', analysis: 'Disaster. Dealers stuck with inventory. Supply/demand broken.' },
                { auction: '2Y Treasury', grade: 'B-', bidCover: '2.65', indirect: '65%', tail: '2.1', analysis: 'Moderate demand but deteriorating trend.' }
            ];

            document.getElementById('auctionBody').innerHTML = auctions.map(a => 
                `<tr>
                    <td>${a.auction}</td>
                    <td class="${a.grade.startsWith('A') ? 'positive' : a.grade.startsWith('B') ? 'neutral' : 'negative'}">${a.grade}</td>
                    <td>${a.bidCover}</td>
                    <td>${a.indirect}</td>
                    <td>${a.tail}</td>
                    <td>${a.analysis}</td>
                </tr>`
            ).join('');
        }

        function renderMicrostructureMetrics() {
            const microstructure = [
                { metric: 'Gamma Exposure (GEX)', current: '-$2.1B', crisis: '-$5B', distance: '58%', impact: 'Dealers SHORT gamma. Must sell $2.1B per 1% drop.' },
                { metric: 'Zero Gamma Level', current: 'SPX 4420', crisis: '4350', distance: '70 pts', impact: 'Below 4420 = volatility doubles' },
                { metric: 'Dark Index (DIX)', current: '47.2%', crisis: '<38%', distance: '24%', impact: 'Institutions buying despite negative gamma' },
                { metric: 'Vanna Exposure', current: '+$450M', crisis: '+$1B', distance: '55%', impact: 'Positive vanna = rallies accelerate if VIX drops' }
            ];

            document.getElementById('microstructureMetrics').innerHTML = microstructure.map(m => 
                `<div class="card">
                    <div class="card-header"><span class="card-title">${m.metric}</span></div>
                    <div class="metric-value">${m.current}</div>
                    <div style="font-size: 12px; margin: 8px 0;">
                        <div>Crisis: ${m.crisis}</div>
                        <div>Distance: ${m.distance}</div>
                    </div>
                    <div style="font-size: 11px; color: rgba(255,255,255,0.6);">${m.impact}</div>
                </div>`
            ).join('');
        }

        function renderLiquidityTable() {
            const liquidity = [
                { metric: 'Total Repo Fails', current: '$285B/day', normal: '$100B', crisis: '$400B', multiple: '2.85x', status: 'STRESSED', impact: 'Severe collateral shortage. One sovereign selloff from breakdown.' },
                { metric: 'SOFR-FF Spread', current: '11.5bp', normal: '2bp', crisis: '25bp', multiple: '5.75x', status: 'WIDENING', impact: 'Secured > unsecured = collateral scarcity' },
                { metric: 'FRA-OIS', current: '42bp', normal: '10bp', crisis: '80bp', multiple: '4.2x', status: 'STRESS', impact: 'Bank credit risk highest since March 2023' },
                { metric: 'Primary Dealer Holdings', current: '$285B', normal: '$180B', crisis: '$350B', multiple: '1.58x', status: 'OVERLOADED', impact: 'Dealers stuck with inventory' }
            ];

            document.getElementById('liquidityBody').innerHTML = liquidity.map(l => 
                `<tr>
                    <td>${l.metric}</td>
                    <td>${l.current}</td>
                    <td>${l.normal}</td>
                    <td>${l.crisis}</td>
                    <td class="${parseFloat(l.multiple) > 3 ? 'negative' : 'neutral'}">${l.multiple}</td>
                    <td class="${l.status.includes('STRESS') || l.status.includes('WIDENING') ? 'negative' : 'neutral'}">${l.status}</td>
                    <td style="font-size: 12px;">${l.impact}</td>
                </tr>`
            ).join('');
        }

        function renderCentralBankTable() {
            const centralBanks = [
                { bank: 'Federal Reserve', balance: '$6.6T', weekly: '-$22B', monthly: '-$95B', yearly: '-$520B', policy: 'QT AUTO', impact: 'Draining $95B/month indefinitely' },
                { bank: 'ECB', balance: '‚Ç¨7.2T', weekly: '-‚Ç¨11B', monthly: '-‚Ç¨45B', yearly: '-‚Ç¨380B', policy: 'TLTRO RUNOFF', impact: '‚Ç¨450B cliff Q4' },
                { bank: 'BOJ', balance: '¬•755T', weekly: '+¬•2T', monthly: '+¬•8T', yearly: '+¬•45T', policy: 'STILL EASING', impact: 'Only CB adding' },
                { bank: 'PBOC', balance: '¬•45T', weekly: '+¬•0.1T', monthly: '+¬•0.5T', yearly: '+¬•2.8T', policy: 'STEALTH QE', impact: 'Shadow easing' }
            ];

            document.getElementById('centralBankBody').innerHTML = centralBanks.map(cb => 
                `<tr>
                    <td>${cb.bank}</td>
                    <td>${cb.balance}</td>
                    <td class="${cb.weekly.startsWith('+') ? 'positive' : 'negative'}">${cb.weekly}</td>
                    <td class="${cb.monthly.startsWith('+') ? 'positive' : 'negative'}">${cb.monthly}</td>
                    <td class="${cb.yearly.startsWith('+') ? 'positive' : 'negative'}">${cb.yearly}</td>
                    <td>${cb.policy}</td>
                    <td style="font-size: 12px;">${cb.impact}</td>
                </tr>`
            ).join('');
        }

        function renderLaborMetrics() {
            const labor = [
                { metric: 'Unemployment Rate', value: '4.2%', change: {m3: '+0.3pp', yoy: '+0.7pp'}, recession: '5.0%', distance: '0.8pp' },
                { metric: 'Initial Claims (4W)', value: '235K', change: {trend: '+10K/mo'}, recession: '300K', distance: '65K' },
                { metric: 'Job Openings', value: '8.2M', change: {trend: '-400K/mo'}, recession: '6.0M', distance: '2.2M' },
                { metric: 'Quits Rate', value: '2.1%', change: {m3: '-0.2pp'}, recession: '1.8%', distance: '0.3pp' }
            ];

            document.getElementById('laborMetrics').innerHTML = labor.map(l => 
                `<div class="card">
                    <div class="card-header"><span class="card-title">${l.metric}</span></div>
                    <div class="metric-value">${l.value}</div>
                    <div class="metric-change">
                        ${Object.entries(l.change).map(([k,v]) => 
                            `<span class="change-item ${v.startsWith('+') || v.startsWith('-4') ? 'negative' : 'neutral'}">${k}: ${v}</span>`
                        ).join('')}
                    </div>
                    <div style="font-size: 11px; margin-top: 8px;">
                        Recession: ${l.recession} | Distance: ${l.distance}
                    </div>
                </div>`
            ).join('');
        }

        function renderPMITable() {
            const pmi = [
                { country: 'United States', pmi: '47.8', orders: '45.2', m1: '-1.2', m3: '-2.3', status: 'CONTRACTION', interpretation: '6 months contracting. New orders <45 = mass layoffs coming.' },
                { country: 'China', pmi: '49.2', orders: '48.5', m1: '-0.8', m3: '-1.8', status: 'CONTRACTION', interpretation: 'Despite stimulus, failing. Export orders 43.2 = demand collapse.' },
                { country: 'Germany', pmi: '42.4', orders: '40.1', m1: '-1.5', m3: '-3.5', status: 'DEEP RECESSION', interpretation: 'Worst since 2009. Auto industry dying.' },
                { country: 'Japan', pmi: '48.9', orders: '47.8', m1: '-0.5', m3: '-0.8', status: 'WEAKENING', interpretation: 'Yen weakness not helping. BOJ trapped.' },
                { country: 'Global', pmi: '48.3', orders: '46.8', m1: '-1.1', m3: '-2.1', status: 'SYNCHRONIZED SLOWDOWN', interpretation: 'Only 8/30 economies >50. Global recession beginning.' }
            ];

            document.getElementById('pmiBody').innerHTML = pmi.map(p => 
                `<tr>
                    <td>${p.country}</td>
                    <td class="${parseFloat(p.pmi) < 50 ? 'negative' : 'positive'}">${p.pmi}</td>
                    <td class="${parseFloat(p.orders) < 50 ? 'negative' : 'positive'}">${p.orders}</td>
                    <td class="negative">${p.m1}</td>
                    <td class="negative">${p.m3}</td>
                    <td class="${p.status.includes('RECESSION') ? 'negative' : 'neutral'}">${p.status}</td>
                    <td style="font-size: 12px;">${p.interpretation}</td>
                </tr>`
            ).join('');
        }

        function renderCreditSpreads() {
            const spreads = [
                { index: 'IG Index', current: '128bp', change: {w1: '+5', m1: '+15'}, crisis: '250bp', distance: '51%' },
                { index: 'HY Master', current: '385bp', change: {w1: '+12', m1: '+35'}, crisis: '800bp', distance: '52%' },
                { index: 'CCC Rated', current: '985bp', change: {w1: '+45', m1: '+125'}, crisis: '1600bp', distance: '38%' },
                { index: 'Fallen Angels', current: '42/mo', change: {w1: '+8', m1: '+12'}, crisis: '100/mo', distance: '58%' }
            ];

            document.getElementById('creditSpreads').innerHTML = spreads.map(s => 
                `<div class="card">
                    <div class="card-header"><span class="card-title">${s.index}</span></div>
                    <div class="metric-value">${s.current}</div>
                    <div class="metric-change">
                        <span class="change-item negative">1W: ${s.change.w1}</span>
                        <span class="change-item negative">1M: ${s.change.m1}</span>
                    </div>
                    <div style="font-size: 11px; margin-top: 8px;">
                        Crisis: ${s.crisis} | Distance: ${s.distance}
                    </div>
                </div>`
            ).join('');
        }

        function renderEquityInternals() {
            const internals = [
                { metric: '% Stocks >50DMA', spx: '42%', ndx: '35%', rut: '28%', signal: 'Terrible breadth near highs = DISTRIBUTION' },
                { metric: '% Stocks >200DMA', spx: '61%', ndx: '48%', rut: '39%', signal: 'Long-term breadth breakdown' },
                { metric: 'New Highs-Lows', spx: '-412', ndx: '-235', rut: '-589', signal: 'Worst since March 2020' },
                { metric: 'Advance/Decline', spx: '0.65', ndx: '0.58', rut: '0.42', signal: 'Heavy selling pressure' },
                { metric: 'McClellan Oscillator', spx: '-125', ndx: '-145', rut: '-185', signal: 'Oversold but still falling' }
            ];

            document.getElementById('internalsBody').innerHTML = internals.map(i => 
                `<tr>
                    <td>${i.metric}</td>
                    <td class="${parseFloat(i.spx) < 50 || i.spx.startsWith('-') ? 'negative' : 'neutral'}">${i.spx}</td>
                    <td class="${parseFloat(i.ndx) < 50 || i.ndx.startsWith('-') ? 'negative' : 'neutral'}">${i.ndx}</td>
                    <td class="${parseFloat(i.rut) < 50 || i.rut.startsWith('-') ? 'negative' : 'neutral'}">${i.rut}</td>
                    <td style="font-size: 12px;">${i.signal}</td>
                </tr>`
            ).join('');
        }

        function renderSentimentMetrics() {
            const sentiment = [
                { indicator: 'Equity Positioning', current: '+2.1œÉ', percentile: '92nd', signal: 'EXTREME LONG', context: 'Most long since 2021 top' },
                { indicator: 'Bond Positioning', current: '-1.8œÉ', percentile: '8th', signal: 'EXTREME SHORT', context: 'Record shorts' },
                { indicator: 'Put/Call Ratio', current: '0.65', percentile: '15th', signal: 'COMPLACENT', context: 'No hedging' },
                { indicator: 'Fund Cash', current: '3.8%', percentile: '5th', signal: 'RECORD LOW', context: 'Lowest since 2000' },
                { indicator: 'VIX Term Structure', current: '-2.5', percentile: '18th', signal: 'INVERTED', context: 'Near-term fear' }
            ];

            document.getElementById('sentimentMetrics').innerHTML = sentiment.map(s => 
                `<div class="card">
                    <div class="card-header"><span class="card-title">${s.indicator}</span></div>
                    <div class="metric-value">${s.current}</div>
                    <div style="font-size: 12px; margin: 8px 0;">
                        <div>Percentile: ${s.percentile}</div>
                        <div class="${s.signal.includes('EXTREME') ? 'negative' : 'neutral'}">${s.signal}</div>
                    </div>
                    <div style="font-size: 11px; color: rgba(255,255,255,0.6);">${s.context}</div>
                </div>`
            ).join('');
        }

        function renderInsiderTrading() {
            const insiders = [
                { entity: 'Tech CEOs', action: 'SELLING', sector: 'Software/Semi', amount: '$2.3B', signal: 'üî¥üî¥üî¥üî¥üî¥', interpretation: 'Largest since 2021 top' },
                { entity: 'Bank CEOs', action: 'BUYING', sector: 'Regional Banks', amount: '$125M', signal: 'üü¢üü¢üü¢üü¢', interpretation: 'First time in 3 years' },
                { entity: 'Congress', action: 'MIXED', sector: 'Defense/China', amount: '$45M', signal: 'üü°üü°üü°', interpretation: 'Selling China/Tech, buying defense' },
                { entity: 'Pelosi', action: 'SELLING', sector: 'NVDA calls', amount: '$5M', signal: 'üî¥üî¥üî¥üî¥', interpretation: 'She NEVER sells early' }
            ];

            document.getElementById('insiderBody').innerHTML = insiders.map(i => 
                `<tr>
                    <td>${i.entity}</td>
                    <td class="${i.action === 'SELLING' ? 'negative' : i.action === 'BUYING' ? 'positive' : 'neutral'}">${i.action}</td>
                    <td>${i.sector}</td>
                    <td>${i.amount}</td>
                    <td>${i.signal}</td>
                    <td>${i.interpretation}</td>
                </tr>`
            ).join('');
        }

        function renderTechnicalLevels() {
            const levels = [
                { level: 'SPX Zero Gamma', current: '4502', critical: '4420', distance: '82 pts', impact: 'Below = volatility explosion, dealers sell' },
                { level: 'SPX 200DMA', current: '4502', critical: '4150', distance: '352 pts', impact: 'Break = bear market, systematic selling $50B' },
                { level: '10Y Yield', current: '4.42%', critical: '4.50%', distance: '8bp', impact: 'Above = bond crash resumes, TLT to $85' },
                { level: 'DXY', current: '105.2', critical: '106', distance: '0.8', impact: 'Above = EM crisis, $2T carry unwind' },
                { level: 'VIX', current: '18.5', critical: '25', distance: '6.5', impact: 'Above = dealer panic, forced covering' },
                { level: 'USDJPY', current: '148.5', critical: '145', distance: '3.5', impact: 'Below = $1.8T carry unwind begins' }
            ];

            document.getElementById('technicalBody').innerHTML = levels.map(l => 
                `<tr>
                    <td>${l.level}</td>
                    <td>${l.current}</td>
                    <td class="negative">${l.critical}</td>
                    <td class="${l.distance.includes('8bp') || l.distance.includes('0.8') ? 'negative' : 'neutral'}">${l.distance}</td>
                    <td style="font-size: 12px;">${l.impact}</td>
                </tr>`
            ).join('');
        }

        function renderIntermarketRelationships() {
            const relationships = [
                { relationship: 'Stocks/Bonds', current: '+0.65', normal: '-0.20', signal: 'RISK OFF', interpretation: 'Both selling = nowhere to hide. 60/40 broken.' },
                { relationship: 'Dollar/Gold', current: '+0.45', normal: '-0.60', signal: 'ANOMALY', interpretation: 'Both rising = systemic fear. CBs buying gold.' },
                { relationship: 'Oil/Yields', current: '+0.85', normal: '+0.40', signal: 'INFLATION', interpretation: 'Oil driving yields. Energy shock = rate shock.' },
                { relationship: 'Copper/Gold', current: '0.0042', normal: '0.0050', signal: 'RECESSION', interpretation: 'Classic recession trade. Growth collapsing.' },
                { relationship: 'JPY Carry', current: '$1.8T', normal: '$1.2T', signal: 'EXTREME', interpretation: 'Largest ever. Unwind = global crisis.' }
            ];

            document.getElementById('intermarketBody').innerHTML = relationships.map(r => 
                `<tr>
                    <td>${r.relationship}</td>
                    <td>${r.current}</td>
                    <td>${r.normal}</td>
                    <td class="${r.signal === 'EXTREME' || r.signal === 'ANOMALY' ? 'negative' : 'neutral'}">${r.signal}</td>
                    <td style="font-size: 12px;">${r.interpretation}</td>
                </tr>`
            ).join('');
        }

        function renderTrades() {
            const trades = [
                { rank: 1, trade: 'Long SPY/Short QQQ', entry: 'Current', stop: '-3%', target: '+8%', confidence: 90 },
                { rank: 2, trade: 'Long TLT Volatility', entry: 'IV<25', stop: '-30%', target: '+150%', confidence: 85 },
                { rank: 3, trade: 'Short Regional Banks', entry: 'KRE $52', stop: '$54', target: '$45', confidence: 85 },
                { rank: 4, trade: 'Long USD/CNH', entry: '7.30', stop: '7.20', target: '7.50', confidence: 80 },
                { rank: 5, trade: 'Long VIX Jan Calls', entry: '$2.50', stop: '$1.00', target: '$8.00', confidence: 80 }
            ];

            document.getElementById('tradesBody').innerHTML = trades.map(t => 
                `<div class="trade-row">
                    <span>#${t.rank}</span>
                    <span>${t.trade}</span>
                    <span>${t.entry}</span>
                    <span class="positive">${t.target}</span>
                    <span class="negative">${t.stop}</span>
                    <div>
                        <div class="confidence-bar">
                            <div class="confidence-fill" style="width: ${t.confidence}%"></div>
                        </div>
                        <small>${t.confidence}%</small>
                    </div>
                </div>`
            ).join('');
        }

        function renderBlackSwanRisks() {
            const risks = [
                { risk: 'China dumps remaining Treasuries rapidly', probability: '5%', impact: 'SPX -20%', timeline: '1-3 months' },
                { risk: 'Japanese carry trade unwind accelerates', probability: '8%', impact: 'Global -15%', timeline: '2-4 weeks' },
                { risk: 'European banking crisis from TLTRO cliff', probability: '10%', impact: 'Contagion risk', timeline: 'Q4 2025' },
                { risk: 'Repo market complete seizure', probability: '3%', impact: 'Fed emergency intervention', timeline: 'Any time' }
            ];

            document.getElementById('blackSwanRisks').innerHTML = risks.map(r => 
                `<div class="alert-box" style="margin: 10px 0;">
                    <strong>${r.risk}</strong><br>
                    Probability: ${r.probability} | Impact: ${r.impact} | Timeline: ${r.timeline}
                </div>`
            ).join('');
        }

        function renderAgentGrid() {
            const agents = [
                'fed-liquidity', 'treasury-api', 'ai-prediction', 'ice-bofa',
                'coinmarketcap', 'alphavantage', 'cross-currency', 'enhanced-repo',
                'census-economic', 'ny-fed', 'fred-api', 'chatgpt-agent',
                'global-liquidity', 'polygon-api'
            ];

            document.getElementById('agentGrid').innerHTML = agents.map(agent => 
                `<div class="agent-card" id="agent-${agent}">
                    <div class="agent-name">${formatAgentName(agent)}</div>
                    <div class="agent-metrics">
                        <div>Status: <span id="${agent}-status">Connecting...</span></div>
                        <div>Response: <span id="${agent}-response">--</span></div>
                        <div>Data Points: <span id="${agent}-datapoints">--</span></div>
                    </div>
                </div>`
            ).join('');
        }

        function formatAgentName(agent) {
            return agent.split('-').map(word => 
                word.charAt(0).toUpperCase() + word.slice(1)
            ).join(' ');
        }

        function initializeAllCharts() {
            // Dark Pool Chart
            const darkPoolCtx = document.getElementById('darkPoolChart').getContext('2d');
            charts.darkPool = new Chart(darkPoolCtx, {
                type: 'bar',
                data: {
                    labels: ['SPY', 'QQQ', 'NVDA', 'AAPL', 'MSFT', 'TSLA', 'AMD', 'META'],
                    datasets: [{
                        label: 'Dark Pool Volume ($B)',
                        data: [2.3, 0.85, 1.2, 0.95, 0.78, 0.65, 0.55, 0.48],
                        backgroundColor: 'rgba(0, 255, 136, 0.5)',
                        borderColor: 'rgba(0, 255, 136, 1)',
                        borderWidth: 1
                    }]
                },
                options: getChartOptions()
            });

            // Central Bank Chart
            const cbCtx = document.getElementById('centralBankChart').getContext('2d');
            charts.centralBank = new Chart(cbCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep'],
                    datasets: [
                        { label: 'Fed ($T)', data: [7.2, 7.1, 7.0, 6.9, 6.8, 6.7, 6.6, 6.6, 6.6], borderColor: 'rgb(75, 192, 192)', tension: 0.1 },
                        { label: 'ECB (‚Ç¨T)', data: [7.8, 7.7, 7.6, 7.5, 7.4, 7.3, 7.2, 7.2, 7.2], borderColor: 'rgb(255, 99, 132)', tension: 0.1 },
                        { label: 'BOJ (¬•100T)', data: [7.1, 7.2, 7.3, 7.4, 7.5, 7.5, 7.5, 7.5, 7.55], borderColor: 'rgb(255, 205, 86)', tension: 0.1 },
                        { label: 'PBOC (¬•10T)', data: [4.3, 4.35, 4.4, 4.42, 4.45, 4.48, 4.5, 4.5, 4.5], borderColor: 'rgb(153, 102, 255)', tension: 0.1 }
                    ]
                },
                options: getChartOptions()
            });

            // Credit Spreads Chart
            const creditCtx = document.getElementById('creditChart').getContext('2d');
            charts.credit = new Chart(creditCtx, {
                type: 'line',
                data: {
                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep'],
                    datasets: [
                        { label: 'IG (bp)', data: [95, 98, 102, 108, 112, 115, 120, 125, 128], borderColor: 'rgb(75, 192, 192)', tension: 0.1 },
                        { label: 'HY (bp)', data: [320, 330, 340, 350, 360, 365, 370, 380, 385], borderColor: 'rgb(255, 99, 132)', tension: 0.1 },
                        { label: 'CCC (bp)', data: [850, 870, 890, 910, 930, 950, 965, 975, 985], borderColor: 'rgb(255, 205, 86)', tension: 0.1 }
                    ]
                },
                options: getChartOptions()
            });
        }

        function getChartOptions() {
            return {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: { labels: { color: 'white' } }
                },
                scales: {
                    y: {
                        ticks: { color: 'white' },
                        grid: { color: 'rgba(255,255,255,0.1)' }
                    },
                    x: {
                        ticks: { color: 'white' },
                        grid: { color: 'rgba(255,255,255,0.1)' }
                    }
                }
            };
        }

        async function fetchData() {
            try {
                const timestamp = new Date().toLocaleTimeString();
                console.log(`[${timestamp}] Fetching data from API...`);
                
                // Visual indicator that fetch is happening
                document.getElementById('refreshCountdown').style.background = '#00ff88';
                
                const response = await fetch('https://api.justhodl.ai/', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ operation: 'data' })
                });

                if (response.ok) {
                    const data = await response.json();
                    console.log(`[${timestamp}] Data received:`, data);
                    allData = data;
                    updateWithRealData(data);
                    
                    // Show last update time
                    const updateNotice = document.createElement('div');
                    updateNotice.style.cssText = 'position: fixed; top: 80px; right: 20px; background: #00ff88; color: black; padding: 10px; border-radius: 5px; animation: fadeOut 3s forwards;';
                    updateNotice.textContent = `Updated: ${timestamp}`;
                    document.body.appendChild(updateNotice);
                    setTimeout(() => updateNotice.remove(), 3000);
                }
                
                document.getElementById('refreshCountdown').style.background = '';
            } catch (error) {
                console.error(`[${new Date().toLocaleTimeString()}] Error:`, error);
            }
        }

        function updateWithRealData(data) {
            if (!data || !data.raw_data) return;
            
            const rawData = data.raw_data;
            
            // Update agent status
            let activeCount = 0;
            Object.keys(rawData).forEach(agent => {
                const hasData = rawData[agent] && Object.keys(rawData[agent]).length > 0;
                if (hasData) {
                    activeCount++;
                    const card = document.getElementById(`agent-${agent}`);
                    if (card) {
                        card.className = 'agent-card';
                        document.getElementById(`${agent}-status`).textContent = 'Active';
                        document.getElementById(`${agent}-status`).className = 'positive';
                        document.getElementById(`${agent}-datapoints`).textContent = Object.keys(rawData[agent]).length;
                    }
                }
            });
            
            document.getElementById('activeAgents').textContent = `${activeCount}/14 Agents`;
            
            // Update metrics from real data
            updateMetricsFromData(rawData);
            updateKhalidIndex(data);
        }

        function updateMetricsFromData(rawData) {
            // Search for VIX
            for (const agent in rawData) {
                if (rawData[agent].VIXCLS) {
                    document.getElementById('vix-value').textContent = parseFloat(rawData[agent].VIXCLS).toFixed(2);
                    break;
                }
            }
            
            // Search for S&P 500
            for (const agent in rawData) {
                if (rawData[agent].SP500 || rawData[agent].sp500) {
                    const value = rawData[agent].SP500 || rawData[agent].sp500;
                    document.getElementById('sp500-value').textContent = formatNumber(value);
                    break;
                }
            }
            
            // Bitcoin from coinmarketcap
            if (rawData.coinmarketcap && rawData.coinmarketcap.bitcoin) {
                document.getElementById('bitcoin-value').textContent = '$' + formatNumber(rawData.coinmarketcap.bitcoin.price || 115376);
            }
            
            // Fed Balance (WALCL)
            for (const agent in rawData) {
                if (rawData[agent].WALCL) {
                    const value = (parseFloat(rawData[agent].WALCL) / 1000000000000).toFixed(1);
                    document.getElementById('fed-value').textContent = '$' + value + 'T';
                    break;
                }
            }
            
            // Treasury 10Y
            for (const agent in rawData) {
                if (rawData[agent].DGS10) {
                    document.getElementById('treasury10y-value').textContent = parseFloat(rawData[agent].DGS10).toFixed(2) + '%';
                    break;
                }
            }
            
            // Dollar Index
            for (const agent in rawData) {
                if (rawData[agent].DXY || rawData[agent].DTWEXBGS) {
                    const value = rawData[agent].DXY || rawData[agent].DTWEXBGS;
                    document.getElementById('dollar-value').textContent = parseFloat(value).toFixed(2);
                    break;
                }
            }
        }

        function updateKhalidIndex(data) {
            let index = 45;
            
            if (data.processed && data.processed.khalid_index) {
                index = data.processed.khalid_index;
            } else if (data.raw_data && data.raw_data['ai-prediction']) {
                const aiData = data.raw_data['ai-prediction'];
                if (aiData.crisis_probability) {
                    index = Math.round(100 - parseFloat(aiData.crisis_probability));
                }
            }
            
            document.getElementById('khalidIndexValue').textContent = index;
            document.getElementById('indexPointer').style.left = index + '%';
            
            let signal = 'HOLD';
            if (index < 20) signal = 'EXTREME FEAR/BUY';
            else if (index < 35) signal = 'FEAR/ADD';
            else if (index > 80) signal = 'EXTREME GREED/SELL';
            else if (index > 65) signal = 'GREED/TAKE PROFITS';
            
            document.getElementById('khalidSignal').textContent = signal;
            document.getElementById('marketRegime').textContent = 
                index < 30 ? 'CRISIS/CAPITULATION' : 
                index < 45 ? 'LATE CYCLE DISTRIBUTION' :
                index < 55 ? 'NEUTRAL' :
                index < 70 ? 'RISK-ON' : 'EUPHORIA/BUBBLE';
            document.getElementById('crisisDistance').textContent = (100 - index) + '%';
        }

        function setupAutoRefresh() {
            let countdown = refreshInterval;
            let updateCount = 0;
            
            // Add update counter display
            const counterDiv = document.createElement('div');
            counterDiv.className = 'update-counter';
            counterDiv.innerHTML = `Updates: <span id="updateCount">0</span> | Last: <span id="lastUpdate">Never</span>`;
            document.body.appendChild(counterDiv);
            
            // Update every second
            const countdownInterval = setInterval(() => {
                countdown--;
                document.getElementById('refreshCountdown').textContent = countdown;
                
                // Visual countdown indicator
                if (countdown <= 5) {
                    document.getElementById('refreshCountdown').style.color = '#ffaa00';
                } else {
                    document.getElementById('refreshCountdown').style.color = '#ffffff';
                }
                
                if (countdown <= 0) {
                    countdown = refreshInterval;
                    updateCount++;
                    
                    // Update counter display
                    document.getElementById('updateCount').textContent = updateCount;
                    document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString();
                    
                    // Actually fetch data
                    fetchData();
                    
                    console.log(`[AUTO-UPDATE #${updateCount}] Fetching at ${new Date().toLocaleTimeString()}`);
                }
            }, 1000);
            
            // Also add manual refresh button
            const refreshBtn = document.createElement('button');
            refreshBtn.textContent = 'Manual Refresh';
            refreshBtn.style.cssText = 'position: fixed; bottom: 20px; left: 20px; background: #00ff88; color: black; padding: 10px 20px; border: none; border-radius: 8px; cursor: pointer; font-weight: bold;';
            refreshBtn.onclick = () => {
                console.log('[MANUAL REFRESH] Triggered by user');
                fetchData();
                updateCount++;
                document.getElementById('updateCount').textContent = updateCount;
                document.getElementById('lastUpdate').textContent = new Date().toLocaleTimeString();
            };
            document.body.appendChild(refreshBtn);
        }

        function updateTime() {
            setInterval(() => {
                const now = new Date();
                document.getElementById('currentTime').textContent = 
                    now.toLocaleTimeString('en-US', { 
                        hour: '2-digit', 
                        minute: '2-digit', 
                        second: '2-digit',
                        timeZone: 'America/New_York'
                    }) + ' ET';
            }, 1000);
        }

        function formatNumber(num) {
            if (!num) return '0';
            return parseFloat(num).toLocaleString('en-US', {
                minimumFractionDigits: 0,
                maximumFractionDigits: 2
            });
        }

        // Make data globally accessible
        window.allData = allData;
    </script>
</body>
</html>
