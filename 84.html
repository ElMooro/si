<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JustHodl.AI | Live Financial Command Center</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #00ff41;
            --danger: #ff0040;
            --warning: #ffaa00;
            --info: #00aaff;
            --bg-primary: #0a0e27;
            --bg-secondary: #111827;
            --bg-tertiary: #1a1f3a;
            --border: #2d3561;
            --text-primary: #e0e7ff;
            --text-secondary: #94a3b8;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            overflow-x: hidden;
        }

        /* Header */
        .header {
            background: linear-gradient(180deg, rgba(26, 31, 58, 0.95) 0%, rgba(17, 24, 39, 0.95) 100%);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border);
            padding: 15px 30px;
            position: sticky;
            top: 0;
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .logo-icon {
            width: 45px;
            height: 45px;
            background: linear-gradient(135deg, #00ff41 0%, #00aaff 100%);
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            color: var(--bg-primary);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        .logo-text {
            font-size: 24px;
            font-weight: 800;
            background: linear-gradient(135deg, #00ff41 0%, #00aaff 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .header-stats {
            display: flex;
            gap: 30px;
            align-items: center;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .stat-value {
            font-size: 20px;
            font-weight: bold;
            color: var(--primary);
        }

        .stat-label {
            font-size: 11px;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 15px;
            background: rgba(0, 255, 65, 0.1);
            border: 1px solid var(--primary);
            border-radius: 20px;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            background: var(--primary);
            border-radius: 50%;
            animation: blink 2s infinite;
        }

        .status-dot.error {
            background: var(--danger);
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.3; }
        }

        /* Controls */
        .controls {
            padding: 20px 30px;
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border);
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #00ff41 0%, #00aaff 100%);
            color: var(--bg-primary);
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 255, 65, 0.3);
        }

        .btn-secondary {
            background: transparent;
            color: var(--text-primary);
            border: 1px solid var(--border);
        }

        .btn-secondary:hover {
            background: var(--bg-tertiary);
            border-color: var(--primary);
        }

        .auto-refresh-indicator {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 8px 15px;
            background: rgba(0, 170, 255, 0.1);
            border: 1px solid var(--info);
            border-radius: 20px;
            margin-left: auto;
        }

        /* Main Container */
        .main-container {
            padding: 30px;
            max-width: 1800px;
            margin: 0 auto;
        }

        /* Data Display */
        .data-section {
            margin-bottom: 30px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid var(--border);
        }

        .section-title {
            font-size: 24px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .agent-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            background: rgba(0, 255, 65, 0.2);
            color: var(--primary);
            border: 1px solid var(--primary);
        }

        .agent-badge.error {
            background: rgba(255, 0, 64, 0.2);
            color: var(--danger);
            border-color: var(--danger);
        }

        /* JSON Data Display */
        .json-viewer {
            background: #000;
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 20px;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            overflow-x: auto;
            max-height: 600px;
            overflow-y: auto;
        }

        .json-key {
            color: #00aaff;
        }

        .json-string {
            color: #00ff41;
        }

        .json-number {
            color: #ffaa00;
        }

        .json-boolean {
            color: #ff00ff;
        }

        .json-null {
            color: #ff0040;
        }

        /* Agent Status Grid */
        .agents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .agent-card {
            background: var(--bg-tertiary);
            border: 1px solid var(--border);
            border-radius: 8px;
            padding: 15px;
            transition: all 0.3s;
            position: relative;
        }

        .agent-card.healthy {
            border-color: var(--primary);
        }

        .agent-card.unhealthy {
            border-color: var(--danger);
        }

        .agent-card:hover {
            transform: scale(1.02);
            box-shadow: 0 5px 15px rgba(0, 255, 65, 0.2);
        }

        .agent-name {
            font-size: 16px;
            font-weight: 600;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .agent-status {
            font-size: 12px;
            margin-bottom: 5px;
        }

        .agent-url {
            font-size: 11px;
            color: var(--text-secondary);
            word-break: break-all;
            margin-bottom: 10px;
        }

        .agent-data {
            font-size: 12px;
            background: #000;
            border-radius: 4px;
            padding: 8px;
            margin-top: 10px;
            max-height: 150px;
            overflow-y: auto;
        }

        /* Loading Animation */
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid var(--border);
            border-top-color: var(--primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-right: 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Terminal */
        .terminal {
            background: #000;
            border: 1px solid var(--primary);
            border-radius: 8px;
            padding: 15px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 400px;
            overflow-y: auto;
            margin-bottom: 30px;
        }

        .terminal-line {
            margin-bottom: 5px;
            display: flex;
            align-items: flex-start;
        }

        .terminal-timestamp {
            color: var(--text-secondary);
            margin-right: 10px;
        }

        .terminal-message {
            color: var(--primary);
            flex: 1;
        }

        .terminal-error {
            color: var(--danger);
        }

        .terminal-warning {
            color: var(--warning);
        }

        .terminal-info {
            color: var(--info);
        }

        /* Error Display */
        .error-message {
            background: rgba(255, 0, 64, 0.1);
            border: 1px solid var(--danger);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .error-icon {
            font-size: 24px;
            color: var(--danger);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
            }

            .controls {
                padding: 15px;
            }

            .agents-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="logo">
            <div class="logo-icon">JH</div>
            <div class="logo-text">JUSTHODL.AI - REAL DATA</div>
        </div>
        
        <div class="header-stats">
            <div class="stat-item">
                <div class="stat-value" id="totalAgents">0/0</div>
                <div class="stat-label">Active Agents</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="responseTime">0ms</div>
                <div class="stat-label">Response Time</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="dataPoints">0</div>
                <div class="stat-label">Data Points</div>
            </div>
            <div class="connection-status">
                <div class="status-dot" id="connectionDot"></div>
                <span id="connectionStatus">Connecting...</span>
            </div>
        </div>
    </header>

    <!-- Controls -->
    <div class="controls">
        <button class="btn btn-primary" onclick="fetchHealthCheck()">
            <i class="fas fa-heartbeat"></i> Health Check
        </button>
        <button class="btn btn-primary" onclick="fetchAnalyze()">
            <i class="fas fa-chart-line"></i> Full Analysis
        </button>
        <button class="btn btn-primary" onclick="fetchDiscover()">
            <i class="fas fa-search"></i> Discover
        </button>
        <button class="btn btn-secondary" onclick="toggleAutoRefresh()">
            <i class="fas fa-sync"></i> <span id="autoRefreshBtn">Enable Auto-Refresh</span>
        </button>
        <button class="btn btn-secondary" onclick="clearAllData()">
            <i class="fas fa-trash"></i> Clear Data
        </button>
        
        <div class="auto-refresh-indicator">
            <span id="refreshIndicator">Manual Mode</span>
            <span id="refreshCountdown"></span>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        
        <!-- Terminal Log -->
        <div class="terminal" id="terminal">
            <div class="terminal-line">
                <span class="terminal-timestamp">[00:00:00]</span>
                <span class="terminal-message">JUSTHODL.AI Real-Time Data System Initializing...</span>
            </div>
        </div>

        <!-- Agent Status Section -->
        <div class="data-section">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-robot"></i> Agent Status
                    <span id="agentStatusBadge" class="agent-badge">LOADING</span>
                </h2>
                <button class="btn btn-secondary" onclick="testAllAgents()">
                    <i class="fas fa-vial"></i> Test All Agents
                </button>
            </div>
            <div class="agents-grid" id="agentsGrid">
                <!-- Agents will be populated here -->
            </div>
        </div>

        <!-- Health Check Data -->
        <div class="data-section" id="healthSection" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-heartbeat"></i> Health Check Results
                    <span class="agent-badge" id="healthBadge">LIVE</span>
                </h2>
                <span id="healthTimestamp"></span>
            </div>
            <div class="json-viewer" id="healthData">
                <!-- Health data will appear here -->
            </div>
        </div>

        <!-- Analysis Data -->
        <div class="data-section" id="analysisSection" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-analytics"></i> Full System Analysis
                    <span class="agent-badge" id="analysisBadge">LIVE</span>
                </h2>
                <span id="analysisTimestamp"></span>
            </div>
            <div class="json-viewer" id="analysisData">
                <!-- Analysis data will appear here -->
            </div>
        </div>

        <!-- Individual Agent Data Sections -->
        <div id="agentDataSections">
            <!-- Dynamic agent sections will be created here -->
        </div>

    </div>

    <script>
        // Configuration
        const API_ENDPOINT = 'https://api.justhodl.ai/';
        const AGENT_URLS = {
            'polygon-api': 'https://fjf6t3ne4h.execute-api.us-east-1.amazonaws.com/prod',
            'alphavantage-technical-analysis': 'https://ngqq4e3hmqi6j5nky2mzoixc5e0yybrh.lambda-url.us-east-1.on.aws/',
            'global-liquidity-agent-v2': 'https://lwybn3kjcpofq5ifcre5ybtuey0fddxz.lambda-url.us-east-1.on.aws/',
            'treasury-api': 'https://oanydg4qltq5emsnnb2m23mifm0bqjqh.lambda-url.us-east-1.on.aws/',
            'fred-api': 'https://klehdyiwrl.execute-api.us-east-1.amazonaws.com/prod',
            'ny-fed': 'https://jc6ripzwk1.execute-api.us-east-1.amazonaws.com/prod',
            'coinmarketcap-agent': 'https://i5msak7bhk.execute-api.us-east-1.amazonaws.com/prod/crypto',
            'census-economic-agent': 'https://2lhhfitug2w2m4leajszuptafu0kgend.lambda-url.us-east-1.on.aws/',
            'ice-bofa': 'https://s57bexwijusq7jukyxishguffe0nukpw.lambda-url.us-east-1.on.aws/',
            'enhanced-repo-agent': 'https://uhuftf5gghrsnoeui66g24qeh40ovomr.lambda-url.us-east-1.on.aws/',
            'cross-currency': 'https://cm6i7tzsb6fpyvus5zvy43igae0oxmuc.lambda-url.us-east-1.on.aws/',
            'aiapi-market-analyzer': 'https://6fa5qo7fov36efsq7vftugu2iy0wfecn.lambda-url.us-east-1.on.aws/',
            'chatgpt-agent-api': 'https://aamyjez2avm6kvjowjowlcuk5m0pemhl.lambda-url.us-east-1.on.aws/',
            'fed-liquidity': 'https://mjqyipzzwjcmx44irtvijecswm0nkikf.lambda-url.us-east-1.on.aws/',
            'news-sentiment-agent': 'https://kcm6voksx75rzhyxkblfagcbeq0fxdyb.lambda-url.us-east-1.on.aws/'
        };

        // Global State
        let autoRefreshInterval = null;
        let refreshCountdown = 30;
        let lastHealthData = null;
        let lastAnalysisData = null;

        // Terminal Logger
        function log(message, type = 'info') {
            const terminal = document.getElementById('terminal');
            const timestamp = new Date().toLocaleTimeString();
            const line = document.createElement('div');
            line.className = 'terminal-line';
            
            let messageClass = 'terminal-message';
            if (type === 'error') messageClass = 'terminal-error';
            if (type === 'warning') messageClass = 'terminal-warning';
            if (type === 'success') messageClass = 'terminal-message';
            if (type === 'info') messageClass = 'terminal-info';
            
            line.innerHTML = `
                <span class="terminal-timestamp">[${timestamp}]</span>
                <span class="${messageClass}">${message}</span>
            `;
            
            terminal.appendChild(line);
            terminal.scrollTop = terminal.scrollHeight;
        }

        // Update Connection Status
        function updateConnectionStatus(connected, message) {
            const dot = document.getElementById('connectionDot');
            const status = document.getElementById('connectionStatus');
            
            if (connected) {
                dot.classList.remove('error');
                status.textContent = message || 'Connected to api.justhodl.ai';
            } else {
                dot.classList.add('error');
                status.textContent = message || 'Connection Error';
            }
        }

        // JSON Formatter
        function formatJSON(obj) {
            return JSON.stringify(obj, null, 2)
                .replace(/"([^"]+)":/g, '<span class="json-key">"$1":</span>')
                .replace(/: "([^"]*)"/g, ': <span class="json-string">"$1"</span>')
                .replace(/: (\d+\.?\d*)/g, ': <span class="json-number">$1</span>')
                .replace(/: (true|false)/g, ': <span class="json-boolean">$1</span>')
                .replace(/: null/g, ': <span class="json-null">null</span>');
        }

        // Count Data Points
        function countDataPoints(obj) {
            let count = 0;
            function traverse(o) {
                for (let key in o) {
                    if (o.hasOwnProperty(key)) {
                        count++;
                        if (typeof o[key] === 'object' && o[key] !== null) {
                            traverse(o[key]);
                        }
                    }
                }
            }
            traverse(obj);
            return count;
        }

        // Fetch Health Check
        async function fetchHealthCheck() {
            const startTime = Date.now();
            log('Initiating health check...', 'info');
            updateConnectionStatus(true, 'Checking health...');
            
            try {
                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ operation: 'health' })
                });
                
                const responseTime = Date.now() - startTime;
                document.getElementById('responseTime').textContent = `${responseTime}ms`;
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                lastHealthData = data;
                
                // Update display
                displayHealthData(data);
                updateAgentStatus(data);
                
                // Update stats
                const healthyAgents = data.healthy_agents || 0;
                const totalAgents = data.total_agents || 0;
                document.getElementById('totalAgents').textContent = `${healthyAgents}/${totalAgents}`;
                document.getElementById('dataPoints').textContent = countDataPoints(data);
                
                updateConnectionStatus(true, 'Connected - Health Check Complete');
                log(`Health check successful: ${healthyAgents}/${totalAgents} agents healthy (${responseTime}ms)`, 'success');
                
            } catch (error) {
                log(`Health check failed: ${error.message}`, 'error');
                updateConnectionStatus(false, 'Health Check Failed');
                displayError('healthSection', error.message);
            }
        }

        // Fetch Analyze
        async function fetchAnalyze() {
            const startTime = Date.now();
            log('Running full system analysis...', 'info');
            updateConnectionStatus(true, 'Analyzing all agents...');
            
            try {
                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ operation: 'analyze' })
                });
                
                const responseTime = Date.now() - startTime;
                document.getElementById('responseTime').textContent = `${responseTime}ms`;
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                lastAnalysisData = data;
                
                // Update display
                displayAnalysisData(data);
                processAgentData(data);
                
                // Update stats
                document.getElementById('dataPoints').textContent = countDataPoints(data);
                
                updateConnectionStatus(true, 'Connected - Analysis Complete');
                log(`Full analysis complete: ${Object.keys(data).length} agents returned data (${responseTime}ms)`, 'success');
                
            } catch (error) {
                log(`Analysis failed: ${error.message}`, 'error');
                updateConnectionStatus(false, 'Analysis Failed');
                displayError('analysisSection', error.message);
            }
        }

        // Fetch Discover
        async function fetchDiscover() {
            const startTime = Date.now();
            log('Running discover operation...', 'info');
            updateConnectionStatus(true, 'Discovering...');
            
            try {
                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ operation: 'discover' })
                });
                
                const responseTime = Date.now() - startTime;
                document.getElementById('responseTime').textContent = `${responseTime}ms`;
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                
                const data = await response.json();
                
                // Display as analysis data
                displayAnalysisData(data);
                
                updateConnectionStatus(true, 'Connected - Discover Complete');
                log(`Discover operation complete (${responseTime}ms)`, 'success');
                
            } catch (error) {
                log(`Discover failed: ${error.message}`, 'error');
                updateConnectionStatus(false, 'Discover Failed');
            }
        }

        // Display Health Data
        function displayHealthData(data) {
            const section = document.getElementById('healthSection');
            const dataDiv = document.getElementById('healthData');
            const timestamp = document.getElementById('healthTimestamp');
            
            section.style.display = 'block';
            timestamp.textContent = new Date().toLocaleString();
            dataDiv.innerHTML = formatJSON(data);
        }

        // Display Analysis Data
        function displayAnalysisData(data) {
            const section = document.getElementById('analysisSection');
            const dataDiv = document.getElementById('analysisData');
            const timestamp = document.getElementById('analysisTimestamp');
            
            section.style.display = 'block';
            timestamp.textContent = new Date().toLocaleString();
            dataDiv.innerHTML = formatJSON(data);
        }

        // Process Agent Data
        function processAgentData(data) {
            const sectionsDiv = document.getElementById('agentDataSections');
            sectionsDiv.innerHTML = '';
            
            // Process each agent's data
            Object.keys(data).forEach(agentName => {
                if (typeof data[agentName] === 'object' && data[agentName] !== null) {
                    createAgentDataSection(agentName, data[agentName]);
                }
            });
        }

        // Create Agent Data Section
        function createAgentDataSection(agentName, agentData) {
            const sectionsDiv = document.getElementById('agentDataSections');
            
            const section = document.createElement('div');
            section.className = 'data-section';
            
            const isHealthy = agentData.status !== 'error' && agentData.error === undefined;
            const dataPoints = countDataPoints(agentData);
            
            section.innerHTML = `
                <div class="section-header">
                    <h2 class="section-title">
                        <i class="fas fa-database"></i> ${agentName.toUpperCase()}
                        <span class="agent-badge ${isHealthy ? '' : 'error'}">
                            ${isHealthy ? `${dataPoints} POINTS` : 'ERROR'}
                        </span>
                    </h2>
                    <span>${new Date().toLocaleTimeString()}</span>
                </div>
                <div class="json-viewer">
                    ${formatJSON(agentData)}
                </div>
            `;
            
            sectionsDiv.appendChild(section);
        }

        // Update Agent Status Grid
        function updateAgentStatus(healthData) {
            const grid = document.getElementById('agentsGrid');
            const badge = document.getElementById('agentStatusBadge');
            
            grid.innerHTML = '';
            
            // Get agent status from health data
            const agents = healthData.agent_status || {};
            const healthyCount = Object.values(agents).filter(a => a.status === 'healthy').length;
            const totalCount = Object.keys(agents).length;
            
            badge.textContent = `${healthyCount}/${totalCount} HEALTHY`;
            badge.className = healthyCount === totalCount ? 'agent-badge' : 'agent-badge error';
            
            // Create cards for each agent
            Object.keys(AGENT_URLS).forEach(agentName => {
                const agentInfo = agents[agentName] || { status: 'unknown' };
                const card = createAgentCard(agentName, agentInfo);
                grid.appendChild(card);
            });
        }

        // Create Agent Card
        function createAgentCard(agentName, agentInfo) {
            const card = document.createElement('div');
            const isHealthy = agentInfo.status === 'healthy';
            
            card.className = `agent-card ${isHealthy ? 'healthy' : 'unhealthy'}`;
            
            card.innerHTML = `
                <div class="agent-name">${agentName}</div>
                <div class="agent-status">
                    Status: <strong style="color: ${isHealthy ? 'var(--primary)' : 'var(--danger)'}">
                        ${agentInfo.status || 'UNKNOWN'}
                    </strong>
                </div>
                <div class="agent-url">${AGENT_URLS[agentName]}</div>
                ${agentInfo.message ? `<div class="agent-data">${agentInfo.message}</div>` : ''}
                ${agentInfo.response_time ? `<div class="agent-status">Response: ${agentInfo.response_time}ms</div>` : ''}
                ${agentInfo.error ? `<div class="agent-data" style="color: var(--danger);">Error: ${agentInfo.error}</div>` : ''}
            `;
            
            // Add click to test individual agent
            card.onclick = () => testSingleAgent(agentName);
            
            return card;
        }

        // Test Single Agent
        async function testSingleAgent(agentName) {
            log(`Testing agent: ${agentName}...`, 'info');
            
            try {
                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        operation: 'run_agent',
                        agent: agentName
                    })
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}`);
                }
                
                const data = await response.json();
                log(`Agent ${agentName} test successful: ${JSON.stringify(data).length} bytes received`, 'success');
                
                // Create section for this agent's data
                createAgentDataSection(agentName, data);
                
            } catch (error) {
                log(`Agent ${agentName} test failed: ${error.message}`, 'error');
            }
        }

        // Test All Agents
        async function testAllAgents() {
            log('Testing all agents individually...', 'info');
            
            for (const agentName of Object.keys(AGENT_URLS)) {
                await testSingleAgent(agentName);
                await new Promise(resolve => setTimeout(resolve, 500)); // Small delay between tests
            }
            
            log('All agent tests complete', 'success');
        }

        // Display Error
        function displayError(sectionId, errorMessage) {
            const section = document.getElementById(sectionId);
            const dataDiv = section.querySelector('.json-viewer');
            
            section.style.display = 'block';
            dataDiv.innerHTML = `
                <div class="error-message">
                    <i class="fas fa-exclamation-triangle error-icon"></i>
                    <div>
                        <strong>Error:</strong> ${errorMessage}
                    </div>
                </div>
            `;
        }

        // Clear All Data
        function clearAllData() {
            document.getElementById('healthSection').style.display = 'none';
            document.getElementById('analysisSection').style.display = 'none';
            document.getElementById('agentDataSections').innerHTML = '';
            document.getElementById('terminal').innerHTML = `
                <div class="terminal-line">
                    <span class="terminal-timestamp">[${new Date().toLocaleTimeString()}]</span>
                    <span class="terminal-message">Terminal cleared. Ready for new operations.</span>
                </div>
            `;
            log('All data cleared', 'info');
        }

        // Toggle Auto-Refresh
        function toggleAutoRefresh() {
            const btn = document.getElementById('autoRefreshBtn');
            const indicator = document.getElementById('refreshIndicator');
            
            if (autoRefreshInterval) {
                clearInterval(autoRefreshInterval);
                autoRefreshInterval = null;
                btn.textContent = 'Enable Auto-Refresh';
                indicator.textContent = 'Manual Mode';
                document.getElementById('refreshCountdown').textContent = '';
                log('Auto-refresh disabled', 'warning');
            } else {
                autoRefreshInterval = setInterval(() => {
                    refreshCountdown--;
                    document.getElementById('refreshCountdown').textContent = `${refreshCountdown}s`;
                    
                    if (refreshCountdown <= 0) {
                        refreshCountdown = 30;
                        fetchHealthCheck();
                        fetchAnalyze();
                    }
                }, 1000);
                
                btn.textContent = 'Disable Auto-Refresh';
                indicator.textContent = 'Auto-Refresh Active';
                log('Auto-refresh enabled (30s interval)', 'success');
                
                // Immediate refresh
                fetchHealthCheck();
                fetchAnalyze();
            }
        }

        // Initialize on Load
        document.addEventListener('DOMContentLoaded', () => {
            log('JUSTHODL.AI Real-Time Data System v1.0', 'info');
            log('Connecting to api.justhodl.ai...', 'info');
            log('System ready. Click "Health Check" or "Full Analysis" to fetch real data.', 'success');
            
            updateConnectionStatus(true, 'Ready - Click buttons to fetch data');
            
            // Initial health check
            setTimeout(() => {
                log('Running initial health check...', 'info');
                fetchHealthCheck();
            }, 1000);
        });
    </script>
</body>
</html>
