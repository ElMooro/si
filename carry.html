<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>JustHodl.AI | Global Carry Trade Monitor</title>
<script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;600;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{--bg0:#060a12;--bg1:#0b0f1a;--bg2:#111827;--bg3:#1a2035;--bg4:#232b42;--brd:#1e2a45;--brd2:#2d3a5c;--t1:#e2e8f0;--t2:#94a3b8;--t3:#64748b;--green:#10b981;--red:#ef4444;--blue:#3b82f6;--yellow:#f59e0b;--orange:#f97316;--purple:#a78bfa;--cyan:#22d3ee;--pink:#ec4899;--gold:#fbbf24}*{margin:0;padding:0;box-sizing:border-box}body{background:var(--bg0);color:var(--t1);font-family:'DM Sans',sans-serif;min-height:100vh}.mono{font-family:'JetBrains Mono',monospace}a{color:var(--cyan);text-decoration:none}.topbar{background:linear-gradient(180deg,var(--bg1) 0%,rgba(11,15,26,.95) 100%);border-bottom:1px solid var(--brd);padding:12px 24px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:100;backdrop-filter:blur(12px)}.logo{font-size:18px;font-weight:700;letter-spacing:-0.5px}.logo .hl{color:var(--cyan)}.logo sub{color:var(--t3);font-weight:400;font-size:11px;margin-left:8px;letter-spacing:1.5px;text-transform:uppercase}.topbar-r{display:flex;align-items:center;gap:16px;font-size:11px;color:var(--t3)}.live{display:flex;align-items:center;gap:5px;color:var(--green)}.dot{width:6px;height:6px;border-radius:50%;background:var(--green);animation:blink 2s infinite}@keyframes blink{0%,100%{opacity:1}50%{opacity:.3}}.hero{padding:20px 24px;display:grid;grid-template-columns:repeat(5,1fr);gap:10px}.hc{background:linear-gradient(135deg,var(--bg2),var(--bg3));border:1px solid var(--brd);border-radius:10px;padding:16px;position:relative;overflow:hidden}.hc::before{content:'';position:absolute;top:0;left:0;right:0;height:2px}.hc.g::before{background:linear-gradient(90deg,var(--green),transparent)}.hc.r::before{background:linear-gradient(90deg,var(--red),transparent)}.hc.y::before{background:linear-gradient(90deg,var(--yellow),transparent)}.hc.c::before{background:linear-gradient(90deg,var(--cyan),transparent)}.hc-lbl{font-size:10px;color:var(--t3);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px}.hc-val{font-size:26px;font-weight:700;font-family:'JetBrains Mono',monospace}.hc-sub{font-size:10px;color:var(--t3);margin-top:4px;line-height:1.4}.hc-val.green{color:var(--green)}.hc-val.red{color:var(--red)}.hc-val.yellow{color:var(--yellow)}.hc-val.cyan{color:var(--cyan)}.hc-val.blue{color:var(--blue)}.section{padding:0 24px 20px}.sh{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;padding-top:8px;border-top:1px solid var(--brd)}.st{font-size:14px;font-weight:600;display:flex;align-items:center;gap:8px}.badge{font-size:9px;padding:2px 8px;border-radius:10px;font-weight:600;font-family:'JetBrains Mono',monospace;text-transform:uppercase;letter-spacing:.5px}.b-live{background:rgba(16,185,129,.12);color:var(--green);border:1px solid rgba(16,185,129,.2)}.b-risk{background:rgba(239,68,68,.12);color:var(--red);border:1px solid rgba(239,68,68,.2)}.b-info{background:rgba(59,130,246,.12);color:var(--blue);border:1px solid rgba(59,130,246,.2)}.ct-wrap{overflow-x:auto}.ct{width:100%;border-collapse:separate;border-spacing:0 4px}.ct th{font-size:10px;color:var(--t3);text-transform:uppercase;letter-spacing:1px;padding:6px 12px;text-align:left;font-weight:500;position:sticky;top:0}.ct td{padding:10px 12px;font-size:12px;background:var(--bg2);border-top:1px solid var(--brd);border-bottom:1px solid var(--brd)}.ct tr td:first-child{border-left:1px solid var(--brd);border-radius:8px 0 0 8px}.ct tr td:last-child{border-right:1px solid var(--brd);border-radius:0 8px 8px 0}.ct tbody tr:hover td{background:var(--bg3)}.ct-pair{font-weight:600;font-size:13px;white-space:nowrap}.ct-desc{font-size:10px;color:var(--t3);margin-top:2px}.ct-val{font-family:'JetBrains Mono',monospace;font-size:12px}.pos{color:var(--green)}.neg{color:var(--red)}.flat{color:var(--t3)}.signal{display:inline-flex;align-items:center;gap:5px;font-size:11px;font-weight:600;padding:3px 10px;border-radius:12px}.sig-build{color:var(--green);background:rgba(16,185,129,.1);border:1px solid rgba(16,185,129,.2)}.sig-unwind{color:var(--red);background:rgba(239,68,68,.1);border:1px solid rgba(239,68,68,.2);animation:pulse-red 2s infinite}.sig-stable{color:var(--yellow);background:rgba(245,158,11,.1);border:1px solid rgba(245,158,11,.2)}.sig-compressed{color:var(--purple);background:rgba(167,139,250,.1);border:1px solid rgba(167,139,250,.2)}@keyframes pulse-red{0%,100%{box-shadow:0 0 0 0 rgba(239,68,68,.3)}50%{box-shadow:0 0 8px 2px rgba(239,68,68,.15)}}.sig-dot{width:6px;height:6px;border-radius:50%}.sig-build .sig-dot{background:var(--green)}.sig-unwind .sig-dot{background:var(--red)}.sig-stable .sig-dot{background:var(--yellow)}.sig-compressed .sig-dot{background:var(--purple)}.bar-wrap{width:80px;height:5px;background:var(--bg4);border-radius:3px;overflow:hidden}.bar-fill{height:100%;border-radius:3px;transition:width .5s}.impact-tag{font-size:10px;padding:2px 8px;border-radius:4px;white-space:nowrap}.imp-add{color:var(--green);background:rgba(16,185,129,.08)}.imp-drain{color:var(--red);background:rgba(239,68,68,.08)}.imp-neutral{color:var(--t3);background:rgba(100,116,139,.08)}.lg{display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:8px}.lc{background:var(--bg2);border:1px solid var(--brd);border-radius:8px;padding:14px;transition:border-color .2s}.lc:hover{border-color:var(--brd2)}.lc-lbl{font-size:10px;color:var(--t3);margin-bottom:4px;display:flex;justify-content:space-between}.lc-val{font-size:20px;font-weight:700;font-family:'JetBrains Mono',monospace}.lc-chg{font-size:11px;font-family:'JetBrains Mono',monospace;margin-top:3px}.chart-row{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px}.chart-box{background:var(--bg2);border:1px solid var(--brd);border-radius:8px;padding:14px}.chart-box h4{font-size:11px;color:var(--t2);margin-bottom:8px;font-weight:500}.analysis{background:var(--bg2);border:1px solid var(--brd);border-radius:8px;padding:18px;margin-bottom:12px;line-height:1.7;font-size:13px;color:var(--t2)}.analysis h4{color:var(--t1);font-size:13px;margin-bottom:8px}.analysis .key{color:var(--cyan);font-weight:600}.analysis .warn{color:var(--yellow);font-weight:600}.analysis .danger{color:var(--red);font-weight:600}.status-bar{position:fixed;bottom:0;left:0;right:0;background:var(--bg1);border-top:1px solid var(--brd);padding:5px 24px;font-size:10px;color:var(--t3);font-family:'JetBrains Mono',monospace;display:flex;justify-content:space-between;align-items:center;z-index:100}.prog{width:180px;height:3px;background:var(--bg3);border-radius:2px;overflow:hidden;display:none}.prog-fill{height:100%;background:var(--cyan);border-radius:2px;transition:width .3s}.nav-link{color:var(--t3);font-size:11px;text-decoration:none;padding:4px 10px;border:1px solid var(--brd);border-radius:5px;transition:all .15s}.nav-link:hover{color:var(--cyan);border-color:var(--cyan)}@media(max-width:1200px){.hero{grid-template-columns:repeat(3,1fr)}.chart-row{grid-template-columns:1fr}}@media(max-width:768px){.hero{grid-template-columns:1fr 1fr}.chart-row{grid-template-columns:1fr}.ct{font-size:11px}}@media(max-width:500px){.hero{grid-template-columns:1fr}}
</style>
</head>
<body>
<div class="topbar"><div class="logo"><span class="hl">CARRY</span>TRADE<sub>Global Flow Monitor v1.0</sub></div><div class="topbar-r"><a href="index.html" class="nav-link">Terminal</a><a href="fred.html" class="nav-link">FRED</a><div class="live"><div class="dot"></div> LIVE</div><span id="clock" class="mono"></span></div></div>
<div class="hero"><div class="hc c" id="hGci"><div class="hc-lbl">Carry Attractiveness Index</div><div class="hc-val cyan" id="vGci">--</div><div class="hc-sub" id="sGci">Weighted avg carry-to-vol ratio</div></div><div class="hc g" id="hVix"><div class="hc-lbl">Risk Environment (VIX)</div><div class="hc-val" id="vVix">--</div><div class="hc-sub" id="sVix">Volatility regime</div></div><div class="hc c" id="hLiq"><div class="hc-lbl">G3 Central Bank Assets</div><div class="hc-val cyan" id="vLiq">--</div><div class="hc-sub" id="sLiq">Fed + ECB + BoJ combined</div></div><div class="hc y" id="hUnwind"><div class="hc-lbl">Unwind Alerts</div><div class="hc-val yellow" id="vUnwind">--</div><div class="hc-sub" id="sUnwind">Carry trades showing stress</div></div><div class="hc g" id="hSpread"><div class="hc-lbl">JPY-USD Spread</div><div class="hc-val" id="vSpread">--</div><div class="hc-sub" id="sSpread">Key carry differential (bps)</div></div></div>
<div class="section"><div class="sh"><div class="st">Major Global Carry Trades <span class="badge b-live">LIVE DATA</span></div><div style="font-size:10px;color:var(--t3)" id="lastRefresh"></div></div><div class="ct-wrap"><table class="ct"><thead><tr><th>Carry Trade</th><th>Funding Rate</th><th>Invest Rate</th><th>Spread (bps)</th><th>FX Rate</th><th>FX 1W %</th><th>FX 1M %</th><th>Carry/Vol</th><th>Signal</th><th>Strength</th><th>Liquidity Impact</th></tr></thead><tbody id="ctBody"></tbody></table></div></div>
<div class="section"><div class="sh"><div class="st">AI Carry Trade Analysis <span class="badge b-info">AUTO</span></div></div><div class="analysis" id="analysisBox"><h4>Loading analysis...</h4></div></div>
<div class="section"><div class="sh"><div class="st">Carry Trade Analytics</div></div><div class="chart-row"><div class="chart-box"><h4>Interest Rate Differentials (basis points)</h4><div id="chDiff" style="height:280px"></div></div><div class="chart-box"><h4>FX Momentum - 1 Month Change (%)</h4><div id="chFX" style="height:280px"></div></div></div><div class="chart-row"><div class="chart-box"><h4>Central Bank Balance Sheets (Trillions)</h4><div id="chCB" style="height:280px"></div></div><div class="chart-box"><h4>Carry Risk Indicator (VIX + FX Vol)</h4><div id="chRisk" style="height:280px"></div></div></div></div>
<div class="section"><div class="sh"><div class="st">Global Liquidity Dashboard <span class="badge b-info">REAL-TIME</span></div></div><div class="lg" id="liqGrid"></div></div>
<div class="status-bar"><span id="sMsg">Initializing carry trade monitor...</span><div class="prog" id="prog"><div class="prog-fill" id="pFill"></div></div></div>
<script>
var PROXY='https://4dgpa7mv5dfipsh3gi2xim6uja0igozb.lambda-url.us-east-1.on.aws/';

var CARRIES=[
{id:'jpy_usd',name:'JPY > USD',desc:'Borrow Yen, Invest US Dollar',fund:'IRSTCI01JPM156N',invest:'DFF',fx:'DEXJPUS',fxInv:false,fbFund:0.50,fbInvest:null,color:'#ef4444',fundLbl:'BoJ Policy',investLbl:'Fed Funds',fxLbl:'USD/JPY',size:'massive'},
{id:'jpy_aud',name:'JPY > AUD',desc:'Borrow Yen, Invest Aussie Dollar',fund:'IRSTCI01JPM156N',invest:'IR3TIB01AUM156N',fx:'DEXJPUS',fxInv:false,fbFund:0.50,fbInvest:4.10,color:'#f97316',fundLbl:'BoJ Policy',investLbl:'RBA Rate',fxLbl:'USD/JPY proxy',size:'large'},
{id:'jpy_mxn',name:'JPY > MXN',desc:'Borrow Yen, Invest Mexican Peso',fund:'IRSTCI01JPM156N',invest:'INTGSTMXM193N',fx:'DEXMXUS',fxInv:true,fbFund:0.50,fbInvest:9.50,color:'#10b981',fundLbl:'BoJ Policy',investLbl:'Banxico',fxLbl:'USD/MXN',size:'large'},
{id:'eur_usd',name:'EUR > USD',desc:'Borrow Euro, Invest US Dollar',fund:'ECBDFR',invest:'DFF',fx:'DEXUSEU',fxInv:true,fbFund:null,fbInvest:null,color:'#3b82f6',fundLbl:'ECB Deposit',investLbl:'Fed Funds',fxLbl:'EUR/USD',size:'large'},
{id:'chf_usd',name:'CHF > USD',desc:'Borrow Swiss Franc, Invest US Dollar',fund:'IR3TIB01CHM156N',invest:'DFF',fx:'DEXSZUS',fxInv:false,fbFund:0.50,fbInvest:null,color:'#a78bfa',fundLbl:'SNB Rate',investLbl:'Fed Funds',fxLbl:'USD/CHF',size:'medium'},
{id:'eur_try',name:'EUR > TRY',desc:'Borrow Euro, Invest Turkish Lira',fund:'ECBDFR',invest:'INTGSTTRM193N',fx:'DEXUSEU',fxInv:true,fbFund:null,fbInvest:42.50,color:'#fbbf24',fundLbl:'ECB Deposit',investLbl:'TCMB Rate',fxLbl:'EUR proxy',size:'medium'},
{id:'usd_brl',name:'USD > BRL',desc:'Borrow Dollar, Invest Brazilian Real',fund:'DFF',invest:'INTGSTBRM193N',fx:'DEXBZUS',fxInv:true,fbFund:null,fbInvest:13.25,color:'#22d3ee',fundLbl:'Fed Funds',investLbl:'BCB Selic',fxLbl:'USD/BRL',size:'medium'},
{id:'jpy_krw',name:'JPY > KRW',desc:'Borrow Yen, Invest Korean Won',fund:'IRSTCI01JPM156N',invest:'IR3TIB01KRM156N',fx:'DEXKOUS',fxInv:false,fbFund:0.50,fbInvest:2.75,color:'#ec4899',fundLbl:'BoJ Policy',investLbl:'BoK Rate',fxLbl:'USD/KRW',size:'medium'},
{id:'chf_aud',name:'CHF > AUD',desc:'Borrow Swiss Franc, Invest Aussie Dollar',fund:'IR3TIB01CHM156N',invest:'IR3TIB01AUM156N',fx:'DEXSZUS',fxInv:false,fbFund:0.50,fbInvest:4.10,color:'#f472b6',fundLbl:'SNB Rate',investLbl:'RBA Rate',fxLbl:'CHF proxy',size:'small'},
{id:'eur_inr',name:'EUR > INR',desc:'Borrow Euro, Invest Indian Rupee',fund:'ECBDFR',invest:'INTGSTINM193N',fx:'DEXUSEU',fxInv:true,fbFund:null,fbInvest:6.50,color:'#6366f1',fundLbl:'ECB Deposit',investLbl:'RBI Rate',fxLbl:'EUR proxy',size:'small'},
{id:'jpy_zar',name:'JPY > ZAR',desc:'Borrow Yen, Invest South African Rand',fund:'IRSTCI01JPM156N',invest:'IR3TIB01ZAM156N',fx:'DEXJPUS',fxInv:false,fbFund:0.50,fbInvest:7.75,color:'#14b8a6',fundLbl:'BoJ Policy',investLbl:'SARB Rate',fxLbl:'JPY proxy',size:'medium'},
{id:'eur_pln',name:'EUR > PLN',desc:'Borrow Euro, Invest Polish Zloty',fund:'ECBDFR',invest:'IR3TIB01PLM156N',fx:'DEXUSEU',fxInv:true,fbFund:null,fbInvest:5.75,color:'#f43f5e',fundLbl:'ECB Deposit',investLbl:'NBP Rate',fxLbl:'EUR proxy',size:'small'}
];
var LIQ={'WALCL':{n:'Fed Total Assets',u:'$'},'ECBASSETSW':{n:'ECB Total Assets',u:'E'},'JPNASSETS':{n:'BoJ Total Assets',u:'Y'},'RRPONTSYD':{n:'Reverse Repo Facility',u:'$'},'RPONTSYD':{n:'Repo Facility',u:'$'},'WRESBAL':{n:'Bank Reserve Balances',u:'$'},'M2SL':{n:'M2 Money Supply',u:'$'},'TOTCI':{n:'C&I Loans',u:'$'},'SWPT':{n:'CB Liquidity Swaps',u:'$'},'BOGMBASE':{n:'Monetary Base',u:'$'},'TOTALSL':{n:'Total Consumer Credit',u:'$'}};
var EXTRA=['VIXCLS','EVZCLS','T10Y2Y','DGS10','DGS2','DTWEXBGS','STLFSI4'];
var D={},Q=[],loading=false,results=[];
var allIds=new Set();
CARRIES.forEach(function(c){if(c.fund)allIds.add(c.fund);if(c.invest)allIds.add(c.invest);if(c.fx)allIds.add(c.fx);});
Object.keys(LIQ).forEach(function(s){allIds.add(s);});
EXTRA.forEach(function(s){allIds.add(s);});
function sl(ms){return new Promise(function(r){setTimeout(r,ms);});}
async function fetchBatch(ids){var url=PROXY+'?series='+ids.join(',')+'&limit=60';var r=await fetch(url);var j=await r.json();if(j.batch&&j.data){for(var sid in j.data){if(j.data[sid].error)continue;D[sid]=j.data[sid];}}else if(j.series_id&&j.error===undefined){D[j.series_id]=j;}}
async function loadAll(){var ids=Array.from(allIds);var p=document.getElementById('prog'),f=document.getElementById('pFill');p.style.display='block';var total=ids.length,done=0;while(ids.length>0){var batch=ids.splice(0,12);try{setS('Fetching '+batch.length+' series... ('+ids.length+' left)');await fetchBatch(batch);}catch(e){console.warn('err',e);}done+=batch.length;f.style.width=(done/total*100)+'%';if(ids.length>0)await sl(500);}p.style.display='none';setS('Loaded '+Object.keys(D).length+' series | Analyzing...');analyze();renderAll();setS('Ready | '+Object.keys(D).length+' series | '+results.length+' carry trades');document.getElementById('lastRefresh').textContent='Last refresh: '+new Date().toLocaleTimeString();}
function gv(sid){var d=D[sid];return d?d.value:null;}
function gobs(sid){var d=D[sid];return(d&&d.observations)?d.observations:[];}
function pctChg(obs,days){if(obs.length<2)return null;var now=obs[0].value,d0=new Date(obs[0].date);var tgt=new Date(d0);tgt.setDate(tgt.getDate()-days);var best=null,bd=Infinity;for(var i=0;i<obs.length;i++){var df=Math.abs(new Date(obs[i].date)-tgt);if(df<bd){bd=df;best=obs[i];}}if(best===null||best.value===0||bd>days*86400000*0.6)return null;return((now-best.value)/Math.abs(best.value))*100;}
function analyze(){var vix=gv('VIXCLS')||20;results=[];CARRIES.forEach(function(c){var fr=gv(c.fund);if(fr===null)fr=c.fbFund;var ir=gv(c.invest);if(ir===null)ir=c.fbInvest;var fxv=gv(c.fx);var fxObs=gobs(c.fx);var diff=(fr!==null&&ir!==null)?(ir-fr):null;var diffBps=diff!==null?Math.round(diff*100):null;var fx1w=pctChg(fxObs,7);var fx1m=pctChg(fxObs,30);var cv=null;if(diff!==null&&vix>0){cv=diff/(vix/10);}var sig='stable',str=50;if(diff!==null){if(diffBps!==null&&diffBps<50){sig='compressed';str=30;}if(fx1m!==null&&diffBps!==null&&diffBps>50){if(c.fxInv){if(fx1m<-1){sig='building';str=Math.min(92,55+Math.abs(fx1m)*6);}else if(fx1m>2){sig='unwinding';str=Math.min(92,55+fx1m*5);}}else{if(fx1m>1){sig='building';str=Math.min(92,55+fx1m*6);}else if(fx1m<-2){sig='unwinding';str=Math.min(92,55+Math.abs(fx1m)*5);}}}if(vix>28&&sig==='building'){sig='stable';str=40;}if(vix>35){sig='unwinding';str=Math.min(90,65+(vix-35)*2);}if(diffBps!==null&&diffBps<100&&diffBps>0&&sig==='building'){sig='stable';str=Math.max(str-15,30);}}results.push({id:c.id,name:c.name,desc:c.desc,color:c.color,size:c.size,fr:fr,ir:ir,diff:diff,diffBps:diffBps,fxv:fxv,fx1w:fx1w,fx1m:fx1m,cv:cv,sig:sig,str:str,fundLbl:c.fundLbl,investLbl:c.investLbl,fxLbl:c.fxLbl});});results.sort(function(a,b){return Math.abs(b.diffBps||0)-Math.abs(a.diffBps||0);});}
function renderAll(){renderHero();renderTable();renderLiq();renderCharts();renderAnalysis();}
function renderHero(){var pos=results.filter(function(c){return c.cv!==null&&c.cv>0;});var avg=pos.length>0?pos.reduce(function(s,c){return s+c.cv;},0)/pos.length:0;var el=document.getElementById('vGci');el.textContent=avg.toFixed(2);el.className='hc-val '+(avg>1.5?'green':avg>0.8?'cyan':'yellow');document.getElementById('sGci').textContent=pos.length+' positive carry trades active';document.getElementById('hGci').className='hc '+(avg>1.2?'g':avg>0.6?'c':'y');var vix=gv('VIXCLS');var ve=document.getElementById('vVix');if(vix!==null){ve.textContent=vix.toFixed(1);if(vix<16){ve.className='hc-val green';document.getElementById('sVix').textContent='Low vol - carry friendly';document.getElementById('hVix').className='hc g';}else if(vix<25){ve.className='hc-val yellow';document.getElementById('sVix').textContent='Moderate vol - watch for spikes';document.getElementById('hVix').className='hc y';}else{ve.className='hc-val red';document.getElementById('sVix').textContent='HIGH VOL - unwind pressure';document.getElementById('hVix').className='hc r';}}var fed=gv('WALCL'),ecb=gv('ECBASSETSW');if(fed!==null){var t=fed/1e6;document.getElementById('vLiq').textContent='$'+t.toFixed(1)+'T';document.getElementById('sLiq').textContent='Fed: $'+t.toFixed(1)+'T'+(ecb?(' | ECB: E'+(ecb/1e6).toFixed(1)+'T'):'');}var uw=results.filter(function(c){return c.sig==='unwinding';});var ue=document.getElementById('vUnwind');ue.textContent=uw.length;if(uw.length===0){ue.className='hc-val green';document.getElementById('sUnwind').textContent='No active unwinds detected';document.getElementById('hUnwind').className='hc g';}else if(uw.length<=2){ue.className='hc-val yellow';document.getElementById('sUnwind').textContent=uw.map(function(u){return u.name;}).join(', ');document.getElementById('hUnwind').className='hc y';}else{ue.className='hc-val red';document.getElementById('sUnwind').textContent='ALERT: '+uw.length+' trades unwinding';document.getElementById('hUnwind').className='hc r';}var se=document.getElementById('vSpread');var jpyT=results.find(function(c){return c.id==='jpy_usd';});if(jpyT&&jpyT.diffBps!==null){se.textContent=jpyT.diffBps+'bp';se.className='hc-val '+(jpyT.diffBps>300?'green':jpyT.diffBps>150?'yellow':'red');document.getElementById('sSpread').textContent='BoJ '+(jpyT.fr!==null?jpyT.fr.toFixed(2):'?')+'% vs Fed '+(jpyT.ir!==null?jpyT.ir.toFixed(2):'?')+'%';}}
function renderTable(){var tb=document.getElementById('ctBody');var html='';results.forEach(function(c){var frS=c.fr!==null?c.fr.toFixed(2)+'%':'--';var irS=c.ir!==null?c.ir.toFixed(2)+'%':'--';var diffS=c.diffBps!==null?((c.diffBps>0?'+':'')+c.diffBps+'bp'):'--';var diffC=c.diffBps!==null?(c.diffBps>0?'pos':'neg'):'flat';var fxS=c.fxv!==null?c.fxv.toFixed(2):'--';var fw=c.fx1w!==null?((c.fx1w>0?'+':'')+c.fx1w.toFixed(2)+'%'):'--';var fwC=c.fx1w!==null?(c.fx1w>0?'pos':'neg'):'flat';var fm=c.fx1m!==null?((c.fx1m>0?'+':'')+c.fx1m.toFixed(2)+'%'):'--';var fmC=c.fx1m!==null?(c.fx1m>0?'pos':'neg'):'flat';var cvS=c.cv!==null?c.cv.toFixed(2):'--';var sigC='sig-'+c.sig;var sigL=c.sig.charAt(0).toUpperCase()+c.sig.slice(1);var barCol=c.sig==='building'?'var(--green)':c.sig==='unwinding'?'var(--red)':c.sig==='compressed'?'var(--purple)':'var(--yellow)';var impL,impC;if(c.sig==='building'){impL='+ Liquidity';impC='imp-add';}else if(c.sig==='unwinding'){impL='- Liquidity';impC='imp-drain';}else{impL='Neutral';impC='imp-neutral';}html+='<tr><td><div class="ct-pair" style="color:'+c.color+'">'+c.name+'</div><div class="ct-desc">'+c.desc+'</div></td><td class="ct-val">'+frS+'<div class="ct-desc">'+c.fundLbl+'</div></td><td class="ct-val">'+irS+'<div class="ct-desc">'+c.investLbl+'</div></td><td class="ct-val '+diffC+'">'+diffS+'</td><td class="ct-val">'+fxS+'<div class="ct-desc">'+c.fxLbl+'</div></td><td class="ct-val '+fwC+'">'+fw+'</td><td class="ct-val '+fmC+'">'+fm+'</td><td class="ct-val">'+(c.cv!==null&&c.cv>0?'<span class="pos">'+cvS+'</span>':'<span class="neg">'+cvS+'</span>')+'</td><td><span class="signal '+sigC+'"><span class="sig-dot"></span>'+sigL+'</span></td><td><div class="bar-wrap"><div class="bar-fill" style="width:'+c.str+'%;background:'+barCol+'"></div></div></td><td><span class="impact-tag '+impC+'">'+impL+'</span></td></tr>';});tb.innerHTML=html;}
function renderLiq(){var g=document.getElementById('liqGrid');var html='';for(var sid in LIQ){var cfg=LIQ[sid];var d=D[sid];if(d===undefined)continue;var v=d.value,obs=d.observations||[];var chg=pctChg(obs,30);var vs='';if(cfg.u==='$'){if(Math.abs(v)>=1e6)vs='$'+(v/1e6).toFixed(2)+'T';else if(Math.abs(v)>=1e3)vs='$'+(v/1e3).toFixed(1)+'B';else vs='$'+v.toFixed(0)+'M';}else if(cfg.u==='E'){if(Math.abs(v)>=1e6)vs='E'+(v/1e6).toFixed(2)+'T';else vs='E'+(v/1e3).toFixed(0)+'B';}else if(cfg.u==='Y'){vs='Y'+(v/10000).toFixed(1)+'T';}else{vs=v.toFixed(2);}var cs=chg!==null?((chg>0?'+':'')+chg.toFixed(2)+'% 1M'):'';var cc=chg!==null?(chg>0?'pos':'neg'):'flat';html+='<div class="lc"><div class="lc-lbl"><span>'+cfg.n+'</span><span class="mono" style="font-size:9px">'+sid+'</span></div><div class="lc-val mono">'+vs+'</div><div class="lc-chg '+cc+'">'+cs+'</div></div>';}g.innerHTML=html;}
function renderCharts(){var lo={paper_bgcolor:'#111827',plot_bgcolor:'#111827',font:{color:'#64748b',family:'JetBrains Mono',size:10},margin:{l:50,r:15,t:10,b:50},xaxis:{gridcolor:'#1e2a45',tickangle:-35},yaxis:{gridcolor:'#1e2a45'},hovermode:'x unified',showlegend:false};var cfg={responsive:true};var n1=[],d1=[],c1=[];results.forEach(function(c){if(c.diffBps===null)return;n1.push(c.name);d1.push(c.diffBps);c1.push(c.color);});Plotly.newPlot('chDiff',[{x:n1,y:d1,type:'bar',marker:{color:c1,opacity:0.85},hovertemplate:'%{x}: %{y}bp<extra></extra>'}],lo,cfg);var n2=[],d2=[],c2=[];results.forEach(function(c){if(c.fx1m===null)return;n2.push(c.name);d2.push(c.fx1m);c2.push(c.fx1m>=0?'#10b981':'#ef4444');});Plotly.newPlot('chFX',[{x:n2,y:d2,type:'bar',marker:{color:c2,opacity:0.85}}],lo,cfg);var cbT=[];var cbs={'WALCL':{n:'Fed',c:'#3b82f6',div:1e6},'ECBASSETSW':{n:'ECB',c:'#f59e0b',div:1e6}};for(var sid in cbs){var obs=gobs(sid);if(obs.length<2)continue;var rev=obs.slice().reverse();cbT.push({x:rev.map(function(o){return o.date;}),y:rev.map(function(o){return o.value/cbs[sid].div;}),name:cbs[sid].n,type:'scatter',mode:'lines',line:{color:cbs[sid].c,width:2}});}var lo2=JSON.parse(JSON.stringify(lo));lo2.showlegend=true;lo2.legend={font:{size:10}};Plotly.newPlot('chCB',cbT,lo2,cfg);var vobs=gobs('VIXCLS');if(vobs.length>0){var vr=vobs.slice().reverse();Plotly.newPlot('chRisk',[{x:vr.map(function(o){return o.date;}),y:vr.map(function(o){return o.value;}),type:'scatter',mode:'lines',fill:'tozeroy',fillcolor:'rgba(239,68,68,0.08)',line:{color:'#ef4444',width:2}}],lo,cfg);}}
function renderAnalysis(){var box=document.getElementById('analysisBox');var vix=gv('VIXCLS')||20;var uw=results.filter(function(c){return c.sig==='unwinding';});var bd=results.filter(function(c){return c.sig==='building';});var comp=results.filter(function(c){return c.sig==='compressed';});var jpy=results.find(function(c){return c.id==='jpy_usd';});var h='<h4>Carry Trade Environment Assessment</h4>';if(vix<16){h+='<p>The <span class="key">low-volatility regime</span> (VIX: '+vix.toFixed(1)+') creates favorable conditions for carry trades. Low vol compresses option premiums and reduces hedging costs, making leveraged carry positions more attractive.</p>';}else if(vix<25){h+='<p>The <span class="warn">moderate volatility</span> environment (VIX: '+vix.toFixed(1)+') suggests carry trades remain viable but require careful position sizing. VIX spikes above 25 could trigger rapid deleveraging.</p>';}else{h+='<p><span class="danger">ELEVATED VOLATILITY</span> (VIX: '+vix.toFixed(1)+') is pressuring leveraged carry positions globally. Risk of cascading unwinds increases when VIX sustains above 25.</p>';}if(jpy){h+='<p>The <span class="key">JPY carry trade</span> - the largest and most systemically important - shows a spread of '+(jpy.diffBps||'--')+'bp. ';if(jpy.sig==='unwinding'){h+='<span class="danger">WARNING: JPY carry is actively unwinding.</span> This historically spills into US equities and global risk assets as leveraged positions are liquidated.</p>';}else if(jpy.sig==='building'){h+='The trade is currently <span class="key">building</span>, with yen weakening and rate differential supporting positive carry returns.</p>';}else{h+='The trade appears <span class="warn">stable but under watch</span>. BoJ policy normalization is gradually compressing spreads.</p>';}}if(uw.length>0){h+='<p><span class="danger">'+uw.length+' carry trade(s) showing unwind signals:</span> '+uw.map(function(u){return u.name;}).join(', ')+'. Unwinds drain global liquidity as leveraged positions are closed and funding currencies are bought back.</p>';}if(bd.length>0){h+='<p><span class="key">'+bd.length+' carry trade(s) actively building:</span> '+bd.map(function(b){return b.name+' ('+b.diffBps+'bp)';}).join(', ')+'. New carry positions add liquidity to target markets.</p>';}if(comp.length>0){h+='<p><span class="warn">Compressed spreads</span> in '+comp.map(function(c){return c.name;}).join(', ')+' suggest these carries are losing economic justification.</p>';}var fed=gv('WALCL'),rrp=gv('RRPONTSYD');if(fed){h+='<p>Global liquidity: Fed balance sheet at <span class="key">$'+(fed/1e6).toFixed(2)+'T</span>';if(rrp){h+=', reverse repo draining <span class="warn">$'+(rrp/1e3).toFixed(0)+'B</span>';}h+='. Net carry trade flows interact with CB liquidity operations - when carry unwinds coincide with QT, the drain is amplified.</p>';}box.innerHTML=h;}
function setS(m){document.getElementById('sMsg').textContent=m;}
function updClk(){document.getElementById('clock').textContent=new Date().toLocaleTimeString('en-US',{hour12:false});}
setInterval(updClk,1000);updClk();
setInterval(function(){D={};loadAll();},20*60*1000);
loadAll();
</script>
</body>
</html>
