<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Treasury Crisis Detection System v2.0 - Real Data Only</title>
    
    <!-- Required Libraries -->
    <script src="https://cdn.plot.ly/plotly-2.27.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/axios@1.6.0/dist/axios.min.js"></script>
    
    <style>
        /* Core Styles */
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #0a0e27 0%, #151932 100%);
            color: #e0e0e0;
            min-height: 100vh;
        }
        
        /* Header Styles */
        .header {
            background: rgba(20, 24, 44, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            border-bottom: 1px solid rgba(0, 255, 136, 0.2);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: sticky;
            top: 0;
            z-index: 1000;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            background: linear-gradient(45deg, #00ff88, #00ccff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .data-policy {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: bold;
            text-transform: uppercase;
        }
        
        .header-stats {
            display: flex;
            gap: 1rem;
            align-items: center;
            flex-wrap: wrap;
        }
        
        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            min-width: 100px;
        }
        
        .stat-value {
            font-size: 1.25rem;
            font-weight: bold;
            color: #00ff88;
        }
        
        .stat-label {
            font-size: 0.75rem;
            color: #888;
            text-transform: uppercase;
        }
        
        /* Risk Level Indicator */
        .risk-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .risk-level {
            font-weight: bold;
            padding: 0.25rem 0.75rem;
            border-radius: 4px;
        }
        
        .risk-none {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
        }
        
        .risk-low {
            background: rgba(0, 204, 255, 0.2);
            color: #00ccff;
        }
        
        .risk-moderate {
            background: rgba(255, 170, 0, 0.2);
            color: #ffaa00;
        }
        
        .risk-high {
            background: rgba(255, 68, 68, 0.2);
            color: #ff4444;
        }
        
        .risk-severe {
            background: rgba(255, 0, 0, 0.4);
            color: #ff0000;
            animation: severePulse 1s infinite;
        }
        
        @keyframes severePulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.05); }
        }
        
        /* API Status Indicators */
        .api-status {
            display: flex;
            gap: 1rem;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 8px;
            flex-wrap: wrap;
        }
        
        .api-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
        }
        
        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }
        
        .status-dot.connected {
            background: #00ff88;
        }
        
        .status-dot.error {
            background: #ff4444;
        }
        
        .status-dot.loading {
            background: #ffaa00;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Container */
        .container {
            max-width: 1600px;
            margin: 0 auto;
            padding: 2rem;
        }
        
        /* Tabs Navigation */
        .tabs-nav {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 0.5rem;
            overflow-x: auto;
        }
        
        .tab-btn {
            padding: 0.75rem 1.5rem;
            background: transparent;
            border: none;
            border-radius: 8px;
            color: #888;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.3s;
            white-space: nowrap;
        }
        
        .tab-btn:hover {
            background: rgba(255, 255, 255, 0.05);
            color: #fff;
        }
        
        .tab-btn.active {
            background: #00ff88;
            color: #000;
            font-weight: bold;
        }
        
        /* Tab Content */
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        /* Market Phase Banner */
        .market-phase-banner {
            background: linear-gradient(90deg, #00ff88, #00ccff);
            color: #000;
            padding: 12px;
            text-align: center;
            font-weight: bold;
            font-size: 1.1rem;
            animation: phaseGlow 2s ease-in-out infinite;
            position: sticky;
            top: 80px;
            z-index: 999;
        }
        
        @keyframes phaseGlow {
            0%, 100% { opacity: 0.9; }
            50% { opacity: 1; }
        }
        
        .market-phase-banner.normal {
            background: linear-gradient(90deg, #00ff44, #00ff88);
        }
        
        .market-phase-banner.elevated {
            background: linear-gradient(90deg, #ffaa00, #ff8800);
        }
        
        .market-phase-banner.crisis {
            background: linear-gradient(90deg, #ff0000, #ff4444);
            animation: crisisPulse 0.8s ease-in-out infinite;
        }
        
        @keyframes crisisPulse {
            0%, 100% { opacity: 0.7; transform: scale(1); }
            50% { opacity: 1; transform: scale(1.02); }
        }
        
        /* Indicators Grid */
        .indicators-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .indicator-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
            cursor: pointer;
            position: relative;
        }
        
        .indicator-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 30px rgba(0, 255, 136, 0.1);
        }
        
        .indicator-card.triggered {
            border: 2px solid #ff4444;
            background: rgba(255, 68, 68, 0.05);
            animation: warningPulse 2s infinite;
        }
        
        @keyframes warningPulse {
            0%, 100% { box-shadow: 0 0 0 rgba(255, 68, 68, 0); }
            50% { box-shadow: 0 0 20px rgba(255, 68, 68, 0.3); }
        }
        
        .indicator-category {
            font-size: 0.7rem;
            color: #666;
            text-transform: uppercase;
            margin-bottom: 0.25rem;
        }
        
        .indicator-title {
            font-size: 0.875rem;
            color: #888;
            margin-bottom: 0.5rem;
            text-transform: uppercase;
        }
        
        .indicator-value {
            font-size: 1.75rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
        }
        
        .indicator-change {
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .indicator-status {
            font-size: 0.75rem;
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            font-style: italic;
            opacity: 0.9;
        }
        
        /* Crisis Dashboard */
        .crisis-dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .crisis-panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .crisis-panel.critical {
            border: 2px solid #ff4444;
            background: rgba(255, 68, 68, 0.05);
            animation: criticalPulse 2s infinite;
        }
        
        @keyframes criticalPulse {
            0%, 100% { box-shadow: 0 0 0 rgba(255, 68, 68, 0); }
            50% { box-shadow: 0 0 20px rgba(255, 68, 68, 0.5); }
        }
        
        .crisis-score-meter {
            text-align: center;
            margin-bottom: 1.5rem;
        }
        
        .crisis-score-value {
            font-size: 5rem;
            font-weight: bold;
            background: linear-gradient(45deg, #ff4444, #ffaa00);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .crisis-level-display {
            font-size: 1.5rem;
            margin-top: 0.5rem;
            font-weight: bold;
        }
        
        /* Liquidity Analysis */
        .liquidity-panel {
            background: linear-gradient(135deg, rgba(0, 204, 255, 0.1), rgba(0, 255, 136, 0.1));
            border: 1px solid rgba(0, 204, 255, 0.3);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .liquidity-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .liquidity-score {
            font-size: 2rem;
            font-weight: bold;
        }
        
        .liquidity-status {
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-weight: bold;
        }
        
        .liquidity-adequate {
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
        }
        
        .liquidity-concerns {
            background: rgba(0, 204, 255, 0.2);
            color: #00ccff;
        }
        
        .liquidity-stress {
            background: rgba(255, 170, 0, 0.2);
            color: #ffaa00;
        }
        
        .liquidity-crunch {
            background: rgba(255, 68, 68, 0.2);
            color: #ff4444;
        }
        
        /* Summary Panel */
        .summary-panel {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .summary-section {
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .summary-section:last-child {
            border-bottom: none;
        }
        
        .summary-title {
            font-size: 1.25rem;
            font-weight: bold;
            margin-bottom: 1rem;
            color: #00ff88;
        }
        
        .summary-item {
            display: flex;
            justify-content: space-between;
            padding: 0.5rem 0;
        }
        
        .summary-label {
            color: #888;
        }
        
        .summary-value {
            font-weight: bold;
        }
        
        /* Chart Container */
        .chart-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .chart-title {
            font-size: 1.25rem;
            font-weight: bold;
        }
        
        #mainChart, #crisisChart, #liquidityChart, #participationChart, #yieldChart {
            height: 500px;
            border-radius: 8px;
            background: rgba(0, 0, 0, 0.3);
        }
        
        /* Data Table */
        .data-table {
            width: 100%;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 2rem;
        }
        
        .data-table table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .data-table th {
            background: rgba(0, 255, 136, 0.1);
            padding: 1rem;
            text-align: left;
            font-weight: bold;
            color: #00ff88;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            font-size: 0.875rem;
        }
        
        .data-table td {
            padding: 1rem;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
            font-size: 0.875rem;
        }
        
        .data-table tr:hover {
            background: rgba(0, 255, 136, 0.05);
        }
        
        /* Interpretation Box */
        .interpretation-box {
            background: linear-gradient(135deg, rgba(0, 255, 136, 0.05), rgba(0, 204, 255, 0.05));
            border: 1px solid rgba(0, 255, 136, 0.2);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .interpretation-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 1rem;
            font-size: 1.25rem;
            font-weight: bold;
        }
        
        .interpretation-text {
            line-height: 1.6;
            color: #e0e0e0;
        }
        
        /* Crisis Indicators List */
        .crisis-indicators-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 0.75rem;
            margin-top: 1rem;
        }
        
        .crisis-indicator-item {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 6px;
            border-left: 3px solid;
        }
        
        .crisis-indicator-item.active {
            border-left-color: #ff4444;
            background: rgba(255, 68, 68, 0.1);
        }
        
        .crisis-indicator-item.inactive {
            border-left-color: #00ff88;
            opacity: 0.6;
        }
        
        /* Loading and Error States */
        .loading {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(0, 255, 136, 0.3);
            border-top-color: #00ff88;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .error-message {
            background: rgba(255, 68, 68, 0.1);
            border: 1px solid #ff4444;
            color: #ff6666;
            padding: 1rem;
            border-radius: 8px;
            margin: 1rem 0;
        }
        
        .no-data {
            text-align: center;
            color: #888;
            padding: 2rem;
            font-style: italic;
        }
        
        /* Utility Classes */
        .positive { color: #00ff88; }
        .negative { color: #ff4444; }
        .neutral { color: #888; }
        
        /* Responsive Design */
        @media (max-width: 768px) {
            .header {
                padding: 1rem;
            }
            
            .indicators-grid,
            .crisis-dashboard {
                grid-template-columns: 1fr;
            }
            
            .tabs-nav {
                overflow-x: auto;
            }
        }
    </style>
</head>
<body>
    <!-- Market Phase Banner -->
    <div class="market-phase-banner" id="marketPhaseBanner">
        üèõÔ∏è TREASURY CRISIS DETECTION v2.0: INITIALIZING REAL DATA...
    </div>
    
    <header class="header">
        <div class="logo">
            üèõÔ∏è Treasury Crisis Detection v2.0
            <span style="font-size: 0.875rem; color: #888;">31 Indicators</span>
        </div>
        
        <div class="data-policy">REAL DATA ONLY</div>
        
        <div class="header-stats">
            <div class="stat-item">
                <div class="stat-value" id="crisisScore">--</div>
                <div class="stat-label">Crisis Score</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="btcRatio">--</div>
                <div class="stat-label">Bid-Cover</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="tailBp">--</div>
                <div class="stat-label">Tail (bp)</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="lastUpdate">--:--</div>
                <div class="stat-label">Last Update</div>
            </div>
        </div>
        
        <div class="risk-indicator">
            <span>Crisis Level:</span>
            <span class="risk-level risk-none" id="riskLevel">--</span>
        </div>
        
        <div class="api-status">
            <div class="api-indicator">
                <div class="status-dot loading" id="treasuryStatus"></div>
                <span>Treasury API</span>
            </div>
            <div class="api-indicator">
                <div class="status-dot loading" id="crisisStatus"></div>
                <span>Crisis Analysis</span>
            </div>
            <div class="api-indicator">
                <div class="status-dot loading" id="liquidityStatus"></div>
                <span>Liquidity</span>
            </div>
            <div class="api-indicator">
                <div class="status-dot loading" id="summaryStatus"></div>
                <span>Summary</span>
            </div>
        </div>
    </header>
    
    <div class="container">
        <!-- Navigation Tabs -->
        <div class="tabs-nav">
            <button class="tab-btn active" data-tab="overview">üìä Overview</button>
            <button class="tab-btn" data-tab="indicators">üìà 31 Indicators</button>
            <button class="tab-btn" data-tab="crisis">üö® Crisis Analysis</button>
            <button class="tab-btn" data-tab="liquidity">üíß Liquidity Analysis</button>
            <button class="tab-btn" data-tab="summary">üìã Comprehensive Summary</button>
            <button class="tab-btn" data-tab="yields">üìâ Yield Analysis</button>
            <button class="tab-btn" data-tab="participation">üë• Participation</button>
            <button class="tab-btn" data-tab="interpretation">üí° Market Interpretation</button>
        </div>
        
        <!-- Overview Tab -->
        <div class="tab-content active" id="overview">
            <div class="crisis-dashboard">
                <!-- Current Auction Panel -->
                <div class="crisis-panel">
                    <h3 style="margin-bottom: 1rem;">Latest Treasury Auction</h3>
                    <div id="currentAuctionInfo">
                        <div class="loading">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Crisis Score Panel -->
                <div class="crisis-panel" id="crisisScorePanel">
                    <div class="crisis-score-meter">
                        <div class="crisis-score-value" id="crisisScoreValue">--</div>
                        <div style="font-size: 1rem; color: #888;">Crisis Score (0-10)</div>
                        <div class="crisis-level-display" id="crisisLevelDisplay">--</div>
                    </div>
                </div>
                
                <!-- Key Metrics Panel -->
                <div class="crisis-panel">
                    <h3 style="margin-bottom: 1rem;">Key Metrics</h3>
                    <div id="keyMetricsPanel">
                        <div class="loading">
                            <div class="spinner"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Main Chart -->
            <div class="chart-container">
                <div class="chart-header">
                    <h2 class="chart-title">Market Overview - Real Treasury Data</h2>
                </div>
                <div id="mainChart"></div>
            </div>
        </div>
        
        <!-- 31 Indicators Tab -->
        <div class="tab-content" id="indicators">
            <h2 style="margin-bottom: 1rem;">All 31 Treasury Indicators - Real Data Only</h2>
            <div class="indicators-grid" id="indicatorsGrid">
                <div class="loading">
                    <div class="spinner"></div>
                </div>
            </div>
        </div>
        
        <!-- Crisis Analysis Tab -->
        <div class="tab-content" id="crisis">
            <div class="crisis-panel" style="margin-bottom: 2rem;">
                <h2 style="margin-bottom: 1rem;">Crisis Detection Analysis</h2>
                <div id="crisisAnalysisContent">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
            
            <div class="crisis-panel">
                <h3 style="margin-bottom: 1rem;">Crisis Indicators Status</h3>
                <div class="crisis-indicators-list" id="crisisIndicatorsList">
                    <!-- Will be populated with all possible crisis indicators -->
                </div>
            </div>
            
            <div class="chart-container">
                <div class="chart-header">
                    <h2 class="chart-title">Crisis Score Components</h2>
                </div>
                <div id="crisisChart"></div>
            </div>
        </div>
        
        <!-- Liquidity Analysis Tab -->
        <div class="tab-content" id="liquidity">
            <div class="liquidity-panel">
                <div class="liquidity-header">
                    <div>
                        <h2>Liquidity Analysis</h2>
                        <div style="font-size: 0.875rem; color: #888; margin-top: 0.25rem;">
                            Real-time liquidity crunch detection
                        </div>
                    </div>
                    <div style="text-align: right;">
                        <div class="liquidity-score" id="liquidityScore">--</div>
                        <div class="liquidity-status liquidity-adequate" id="liquidityStatusBadge">--</div>
                    </div>
                </div>
                
                <div id="liquidityAnalysisContent" style="margin-top: 1.5rem;">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
            
            <div class="chart-container">
                <div class="chart-header">
                    <h2 class="chart-title">Liquidity Metrics</h2>
                </div>
                <div id="liquidityChart"></div>
            </div>
        </div>
        
        <!-- Comprehensive Summary Tab -->
        <div class="tab-content" id="summary">
            <div class="summary-panel">
                <div id="comprehensiveSummary">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Yield Analysis Tab -->
        <div class="tab-content" id="yields">
            <div class="indicators-grid" id="yieldIndicators">
                <!-- Yield indicators will be displayed here -->
            </div>
            
            <div class="chart-container">
                <div class="chart-header">
                    <h2 class="chart-title">Yield Curve & Tail Analysis</h2>
                </div>
                <div id="yieldChart"></div>
            </div>
        </div>
        
        <!-- Participation Tab -->
        <div class="tab-content" id="participation">
            <div class="indicators-grid" id="participationIndicators">
                <!-- Participation indicators will be displayed here -->
            </div>
            
            <div class="chart-container">
                <div class="chart-header">
                    <h2 class="chart-title">Market Participation Breakdown</h2>
                </div>
                <div id="participationChart"></div>
            </div>
        </div>
        
        <!-- Market Interpretation Tab -->
        <div class="tab-content" id="interpretation">
            <div class="interpretation-box">
                <div class="interpretation-header">
                    <span>üí°</span>
                    <span>Market Interpretation</span>
                </div>
                <div class="interpretation-text" id="marketInterpretation">
                    <div class="loading">
                        <div class="spinner"></div>
                    </div>
                </div>
            </div>
            
            <div class="data-table">
                <table>
                    <thead>
                        <tr>
                            <th>Indicator</th>
                            <th>Current Value</th>
                            <th>Status</th>
                            <th>Interpretation</th>
                        </tr>
                    </thead>
                    <tbody id="interpretationTable">
                        <tr>
                            <td colspan="4" style="text-align: center;">Loading interpretation data...</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>
    
    <script>
        // Treasury API v2.0 Configuration - REAL DATA ONLY
        const TREASURY_API = {
            baseUrl: 'https://klehdyiwrl.execute-api.us-east-1.amazonaws.com/prod',
            endpoints: {
                main: '/treasury',
                current: '/auctions/current',
                crisis: '/crisis/analysis',
                liquidity: '/liquidity/analysis',
                summary: '/summary/latest'
            }
        };
        
        // Complete list of 31 indicators
        const ALL_INDICATORS = {
            // Core Auction Data (5)
            core: [
                'auction_date',
                'security_type',
                'security_term',
                'cusip',
                'alloted_at_high'
            ],
            // Volume Indicators (3)
            volume: [
                'bid_to_cover_ratio',
                'total_accepted',
                'total_tendered'
            ],
            // Yield Indicators (6)
            yields: [
                'high_rate',
                'median_rate',
                'low_rate',
                'investment_rate',
                'price',
                'yield_range'
            ],
            // Participation Indicators (4)
            participation: [
                'primary_dealer_pct',
                'indirect_bidder_pct',
                'direct_bidder_pct',
                'foreign_participation'
            ],
            // Risk Indicators (5)
            risk: [
                'tail',
                'abnormal_auction',
                'severe_tail',
                'extreme_tail',
                'market_depth_ratio'
            ],
            // Change Indicators (5)
            changes: [
                'bid_to_cover_change',
                'yield_change',
                'primary_dealer_change',
                'foreign_participation_change',
                'tail_change'
            ],
            // Crisis Detection (3)
            crisis: [
                'crisis_score',
                'crisis_indicators',
                'crisis_level'
            ]
        };
        
        // Crisis Indicators Definitions
        const CRISIS_INDICATORS_DEFINITIONS = {
            'EXTREMELY_LOW_BID_TO_COVER': { threshold: 'BTC < 1.5', weight: 2.5 },
            'LOW_BID_TO_COVER': { threshold: 'BTC < 2.0', weight: 2.0 },
            'WEAK_BID_TO_COVER': { threshold: 'BTC < 2.3', weight: 1.0 },
            'EXTREME_TAIL': { threshold: 'Tail > 5bp', weight: 2.0 },
            'HIGH_TAIL': { threshold: 'Tail > 3bp', weight: 1.5 },
            'ELEVATED_TAIL': { threshold: 'Tail > 1bp', weight: 1.0 },
            'HIGH_DEALER_CONCENTRATION': { threshold: 'Dealers > 70%', weight: 1.5 },
            'ELEVATED_DEALER_RELIANCE': { threshold: 'Dealers > 60%', weight: 1.0 },
            'LOW_FOREIGN_PARTICIPATION': { threshold: 'Foreign < 20%', weight: 1.5 },
            'WEAK_FOREIGN_DEMAND': { threshold: 'Foreign < 30%', weight: 1.0 },
            'LOW_MARKET_DEPTH': { threshold: 'Depth < 1.5', weight: 1.0 },
            'REDUCED_LIQUIDITY': { threshold: 'Depth < 2.0', weight: 0.5 },
            'EXTREME_YIELD_DISPERSION': { threshold: 'Range > 10bp', weight: 1.0 },
            'HIGH_YIELD_DISPERSION': { threshold: 'Range > 5bp', weight: 0.5 },
            'SHARP_DEMAND_DROP': { threshold: 'BTC Change < -15%', weight: 1.0 },
            'FOREIGN_EXODUS': { threshold: 'Foreign Change < -20%', weight: 0.5 }
        };
        
        // Liquidity Indicators Definitions
        const LIQUIDITY_INDICATORS_DEFINITIONS = {
            'LOW_DEMAND_LIQUIDITY': 'BTC < 2.0',
            'MODERATE_DEMAND_STRESS': 'BTC < 2.5',
            'SHALLOW_MARKET_DEPTH': 'Depth < 1.5',
            'REDUCED_MARKET_DEPTH': 'Depth < 2.0',
            'HIGH_PRICING_DISPERSION': 'Tail > 3bp',
            'MODERATE_PRICING_DISPERSION': 'Tail > 1bp',
            'LOW_INTERNATIONAL_LIQUIDITY': 'Foreign < 30%',
            'EXTREME_YIELD_DISPERSION': 'Range > 10bp'
        };
        
        // Global state - REAL DATA ONLY
        let currentData = {
            auction: null,
            crisis: null,
            liquidity: null,
            summary: null,
            lastUpdate: null
        };
        
        let charts = {
            main: null,
            crisis: null,
            liquidity: null,
            participation: null,
            yield: null
        };
        
        let autoRefreshInterval = null;
        
        // Initialize the platform
        async function initializePlatform() {
            console.log('üöÄ Initializing Treasury Crisis Detection v2.0 - REAL DATA ONLY...');
            
            // Test API connections
            await testAPIConnections();
            
            // Load all data
            await loadAllData();
            
            // Initialize charts
            initializeCharts();
            
            // Setup event listeners
            setupEventListeners();
            
            // Start auto-refresh (every 30 seconds)
            startAutoRefresh();
            
            console.log('‚úÖ System initialized with REAL TREASURY DATA');
        }
        
        // Test API connections
        async function testAPIConnections() {
            const endpoints = [
                { id: 'treasuryStatus', endpoint: TREASURY_API.endpoints.main },
                { id: 'crisisStatus', endpoint: TREASURY_API.endpoints.crisis },
                { id: 'liquidityStatus', endpoint: TREASURY_API.endpoints.liquidity },
                { id: 'summaryStatus', endpoint: TREASURY_API.endpoints.summary }
            ];
            
            for (const api of endpoints) {
                try {
                    const response = await fetch(TREASURY_API.baseUrl + api.endpoint);
                    const statusElement = document.getElementById(api.id);
                    
                    if (response.ok) {
                        statusElement.className = 'status-dot connected';
                    } else {
                        statusElement.className = 'status-dot error';
                    }
                } catch (error) {
                    console.error(`API connection error for ${api.endpoint}:`, error);
                    document.getElementById(api.id).className = 'status-dot error';
                }
            }
        }
        
        // Load all data
        async function loadAllData() {
            try {
                // Load current auction data
                const auctionResponse = await fetch(TREASURY_API.baseUrl + TREASURY_API.endpoints.current);
                const auctionData = await auctionResponse.json();
                
                if (auctionData.latest_auction) {
                    currentData.auction = auctionData.latest_auction;
                    currentData.lastUpdate = new Date();
                    updateOverview();
                    updateAllIndicators();
                }
                
                // Load crisis analysis
                const crisisResponse = await fetch(TREASURY_API.baseUrl + TREASURY_API.endpoints.crisis);
                const crisisData = await crisisResponse.json();
                currentData.crisis = crisisData;
                updateCrisisAnalysis();
                
                // Load liquidity analysis
                const liquidityResponse = await fetch(TREASURY_API.baseUrl + TREASURY_API.endpoints.liquidity);
                const liquidityData = await liquidityResponse.json();
                currentData.liquidity = liquidityData;
                updateLiquidityAnalysis();
                
                // Load comprehensive summary
                const summaryResponse = await fetch(TREASURY_API.baseUrl + TREASURY_API.endpoints.summary);
                const summaryData = await summaryResponse.json();
                currentData.summary = summaryData;
                updateComprehensiveSummary();
                
                // Update header and banner
                updateHeader();
                updateMarketPhase();
                
            } catch (error) {
                console.error('Error loading data:', error);
                showError('Failed to load Treasury data. Please check your connection.');
            }
        }
        
        // Update header statistics
        function updateHeader() {
            if (currentData.auction) {
                document.getElementById('crisisScore').textContent = 
                    currentData.auction.crisis_score?.toFixed(1) || '--';
                document.getElementById('btcRatio').textContent = 
                    currentData.auction.bid_to_cover_ratio?.toFixed(2) || '--';
                document.getElementById('tailBp').textContent = 
                    currentData.auction.tail?.toFixed(1) || '--';
                document.getElementById('lastUpdate').textContent = 
                    currentData.lastUpdate ? currentData.lastUpdate.toLocaleTimeString() : '--:--';
                
                // Update risk level
                const riskElement = document.getElementById('riskLevel');
                const crisisLevel = currentData.auction.crisis_level || 'NONE';
                riskElement.textContent = crisisLevel;
                riskElement.className = `risk-level risk-${crisisLevel.toLowerCase()}`;
            }
        }
        
        // Update market phase banner
        function updateMarketPhase() {
            const banner = document.getElementById('marketPhaseBanner');
            const crisisLevel = currentData.auction?.crisis_level || 'NONE';
            const crisisScore = currentData.auction?.crisis_score || 0;
            
            let phase = '';
            let bannerClass = 'normal';
            
            if (crisisLevel === 'SEVERE' || crisisScore >= 7) {
                phase = 'üö® SEVERE CRISIS DETECTED - IMMEDIATE ATTENTION REQUIRED';
                bannerClass = 'crisis';
            } else if (crisisLevel === 'HIGH' || crisisScore >= 5) {
                phase = '‚ö†Ô∏è HIGH MARKET STRESS - CRISIS PATTERNS EMERGING';
                bannerClass = 'crisis';
            } else if (crisisLevel === 'MODERATE' || crisisScore >= 3) {
                phase = '‚ö†Ô∏è MODERATE STRESS DETECTED - INCREASED MONITORING';
                bannerClass = 'elevated';
            } else if (crisisLevel === 'LOW' || crisisScore >= 1) {
                phase = 'üìä MINOR STRESS INDICATORS - MONITOR CONDITIONS';
                bannerClass = 'elevated';
            } else {
                phase = '‚úÖ NORMAL MARKET CONDITIONS - NO CRISIS INDICATORS';
                bannerClass = 'normal';
            }
            
            banner.textContent = phase;
            banner.className = `market-phase-banner ${bannerClass}`;
        }
        
        // Update overview
        function updateOverview() {
            if (!currentData.auction) return;
            
            const auction = currentData.auction;
            
            // Update current auction info
            const auctionInfo = document.getElementById('currentAuctionInfo');
            auctionInfo.innerHTML = `
                <div class="summary-item">
                    <span class="summary-label">Date</span>
                    <span class="summary-value">${auction.auction_date || '--'}</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Security</span>
                    <span class="summary-value">${auction.security_term || '--'} ${auction.security_type || '--'}</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">CUSIP</span>
                    <span class="summary-value">${auction.cusip || '--'}</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Amount</span>
                    <span class="summary-value">$${((auction.total_accepted || 0) / 1e9).toFixed(1)}B</span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Data Source</span>
                    <span class="summary-value positive">REAL TREASURY DATA</span>
                </div>
            `;
            
            // Update crisis score panel
            document.getElementById('crisisScoreValue').textContent = 
                auction.crisis_score?.toFixed(1) || '--';
            document.getElementById('crisisLevelDisplay').textContent = 
                auction.crisis_level || '--';
            document.getElementById('crisisLevelDisplay').className = 
                `crisis-level-display ${getCrisisColorClass(auction.crisis_level)}`;
            
            // Update panel styling for critical conditions
            const panel = document.getElementById('crisisScorePanel');
            if (auction.crisis_score >= 5) {
                panel.classList.add('critical');
            } else {
                panel.classList.remove('critical');
            }
            
            // Update key metrics
            const metricsPanel = document.getElementById('keyMetricsPanel');
            metricsPanel.innerHTML = `
                <div class="summary-item">
                    <span class="summary-label">Bid-to-Cover</span>
                    <span class="summary-value ${auction.bid_to_cover_ratio < 2.3 ? 'negative' : 'positive'}">
                        ${auction.bid_to_cover_ratio?.toFixed(2) || '--'}
                    </span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Tail (bp)</span>
                    <span class="summary-value ${auction.tail > 3 ? 'negative' : auction.tail > 1 ? 'neutral' : 'positive'}">
                        ${auction.tail?.toFixed(1) || '--'}
                    </span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Foreign %</span>
                    <span class="summary-value ${auction.foreign_participation < 30 ? 'negative' : 'positive'}">
                        ${auction.foreign_participation?.toFixed(1) || '--'}%
                    </span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Dealer %</span>
                    <span class="summary-value ${auction.primary_dealer_pct > 60 ? 'negative' : 'positive'}">
                        ${auction.primary_dealer_pct?.toFixed(1) || '--'}%
                    </span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Market Depth</span>
                    <span class="summary-value ${auction.market_depth_ratio < 2 ? 'negative' : 'positive'}">
                        ${auction.market_depth_ratio?.toFixed(2) || '--'}
                    </span>
                </div>
                <div class="summary-item">
                    <span class="summary-label">Yield Range</span>
                    <span class="summary-value ${auction.yield_range > 10 ? 'negative' : 'neutral'}">
                        ${auction.yield_range?.toFixed(1) || '--'}bp
                    </span>
                </div>
            `;
            
            // Update main chart
            updateMainChart();
        }
        
        // Update all 31 indicators
        function updateAllIndicators() {
            if (!currentData.auction) return;
            
            const grid = document.getElementById('indicatorsGrid');
            grid.innerHTML = '';
            
            const auction = currentData.auction;
            
            // Create indicator cards for all 31 indicators
            const indicatorGroups = [
                { title: 'Core Auction Data', indicators: ALL_INDICATORS.core },
                { title: 'Volume Indicators', indicators: ALL_INDICATORS.volume },
                { title: 'Yield Indicators', indicators: ALL_INDICATORS.yields },
                { title: 'Participation', indicators: ALL_INDICATORS.participation },
                { title: 'Risk Indicators', indicators: ALL_INDICATORS.risk },
                { title: 'Change Indicators', indicators: ALL_INDICATORS.changes },
                { title: 'Crisis Detection', indicators: ALL_INDICATORS.crisis }
            ];
            
            indicatorGroups.forEach(group => {
                group.indicators.forEach(indicator => {
                    const card = createIndicatorCard(indicator, auction[indicator], group.title);
                    grid.appendChild(card);
                });
            });
            
            // Update specific indicator tabs
            updateYieldIndicators();
            updateParticipationIndicators();
        }
        
        // Create indicator card
        function createIndicatorCard(name, value, category) {
            const card = document.createElement('div');
            card.className = 'indicator-card';
            
            // Check if this is a triggered crisis indicator
            if (isIndicatorTriggered(name, value)) {
                card.classList.add('triggered');
            }
            
            // Format value based on type
            let formattedValue = formatIndicatorValue(name, value);
            let changeIndicator = '';
            
            // Add change indicator for change metrics
            if (name.includes('_change') && value !== null && value !== undefined) {
                const changeClass = value >= 0 ? 'positive' : 'negative';
                changeIndicator = `<span class="${changeClass}">${value >= 0 ? '‚ñ≤' : '‚ñº'} ${Math.abs(value).toFixed(1)}%</span>`;
                formattedValue = '';
            }
            
            card.innerHTML = `
                <div class="indicator-category">${category}</div>
                <div class="indicator-title">${formatIndicatorName(name)}</div>
                <div class="indicator-value ${getValueClass(name, value)}">
                    ${formattedValue}
                </div>
                ${changeIndicator ? `<div class="indicator-change">${changeIndicator}</div>` : ''}
                <div class="indicator-status">${getIndicatorStatus(name, value)}</div>
            `;
            
            return card;
        }
        
        // Format indicator name for display
        function formatIndicatorName(name) {
            return name.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase());
        }
        
        // Format indicator value
        function formatIndicatorValue(name, value) {
            if (value === null || value === undefined) return '--';
            
            if (name === 'crisis_indicators') {
                return Array.isArray(value) ? `${value.length} active` : '0 active';
            }
            
            if (name === 'crisis_level' || name === 'security_type' || name === 'security_term') {
                return value;
            }
            
            if (name === 'auction_date' || name === 'cusip') {
                return value;
            }
            
            if (name === 'total_accepted' || name === 'total_tendered') {
                return `$${(value / 1e9).toFixed(1)}B`;
            }
            
            if (name.includes('_pct') || name.includes('participation')) {
                return `${value.toFixed(1)}%`;
            }
            
            if (name.includes('rate') || name === 'yield_range' || name === 'tail') {
                return `${value.toFixed(2)}${name === 'tail' || name === 'yield_range' ? 'bp' : '%'}`;
            }
            
            if (name === 'abnormal_auction' || name === 'severe_tail' || name === 'extreme_tail') {
                return value === 1 ? 'YES' : 'NO';
            }
            
            if (typeof value === 'number') {
                return value.toFixed(2);
            }
            
            return value;
        }
        
        // Get value class for styling
        function getValueClass(name, value) {
            if (value === null || value === undefined) return 'neutral';
            
            if (name === 'crisis_score') {
                if (value >= 7) return 'negative';
                if (value >= 3) return 'neutral';
                return 'positive';
            }
            
            if (name === 'bid_to_cover_ratio') {
                if (value < 2) return 'negative';
                if (value < 2.5) return 'neutral';
                return 'positive';
            }
            
            if (name === 'tail') {
                if (value > 3) return 'negative';
                if (value > 1) return 'neutral';
                return 'positive';
            }
            
            if (name.includes('_change')) {
                return value >= 0 ? 'positive' : 'negative';
            }
            
            return 'neutral';
        }
        
        // Get indicator status text
        function getIndicatorStatus(name, value) {
            if (value === null || value === undefined) return 'No data';
            
            if (name === 'crisis_level') {
                return getCrisisLevelDescription(value);
            }
            
            if (name === 'bid_to_cover_ratio') {
                if (value < 1.5) return '‚ö†Ô∏è Extremely weak demand';
                if (value < 2) return '‚ö†Ô∏è Low demand';
                if (value < 2.3) return 'Weak demand';
                if (value < 2.5) return 'Adequate demand';
                return '‚úÖ Strong demand';
            }
            
            if (name === 'tail') {
                if (value > 5) return '‚ö†Ô∏è Extreme tail';
                if (value > 3) return '‚ö†Ô∏è High tail';
                if (value > 1) return 'Elevated tail';
                return '‚úÖ Efficient pricing';
            }
            
            if (name === 'market_depth_ratio') {
                if (value < 1.5) return '‚ö†Ô∏è Low market depth';
                if (value < 2) return 'Reduced liquidity';
                if (value < 2.5) return 'Adequate liquidity';
                return '‚úÖ Deep market';
            }
            
            return '';
        }
        
        // Check if indicator is triggered
        function isIndicatorTriggered(name, value) {
            if (name === 'abnormal_auction' || name === 'severe_tail' || name === 'extreme_tail') {
                return value === 1;
            }
            
            if (name === 'crisis_score') {
                return value >= 3;
            }
            
            if (name === 'bid_to_cover_ratio') {
                return value < 2.3;
            }
            
            if (name === 'tail') {
                return value > 1;
            }
            
            return false;
        }
        
        // Get crisis level description
        function getCrisisLevelDescription(level) {
            const descriptions = {
                'NONE': 'Normal market conditions',
                'LOW': 'Minor stress indicators',
                'MODERATE': 'Moderate market stress',
                'HIGH': 'Significant market stress',
                'SEVERE': 'Critical conditions'
            };
            return descriptions[level] || '';
        }
        
        // Get crisis color class
        function getCrisisColorClass(level) {
            if (level === 'SEVERE') return 'negative';
            if (level === 'HIGH') return 'negative';
            if (level === 'MODERATE') return 'neutral';
            if (level === 'LOW') return 'neutral';
            return 'positive';
        }
        
        // Update crisis analysis
        function updateCrisisAnalysis() {
            if (!currentData.crisis) return;
            
            const content = document.getElementById('crisisAnalysisContent');
            const analysis = currentData.crisis.crisis_analysis;
            
            if (analysis) {
                content.innerHTML = `
                    <div class="summary-section">
                        <div class="summary-item">
                            <span class="summary-label">Crisis Level</span>
                            <span class="summary-value ${getCrisisColorClass(analysis.crisis_level)}">
                                ${analysis.crisis_level}
                            </span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Crisis Score</span>
                            <span class="summary-value">${analysis.crisis_score}/10</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Active Indicators</span>
                            <span class="summary-value">${analysis.crisis_indicators?.length || 0}</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Assessment Date</span>
                            <span class="summary-value">${new Date(analysis.assessment_date).toLocaleString()}</span>
                        </div>
                    </div>
                    <div style="margin-top: 1rem; padding: 1rem; background: rgba(0,0,0,0.3); border-radius: 6px;">
                        <strong>Interpretation:</strong><br>
                        ${currentData.crisis.interpretation}
                    </div>
                `;
            }
            
            // Update crisis indicators list
            updateCrisisIndicatorsList();
            
            // Update crisis chart
            updateCrisisChart();
        }
        
        // Update crisis indicators list
        function updateCrisisIndicatorsList() {
            const list = document.getElementById('crisisIndicatorsList');
            const activeIndicators = currentData.crisis?.crisis_analysis?.crisis_indicators || [];
            
            list.innerHTML = '';
            
            Object.keys(CRISIS_INDICATORS_DEFINITIONS).forEach(indicator => {
                const def = CRISIS_INDICATORS_DEFINITIONS[indicator];
                const isActive = activeIndicators.includes(indicator);
                
                const item = document.createElement('div');
                item.className = `crisis-indicator-item ${isActive ? 'active' : 'inactive'}`;
                item.innerHTML = `
                    <span>${isActive ? 'üî¥' : '‚ö™'}</span>
                    <div style="flex: 1;">
                        <div style="font-weight: bold;">${indicator.replace(/_/g, ' ')}</div>
                        <div style="font-size: 0.75rem; color: #888;">
                            ${def.threshold} (Weight: ${def.weight})
                        </div>
                    </div>
                `;
                list.appendChild(item);
            });
        }
        
        // Update liquidity analysis
        function updateLiquidityAnalysis() {
            if (!currentData.liquidity) return;
            
            const analysis = currentData.liquidity.liquidity_analysis;
            const metrics = currentData.liquidity.key_metrics;
            
            if (analysis) {
                // Update liquidity score and status
                document.getElementById('liquidityScore').textContent = 
                    analysis.liquidity_score?.toFixed(1) || '--';
                
                const statusBadge = document.getElementById('liquidityStatusBadge');
                statusBadge.textContent = analysis.liquidity_status || '--';
                statusBadge.className = `liquidity-status ${getLiquidityStatusClass(analysis.liquidity_status)}`;
                
                // Update content
                const content = document.getElementById('liquidityAnalysisContent');
                content.innerHTML = `
                    <div class="summary-section">
                        <h4>Key Liquidity Metrics</h4>
                        <div class="summary-item">
                            <span class="summary-label">Bid-to-Cover</span>
                            <span class="summary-value">${metrics?.bid_to_cover?.toFixed(2) || '--'}</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Market Depth</span>
                            <span class="summary-value">${metrics?.market_depth?.toFixed(2) || '--'}</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Tail (bp)</span>
                            <span class="summary-value">${metrics?.tail_bp?.toFixed(1) || '--'}</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Yield Range (bp)</span>
                            <span class="summary-value">${metrics?.yield_range_bp?.toFixed(1) || '--'}</span>
                        </div>
                        <div class="summary-item">
                            <span class="summary-label">Foreign Participation</span>
                            <span class="summary-value">${metrics?.foreign_participation?.toFixed(1) || '--'}%</span>
                        </div>
                    </div>
                    <div style="margin-top: 1rem;">
                        <h4>Active Liquidity Indicators</h4>
                        <div class="crisis-indicators-list">
                            ${(analysis.liquidity_indicators || []).map(ind => `
                                <div class="crisis-indicator-item active">
                                    <span>‚ö†Ô∏è</span>
                                    <div>${ind.replace(/_/g, ' ')}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                    <div style="margin-top: 1rem; padding: 1rem; background: rgba(0,0,0,0.3); border-radius: 6px;">
                        <strong>Interpretation:</strong><br>
                        ${currentData.liquidity.interpretation}
                    </div>
                `;
            }
            
            // Update liquidity chart
            updateLiquidityChart();
        }
        
        // Get liquidity status class
        function getLiquidityStatusClass(status) {
            if (status === 'LIQUIDITY_CRUNCH') return 'liquidity-crunch';
            if (status === 'LIQUIDITY_STRESS') return 'liquidity-stress';
            if (status === 'LIQUIDITY_CONCERNS') return 'liquidity-concerns';
            return 'liquidity-adequate';
        }
        
        // Update comprehensive summary
        function updateComprehensiveSummary() {
            if (!currentData.summary) return;
            
            const summaryDiv = document.getElementById('comprehensiveSummary');
            const summary = currentData.summary.auction_summary;
            
            if (summary) {
                summaryDiv.innerHTML = `
                    <div class="summary-section">
                        <h3 class="summary-title">Auction Overview</h3>
                        ${Object.entries(summary.overview || {}).map(([key, value]) => `
                            <div class="summary-item">
                                <span class="summary-label">${formatIndicatorName(key)}</span>
                                <span class="summary-value">${value}</span>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="summary-section">
                        <h3 class="summary-title">Yield Analysis</h3>
                        ${Object.entries(summary.yield_analysis || {}).map(([key, value]) => `
                            <div class="summary-item">
                                <span class="summary-label">${formatIndicatorName(key)}</span>
                                <span class="summary-value">${value}</span>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="summary-section">
                        <h3 class="summary-title">Participation Breakdown</h3>
                        ${Object.entries(summary.participation || {}).map(([key, value]) => `
                            <div class="summary-item">
                                <span class="summary-label">${formatIndicatorName(key)}</span>
                                <span class="summary-value">${value}</span>
                            </div>
                        `).join('')}
                    </div>
                    
                    <div class="summary-section">
                        <h3 class="summary-title">Risk Assessment</h3>
                        ${Object.entries(summary.risk_assessment || {}).map(([key, value]) => {
                            if (key === 'active_indicators' && Array.isArray(value)) {
                                return `
                                    <div class="summary-item">
                                        <span class="summary-label">${formatIndicatorName(key)}</span>
                                        <span class="summary-value">${value.length} indicators</span>
                                    </div>
                                `;
                            }
                            return `
                                <div class="summary-item">
                                    <span class="summary-label">${formatIndicatorName(key)}</span>
                                    <span class="summary-value">${value}</span>
                                </div>
                            `;
                        }).join('')}
                    </div>
                `;
            }
            
            // Update market interpretation
            if (currentData.summary.market_interpretation) {
                document.getElementById('marketInterpretation').innerHTML = currentData.summary.market_interpretation;
            }
        }
        
        // Update yield indicators
        function updateYieldIndicators() {
            if (!currentData.auction) return;
            
            const grid = document.getElementById('yieldIndicators');
            grid.innerHTML = '';
            
            const auction = currentData.auction;
            const yieldIndicators = [
                { name: 'high_rate', label: 'High Yield', value: auction.high_rate },
                { name: 'median_rate', label: 'Median Yield', value: auction.median_rate },
                { name: 'low_rate', label: 'Low Yield', value: auction.low_rate },
                { name: 'investment_rate', label: 'Investment Rate', value: auction.investment_rate },
                { name: 'price', label: 'Price', value: auction.price },
                { name: 'yield_range', label: 'Yield Range', value: auction.yield_range },
                { name: 'tail', label: 'Tail', value: auction.tail },
                { name: 'alloted_at_high', label: 'Allotted at High', value: auction.alloted_at_high }
            ];
            
            yieldIndicators.forEach(ind => {
                const card = createIndicatorCard(ind.name, ind.value, 'Yield Metrics');
                grid.appendChild(card);
            });
            
            // Update yield chart
            updateYieldChart();
        }
        
        // Update participation indicators
        function updateParticipationIndicators() {
            if (!currentData.auction) return;
            
            const grid = document.getElementById('participationIndicators');
            grid.innerHTML = '';
            
            const auction = currentData.auction;
            const participationIndicators = [
                { name: 'primary_dealer_pct', label: 'Primary Dealers', value: auction.primary_dealer_pct },
                { name: 'indirect_bidder_pct', label: 'Indirect Bidders', value: auction.indirect_bidder_pct },
                { name: 'direct_bidder_pct', label: 'Direct Bidders', value: auction.direct_bidder_pct },
                { name: 'foreign_participation', label: 'Foreign Participation', value: auction.foreign_participation },
                { name: 'primary_dealer_change', label: 'Dealer Change', value: auction.primary_dealer_change },
                { name: 'foreign_participation_change', label: 'Foreign Change', value: auction.foreign_participation_change }
            ];
            
            participationIndicators.forEach(ind => {
                const card = createIndicatorCard(ind.name, ind.value, 'Participation');
                grid.appendChild(card);
            });
            
            // Update participation chart
            updateParticipationChart();
        }
        
        // Update interpretation table
        function updateInterpretationTable() {
            if (!currentData.auction) return;
            
            const table = document.getElementById('interpretationTable');
            const auction = currentData.auction;
            
            const interpretations = [
                {
                    indicator: 'Bid-to-Cover Ratio',
                    value: auction.bid_to_cover_ratio?.toFixed(2) || '--',
                    status: auction.bid_to_cover_ratio < 2.3 ? 'WEAK' : 'NORMAL',
                    interpretation: interpretBidToCover(auction.bid_to_cover_ratio)
                },
                {
                    indicator: 'Tail',
                    value: `${auction.tail?.toFixed(1) || '--'}bp`,
                    status: auction.tail > 3 ? 'HIGH' : auction.tail > 1 ? 'ELEVATED' : 'NORMAL',
                    interpretation: interpretTail(auction.tail)
                },
                {
                    indicator: 'Foreign Participation',
                    value: `${auction.foreign_participation?.toFixed(1) || '--'}%`,
                    status: auction.foreign_participation < 30 ? 'LOW' : 'NORMAL',
                    interpretation: interpretForeignParticipation(auction.foreign_participation)
                },
                {
                    indicator: 'Market Depth',
                    value: auction.market_depth_ratio?.toFixed(2) || '--',
                    status: auction.market_depth_ratio < 2 ? 'LOW' : 'NORMAL',
                    interpretation: interpretMarketDepth(auction.market_depth_ratio)
                },
                {
                    indicator: 'Yield Range',
                    value: `${auction.yield_range?.toFixed(1) || '--'}bp`,
                    status: auction.yield_range > 10 ? 'HIGH' : 'NORMAL',
                    interpretation: interpretYieldRange(auction.yield_range)
                }
            ];
            
            table.innerHTML = interpretations.map(item => `
                <tr>
                    <td>${item.indicator}</td>
                    <td class="${item.status === 'NORMAL' ? 'positive' : item.status === 'HIGH' || item.status === 'LOW' || item.status === 'WEAK' ? 'negative' : 'neutral'}">
                        ${item.value}
                    </td>
                    <td>
                        <span class="risk-level risk-${item.status === 'NORMAL' ? 'none' : item.status === 'HIGH' || item.status === 'LOW' || item.status === 'WEAK' ? 'high' : 'moderate'}">
                            ${item.status}
                        </span>
                    </td>
                    <td style="font-size: 0.875rem;">${item.interpretation}</td>
                </tr>
            `).join('');
        }
        
        // Interpretation functions
        function interpretBidToCover(value) {
            if (!value) return 'No data available';
            if (value >= 2.5) return 'Strong investor demand evidenced by healthy bid-to-cover ratio';
            if (value >= 2.0) return 'Adequate demand levels, though below optimal ranges';
            return 'Weak demand signals potential market stress or reduced appetite for Treasuries';
        }
        
        function interpretTail(value) {
            if (!value) return 'No data available';
            if (value <= 1) return 'Efficient price discovery with minimal tail suggests good market functioning';
            if (value <= 3) return 'Moderate pricing dispersion indicates some uncertainty in yield expectations';
            return 'High tail suggests significant disagreement on fair value or market stress';
        }
        
        function interpretForeignParticipation(value) {
            if (!value) return 'No data available';
            if (value >= 50) return 'Strong international demand supports Treasury market liquidity';
            if (value >= 30) return 'Moderate foreign participation provides adequate international support';
            return 'Low foreign participation may indicate reduced international confidence';
        }
        
        function interpretMarketDepth(value) {
            if (!value) return 'No data available';
            if (value >= 2.5) return 'Deep market liquidity suggests healthy secondary market conditions';
            if (value >= 2.0) return 'Adequate liquidity levels support normal market operations';
            return 'Limited liquidity may constrain market efficiency and increase volatility risk';
        }
        
        function interpretYieldRange(value) {
            if (!value) return 'No data available';
            if (value <= 5) return 'Tight yield range indicates consensus on fair value';
            return 'Wide yield range suggests disagreement among investors on appropriate pricing';
        }
        
        // Initialize charts
        function initializeCharts() {
            const chartConfig = {
                paper_bgcolor: 'rgba(0, 0, 0, 0)',
                plot_bgcolor: 'rgba(0, 0, 0, 0.3)',
                font: { color: '#fff' },
                xaxis: {
                    gridcolor: 'rgba(255, 255, 255, 0.1)',
                    tickfont: { color: '#888' }
                },
                yaxis: {
                    gridcolor: 'rgba(255, 255, 255, 0.1)',
                    tickfont: { color: '#888' }
                },
                showlegend: true,
                legend: {
                    orientation: 'h',
                    y: -0.15
                }
            };
            
            const config = {
                responsive: true,
                displayModeBar: false
            };
            
            // Initialize empty charts
            ['mainChart', 'crisisChart', 'liquidityChart', 'participationChart', 'yieldChart'].forEach(chartId => {
                if (document.getElementById(chartId)) {
                    Plotly.newPlot(chartId, [], chartConfig, config);
                }
            });
        }
        
        // Update main chart
        function updateMainChart() {
            if (!currentData.auction || !document.getElementById('mainChart')) return;
            
            const auction = currentData.auction;
            
            // Create gauge charts for key metrics
            const traces = [
                {
                    type: 'indicator',
                    mode: 'gauge+number+delta',
                    value: auction.bid_to_cover_ratio,
                    title: { text: 'Bid-to-Cover Ratio' },
                    delta: { reference: 2.5, increasing: { color: '#00ff88' } },
                    gauge: {
                        axis: { range: [1, 4], tickwidth: 1 },
                        bar: { color: auction.bid_to_cover_ratio < 2.3 ? '#ff4444' : '#00ff88' },
                        bgcolor: 'rgba(255,255,255,0.1)',
                        borderwidth: 0,
                        steps: [
                            { range: [1, 2], color: 'rgba(255,68,68,0.1)' },
                            { range: [2, 2.5], color: 'rgba(255,170,0,0.1)' },
                            { range: [2.5, 4], color: 'rgba(0,255,136,0.1)' }
                        ],
                        threshold: {
                            line: { color: '#ffaa00', width: 2 },
                            thickness: 0.75,
                            value: 2.3
                        }
                    },
                    domain: { x: [0, 0.32], y: [0.55, 1] }
                },
                {
                    type: 'indicator',
                    mode: 'gauge+number',
                    value: auction.tail,
                    title: { text: 'Tail (basis points)' },
                    gauge: {
                        axis: { range: [0, 10], tickwidth: 1 },
                        bar: { color: auction.tail > 3 ? '#ff4444' : auction.tail > 1 ? '#ffaa00' : '#00ff88' },
                        bgcolor: 'rgba(255,255,255,0.1)',
                        borderwidth: 0,
                        steps: [
                            { range: [0, 1], color: 'rgba(0,255,136,0.1)' },
                            { range: [1, 3], color: 'rgba(255,170,0,0.1)' },
                            { range: [3, 10], color: 'rgba(255,68,68,0.1)' }
                        ]
                    },
                    domain: { x: [0.34, 0.66], y: [0.55, 1] }
                },
                {
                    type: 'indicator',
                    mode: 'gauge+number',
                    value: auction.foreign_participation,
                    title: { text: 'Foreign Participation %' },
                    gauge: {
                        axis: { range: [0, 100], tickwidth: 1 },
                        bar: { color: auction.foreign_participation < 30 ? '#ff4444' : '#00ff88' },
                        bgcolor: 'rgba(255,255,255,0.1)',
                        borderwidth: 0,
                        steps: [
                            { range: [0, 30], color: 'rgba(255,68,68,0.1)' },
                            { range: [30, 50], color: 'rgba(255,170,0,0.1)' },
                            { range: [50, 100], color: 'rgba(0,255,136,0.1)' }
                        ]
                    },
                    domain: { x: [0.68, 1], y: [0.55, 1] }
                },
                {
                    type: 'indicator',
                    mode: 'number+gauge',
                    value: auction.crisis_score,
                    title: { text: 'Crisis Score (0-10)' },
                    gauge: {
                        axis: { range: [0, 10], tickwidth: 1 },
                        bar: { color: auction.crisis_score >= 5 ? '#ff0000' : auction.crisis_score >= 3 ? '#ffaa00' : '#00ff88' },
                        bgcolor: 'rgba(255,255,255,0.1)',
                        borderwidth: 0,
                        steps: [
                            { range: [0, 3], color: 'rgba(0,255,136,0.1)' },
                            { range: [3, 5], color: 'rgba(255,170,0,0.1)' },
                            { range: [5, 7], color: 'rgba(255,68,68,0.1)' },
                            { range: [7, 10], color: 'rgba(255,0,0,0.2)' }
                        ],
                        threshold: {
                            line: { color: '#ff0000', width: 4 },
                            thickness: 0.75,
                            value: 7
                        }
                    },
                    domain: { x: [0.25, 0.75], y: [0, 0.45] }
                }
            ];
            
            const layout = {
                title: `Treasury Auction ${auction.auction_date} - ${auction.security_term} ${auction.security_type}`,
                paper_bgcolor: 'rgba(0, 0, 0, 0)',
                plot_bgcolor: 'rgba(0, 0, 0, 0)',
                font: { color: '#fff' },
                margin: { t: 50, b: 50, l: 50, r: 50 }
            };
            
            Plotly.newPlot('mainChart', traces, layout, { responsive: true });
        }
        
        // Update crisis chart
        function updateCrisisChart() {
            if (!currentData.crisis || !document.getElementById('crisisChart')) return;
            
            const activeIndicators = currentData.crisis.crisis_analysis?.crisis_indicators || [];
            
            // Count indicators by type
            const indicatorCounts = {
                'Bid-to-Cover': 0,
                'Tail': 0,
                'Dealer': 0,
                'Foreign': 0,
                'Market Depth': 0,
                'Yield': 0,
                'Changes': 0
            };
            
            activeIndicators.forEach(ind => {
                if (ind.includes('BID_TO_COVER')) indicatorCounts['Bid-to-Cover']++;
                else if (ind.includes('TAIL')) indicatorCounts['Tail']++;
                else if (ind.includes('DEALER')) indicatorCounts['Dealer']++;
                else if (ind.includes('FOREIGN')) indicatorCounts['Foreign']++;
                else if (ind.includes('DEPTH') || ind.includes('LIQUIDITY')) indicatorCounts['Market Depth']++;
                else if (ind.includes('YIELD')) indicatorCounts['Yield']++;
                else if (ind.includes('DROP') || ind.includes('EXODUS')) indicatorCounts['Changes']++;
            });
            
            const trace = {
                x: Object.keys(indicatorCounts),
                y: Object.values(indicatorCounts),
                type: 'bar',
                marker: {
                    color: Object.values(indicatorCounts).map(v => 
                        v >= 2 ? '#ff4444' : v >= 1 ? '#ffaa00' : '#00ff88'
                    )
                },
                text: Object.values(indicatorCounts).map(v => v.toString()),
                textposition: 'outside'
            };
            
            const layout = {
                title: 'Crisis Indicators by Category',
                paper_bgcolor: 'rgba(0, 0, 0, 0)',
                plot_bgcolor: 'rgba(0, 0, 0, 0.3)',
                font: { color: '#fff' },
                xaxis: {
                    gridcolor: 'rgba(255, 255, 255, 0.1)',
                    tickfont: { color: '#888' }
                },
                yaxis: {
                    title: 'Active Indicators',
                    gridcolor: 'rgba(255, 255, 255, 0.1)',
                    tickfont: { color: '#888' },
                    range: [0, Math.max(...Object.values(indicatorCounts), 3)]
                }
            };
            
            Plotly.newPlot('crisisChart', [trace], layout, { responsive: true });
        }
        
        // Update liquidity chart
        function updateLiquidityChart() {
            if (!currentData.liquidity || !document.getElementById('liquidityChart')) return;
            
            const metrics = currentData.liquidity.key_metrics;
            
            if (metrics) {
                const categories = ['Bid-to-Cover', 'Market Depth', 'Tail (bp)', 'Yield Range (bp)', 'Foreign %'];
                const values = [
                    metrics.bid_to_cover || 0,
                    metrics.market_depth || 0,
                    metrics.tail_bp || 0,
                    metrics.yield_range_bp || 0,
                    metrics.foreign_participation || 0
                ];
                
                const trace = {
                    type: 'scatterpolar',
                    r: values,
                    theta: categories,
                    fill: 'toself',
                    fillcolor: 'rgba(0, 255, 136, 0.2)',
                    line: {
                        color: '#00ff88',
                        width: 2
                    },
                    marker: {
                        color: '#00ff88',
                        size: 8
                    }
                };
                
                const layout = {
                    title: 'Liquidity Metrics Radar',
                    paper_bgcolor: 'rgba(0, 0, 0, 0)',
                    plot_bgcolor: 'rgba(0, 0, 0, 0.3)',
                    font: { color: '#fff' },
                    polar: {
                        radialaxis: {
                            visible: true,
                            gridcolor: 'rgba(255, 255, 255, 0.1)',
                            tickfont: { color: '#888' }
                        },
                        angularaxis: {
                            gridcolor: 'rgba(255, 255, 255, 0.1)',
                            tickfont: { color: '#888' }
                        }
                    }
                };
                
                Plotly.newPlot('liquidityChart', [trace], layout, { responsive: true });
            }
        }
        
        // Update participation chart
        function updateParticipationChart() {
            if (!currentData.auction || !document.getElementById('participationChart')) return;
            
            const auction = currentData.auction;
            
            const data = [{
                values: [
                    auction.primary_dealer_pct || 0,
                    auction.indirect_bidder_pct || 0,
                    auction.direct_bidder_pct || 0,
                    Math.max(0, 100 - (auction.primary_dealer_pct || 0) - (auction.indirect_bidder_pct || 0) - (auction.direct_bidder_pct || 0))
                ],
                labels: ['Primary Dealers', 'Foreign/Indirect', 'Direct Bidders', 'Other'],
                type: 'pie',
                marker: {
                    colors: ['#ff4444', '#00ff88', '#00ccff', '#666'],
                    line: {
                        color: '#fff',
                        width: 2
                    }
                },
                textinfo: 'label+percent',
                textposition: 'outside',
                hole: 0.4
            }];
            
            const layout = {
                title: 'Market Participation Breakdown',
                paper_bgcolor: 'rgba(0, 0, 0, 0)',
                plot_bgcolor: 'rgba(0, 0, 0, 0)',
                font: { color: '#fff' },
                showlegend: true,
                legend: {
                    orientation: 'v',
                    x: 1,
                    y: 0.5
                }
            };
            
            Plotly.newPlot('participationChart', data, layout, { responsive: true });
        }
        
        // Update yield chart
        function updateYieldChart() {
            if (!currentData.auction || !document.getElementById('yieldChart')) return;
            
            const auction = currentData.auction;
            
            const trace1 = {
                x: ['Low', 'Median', 'High'],
                y: [auction.low_rate || 0, auction.median_rate || 0, auction.high_rate || 0],
                type: 'scatter',
                mode: 'lines+markers',
                name: 'Yield Curve',
                line: {
                    color: '#00ff88',
                    width: 3,
                    shape: 'spline'
                },
                marker: {
                    size: 10,
                    color: ['#00ff88', '#ffaa00', '#ff4444']
                }
            };
            
            const trace2 = {
                x: ['Tail'],
                y: [auction.tail || 0],
                type: 'bar',
                name: 'Tail (bp)',
                marker: {
                    color: auction.tail > 3 ? '#ff4444' : auction.tail > 1 ? '#ffaa00' : '#00ff88'
                },
                yaxis: 'y2',
                width: 0.3
            };
            
            const layout = {
                title: 'Yield Analysis',
                paper_bgcolor: 'rgba(0, 0, 0, 0)',
                plot_bgcolor: 'rgba(0, 0, 0, 0.3)',
                font: { color: '#fff' },
                xaxis: {
                    gridcolor: 'rgba(255, 255, 255, 0.1)',
                    tickfont: { color: '#888' }
                },
                yaxis: {
                    title: 'Yield (%)',
                    gridcolor: 'rgba(255, 255, 255, 0.1)',
                    tickfont: { color: '#888' }
                },
                yaxis2: {
                    title: 'Tail (basis points)',
                    overlaying: 'y',
                    side: 'right',
                    gridcolor: 'rgba(255, 255, 255, 0.1)',
                    tickfont: { color: '#888' }
                },
                showlegend: true
            };
            
            Plotly.newPlot('yieldChart', [trace1, trace2], layout, { responsive: true });
        }
        
        // Setup event listeners
        function setupEventListeners() {
            // Tab navigation
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    e.target.classList.add('active');
                    
                    document.querySelectorAll('.tab-content').forEach(content => {
                        content.classList.remove('active');
                    });
                    
                    const tabId = e.target.dataset.tab;
                    document.getElementById(tabId).classList.add('active');
                    
                    // Update interpretation table when switching to interpretation tab
                    if (tabId === 'interpretation') {
                        updateInterpretationTable();
                    }
                });
            });
        }
        
        // Start auto-refresh
        function startAutoRefresh() {
            // Refresh every 30 seconds
            autoRefreshInterval = setInterval(() => {
                console.log('üîÑ Auto-refreshing real Treasury data...');
                loadAllData();
            }, 30000);
        }
        
        // Show error message
        function showError(message) {
            console.error(message);
            // You can implement a toast notification or error display here
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', initializePlatform);
    </script>
</body>
</html>
