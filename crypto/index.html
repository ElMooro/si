<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>JustHodl.AI | Crypto Intelligence Terminal v4</title>
<link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Mono:wght@300;400;500;600;700&family=IBM+Plex+Sans:wght@300;400;500;600;700&display=swap" rel="stylesheet">
<style>
:root{--bg:#050810;--bg1:#0a0f1a;--bg2:#0f1524;--bg3:#141c2e;--bg4:#1a2338;--brd:#1a2540;--brd2:#243050;--t1:#e8ecf4;--t2:#8b95ad;--t3:#5a6580;--green:#00e676;--green2:#00c853;--gbg:rgba(0,230,118,.06);--red:#ff1744;--red2:#d50000;--rbg:rgba(255,23,68,.06);--yellow:#ffc400;--ybg:rgba(255,196,0,.06);--blue:#2979ff;--bbg:rgba(41,121,255,.06);--cyan:#00e5ff;--purple:#7c4dff;--orange:#ff6d00}
*{margin:0;padding:0;box-sizing:border-box}
body{background:var(--bg);color:var(--t1);font-family:'IBM Plex Sans',system-ui,sans-serif;min-height:100vh;overflow-x:hidden}
.mono{font-family:'IBM Plex Mono',monospace}
.hdr{background:linear-gradient(180deg,rgba(10,15,30,.98),var(--bg));border-bottom:1px solid var(--brd);padding:10px 20px;display:flex;align-items:center;justify-content:space-between;position:sticky;top:0;z-index:200;backdrop-filter:blur(24px)}
.hdr-l{display:flex;align-items:center;gap:14px}
.logo{font-size:18px;font-weight:700;background:linear-gradient(135deg,var(--orange),var(--yellow));-webkit-background-clip:text;-webkit-text-fill-color:transparent}
.logo-sub{font-size:10px;color:var(--t3);text-transform:uppercase;letter-spacing:3px}
.hdr-r{display:flex;align-items:center;gap:16px;font-size:11px;color:var(--t2)}
.dot{width:7px;height:7px;border-radius:50%;background:var(--green);animation:pulse 2s infinite;box-shadow:0 0 8px var(--green)}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.5}}
.tabs{display:flex;gap:2px;background:var(--bg1);border-bottom:1px solid var(--brd);padding:0 12px;overflow-x:auto;scrollbar-width:none}
.tabs::-webkit-scrollbar{display:none}
.tab{padding:7px 11px;cursor:pointer;font-size:10px;color:var(--t3);border-bottom:2px solid transparent;transition:all .2s;white-space:nowrap}
.tab:hover{color:var(--t2);background:var(--bg2)}
.tab.active{color:var(--cyan);border-bottom-color:var(--cyan);background:var(--bg2)}
.container{padding:16px;max-width:1400px;margin:0 auto}
.grid{display:grid;gap:12px}.g2{grid-template-columns:1fr 1fr}.g3{grid-template-columns:1fr 1fr 1fr}.g4{grid-template-columns:1fr 1fr 1fr 1fr}
.card{background:var(--bg2);border:1px solid var(--brd);border-radius:8px;padding:14px;overflow:hidden}
.card-title{font-size:11px;color:var(--t3);text-transform:uppercase;letter-spacing:1px;margin-bottom:10px;display:flex;align-items:center;gap:6px}
.risk-gauge{text-align:center;padding:20px}.risk-score{font-size:56px;font-weight:700;line-height:1}.risk-label{font-size:14px;font-weight:600;margin-top:4px}
.risk-bar{height:8px;background:var(--bg4);border-radius:4px;margin:12px 0;position:relative;overflow:hidden}
.risk-fill{height:100%;border-radius:4px;transition:width .6s ease}
.metric{display:flex;justify-content:space-between;align-items:center;padding:6px 0;border-bottom:1px solid var(--brd)}.metric:last-child{border-bottom:none}
.metric-name{font-size:11px;color:var(--t2)}.metric-val{font-size:12px;font-weight:600;font-family:'IBM Plex Mono',monospace}
.up{color:var(--green)}.dn{color:var(--red)}.nt{color:var(--yellow)}
.signal{display:inline-block;padding:2px 8px;border-radius:4px;font-size:10px;font-weight:600}
.sig-mint{background:var(--gbg);color:var(--green)}.sig-burn{background:var(--rbg);color:var(--red)}.sig-stable{background:var(--ybg);color:var(--yellow)}
.sig-inflow{background:var(--gbg);color:var(--green)}.sig-outflow{background:var(--rbg);color:var(--red)}.sig-neutral{background:rgba(255,255,255,.05);color:var(--t2)}
table{width:100%;border-collapse:collapse;font-size:11px}
th{text-align:left;padding:6px 8px;color:var(--t3);font-weight:500;border-bottom:1px solid var(--brd2);font-size:10px;text-transform:uppercase;letter-spacing:.5px}
td{padding:5px 8px;border-bottom:1px solid var(--brd)}tr:hover{background:rgba(255,255,255,.02)}
.pane{display:none}.pane.active{display:block}
.alert-box{padding:10px 14px;border-radius:6px;margin-bottom:8px;font-size:12px;display:flex;align-items:center;gap:8px}
.alert-red{background:var(--rbg);border:1px solid rgba(255,23,68,.2)}.alert-green{background:var(--gbg);border:1px solid rgba(0,230,118,.2)}.alert-yellow{background:var(--ybg);border:1px solid rgba(255,196,0,.2)}
.fg-gauge{width:100%;height:20px;border-radius:10px;background:linear-gradient(90deg,#ff1744,#ff6d00,#ffc400,#76ff03,#00e676);position:relative;margin:8px 0}
.fg-needle{position:absolute;top:-4px;width:4px;height:28px;background:#fff;border-radius:2px;transition:left .6s ease;box-shadow:0 0 8px rgba(255,255,255,.5)}
.stat-big{font-size:28px;font-weight:700;line-height:1}.stat-sm{font-size:11px;color:var(--t3)}
.back-link{color:var(--cyan);text-decoration:none;font-size:11px;padding:4px 10px;border:1px solid var(--brd2);border-radius:5px}.back-link:hover{background:rgba(0,229,255,.06)}
.loading{text-align:center;padding:60px 20px;color:var(--t3)}
.loading .spinner{width:40px;height:40px;border:3px solid var(--brd2);border-top-color:var(--cyan);border-radius:50%;animation:spin 1s linear infinite;margin:0 auto 16px}
@keyframes spin{to{transform:rotate(360deg)}}
.nav-links{display:flex;gap:8px;font-size:11px}
.nav-links a{color:var(--t3);text-decoration:none;padding:3px 8px;border:1px solid var(--brd);border-radius:4px;transition:all .2s}
.nav-links a:hover{color:var(--cyan);border-color:var(--cyan)}
.bias-badge{display:inline-block;padding:3px 10px;border-radius:12px;font-size:11px;font-weight:700}
.bias-STRONG_BUY,.bias-BUY{background:var(--gbg);color:var(--green)}.bias-STRONG_SELL,.bias-SELL{background:var(--rbg);color:var(--red)}.bias-NEUTRAL,.bias-MIXED{background:var(--ybg);color:var(--yellow)}
.pattern-tag{display:inline-block;padding:2px 8px;border-radius:4px;font-size:10px;font-weight:600;margin:2px}
.pattern-BULLISH{background:var(--gbg);color:var(--green)}.pattern-BEARISH{background:var(--rbg);color:var(--red)}.pattern-NEUTRAL{background:var(--ybg);color:var(--yellow)}
.ai-report{white-space:pre-wrap;font-size:13px;line-height:1.7;color:var(--t1);padding:16px;background:var(--bg1);border-radius:8px;border:1px solid var(--brd2)}
.ai-report strong,.ai-report b{color:var(--cyan)}.tf-pill{display:inline-block;padding:2px 6px;border-radius:3px;font-size:9px;margin:0 2px;background:var(--bg4);color:var(--t2)}
.score-bar{height:6px;background:var(--bg4);border-radius:3px;overflow:hidden;width:60px;display:inline-block;vertical-align:middle;margin-left:6px}
.score-fill{height:100%;border-radius:3px}
@media(max-width:900px){.g2,.g3,.g4{grid-template-columns:1fr}.tabs{flex-wrap:nowrap}}
</style>
</head>
<body>
<div class="hdr">
  <div class="hdr-l"><div><div class="logo">ü™ô CRYPTO INTEL v4</div><div class="logo-sub">JustHodl.AI Terminal</div></div></div>
  <div class="hdr-r">
    <div class="nav-links">
      <a href="http://justhodl-dashboard-live.s3-website-us-east-1.amazonaws.com/">üìä Main Terminal</a>
      <a href="https://justhodl.ai">üè† JustHodl.AI</a>
    </div>
    <span id="ts" class="mono" style="font-size:10px">Loading...</span>
    <span style="display:flex;align-items:center;gap:5px"><span class="dot"></span> LIVE</span>
  </div>
</div>

<div class="tabs" id="tabs">
  <div class="tab active" data-tab="overview">üìä Overview</div>
  <div class="tab" data-tab="technicals">üìà Technicals</div>
  <div class="tab" data-tab="patterns">üîç Patterns</div>
  <div class="tab" data-tab="ai">ü§ñ AI Intel</div>
  <div class="tab" data-tab="stablecoins">üí∞ Stablecoins</div>
  <div class="tab" data-tab="tvl">üèóÔ∏è DeFi TVL</div>
  <div class="tab" data-tab="derivatives">üìâ Derivatives</div>
  <div class="tab" data-tab="sentiment">üß† Sentiment</div>
  <div class="tab" data-tab="global">üåç Global</div>
  <div class="tab" data-tab="onchain">‚õìÔ∏è On-Chain</div>
  <div class="tab" data-tab="dex">üîÑ DEX</div>
  <div class="tab" data-tab="yields">üíé Yields</div>
</div>

<div class="container" id="main">
  <div class="loading"><div class="spinner"></div><div>Loading Crypto Intelligence v4...</div></div>
</div>

<script>
const DU="https://justhodl-dashboard-live.s3.amazonaws.com/crypto-intel.json";
let D=null;

document.getElementById('tabs').addEventListener('click',function(e){
  if(!e.target.classList.contains('tab'))return;
  document.querySelectorAll('.tab').forEach(t=>t.classList.remove('active'));
  e.target.classList.add('active');
  document.querySelectorAll('.pane').forEach(p=>p.classList.remove('active'));
  const p=document.getElementById('pane-'+e.target.dataset.tab);
  if(p)p.classList.add('active');
});

function cl(v){if(v==null)return'';v=parseFloat(v);return v>0?'up':v<0?'dn':'nt'}
function pct(v){if(v==null)return'-';v=parseFloat(v);return(v>0?'+':'')+v.toFixed(2)+'%'}
function sig(type){
  const m={'MINTING':'sig-mint','BURNING':'sig-burn','STABLE':'sig-stable','INFLOW':'sig-inflow','OUTFLOW':'sig-outflow','NEUTRAL':'sig-neutral'};
  return '<span class="signal '+(m[type]||'sig-neutral')+'">'+type+'</span>';
}
function bias(b){return '<span class="bias-badge bias-'+b+'">'+b.replace(/_/g,' ')+'</span>'}
function scoreBar(s){
  const c=s>=70?'var(--green)':s>=50?'var(--yellow)':s>=30?'var(--orange)':'var(--red)';
  return '<span class="score-bar"><span class="score-fill" style="width:'+s+'%;background:'+c+'"></span></span> '+s;
}
function patTag(p){return '<span class="pattern-tag pattern-'+p.bias+'">'+p.type+'</span>'}

function render(){
try{
  if(!D){document.getElementById('main').innerHTML='<div class="loading" style="color:var(--red)">Failed to load data</div>';return}
  const R=D.risk_score||{};const ts=D.generated_at||'?';
  document.getElementById('ts').textContent=ts.replace('T',' ').replace('Z',' UTC');
  let h='';

  // ‚ïê‚ïê OVERVIEW ‚ïê‚ïê
  h+='<div class="pane active" id="pane-overview">';
  const rClr=R.score>=75?'var(--red)':R.score>=60?'var(--orange)':R.score>=40?'var(--yellow)':R.score>=25?'var(--green2)':'var(--green)';
  h+='<div class="grid g4" style="margin-bottom:12px">';
  h+='<div class="card risk-gauge" style="grid-column:span 2"><div class="card-title">üéØ Composite Risk Score</div>';
  h+='<div class="risk-score" style="color:'+rClr+'">'+R.score+'</div>';
  h+='<div class="risk-label" style="color:'+rClr+'">'+R.regime+'</div>';
  h+='<div class="risk-bar"><div class="risk-fill" style="width:'+R.score+'%;background:'+rClr+'"></div></div>';
  h+='<div style="font-size:12px;color:var(--t2)">'+R.action+'</div></div>';

  const fg=D.fear_greed||{};const fgv=fg.current||50;
  const fgClr=fgv<25?'var(--red)':fgv<45?'var(--orange)':fgv<55?'var(--yellow)':fgv<75?'var(--green2)':'var(--green)';
  h+='<div class="card"><div class="card-title">üò± Fear & Greed</div>';
  h+='<div class="stat-big" style="color:'+fgClr+'">'+fgv+'</div>';
  h+='<div style="font-size:12px;color:'+fgClr+';font-weight:600">'+(fg.label||'-')+'</div>';
  h+='<div class="fg-gauge"><div class="fg-needle" style="left:'+fgv+'%"></div></div>';
  h+='<div class="metric"><span class="metric-name">7D Avg</span><span class="metric-val">'+(fg.avg_7d||'-')+'</span></div>';
  h+='<div class="metric"><span class="metric-name">30D Avg</span><span class="metric-val">'+(fg.avg_30d||'-')+'</span></div></div>';

  const gl=D.global_market||{};
  h+='<div class="card"><div class="card-title">üåç Market Cap</div>';
  h+='<div class="stat-big">'+(gl.total_mcap_fmt||'-')+'</div>';
  h+='<div class="stat-sm">24h: <span class="'+cl(gl.mcap_change_24h)+'">'+pct(gl.mcap_change_24h)+'</span></div>';
  h+='<div class="metric" style="margin-top:8px"><span class="metric-name">BTC Dom</span><span class="metric-val">'+(gl.btc_dominance||'-')+'%</span></div>';
  h+='<div class="metric"><span class="metric-name">24h Vol</span><span class="metric-val">'+(gl.total_volume_fmt||'-')+'</span></div></div>';
  h+='</div>';

  if(R.signals&&R.signals.length){h+='<div style="margin:12px 0">';R.signals.forEach(function(s){
    const cls=s.startsWith('üî¥')?'alert-red':s.startsWith('üü¢')?'alert-green':'alert-yellow';
    h+='<div class="alert-box '+cls+'">'+s+'</div>';});h+='</div>';}

  // Multi-TF Quick View
  const tech=D.technicals||{};const coins=tech.coins||{};
  if(Object.keys(coins).length){
    h+='<div class="card" style="margin-top:12px"><div class="card-title">üìà Multi-Timeframe Consensus (TIER 4)</div>';
    h+='<table><thead><tr><th>Coin</th><th style="text-align:right">Price</th><th>4H</th><th>1D</th><th>1W</th><th>Consensus</th><th>Key Signals</th></tr></thead><tbody>';
    Object.entries(coins).forEach(function([coin,data]){
      h+='<tr><td><strong>'+coin+'</strong></td>';
      h+='<td style="text-align:right" class="mono">$'+(data.price||0).toLocaleString(undefined,{maximumFractionDigits:6})+'</td>';
      ['4h','1d','1w'].forEach(function(tf){
        const tfd=data.timeframes&&data.timeframes[tf]||{};
        if(tfd.status==='ok'){h+='<td>'+bias(tfd.bias)+' <span class="mono" style="font-size:10px">'+tfd.score+'</span></td>';}
        else{h+='<td style="color:var(--t3)">-</td>';}
      });
      h+='<td>'+bias(data.consensus||'?')+'</td>';
      h+='<td style="font-size:10px;color:var(--t2)">'+(data.key_signals||[]).slice(0,3).join(', ')+'</td></tr>';
    });
    h+='</tbody></table></div>';
  }

  // TIER 3 Quick cards
  const eth_gas=D.eth_gas||{};const whales=D.whale_txs||{};const onr=D.onchain_ratios||{};
  h+='<div class="grid g3" style="margin-top:12px">';
  h+='<div class="card"><div class="card-title">‚õΩ ETH Gas</div>';
  h+='<div class="metric"><span class="metric-name">Low</span><span class="metric-val mono">'+(eth_gas.low||'-')+' gwei</span></div>';
  h+='<div class="metric"><span class="metric-name">Standard</span><span class="metric-val mono">'+(eth_gas.standard||'-')+' gwei</span></div>';
  h+='<div class="metric"><span class="metric-name">Fast</span><span class="metric-val mono">'+(eth_gas.fast||'-')+' gwei</span></div></div>';
  
  h+='<div class="card"><div class="card-title">üêã Whale Activity</div>';
  h+='<div class="stat-big">'+(whales.whale_count||0)+'</div><div class="stat-sm">Large Txns (100+ BTC)</div>';
  h+='<div class="metric" style="margin-top:6px"><span class="metric-name">Total BTC</span><span class="metric-val mono">'+(whales.total_whale_btc||0)+' BTC</span></div></div>';
  
  h+='<div class="card"><div class="card-title">üìä MVRV Ratio</div>';
  h+='<div class="stat-big">'+(onr.mvrv_approx||'-')+'</div>';
  const onrSig=onr.signal||'?';const onrClr=onrSig==='OVERVALUED'?'var(--red)':onrSig==='UNDERVALUED'?'var(--green)':'var(--yellow)';
  h+='<div style="font-size:12px;color:'+onrClr+';font-weight:600">'+onrSig+'</div>';
  h+='<div class="metric" style="margin-top:6px"><span class="metric-name">30D Mom</span><span class="metric-val mono '+cl(onr.momentum_30d)+'">'+pct(onr.momentum_30d)+'</span></div></div>';
  h+='</div>';

  // Top Coins
  const tc=D.top_coins||{};
  if(tc.coins&&tc.coins.length){
    h+='<div class="card" style="margin-top:12px"><div class="card-title">üîù Top Coins</div>';
    h+='<table><thead><tr><th>#</th><th>Coin</th><th style="text-align:right">Price</th><th style="text-align:right">1h</th><th style="text-align:right">24h</th><th style="text-align:right">7d</th><th style="text-align:right">30d</th><th style="text-align:right">MCap</th></tr></thead><tbody>';
    tc.coins.forEach(function(c){
      h+='<tr><td class="mono">'+c.rank+'</td><td><strong>'+c.symbol+'</strong> <span style="color:var(--t3);font-size:10px">'+c.name+'</span></td>';
      h+='<td style="text-align:right" class="mono">'+c.price_fmt+'</td>';
      h+='<td style="text-align:right" class="mono '+cl(c.change_1h)+'">'+pct(c.change_1h)+'</td>';
      h+='<td style="text-align:right" class="mono '+cl(c.change_24h)+'">'+pct(c.change_24h)+'</td>';
      h+='<td style="text-align:right" class="mono '+cl(c.change_7d)+'">'+pct(c.change_7d)+'</td>';
      h+='<td style="text-align:right" class="mono '+cl(c.change_30d)+'">'+pct(c.change_30d)+'</td>';
      h+='<td style="text-align:right" class="mono">'+c.mcap_fmt+'</td></tr>';});
    h+='</tbody></table></div>';}
  h+='</div>';

  // ‚ïê‚ïê TECHNICALS (TIER 1+4) ‚ïê‚ïê
  h+='<div class="pane" id="pane-technicals">';
  if(Object.keys(coins).length){
    Object.entries(coins).forEach(function([coin,data]){
      h+='<div class="card" style="margin-bottom:12px"><div class="card-title">'+coin+' ‚Äî $'+(data.price||0).toLocaleString(undefined,{maximumFractionDigits:6})+' | Consensus: '+bias(data.consensus||'?')+'</div>';
      h+='<table><thead><tr><th>TF</th><th>RSI</th><th>MACD</th><th>EMA Trend</th><th>SuperTrend</th><th>BB %</th><th>StochRSI</th><th>ATR %</th><th style="text-align:right">Score</th><th>Bias</th></tr></thead><tbody>';
      ['4h','1d','1w'].forEach(function(tf){
        const tfd=data.timeframes&&data.timeframes[tf]||{};
        if(tfd.status!=='ok'){h+='<tr><td class="tf-pill">'+tf+'</td><td colspan="9" style="color:var(--t3)">No data</td></tr>';return;}
        const ind=tfd.indicators||{};const macd=ind.macd||{};const ema=ind.ema||{};const bb=ind.bollinger||{};const sr=ind.stochrsi||{};const st=ind.supertrend||{};
        const rsiClr=(ind.rsi||50)<30?'up':(ind.rsi||50)>70?'dn':'nt';
        h+='<tr><td><span class="tf-pill">'+tf+'</span></td>';
        h+='<td class="mono '+rsiClr+'">'+(ind.rsi||'-')+'</td>';
        h+='<td class="mono"><span class="'+(macd.cross==='BULLISH'?'up':macd.cross==='BEARISH'?'dn':'nt')+'">'+(macd.cross||'-')+'</span></td>';
        h+='<td><span class="'+(ema.trend&&ema.trend.includes('BULL')?'up':ema.trend&&ema.trend.includes('BEAR')?'dn':'nt')+'">'+(ema.trend||'-')+'</span>'+(ema.cross_signal?' <span style="color:var(--yellow);font-size:10px">‚ö°'+ema.cross_signal+'</span>':'')+'</td>';
        h+='<td class="'+(st.trend==='BULLISH'?'up':'dn')+'">'+(st.trend||'-')+'</td>';
        h+='<td class="mono">'+(bb.position!=null?bb.position+'%':'-')+'</td>';
        h+='<td class="mono">'+(sr.k!=null?sr.k:'-')+'</td>';
        h+='<td class="mono">'+(ind.atr_pct!=null?ind.atr_pct+'%':'-')+'</td>';
        h+='<td style="text-align:right">'+scoreBar(tfd.score||50)+'</td>';
        h+='<td>'+bias(tfd.bias||'?')+'</td></tr>';
      });
      h+='</tbody></table>';
      if(data.key_signals&&data.key_signals.length){h+='<div style="margin-top:8px;font-size:11px;color:var(--t2)">Signals: '+data.key_signals.join(' | ')+'</div>';}
      h+='</div>';
    });
  } else {h+='<div class="card"><div style="color:var(--t3);padding:40px;text-align:center">Technical data loading...</div></div>';}
  h+='</div>';

  // ‚ïê‚ïê PATTERNS (TIER 2) ‚ïê‚ïê
  h+='<div class="pane" id="pane-patterns">';
  h+='<div class="card"><div class="card-title">üîç Detected Chart Patterns (All Timeframes)</div>';
  var allPatterns=[];
  Object.entries(coins).forEach(function([coin,data]){
    ['4h','1d','1w'].forEach(function(tf){
      const tfd=data.timeframes&&data.timeframes[tf]||{};
      if(tfd.patterns&&tfd.patterns.length){
        tfd.patterns.forEach(function(p){allPatterns.push(Object.assign({},p,{coin:coin,tf:tf}));});
      }
    });
  });
  if(allPatterns.length){
    h+='<table><thead><tr><th>Coin</th><th>TF</th><th>Pattern</th><th>Confidence</th><th>Bias</th><th>Detail</th></tr></thead><tbody>';
    allPatterns.forEach(function(p){
      h+='<tr><td><strong>'+p.coin+'</strong></td><td><span class="tf-pill">'+p.tf+'</span></td>';
      h+='<td>'+patTag(p)+'</td>';
      h+='<td style="color:'+(p.confidence==='HIGH'?'var(--green)':p.confidence==='MEDIUM'?'var(--yellow)':'var(--t3)')+'">'+p.confidence+'</td>';
      h+='<td class="'+(p.bias==='BULLISH'?'up':'dn')+'">'+p.bias+'</td>';
      h+='<td style="font-size:10px;color:var(--t2)">'+(p.detail||'')+'</td></tr>';
    });
    h+='</tbody></table>';
  } else {h+='<div style="color:var(--t3);padding:30px;text-align:center">No patterns detected currently. Patterns update every 15 minutes.</div>';}
  h+='</div></div>';

  // ‚ïê‚ïê AI INTELLIGENCE ‚ïê‚ïê
  h+='<div class="pane" id="pane-ai">';
  const ai=D.ai_intelligence||{};
  if(ai.status==='ok'&&ai.analysis){
    h+='<div class="card" style="margin-bottom:12px"><div class="card-title">ü§ñ AI Intelligence Report ‚Äî Claude Analysis</div>';
    h+='<div style="font-size:10px;color:var(--t3);margin-bottom:12px">Model: '+(ai.model||'?')+' | Generated: '+(ai.generated_at||'?')+'</div>';
    var formatted=ai.analysis.replace(/\*\*(.*?)\*\*/g,'<strong>$1</strong>').replace(/\n/g,'<br>');
    h+='<div class="ai-report">'+formatted+'</div></div>';
  } else {
    h+='<div class="card"><div class="card-title">ü§ñ AI Intelligence</div>';
    h+='<div style="color:var(--t3);padding:30px;text-align:center">'+(ai.error||'AI Intelligence generating... This runs every 15 minutes.')+'</div></div>';
  }
  h+='</div>';

  // ‚ïê‚ïê STABLECOINS ‚ïê‚ïê
  h+='<div class="pane" id="pane-stablecoins">';
  const st=D.stablecoins||{};
  h+='<div class="card"><div class="card-title">üí∞ Stablecoin Supply ‚Äî Mint/Burn Signals</div>';
  h+='<div class="grid g3" style="margin-bottom:12px">';
  h+='<div class="card" style="text-align:center"><div class="stat-sm">Total Supply</div><div class="stat-big">'+(st.total_mcap_fmt||'-')+'</div></div>';
  h+='<div class="card" style="text-align:center"><div class="stat-sm">Net Signal</div><div class="stat-big">'+sig(st.net_signal||'NEUTRAL')+'</div></div>';
  h+='<div class="card" style="text-align:center"><div class="stat-sm">Mint / Burn</div><div class="stat-big"><span class="up">'+(st.minting_count||0)+'</span> / <span class="dn">'+(st.burning_count||0)+'</span></div></div>';
  h+='</div>';
  if(st.stablecoins&&st.stablecoins.length){
    h+='<table><thead><tr><th>Stablecoin</th><th>Symbol</th><th style="text-align:right">Market Cap</th><th style="text-align:right">1D</th><th style="text-align:right">7D</th><th style="text-align:right">30D</th><th>Signal</th><th>Type</th></tr></thead><tbody>';
    st.stablecoins.forEach(function(s){
      h+='<tr><td><strong>'+s.name+'</strong></td><td class="mono">'+s.symbol+'</td>';
      h+='<td style="text-align:right" class="mono">'+s.mcap_fmt+'</td>';
      h+='<td style="text-align:right" class="mono '+cl(s.change_1d)+'">'+pct(s.change_1d)+'</td>';
      h+='<td style="text-align:right" class="mono '+cl(s.change_7d)+'">'+pct(s.change_7d)+'</td>';
      h+='<td style="text-align:right" class="mono '+cl(s.change_30d)+'">'+pct(s.change_30d)+'</td>';
      h+='<td>'+sig(s.signal)+'</td>';
      h+='<td style="color:var(--t3);font-size:10px">'+s.mechanism+'</td></tr>';});
    h+='</tbody></table>';}
  h+='</div></div>';

  // ‚ïê‚ïê TVL ‚ïê‚ïê
  h+='<div class="pane" id="pane-tvl">';
  const tvl=D.tvl||{};
  h+='<div class="card" style="margin-bottom:12px"><div class="card-title">üèóÔ∏è Total DeFi TVL: '+(tvl.total_tvl_fmt||'-')+'</div></div>';
  h+='<div class="grid g2">';
  h+='<div class="card"><div class="card-title">TVL by Chain</div>';
  if(tvl.chains&&tvl.chains.length){
    h+='<table><thead><tr><th>Chain</th><th style="text-align:right">TVL</th><th style="text-align:right">Share</th></tr></thead><tbody>';
    tvl.chains.forEach(function(c){h+='<tr><td><strong>'+c.name+'</strong></td><td style="text-align:right" class="mono">'+c.tvl_fmt+'</td><td style="text-align:right" class="mono">'+c.share+'%</td></tr>';});
    h+='</tbody></table>';} else {h+='<div style="color:var(--t3);padding:20px;text-align:center">Loading TVL data...</div>';}
  h+='</div>';
  h+='<div class="card"><div class="card-title">Top Protocols</div>';
  if(tvl.top_protocols&&tvl.top_protocols.length){
    h+='<table><thead><tr><th>Protocol</th><th>Chain</th><th style="text-align:right">TVL</th><th style="text-align:right">1D</th><th style="text-align:right">7D</th></tr></thead><tbody>';
    tvl.top_protocols.forEach(function(p){
      h+='<tr><td><strong>'+p.name+'</strong></td><td style="font-size:10px;color:var(--t3)">'+p.chain+'</td>';
      h+='<td style="text-align:right" class="mono">'+p.tvl_fmt+'</td>';
      h+='<td style="text-align:right" class="mono '+cl(p.change_1d)+'">'+pct(p.change_1d)+'</td>';
      h+='<td style="text-align:right" class="mono '+cl(p.change_7d)+'">'+pct(p.change_7d)+'</td></tr>';});
    h+='</tbody></table>';} else {h+='<div style="color:var(--t3);padding:20px;text-align:center">Loading protocols...</div>';}
  h+='</div></div></div>';

  // ‚ïê‚ïê DERIVATIVES ‚ïê‚ïê
  h+='<div class="pane" id="pane-derivatives">';
  const fn=D.funding||{};
  h+='<div class="card" style="margin-bottom:12px"><div class="card-title">üìä Leverage Overview</div>';
  h+='<div class="grid g3"><div class="card" style="text-align:center"><div class="stat-sm">Avg Funding</div><div class="stat-big mono">'+(fn.avg_funding||0).toFixed(4)+'%</div></div>';
  h+='<div class="card" style="text-align:center"><div class="stat-sm">Sentiment</div><div class="stat-big">'+(fn.leverage_sentiment||'-')+'</div></div>';
  h+='<div class="card" style="text-align:center"><div class="stat-sm">Long / Short</div><div class="stat-big"><span class="up">'+(fn.positive_count||0)+'</span> / <span class="dn">'+(fn.negative_count||0)+'</span></div></div></div></div>';
  h+='<div class="grid g2">';
  h+='<div class="card"><div class="card-title">üìà Most Longed</div>';
  if(fn.most_longed&&fn.most_longed.length){
    h+='<table><thead><tr><th>Symbol</th><th style="text-align:right">Funding</th><th style="text-align:right">Annual</th><th style="text-align:right">Basis</th></tr></thead><tbody>';
    fn.most_longed.forEach(function(p){h+='<tr><td class="mono"><strong>'+p.symbol+'</strong></td><td style="text-align:right" class="mono up">'+p.funding_rate.toFixed(4)+'%</td><td style="text-align:right" class="mono up">'+p.annualized.toFixed(1)+'%</td><td style="text-align:right" class="mono">'+p.basis_bps+'</td></tr>';});
    h+='</tbody></table>';} else {h+='<div style="color:var(--t3);padding:20px;text-align:center">Loading funding data...</div>';}
  h+='</div>';
  h+='<div class="card"><div class="card-title">üìâ Most Shorted</div>';
  if(fn.most_shorted&&fn.most_shorted.length){
    h+='<table><thead><tr><th>Symbol</th><th style="text-align:right">Funding</th><th style="text-align:right">Annual</th><th style="text-align:right">Basis</th></tr></thead><tbody>';
    fn.most_shorted.forEach(function(p){h+='<tr><td class="mono"><strong>'+p.symbol+'</strong></td><td style="text-align:right" class="mono dn">'+p.funding_rate.toFixed(4)+'%</td><td style="text-align:right" class="mono dn">'+p.annualized.toFixed(1)+'%</td><td style="text-align:right" class="mono">'+p.basis_bps+'</td></tr>';});
    h+='</tbody></table>';} else {h+='<div style="color:var(--t3);padding:20px;text-align:center">Loading...</div>';}
  h+='</div></div>';
  // Full table
  if(fn.top_funding&&fn.top_funding.length){
    h+='<div class="card" style="margin-top:12px"><div class="card-title">All Funding (Top 20)</div>';
    h+='<table><thead><tr><th>Symbol</th><th style="text-align:right">8H Rate</th><th style="text-align:right">Annual</th><th style="text-align:right">Mark</th><th style="text-align:right">Basis</th></tr></thead><tbody>';
    fn.top_funding.forEach(function(p){
      h+='<tr><td class="mono"><strong>'+p.symbol+'</strong></td>';
      h+='<td style="text-align:right" class="mono '+cl(p.funding_rate)+'">'+p.funding_rate.toFixed(4)+'%</td>';
      h+='<td style="text-align:right" class="mono '+cl(p.annualized)+'">'+p.annualized.toFixed(1)+'%</td>';
      h+='<td style="text-align:right" class="mono">$'+p.mark_price.toLocaleString()+'</td>';
      h+='<td style="text-align:right" class="mono">'+p.basis_bps+'</td></tr>';});
    h+='</tbody></table></div>';}
  // Open Interest
  const oi=D.open_interest||{};
  if(oi.open_interest&&oi.open_interest.length){
    h+='<div class="card" style="margin-top:12px"><div class="card-title">üìä Open Interest</div>';
    h+='<table><thead><tr><th>Symbol</th><th style="text-align:right">OI (contracts)</th></tr></thead><tbody>';
    oi.open_interest.forEach(function(o){h+='<tr><td class="mono"><strong>'+o.symbol+'</strong></td><td style="text-align:right" class="mono">'+o.open_interest.toLocaleString()+'</td></tr>';});
    h+='</tbody></table></div>';}
  h+='</div>';

  // ‚ïê‚ïê SENTIMENT ‚ïê‚ïê
  h+='<div class="pane" id="pane-sentiment">';
  h+='<div class="card"><div class="card-title">üß† Fear & Greed History</div>';
  if(fg.history&&fg.history.length){
    h+='<table><thead><tr><th>Date</th><th>Value</th><th>Label</th></tr></thead><tbody>';
    fg.history.forEach(function(e){
      const c=e.value<25?'dn':e.value<45?'nt':e.value>75?'up':'';
      h+='<tr><td class="mono">'+e.date+'</td><td class="mono '+c+'">'+e.value+'</td><td>'+e.label+'</td></tr>';});
    h+='</tbody></table>';} else {h+='<div style="color:var(--t3);padding:20px;text-align:center">Loading sentiment history...</div>';}
  h+='</div></div>';

  // ‚ïê‚ïê GLOBAL ‚ïê‚ïê
  h+='<div class="pane" id="pane-global">';
  h+='<div class="card"><div class="card-title">üåç Global Market</div>';
  h+='<div class="grid g3">';
  h+='<div class="card" style="text-align:center"><div class="stat-sm">Total MCap</div><div class="stat-big">'+(gl.total_mcap_fmt||'-')+'</div></div>';
  h+='<div class="card" style="text-align:center"><div class="stat-sm">24h Volume</div><div class="stat-big">'+(gl.total_volume_fmt||'-')+'</div></div>';
  h+='<div class="card" style="text-align:center"><div class="stat-sm">Active Coins</div><div class="stat-big">'+(gl.active_coins||'-')+'</div></div>';
  h+='</div></div>';
  const cmc=D.cmc_movers||{};
  if(cmc.top_gainers&&cmc.top_gainers.length){
    h+='<div class="grid g2" style="margin-top:12px">';
    h+='<div class="card"><div class="card-title">üöÄ Top Gainers (24h)</div><table><thead><tr><th>Symbol</th><th style="text-align:right">Price</th><th style="text-align:right">24h</th></tr></thead><tbody>';
    cmc.top_gainers.forEach(function(c){h+='<tr><td class="mono"><strong>'+c.symbol+'</strong></td><td style="text-align:right" class="mono">$'+c.price+'</td><td style="text-align:right" class="mono up">'+pct(c.change_24h)+'</td></tr>';});
    h+='</tbody></table></div>';
    h+='<div class="card"><div class="card-title">üìâ Top Losers (24h)</div><table><thead><tr><th>Symbol</th><th style="text-align:right">Price</th><th style="text-align:right">24h</th></tr></thead><tbody>';
    (cmc.top_losers||[]).forEach(function(c){h+='<tr><td class="mono"><strong>'+c.symbol+'</strong></td><td style="text-align:right" class="mono">$'+c.price+'</td><td style="text-align:right" class="mono dn">'+pct(c.change_24h)+'</td></tr>';});
    h+='</tbody></table></div></div>';}
  h+='</div>';

  // ‚ïê‚ïê ON-CHAIN ‚ïê‚ïê
  h+='<div class="pane" id="pane-onchain">';
  const btc=D.btc_onchain||{};
  h+='<div class="card"><div class="card-title">‚õìÔ∏è BTC On-Chain Metrics</div>';
  if(btc.metrics){
    h+='<table><thead><tr><th>Metric</th><th style="text-align:right">Value</th><th>Unit</th></tr></thead><tbody>';
    Object.entries(btc.metrics).forEach(function([k,v]){h+='<tr><td>'+(v.name||k)+'</td><td style="text-align:right" class="mono">'+(typeof v.value==='number'?v.value.toLocaleString():v.value)+'</td><td style="color:var(--t3)">'+(v.unit||'')+'</td></tr>';});
    h+='</tbody></table>';} else {h+='<div style="color:var(--t3);padding:20px;text-align:center">Loading on-chain data...</div>';}
  h+='</div>';
  // Whale txns
  if(whales.large_txs&&whales.large_txs.length){
    h+='<div class="card" style="margin-top:12px"><div class="card-title">üêã Large BTC Transactions (100+ BTC)</div>';
    h+='<table><thead><tr><th>TX Hash</th><th style="text-align:right">BTC</th><th style="text-align:right">Est. USD</th><th>Inputs</th><th>Outputs</th></tr></thead><tbody>';
    whales.large_txs.forEach(function(t){h+='<tr><td class="mono">'+t.hash+'</td><td style="text-align:right" class="mono">'+t.btc_amount+'</td><td style="text-align:right" class="mono">'+t.usd_est+'</td><td class="mono">'+t.inputs+'</td><td class="mono">'+t.outputs+'</td></tr>';});
    h+='</tbody></table></div>';}
  h+='</div>';

  // ‚ïê‚ïê DEX ‚ïê‚ïê
  h+='<div class="pane" id="pane-dex">';
  const dx=D.dex||{};
  h+='<div class="card"><div class="card-title">üîÑ DEX Volume: '+(dx.total_24h_fmt||'-')+' (24h)</div>';
  if(dx.top_dexes&&dx.top_dexes.length){
    h+='<table><thead><tr><th>DEX</th><th style="text-align:right">24h Volume</th><th style="text-align:right">1D Chg</th></tr></thead><tbody>';
    dx.top_dexes.forEach(function(d){h+='<tr><td><strong>'+d.name+'</strong></td><td style="text-align:right" class="mono">'+d.volume_fmt+'</td><td style="text-align:right" class="mono '+cl(d.change_1d)+'">'+pct(d.change_1d)+'</td></tr>';});
    h+='</tbody></table>';} else {h+='<div style="color:var(--t3);padding:20px;text-align:center">Loading DEX data...</div>';}
  h+='</div></div>';

  // ‚ïê‚ïê YIELDS ‚ïê‚ïê
  h+='<div class="pane" id="pane-yields">';
  const yd=D.yields||{};
  h+='<div class="card"><div class="card-title">üíé Top DeFi Yields (TVL > $1M)</div>';
  if(yd.top_yields&&yd.top_yields.length){
    h+='<table><thead><tr><th>Project</th><th>Chain</th><th>Asset</th><th style="text-align:right">APY</th><th style="text-align:right">TVL</th><th>Stable</th></tr></thead><tbody>';
    yd.top_yields.forEach(function(y){h+='<tr><td><strong>'+y.project+'</strong></td><td style="font-size:10px;color:var(--t3)">'+y.chain+'</td><td class="mono">'+y.symbol+'</td><td style="text-align:right" class="mono up">'+y.apy.toFixed(1)+'%</td><td style="text-align:right" class="mono">'+y.tvl_fmt+'</td><td>'+(y.stablecoin?'‚úÖ':'')+'</td></tr>';});
    h+='</tbody></table>';} else {h+='<div style="color:var(--t3);padding:20px;text-align:center">Loading yield data...</div>';}
  h+='</div></div>';

  document.getElementById('main').innerHTML=h;
}catch(e){console.error(e);document.getElementById('main').innerHTML='<div class="loading" style="color:var(--red)">Render error: '+e.message+'</div>';}
}

function loadData(){fetch(DU+"?t="+Date.now(),{cache:"no-store"}).then(function(r){if(!r.ok)throw new Error("HTTP "+r.status);return r.json()}).then(function(d){D=d;render()}).catch(function(e){console.error(e);document.getElementById('main').innerHTML='<div class="loading" style="color:var(--red)">Failed to load: '+e.message+'<br><br>URL: '+DU+'</div>'})}
loadData();setInterval(loadData,300000);
</script>
</body>
</html>
